<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>JS删除两个数组的相同元素</title>
      <link href="/2020/07/23/js-shan-chu-liang-ge-shu-zu-de-xiang-tong-yuan-su/"/>
      <url>/2020/07/23/js-shan-chu-liang-ge-shu-zu-de-xiang-tong-yuan-su/</url>
      
        <content type="html"><![CDATA[<h2 id="案例1"><a href="#案例1" class="headerlink" title="案例1:"></a>案例1:</h2><p>  如何arr2的数组内容和arr1的id值进行去重</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span>                <span class="token punctuation">{</span>                    id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>                    value<span class="token punctuation">:</span> <span class="token string">'value1'</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span>                    id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>                    value<span class="token punctuation">:</span> <span class="token string">'value2'</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span>                    id<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>                    value<span class="token punctuation">:</span> <span class="token string">'value'</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">{</span>                    id<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>                    value<span class="token punctuation">:</span> <span class="token string">'value6'</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span>            <span class="token punctuation">]</span>  <span class="token keyword">var</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span></code></pre><p>解法：</p><pre class=" language-js"><code class="language-js">  arr1 <span class="token operator">=</span> arr1<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">return</span> arr2<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日常总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端开发技巧</title>
      <link href="/2020/07/11/qian-duan-kai-fa-ji-qiao/"/>
      <url>/2020/07/11/qian-duan-kai-fa-ji-qiao/</url>
      
        <content type="html"><![CDATA[<blockquote><p>作者：乐天派的普通人<br>链接：<a href="https://www.jianshu.com/p/f2a934d48a64" target="_blank" rel="noopener">https://www.jianshu.com/p/f2a934d48a64</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote><blockquote><p>Vue文章部分引用于：<a href="https://www.jianshu.com/p/baedcedc3191" target="_blank" rel="noopener">https://www.jianshu.com/p/baedcedc3191</a></p><p>css文章部分引用于：<a href="https://segmentfault.com/a/1190000020899202" target="_blank" rel="noopener">https://segmentfault.com/a/1190000020899202</a></p></blockquote><h2 id="JavaScript-篇"><a href="#JavaScript-篇" class="headerlink" title="JavaScript 篇"></a>JavaScript 篇</h2><h3 id="1-格式化金钱"><a href="#1-格式化金钱" class="headerlink" title="1.格式化金钱"></a>1.格式化金钱</h3><pre class=" language-dart"><code class="language-dart"><span class="token keyword">const</span> ThousandNum <span class="token operator">=</span> num <span class="token operator">=</span><span class="token operator">></span> num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token function">B</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">=</span><span class="token punctuation">(</span>\d<span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">!</span>\d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> money <span class="token operator">=</span> <span class="token function">ThousandNum</span><span class="token punctuation">(</span><span class="token number">20190214</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// money => "20,190,214"</span></code></pre><h3 id="2-取整"><a href="#2-取整" class="headerlink" title="2.取整"></a>2.取整</h3><p>代替正数的 <code>Math.floor()</code>，代替负数的 <code>Math.ceil()</code></p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">const</span> num1 <span class="token operator">=</span> <span class="token operator">~</span><span class="token operator">~</span> <span class="token number">1.69</span><span class="token punctuation">;</span><span class="token keyword">const</span> num2 <span class="token operator">=</span> <span class="token number">1.69</span> <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">const</span> num3 <span class="token operator">=</span> <span class="token number">1.69</span> <span class="token operator">>></span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// num1 num2 num3 => 1 1 1</span></code></pre><h3 id="3-转数值"><a href="#3-转数值" class="headerlink" title="3.转数值"></a>3.转数值</h3><p>只对 <code>null</code> 、<code>&quot;&quot;</code> 、<code>false</code> 、<code>数值字符串</code> 有效</p><pre class=" language-csharp"><code class="language-csharp"><span class="token keyword">const</span> num1 <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">const</span> num2 <span class="token operator">=</span> <span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">;</span><span class="token keyword">const</span> num3 <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">false</span><span class="token punctuation">;</span><span class="token keyword">const</span> num4 <span class="token operator">=</span> <span class="token operator">+</span><span class="token string">"169"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// num1 num2 num3 num4 => 0 0 0 169</span></code></pre><h3 id="4-精确小数"><a href="#4-精确小数" class="headerlink" title="4.精确小数"></a>4.精确小数</h3><pre class=" language-dart"><code class="language-dart"><span class="token keyword">const</span> RoundNum <span class="token operator">=</span> <span class="token punctuation">(</span>num<span class="token punctuation">,</span> decimal<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>num <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">*</span><span class="token operator">*</span> decimal<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">*</span><span class="token operator">*</span> decimal<span class="token punctuation">;</span><span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">RoundNum</span><span class="token punctuation">(</span><span class="token number">1.69</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// num => 1.7</span></code></pre><h3 id="5-取最小最大值"><a href="#5-取最小最大值" class="headerlink" title="5.取最小最大值"></a>5.取最小最大值</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// min max => 0 2</span></code></pre><h3 id="6-判断数据类型"><a href="#6-判断数据类型" class="headerlink" title="6.判断数据类型"></a>6.判断数据类型</h3><pre class=" language-tsx"><code class="language-tsx">function DataType(tgt, type) {    const dataType = Object.prototype.toString.call(tgt).replace(/\[object (\w+)\]/, "$1").toLowerCase();    return type ? dataType === type : dataType;}DataType("young"); // "string"DataType(20190214); // "number"DataType(true); // "boolean"DataType([], "array"); // trueDataType({}, "array"); // false</code></pre><h3 id="7-是否为空对象"><a href="#7-是否为空对象" class="headerlink" title="7.是否为空对象"></a>7.是否为空对象</h3><pre class=" language-dart"><code class="language-dart"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> flag <span class="token operator">=</span> <span class="token function">DataType</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">"object"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// flag => true</span></code></pre><h3 id="8-克隆数组"><a href="#8-克隆数组" class="headerlink" title="8.克隆数组"></a>8.克隆数组</h3><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">const</span> _arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>_arr<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// arr => [0, 1, 2]</span></code></pre><h3 id="9-合并数组"><a href="#9-合并数组" class="headerlink" title="9.合并数组"></a>9.合并数组</h3><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>arr1<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>arr2<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// arr => [0, 1, 2, 3, 4, 5];</span></code></pre><h3 id="10-去重数组"><a href="#10-去重数组" class="headerlink" title="10.去重数组"></a>10.去重数组</h3><pre class=" language-dart"><code class="language-dart"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// arr => [0, 1, null]</span></code></pre><h3 id="11-截断数组"><a href="#11-截断数组" class="headerlink" title="11.截断数组"></a>11.截断数组</h3><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// arr => [0, 1]</span></code></pre><h3 id="12-交换赋值"><a href="#12-交换赋值" class="headerlink" title="12.交换赋值"></a>12.交换赋值</h3><pre class=" language-csharp"><code class="language-csharp"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>b<span class="token punctuation">,</span> a<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// a b => 1 0</span></code></pre><h3 id="13-创建指定长度且值相等的数组"><a href="#13-创建指定长度且值相等的数组" class="headerlink" title="13.创建指定长度且值相等的数组"></a>13.创建指定长度且值相等的数组</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// arr => [0, 0, 0]</span></code></pre><h3 id="14-克隆对象"><a href="#14-克隆对象" class="headerlink" title="14.克隆对象"></a>14.克隆对象</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> _obj <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 以下方法任选一种</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>_obj <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> obj <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>_obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// obj => { a: 0, b: 1, c: 2 }</span></code></pre><h3 id="15-合并对象"><a href="#15-合并对象" class="headerlink" title="15.合并对象"></a>15.合并对象</h3><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span> c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> d<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> e<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>obj1<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>obj2 <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// obj => { a: 0, b: 1, c: 3, d: 4, e: 5 }</span></code></pre><h3 id="16-创建纯空对象"><a href="#16-创建纯空对象" class="headerlink" title="16.创建纯空对象"></a>16.创建纯空对象</h3><pre class=" language-dart"><code class="language-dart"><span class="token keyword">const</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// obj => {}</span></code></pre><h3 id="17-优雅处理-Async-Await-参数"><a href="#17-优雅处理-Async-Await-参数" class="headerlink" title="17.优雅处理 Async/Await 参数"></a>17.优雅处理 Async/Await 参数</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">AsyncTo</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>err<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token punctuation">[</span>err<span class="token punctuation">,</span> res<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">AsyncTo</span><span class="token punctuation">(</span><span class="token function">Func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="Vue-篇"><a href="#Vue-篇" class="headerlink" title="Vue 篇"></a>Vue 篇</h2><h3 id="1-路由懒加载"><a href="#1-路由懒加载" class="headerlink" title="1.路由懒加载"></a>1.路由懒加载</h3><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'vue-router'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  routes<span class="token punctuation">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      path<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>      component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="2-页面需要导入多个组件"><a href="#2-页面需要导入多个组件" class="headerlink" title="2.页面需要导入多个组件"></a>2.页面需要导入多个组件</h3><p>原来的写法</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> titleCom <span class="token keyword">from</span> <span class="token string">'@/components/home/titleCom'</span><span class="token keyword">import</span> bannerCom <span class="token keyword">from</span> <span class="token string">'@/components/home/bannerCom'</span><span class="token keyword">import</span> cellCom <span class="token keyword">from</span> <span class="token string">'@/components/home/cellCom'</span>components<span class="token punctuation">:</span><span class="token punctuation">{</span>titleCom<span class="token punctuation">,</span>bannerCom<span class="token punctuation">,</span>cellCom<span class="token punctuation">}</span></code></pre><p>利用 require.context 可以写成</p><pre class=" language-php"><code class="language-php"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'@/components/home'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token operator">/</span>\<span class="token punctuation">.</span>vue$<span class="token operator">/</span><span class="token punctuation">)</span><span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>files<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> name <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">)</span>  modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">files</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span> <span class="token operator">||</span> <span class="token function">files</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>components<span class="token punctuation">:</span>modules</code></pre><p>API 说明</p><blockquote><p>实际上是 webpack 的方法,vue 工程一般基于 webpack,所以可以使用<br> <code>require.context(directory,useSubdirectories,regExp)</code> &gt;<br>接收三个参数:</p><p><code>directory</code>：说明需要检索的目录</p><p><code>useSubdirectories</code>：是否检索子目录</p><p><code>regExp</code>: 匹配文件的正则表达式,一般是文件名</p></blockquote><h3 id="3-动态组件"><a href="#3-动态组件" class="headerlink" title="3.动态组件"></a>3.动态组件</h3><p>做一个 tab 切换时就会涉及到组件动态加载</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>currentTabComponent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span></code></pre><p>但是这样每次组件都会重新加载,会消耗大量性能,所以 <code>&lt;keep-alive&gt;</code> 就起到了作用</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>currentTabComponent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span></code></pre><p>这样切换效果没有动画效果,这个也不用着急,可以利用内置的 <code>&lt;transition&gt;</code></p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>currentTabComponent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span></code></pre><h3 id="4-mixins"><a href="#4-mixins" class="headerlink" title="4.mixins"></a>4.mixins</h3><p>有些组件有些重复的 js 逻辑,如校验手机验证码,解析时间等,mixins 就可以实现这种混入</p><pre class=" language-dart"><code class="language-dart"><span class="token keyword">const</span> mixin<span class="token operator">=</span><span class="token punctuation">{</span>    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dealTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token function">dealTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是mixin的dealTime里面的方法'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>  mixins<span class="token punctuation">:</span><span class="token punctuation">[</span>mixin<span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h3 id="5-为路径设置别名"><a href="#5-为路径设置别名" class="headerlink" title="5.为路径设置别名"></a>5.为路径设置别名</h3><p>在开发过程中，我们经常需要引入各种文件，如图片、CSS、JS 等，为了避免写很长的相对路径（../），我们可以为不同的目录配置一个别名</p><pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// vue-cli 2.x 配置</span><span class="token comment" spellcheck="true">// 在 webpack.base.config.js中的 resolve 配置项，在其 alias 中增加别名</span>resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token string">'vue$'</span><span class="token punctuation">:</span> <span class="token string">'vue/dist/vue.esm.js'</span><span class="token punctuation">,</span>      <span class="token string">'@'</span><span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// vue-cli 3.x 配置</span><span class="token comment" spellcheck="true">// 在根目录下创建vue.config.js</span><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token keyword">function</span> resolve <span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  chainWebpack<span class="token punctuation">:</span> config <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias      <span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// key,value自行定义，比如.set('@@', resolve('src/components'))</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="6-img-加载失败"><a href="#6-img-加载失败" class="headerlink" title="6.img 加载失败"></a>6.img 加载失败</h3><p>有些时候后台返回图片地址不一定能打开,所以这个时候应该加一张默认图片</p><pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// page 代码</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>imgUrl<span class="token punctuation">"</span></span> <span class="token attr-name">@error</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleError<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span><span class="token punctuation">{</span>      imgUrl<span class="token punctuation">:</span><span class="token string">''</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span><span class="token punctuation">{</span>    <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>      e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token function">reqiure</span><span class="token punctuation">(</span><span class="token string">'图片路径'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="7-页面统一判断"><a href="#7-页面统一判断" class="headerlink" title="7.页面统一判断"></a>7.页面统一判断</h3><p>在开发中经常会遇到权限判断的问题，我们又不可能在每一个页面的生命周期中去判断一下，那样太消耗时间了，处理方式：</p><pre class=" language-jsx"><code class="language-jsx">router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  myAccess<span class="token punctuation">.</span><span class="token function">checkhaveAccess</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/forbid'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="8-路由的项目启动页和-404-页面"><a href="#8-路由的项目启动页和-404-页面" class="headerlink" title="8.路由的项目启动页和 404 页面"></a>8.路由的项目启动页和 404 页面</h3><p>404 页面指的是: 当进入一个没有 声明/没有匹配 的路由页面时就会跳转到 404 页面</p><pre class=" language-css"><code class="language-css"><span class="token selector">export default new Router(</span><span class="token punctuation">{</span>  <span class="token selector">routes: [    </span><span class="token punctuation">{</span>      <span class="token property">path</span><span class="token punctuation">:</span> <span class="token string">'/'</span>, // 项目启动页      <span class="token property">redirect</span><span class="token punctuation">:</span><span class="token string">'/login'</span>  // 重定向到下方声明的路由    <span class="token punctuation">}</span><span class="token selector">,    </span><span class="token punctuation">{</span>      <span class="token property">path</span><span class="token punctuation">:</span> <span class="token string">'*'</span>, // <span class="token number">404</span> 页面      <span class="token property">component</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> => <span class="token function">import</span><span class="token punctuation">(</span><span class="token string">'./notfind'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>,  ]<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="9-js适配经验："><a href="#9-js适配经验：" class="headerlink" title="9.js适配经验："></a>9.js适配经验：</h3><p>我们在写代码的时候，很有可能写到这种代码：</p><pre class=" language-css"><code class="language-css">[<span class="token number">1</span>,<span class="token number">2</span>,<span class="token number">3</span>,<span class="token number">4</span>,<span class="token number">5</span>]<span class="token number">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></code></pre><p>或者是使用<code>promise</code>等es6的方法，但是我们的需求是在Android4.4上面完美运行。这样就会出现<code>includes is not undefied</code>等错误提示。如果看了我之前谈到<a href="">webpack</a>的文章就会疑问：我们之前不是用了<code>babel</code>插件用来转成es5了呢？我当时也疑问了好久，直到我在webpack里面找到一个插件，具体的使用方法：</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token string">"babel-polyfill"</span><span class="token keyword">import</span> es6Promise <span class="token keyword">from</span> <span class="token string">'es6-promise'</span>es6Promise<span class="token punctuation">.</span><span class="token function">polyfill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'es6-promise'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">polyfill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// webpack配置文件处</span>  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>    app<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'babel-polyfill'</span><span class="token punctuation">,</span> <span class="token string">'./src/main.js'</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><h3 id="10-页面统一判断"><a href="#10-页面统一判断" class="headerlink" title="10. 页面统一判断"></a>10. 页面统一判断</h3><p>在开发中经常会遇到权限判断的问题，我们又不可能在每一个页面的生命周期中去判断一下，那样太消耗时间了，我的处理：</p><pre class=" language-jsx"><code class="language-jsx">router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  myAccess<span class="token punctuation">.</span><span class="token function">checkhaveAccess</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/forbid'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="11-事件的传递："><a href="#11-事件的传递：" class="headerlink" title="11. 事件的传递："></a>11. 事件的传递：</h3><p>一般来说事件的传递有很多种，比如父子之间传递数据就可以直接用<code>props</code>，和<code>emit</code>来做关联。<br> 父组件给子组件传递</p><pre class=" language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// 父组件</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child</span> <span class="token attr-name">:datas</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        content<span class="token punctuation">:</span><span class="token string">'sichaoyun'</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 子组件</span>props<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">"datas"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 或者是 </span>props<span class="token punctuation">:</span> <span class="token punctuation">{</span> datas<span class="token punctuation">:</span> String<span class="token punctuation">}</span></code></pre><p>子组件给父组件传递</p><pre class=" language-kotlin"><code class="language-kotlin"><span class="token comment" spellcheck="true">// 子组件</span><span class="token operator">&lt;</span>template<span class="token operator">></span>    <span class="token operator">&lt;</span>div <span class="token label symbol">@click</span><span class="token operator">=</span><span class="token string">"open"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>methods<span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'showbox'</span><span class="token punctuation">,</span><span class="token string">'the msg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//触发showbox方法，'the msg'为向父组件传递的数据</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 父组件</span><span class="token operator">&lt;</span>child <span class="token label symbol">@showbox</span><span class="token operator">=</span><span class="token string">"toshow"</span> <span class="token operator">:</span>msg<span class="token operator">=</span><span class="token string">"msg"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">></span> <span class="token comment" spellcheck="true">//监听子组件触发的showbox事件,然后调用toshow方法</span>methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">toshow</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="12、-深度watch与watch立即触发回调"><a href="#12、-深度watch与watch立即触发回调" class="headerlink" title="12、 深度watch与watch立即触发回调"></a>12、 深度watch与watch立即触发回调</h3><p>这个是我偶尔在vuejs官网上面发现的，watch有两个可选参数，但是好像版本有限制，具体请移步官方文档。查看版本信息<br> <strong>选项：deep</strong><br> 在选项参数中指定 deep: true，可以监听对象中属性的变化。<br> <strong>选项：immediate</strong><br> 在选项参数中指定 immediate: true, 将立即以表达式的当前值触发回调，也就是默认触发一次。</p><h3 id="13、-路由的项目启动页和404页面"><a href="#13、-路由的项目启动页和404页面" class="headerlink" title="13、 路由的项目启动页和404页面"></a>13、 路由的项目启动页和404页面</h3><pre class=" language-css"><code class="language-css">  <span class="token selector">export default new Router(</span><span class="token punctuation">{</span>      <span class="token selector">routes: [        </span><span class="token punctuation">{</span>          <span class="token property">path</span><span class="token punctuation">:</span> <span class="token string">'/'</span>, // 项目启动页          <span class="token property">redirect</span><span class="token punctuation">:</span><span class="token string">'/login'</span>  // 重定向到下方声明的路由         <span class="token punctuation">}</span><span class="token selector">,        </span><span class="token punctuation">{</span>          <span class="token property">path</span><span class="token punctuation">:</span> <span class="token string">'*'</span>, // <span class="token number">404</span> 页面           <span class="token property">component</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> => <span class="token function">import</span><span class="token punctuation">(</span><span class="token string">'./notfind'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>,      ]    <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>比如你的域名为:<code>www.baidu.com</code></p><p>项目启动页指的是: 当你进入<code>www.baidu.com</code>，会自动跳转到login登录页。</p><p>404页面指的是: 当进入一个没有 声明/没有匹配 的路由页面时就会跳转到404页面。</p><p>比如进入<code>www.baidu.com/testRouter</code>,就会自动跳转到notFind页面。</p><p>当你没有声明一个404页面，进入<code>www.baidu.com/testRouter</code>，显示的页面是一片空白。</p><h2 id="CSS-篇"><a href="#CSS-篇" class="headerlink" title="CSS 篇"></a>CSS 篇</h2><h3 id="1-使用-text-align-last-对齐两端文本"><a href="#1-使用-text-align-last-对齐两端文本" class="headerlink" title="1.使用 text-align-last 对齐两端文本"></a>1.使用 text-align-last 对齐两端文本</h3><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fcodepen.io%2FJowayYoung%2Fpen%2FZgxZJa" target="_blank" rel="noopener">在线演示</a></p><pre class=" language-cpp"><code class="language-cpp"><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bruce flex-ct-x"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"justify-text"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>li<span class="token operator">></span>账号<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>        <span class="token operator">&lt;</span>li<span class="token operator">></span>密码<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>        <span class="token operator">&lt;</span>li<span class="token operator">></span>电子邮件<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>        <span class="token operator">&lt;</span>li<span class="token operator">></span>通讯地址<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">.</span>justify<span class="token operator">-</span>text <span class="token punctuation">{</span>    li <span class="token punctuation">{</span>        margin<span class="token operator">-</span>top<span class="token operator">:</span> 5px<span class="token punctuation">;</span>        padding<span class="token operator">:</span> <span class="token number">0</span> 20px<span class="token punctuation">;</span>        width<span class="token operator">:</span> 100px<span class="token punctuation">;</span>        height<span class="token operator">:</span> 40px<span class="token punctuation">;</span>        background<span class="token operator">-</span>color<span class="token operator">:</span> #f66<span class="token punctuation">;</span>        line<span class="token operator">-</span>height<span class="token operator">:</span> 40px<span class="token punctuation">;</span>        text<span class="token operator">-</span>align<span class="token operator">-</span>last<span class="token operator">:</span> justify<span class="token punctuation">;</span>        color<span class="token operator">:</span> #fff<span class="token punctuation">;</span>        <span class="token operator">&amp;</span><span class="token operator">:</span>first<span class="token operator">-</span>child <span class="token punctuation">{</span>            margin<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="2-使用-color-改变边框颜色"><a href="#2-使用-color-改变边框颜色" class="headerlink" title="2.使用 color 改变边框颜色"></a>2.使用 color 改变边框颜色</h3><pre><code>border` 没有定义 `border-color` 时，设置 `color` 后，`border-color` 会被定义成 `color</code></pre><p>场景：边框颜色与文字颜色相同</p><pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.elem</span> </span><span class="token punctuation">{</span>  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid<span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#f66</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="3-黑白图像"><a href="#3-黑白图像" class="headerlink" title="3.黑白图像"></a>3.黑白图像</h3><p>让你的彩色照片显示黑白照片</p><pre class=" language-css"><code class="language-css"><span class="token selector">img<span class="token class">.desaturate</span> </span><span class="token punctuation">{</span>    <span class="token property">filter</span><span class="token punctuation">:</span> <span class="token function">grayscale</span><span class="token punctuation">(</span><span class="token number">100%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">-webkit-filter</span><span class="token punctuation">:</span> <span class="token function">grayscale</span><span class="token punctuation">(</span><span class="token number">100%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">-moz-filter</span><span class="token punctuation">:</span> <span class="token function">grayscale</span><span class="token punctuation">(</span><span class="token number">100%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">-ms-filter</span><span class="token punctuation">:</span> <span class="token function">grayscale</span><span class="token punctuation">(</span><span class="token number">100%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">-o-filter</span><span class="token punctuation">:</span> <span class="token function">grayscale</span><span class="token punctuation">(</span><span class="token number">100%</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="4-将图片作为背景"><a href="#4-将图片作为背景" class="headerlink" title="4.将图片作为背景"></a>4.将图片作为背景</h3><p>当给页面添加图片时，尤其需要图片是响应式的时候，最好使用 background 属性来引入图片，而不是 <code>&lt;img&gt;</code> 标签</p><p>这看起来使用图片会更复杂，但实际上它会使设置图片的样式变得更加容易。有了 <code>background-size</code>, <code>background-position</code> 和其它的属性，保持或改变图片原始尺寸和宽高比会更方便</p><p><code>background</code> 引入图片的一个缺点是页面的 Web 可访问性会受到轻微的影响，因为屏幕阅读器和搜索引擎无法正确地获取到图像。这个问题可以通过 CSS <code>object-fit</code> 属性解决，到目前为止除了 IE 浏览器其他的浏览器都可以使用 <code>object-fit</code>。</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Img element<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://tutorialzine.com/media/2016/08/bicycle.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bicycle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Div with background image<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span></code></pre><pre class=" language-css"><code class="language-css"><span class="token selector">img </span><span class="token punctuation">{</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">300</span>px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">div </span><span class="token punctuation">{</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">300</span>px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url">url('https://tutorialzine.com/media/2016/08/bicycle.jpg')</span><span class="token punctuation">;</span>    <span class="token property">background-position</span><span class="token punctuation">:</span> center center<span class="token punctuation">;</span>    <span class="token property">background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">section</span><span class="token punctuation">{</span>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>    <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">15</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="5-保持选择器的低权重"><a href="#5-保持选择器的低权重" class="headerlink" title="5.保持选择器的低权重"></a>5.保持选择器的低权重</h3><p>css 的选择器并不都是平等的。当初学习 CSS 时，我总是认为选择器会覆盖它上面的所有内容。然而，情况并非如此</p><pre class=" language-csharp"><code class="language-csharp"><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">'#'</span> id<span class="token operator">=</span><span class="token string">'blue-btn'</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"active"</span><span class="token operator">></span>按钮<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>a<span class="token punctuation">{</span>    color<span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>    padding<span class="token punctuation">:</span> 15px<span class="token punctuation">;</span><span class="token punctuation">}</span>a#blue<span class="token operator">-</span>btn <span class="token punctuation">{</span>    background<span class="token operator">-</span>color<span class="token punctuation">:</span> blue<span class="token punctuation">;</span><span class="token punctuation">}</span>a<span class="token punctuation">.</span>active <span class="token punctuation">{</span>    background<span class="token operator">-</span>color<span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>我们希望.active类中设置的样式会生效使按钮变为红色。但是它并不会起作用，因为按钮在上面有一个ID选择器，它同样设置了background-color，ID选择器具有更高的权重，所以按钮的颜色是蓝色的</p><p>权重也会叠加，于是a#button.active的权重要比a#button的高。一开始就使用高权重的选择器会导致你在后面的维护中不断的使用更高权重的选择器</p><h3 id="6-使用rem进行全局大小调整；使用em进行局部大小调整"><a href="#6-使用rem进行全局大小调整；使用em进行局部大小调整" class="headerlink" title="6.使用rem进行全局大小调整；使用em进行局部大小调整"></a>6.使用rem进行全局大小调整；使用em进行局部大小调整</h3><p>在设置根目录的基本字体大小后，例如html字体大小：15px；，可以将包含元素的字体大小设置为rem</p><pre class=" language-css"><code class="language-css"><span class="token selector">article </span><span class="token punctuation">{</span>        <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">1.25</span>rem<span class="token punctuation">;</span>  <span class="token punctuation">}</span>    <span class="token selector">aside </span><span class="token punctuation">{</span>        <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">.9</span>rem<span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre><p>将文本元素的字体大小设置为em</p><pre class=" language-css"><code class="language-css"><span class="token selector">h2 </span><span class="token punctuation">{</span>        <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">2</span>em<span class="token punctuation">;</span>  <span class="token punctuation">}</span>    <span class="token selector">p </span><span class="token punctuation">{</span>        <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">1</span>em<span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 转载 </tag>
            
            <tag> 实用技巧 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>收集的Vue面试题</title>
      <link href="/2020/07/11/shou-ji-de-vue-mian-shi-ti/"/>
      <url>/2020/07/11/shou-ji-de-vue-mian-shi-ti/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下这些题都是我遇到过的，内容摘自网上博客</p><p>摘自知乎：<a href="https://zhuanlan.zhihu.com/p/94813362" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/94813362</a></p></blockquote><h3 id="什么是虚拟-DOM？"><a href="#什么是虚拟-DOM？" class="headerlink" title="什么是虚拟 DOM？"></a>什么是虚拟 DOM？</h3><p>文档对象模型或 DOM 定义了一个接口，该接口允许 JavaScript 之类的语言访问和操作 HTML 文档。元素由树中的节点表示，并且接口允许我们操纵它们。但是此接口需要付出代价，大量非常频繁的 DOM 操作会使页面速度变慢。</p><p>Vue 通过在内存中实现文档结构的虚拟表示来解决此问题，其中虚拟节点（VNode）表示 DOM 树中的节点。当需要操纵时，可以在虚拟 DOM的 内存中执行计算和操作，而不是在真实 DOM 上进行操纵。这自然会更快，并且允许虚拟 DOM 算法计算出最优化的方式来更新实际 DOM 结构。</p><p>一旦计算出，就将其应用于实际的 DOM 树，这就提高了性能，这就是为什么基于虚拟 DOM 的框架（例如 Vue 和 React）如此突出的原因。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript的字符串方法大全</title>
      <link href="/2020/07/10/javascript-zhong-chang-jian-de-zi-fu-chuan-fang-fa/"/>
      <url>/2020/07/10/javascript-zhong-chang-jian-de-zi-fu-chuan-fang-fa/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://blog.csdn.net/shenxianhui1995/article/details/85271352" target="_blank" rel="noopener">https://blog.csdn.net/shenxianhui1995/article/details/85271352</a></p></blockquote><table><thead><tr><th align="left">方法</th><th align="left">描述</th><th>备注</th></tr></thead><tbody><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-charat.html" target="_blank" rel="noopener">charAt()</a></td><td align="left">返回在指定位置的字符。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-charcodeat.html" target="_blank" rel="noopener">charCodeAt()</a></td><td align="left">返回在指定的位置的字符的 Unicode 编码。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-concat-string.html" target="_blank" rel="noopener">concat()</a></td><td align="left">连接两个或更多字符串，并返回新的字符串。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-fromcharcode.html" target="_blank" rel="noopener">fromCharCode()</a></td><td align="left">将 Unicode 编码转为字符。</td><td>静态方法</td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-indexof.html" target="_blank" rel="noopener">indexOf()</a></td><td align="left">返回某个指定的字符串值在字符串中首次出现的位置。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-string-includes.html" target="_blank" rel="noopener">includes()</a></td><td align="left">查找字符串中是否包含指定的子字符串。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-lastindexof.html" target="_blank" rel="noopener">lastIndexOf()</a></td><td align="left">从后向前搜索字符串，并从起始位置（0）开始计算返回字符串最后出现的位置。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-match.html" target="_blank" rel="noopener">match()</a></td><td align="left">查找找到一个或多个正则表达式的匹配。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-repeat.html" target="_blank" rel="noopener">repeat()</a></td><td align="left">复制字符串指定次数，并将它们连接在一起返回。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-replace.html" target="_blank" rel="noopener">replace()</a></td><td align="left">在字符串中查找匹配的子串， 并替换与正则表达式匹配的子串。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-search.html" target="_blank" rel="noopener">search()</a></td><td align="left">查找与正则表达式相匹配的值。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-slice-string.html" target="_blank" rel="noopener">slice()</a></td><td align="left">提取字符串的片断，并在新的字符串中返回被提取的部分。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-split.html" target="_blank" rel="noopener">split()</a></td><td align="left">把字符串分割为字符串数组。</td><td>字符串转数组</td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-startswith.html" target="_blank" rel="noopener">startsWith()</a></td><td align="left">查看字符串是否以指定的子字符串开头。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-substr.html" target="_blank" rel="noopener">substr()</a></td><td align="left">从起始索引号提取字符串中指定数目的字符。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-substring.html" target="_blank" rel="noopener">substring()</a></td><td align="left">提取字符串中两个指定的索引号之间的字符。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-tolowercase.html" target="_blank" rel="noopener">toLowerCase()</a></td><td align="left">把字符串转换为小写。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-touppercase.html" target="_blank" rel="noopener">toUpperCase()</a></td><td align="left">把字符串转换为大写。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-trim.html" target="_blank" rel="noopener">trim()</a></td><td align="left">去除字符串两边的空白</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-tolocalelowercase.html" target="_blank" rel="noopener">toLocaleLowerCase()</a></td><td align="left">根据本地主机的语言环境把字符串转换为小写。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-tolocaleuppercase.html" target="_blank" rel="noopener">toLocaleUpperCase()</a></td><td align="left">根据本地主机的语言环境把字符串转换为大写。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-valueof-string.html" target="_blank" rel="noopener">valueOf()</a></td><td align="left">返回某个字符串对象的原始值。</td><td></td></tr><tr><td align="left"><a href="https://www.runoob.com/jsref/jsref-tostring.html" target="_blank" rel="noopener">toString()</a></td><td align="left">返回一个字符串。</td><td></td></tr></tbody></table><h2 id="一-字符方法"><a href="#一-字符方法" class="headerlink" title="一. 字符方法"></a>一. 字符方法</h2><h3 id="charAt"><a href="#charAt" class="headerlink" title="charAt()"></a>charAt()</h3><ul><li><p>定义和用法<br>charAt() 方法可返回指定位置的字符<br>第一个字符位置为 0, 第二个字符位置为 1,以此类推</p></li><li><p>语法<br>string.charAt(index);<br>index 必需。表示字符串中某个位置的数字，即字符在字符串中的位置</p></li></ul><h3 id="charCodeAt"><a href="#charCodeAt" class="headerlink" title="charCodeAt()"></a>charCodeAt()</h3><ul><li><p>定义和用法<br><strong>charCodeAt()</strong> 方法可返回指定位置的字符的 Unicode 编码<br>字符串中第一个字符的位置为 0， 第二个字符位置为 1，以此类推</p></li><li><p>语法<br><strong>string.charCodeAt(index);</strong><br>index 必需。表示字符串中某个位置的数字，即字符在字符串中的下标</p></li></ul><h2 id="二-字符串操作方法"><a href="#二-字符串操作方法" class="headerlink" title="二. 字符串操作方法"></a>二. 字符串操作方法</h2><h3 id="concat"><a href="#concat" class="headerlink" title="concat()"></a>concat()</h3><ul><li>定义和用法<br>用于将一或多个字符串拼接起来, 返回拼接得到的新字符串</li><li>语法<br>string.concat(string1, string2, …, stringX);<br>string1, string2, …, stringX 必需。将被连接为一个字符串的一个或多个字符串对象</li><li>提示<br>虽然 concat() 是专门用来拼接字符串的方法, 但实践中使用更多的还是加号操作符(+). 而且, 使用加号操作符在大多数情况下都比使用 concat() 方法要简便易行(特别是在拼接多个字符串的情况下)</li></ul><h3 id="slice"><a href="#slice" class="headerlink" title="slice()"></a>slice()</h3><ul><li><p>定义和用法<br>slice(start, end) 方法可提取字符串的某个部分，并以新的字符串返回被提取的部分<br>使用 start（包含） 和 end（不包含） 参数来指定字符串提取的部分<br>字符串中第一个字符位置为 0, 第二个字符位置为 1, 以此类推</p></li><li><p>语法<br>string.slice(start, end);<br>start 必需。 要抽取的片断的起始下标。第一个字符位置为 0<br>end 可选。 紧接着要截取的片段结尾的下标。若未指定此参数，则要提取的子串包括 start 到原字符串结尾的字符串。如果该参数是负数，那么它规定的是从字符串的尾部开始算起的位置</p></li><li><p>提示<br>如果是负数，则该参数规定的是从字符串的尾部开始算起的位置。也就是说，-1 指字符串的最后一个字符，-2 指倒数第二个字符，以此类推</p></li></ul><h3 id="substr"><a href="#substr" class="headerlink" title="substr()"></a>substr()</h3><ul><li>定义和用法<br>substr() 方法可在字符串中抽取从开始下标开始的指定数目的字符</li><li>语法<br>string.substr(start, length);<br>start 必需。要抽取的子串的起始下标。必须是数值。如果是负数，那么该参数声明从字符串的尾部开始算起的位置。也就是说，-1 指字符串中最后一个字符，-2 指倒数第二个字符，以此类推<br>length 可选。子串中的字符数。必须是数值。如果省略了该参数，那么返回从 stringObject 的开始位置到结尾的字串</li></ul><h3 id="substring"><a href="#substring" class="headerlink" title="substring()"></a>substring()</h3><ul><li>定义和用法<br>substring() 方法用于提取字符串中介于两个指定下标之间的字符<br>substring() 方法返回的子串包括开始处的字符，但不包括结束处的字符</li><li>语法<br>string.substring(from, to);<br>from 必需。一个非负的整数，规定要提取的子串的第一个字符在 string Object 中的位置<br>to 可选。一个非负的整数，比要提取的子串的最后一个字符在 string Object 中的位置多 1。如果省略该参数，那么返回的子串会一直到字符串的结尾</li></ul><h2 id="三-字符串位置方法"><a href="#三-字符串位置方法" class="headerlink" title="三. 字符串位置方法"></a>三. 字符串位置方法</h2><h3 id="indexOf"><a href="#indexOf" class="headerlink" title="indexOf()"></a>indexOf()</h3><ul><li>定义和用法<br>indexOf() 方法可返回某个指定的字符串值在字符串中首次出现的位置<br>如果没有找到匹配的字符串则返回 -1</li><li>语法<br>string.indexOf(searchvalue, start);<br>searchvalue 必需。规定需检索的字符串值<br>start 可选的整数参数。规定在字符串中开始检索的位置。它的合法取值是 0 到 string Object.length - 1。如省略该参数，则将从字符串的首字符开始检索</li></ul><h3 id="lastIndexOf"><a href="#lastIndexOf" class="headerlink" title="lastIndexOf()"></a>lastIndexOf()</h3><ul><li>定义和用法<br>lastIndexOf() 方法可返回一个指定的字符串值最后出现的位置，如果指定第二个参数 start，则在一个字符串中的指定位置从后向前搜索</li><li>语法<br>string.lastIndexOf(searchvalue, start);<br>searchvalue 必需。规定需检索的字符串值<br>start 可选的整数参数。规定在字符串中开始检索的位置。它的合法取值是 0 到 stringObject.length - 1。如省略该参数，则将从字符串的最后一个字符处开始检索</li><li>注意<br>该方法将从后向前检索字符串，但返回是从起始位置 (0) 开始计算子字符串最后出现的位置。 看它是否含有字符串<br>开始检索的位置在字符串的 start 处或字符串的结尾（没有指定 start 时）<br>如果没有找到匹配字符串则返回 -1</li></ul><h2 id="四-字符串大小写转换方法"><a href="#四-字符串大小写转换方法" class="headerlink" title="四. 字符串大小写转换方法"></a>四. 字符串大小写转换方法</h2><h3 id="toLowerCase"><a href="#toLowerCase" class="headerlink" title="toLowerCase()"></a>toLowerCase()</h3><ul><li>定义和用法<br>toLowerCase() 方法用于把字符串转换为小写</li><li>语法<br>string.toLowerCase()</li></ul><h3 id="toUpperCase"><a href="#toUpperCase" class="headerlink" title="toUpperCase()"></a>toUpperCase()</h3><ul><li>定义和用法<br>toUpperCase() 方法用于把字符串转换为大写</li><li>语法<br>string.toUpperCase()</li></ul><h2 id="五-字符串的模式匹配方法"><a href="#五-字符串的模式匹配方法" class="headerlink" title="五. 字符串的模式匹配方法"></a>五. 字符串的模式匹配方法</h2><h3 id="match"><a href="#match" class="headerlink" title="match()"></a>match()</h3><ul><li><p>定义和用法<br>match() 方法可在字符串内检索指定的值，或找到一个或多个正则表达式的匹配</p></li><li><p>语法<br>string.match(regexp)<br>regexp 必需。规定要匹配的模式的 RegExp 对象。如果该参数不是 RegExp 对象，则需要首先把它传递给 RegExp 构造函数，将其转换为 RegExp 对象。</p></li><li><p>注意<br>match() 方法将检索字符串 String Object，以找到一个或多个与 regexp 匹配的文本<br>这个方法的行为在很大程度上有赖于 regexp 是否具有标志 g<br>如果 regexp 没有标志 g，那么 match() 方法就只能在 stringObject 中执行一次匹配<br>如果没有找到任何匹配的文本， match() 将返回 null<br>否则，它将返回一个数组，其中存放了与它找到的匹配文本有关的信息</p></li></ul><h3 id="search"><a href="#search" class="headerlink" title="search()"></a>search()</h3><ul><li>定义和用法<br>search() 方法返回字符串中第一个匹配项的索引; 如果没有找到匹配项, 则返回 -1<br>search() 方法始终是从字符串开头向后查找模式</li><li>语法<br>string.search(searchvalue)<br>searchvalue 必需。查找的字符串或者正则表达式</li></ul><h3 id="replace"><a href="#replace" class="headerlink" title="replace()"></a>replace()</h3><ul><li>定义和用法<br>replace() 方法用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串<br>该方法不会改变原始字符串</li><li>语法<br>string.replace(searchvalue,newvalue)<br>searchvalue 必需。规定子字符串或要替换的模式的 RegExp 对象。<br>请注意，如果该值是一个字符串，则将它作为要检索的直接量文本模式，而不是首先被转换为 RegExp 对象<br>newvalue 必需。一个字符串值。规定了替换文本或生成替换文本的函数</li></ul><h3 id="split"><a href="#split" class="headerlink" title="split()"></a>split()</h3><ul><li><p>定义和用法<br>split() 方法用于把一个字符串分割成字符串数组</p></li><li><p>语法<br>string.split(separator,limit)<br>separator 可选。字符串或正则表达式，从该参数指定的地方分割 stringObject<br>limit 可选。该参数可指定返回的数组的最大长度。如果设置了该参数，返回的子串不会多于这个参数指定的数组。如果没有设置该参数，整个字符串都会被分割，不考虑它的长度</p></li><li><p>提示<br>如果把空字符串 (“”) 用作 separator，那么 stringObject 中的每个字符之间都会被分割</p></li><li><p>注意<br>split() 方法不改变原始字符串</p></li></ul><h2 id="六-其他"><a href="#六-其他" class="headerlink" title="六. 其他"></a>六. 其他</h2><h3 id="trim"><a href="#trim" class="headerlink" title="trim()"></a>trim()</h3><ul><li><p>定义和用法<br>trim() 方法会创建一个字符串的副本, 删除前置及后缀的所有空格, 然后返回结果</p></li><li><p>语法<br>string.trim();</p></li><li><p>注意</p></li><li><p>实例</p></li></ul><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> stringValue <span class="token operator">=</span> <span class="token string">"    hello world    "</span><span class="token punctuation">;</span>stringValue<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "hello world"</span></code></pre><h3 id="localeCompare"><a href="#localeCompare" class="headerlink" title="localeCompare()"></a>localeCompare()</h3><ul><li><p>定义和用法<br>从前到后依次比较两个字符串并返回下列值中的一个:</p></li><li><p>如果字符串在字母表中应该排在字符串参数之前, 则返回一个负数 (大多数情况下是 -1)<br>如果字符串等于字符串参数, 则返回 0<br>如果字符串在字母表中应该排在字符串参数之后, 则返回一个正数 (大多数情况下是 1)<br>语法<br>stringObject.localeCompare(target)<br>target 要以本地特定的顺序与 stringObject 进行比较的字符串</p></li><li><p>注意<br>localeCompare() 区分大小写, 同字母小写在前, 大写在后</p></li><li><p>实例</p></li></ul><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> stringValue <span class="token operator">=</span> <span class="token string">"bcd"</span><span class="token punctuation">;</span>stringValue<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 1</span>stringValue<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">"bc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 1</span>stringValue<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">"bcd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 0</span>stringValue<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">"bcde"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// -1</span>stringValue<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">"cd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// -1</span>stringValue<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">"Bcd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// -1</span></code></pre><h3 id="formCharCode"><a href="#formCharCode" class="headerlink" title="formCharCode()"></a>formCharCode()</h3><ul><li><p>定义和用法<br>fromCharCode() 可接受一个指定的 Unicode 值，然后返回一个字符串<br>从本质来看, 这个方法与 charCodeAt() 执行的是相反的操作</p></li><li><p>语法<br>String.fromCharCode(numX, numX, …, numX)<br>numX 必需。一个或多个 Unicode 值，即要创建的字符串中的字符的 Unicode 编码</p></li><li><p>注意<br>该方法是 String 的静态方法，字符串中的每个字符都由单独的数字 Unicode 编码指定<br>它不能作为您已创建的 String 对象的方法来使用<br>因此它的语法应该是 String.fromCharCode()，而不是 myStringObject.fromCharCode()</p></li><li><p>实例</p></li></ul><pre class=" language-js"><code class="language-js">String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "hello"</span></code></pre><h3 id="valueOf-NaN"><a href="#valueOf-NaN" class="headerlink" title="valueOf()"></a>valueOf()</h3><ul><li><p>定义和用法<br>valueOf() 方法可返回 String 对象的原始值</p></li><li><p>语法<br>string.valueOf()</p></li><li><p>注意<br>valueOf() 方法通常由 JavaScript 在后台自动进行调用，而不是显式地处于代码中</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript数据方法大全</title>
      <link href="/2020/07/10/javascript-shu-ju-de-fang-fa-da-quan/"/>
      <url>/2020/07/10/javascript-shu-ju-de-fang-fa-da-quan/</url>
      
        <content type="html"><![CDATA[<blockquote><p>数组方法详解内容来源于：<a href="https://www.cnblogs.com/zhupengcheng/p/11432131.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhupengcheng/p/11432131.html</a></p></blockquote><h2 id="各版本数组方法一览表"><a href="#各版本数组方法一览表" class="headerlink" title="各版本数组方法一览表"></a>各版本数组方法一览表</h2><table><thead><tr><th>数组方法名</th><th>对应版本</th><th align="left">功能</th><th align="center">原数组是否改变</th></tr></thead><tbody><tr><td>pop()</td><td>ES3-</td><td align="left">删除最后一位，并返回删除的数据</td><td align="center">是</td></tr><tr><td>push()</td><td>ES3-</td><td align="left">在最后一位新增一或多个数据，返回长度</td><td align="center">是</td></tr><tr><td>shift()</td><td>ES3-</td><td align="left">删除第一位，并返回删除的数据</td><td align="center">是</td></tr><tr><td>unshift()</td><td>ES3-</td><td align="left">在第一位新增一或多个数据，返回长度</td><td align="center">是</td></tr><tr><td>reverse()</td><td>ES3-</td><td align="left">反转数组，返回结果</td><td align="center">是</td></tr><tr><td>sort()</td><td>ES3-</td><td align="left">排序（字符规则），返回结果</td><td align="center">是</td></tr><tr><td>splice()</td><td>ES3-</td><td align="left">删除指定位置，并替换，返回删除的数据</td><td align="center">是</td></tr><tr><td>copyWithin()</td><td>ES6-</td><td align="left">指定位置的成员复制到其他位置</td><td align="center">是</td></tr><tr><td>fill()</td><td>ES6-</td><td align="left">使用给定的值，填充到数组中，类似于替换</td><td align="center">是</td></tr><tr><td>concat()</td><td>ES3-</td><td align="left">合并数组，并返回合并之后的数据</td><td align="center">否</td></tr><tr><td>join()</td><td>ES3-</td><td align="left">使用分隔符，将数组转为字符串并返回</td><td align="center">否</td></tr><tr><td>slice()</td><td>ES3-</td><td align="left">截取指定位置的数组，并返回</td><td align="center">否</td></tr><tr><td>toString()</td><td>ES3-</td><td align="left">直接转为字符串，并返回</td><td align="center">否</td></tr><tr><td>valueOf()</td><td>ES5-</td><td align="left">返回数组对象的原始值</td><td align="center">否</td></tr><tr><td>indexOf()</td><td>ES5-</td><td align="left">查询并返回数据的索引</td><td align="center">否</td></tr><tr><td>lastIndexOf()</td><td>ES5-</td><td align="left">反向查询并返回数据的索引</td><td align="center">否</td></tr><tr><td>forEach()</td><td>ES6-</td><td align="left">参数为回调函数，会遍历数组所有的项，回调函数接受三个参数，分别为value，index，self；forEach没有返回值</td><td align="center">否</td></tr><tr><td>map()</td><td>ES6-</td><td align="left">同forEach，同时回调函数返回数据，组成新数组由map返回</td><td align="center">否</td></tr><tr><td>filter()</td><td>ES6-</td><td align="left">同forEach，同时回调函数返回布尔值，为true的数据组成新数组由filter返回</td><td align="center">否</td></tr><tr><td>every()</td><td>ES6-</td><td align="left">同forEach，同时回调函数返回布尔值，全部为true，由every返回true</td><td align="center">否</td></tr><tr><td>some()</td><td>ES6-</td><td align="left">同forEach，同时回调函数返回布尔值，只要有一个为true，由some返回true</td><td align="center">否</td></tr><tr><td>reduce()</td><td>ES6-</td><td align="left">归并，同forEach，迭代数组的所有项，并构建一个最终值，由reduce返回</td><td align="center">否</td></tr><tr><td>reduceRight()</td><td>ES6-</td><td align="left">反向归并，同forEach，迭代数组的所有项，并构建一个最终值，由reduceRight返回</td><td align="center">否</td></tr><tr><td>from()</td><td>ES6-</td><td align="left">将类数组对象和可遍历对象转化为数组</td><td align="center">否</td></tr><tr><td>of()</td><td>ES6-</td><td align="left">将一组值转化为数组</td><td align="center">否</td></tr><tr><td>find()</td><td>ES6-</td><td align="left">在数组内部, 找到第一个符合条件的数组成员，返回值</td><td align="center">否</td></tr><tr><td>findIndex()</td><td>ES6-</td><td align="left">在数组内部, 找到第一个符合条件的数组成员，返回索引</td><td align="center">否</td></tr><tr><td>includes()</td><td>ES7-</td><td align="left">表示某个数组是否包含给定的值，与字符串的includes()方法类似</td><td align="center">否</td></tr></tbody></table><hr><h2 id="方法详解："><a href="#方法详解：" class="headerlink" title="方法详解："></a>方法详解：</h2><p>在讲解数组方法前，我们先简单将数组方法按上方表格内容分为下面两大类</p><p><strong>（1）使用后会改变原数组</strong><br><strong>（2）使用后不会改变原数组</strong></p><h2 id="第一类、使用后原数组改变，失去原数组，得到改变后的新数组"><a href="#第一类、使用后原数组改变，失去原数组，得到改变后的新数组" class="headerlink" title="第一类、使用后原数组改变，失去原数组，得到改变后的新数组"></a>第一类、使用后原数组改变，失去原数组，得到改变后的新数组</h2><h3 id="1-pop"><a href="#1-pop" class="headerlink" title="1.pop()"></a>1.pop()</h3><p><strong>功能</strong>：用于删除并返回数组的最后一个元素。<br><strong>参数</strong>：无</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//3---删除并返回3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//[1,2]---原数组改变</span></code></pre><h3 id="2-push"><a href="#2-push" class="headerlink" title="2.push()"></a>2.push()</h3><p><strong>功能</strong>：向数组的末尾添加一个或更多元素，并返回数组新的长度。<br><strong>参数</strong>：push(newData1, newData2, ……)</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">//4---返回数组现在的长度</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">//[1,2,3,"a"]---原数组改变</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//6---一次可添加多个数组，返回新的数组长度</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">//[1,2,3,"a","hello",world]---原数组改变</span></code></pre><h3 id="3-shift"><a href="#3-shift" class="headerlink" title="3.shift()"></a>3.shift()</h3><p><strong>功能</strong>：方法用于删除并返回数组的第一个元素。<br><strong>参数</strong>：无</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//1---返回被删除的元素</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">//[2,3]---原数组改变</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//2---返回被删除的元素</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">//[3]---原数组改变</span></code></pre><h3 id="4-unshift"><a href="#4-unshift" class="headerlink" title="4.unshift()"></a>4.unshift()</h3><p><strong>功能</strong>：向数组的开头添加一个或更多元素，并返回新的长度。<br><strong>参数</strong>：unshift(newData1, newData2, ……)</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//4---返回当前的数组长度</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment" spellcheck="true">//["world",1,2,3]---原数组改变</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">,</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//7---返回当前的数组长度，可一次性添加多个元素</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment" spellcheck="true">//["a","b","hello","world",1,2,3]---原数组改变</span></code></pre><h3 id="5-reverse"><a href="#5-reverse" class="headerlink" title="5.reverse()"></a>5.reverse()</h3><p><strong>功能</strong>：颠倒数组中元素的顺序，并返回更改后的数组<br><strong>参数</strong>：无</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//[3,2,1]---返回颠倒后的数组</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">//[3,2,1]---原数组改变</span></code></pre><h3 id="6-sort"><a href="#6-sort" class="headerlink" title="6.sort()"></a>6.sort()</h3><p><strong>功能</strong>：对数组中的元素进行排序，默认是升序，返回新数组<br><strong>参数</strong>：无</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//[1, 2, 3, 4, 5, 6]---返回排序后的新数组，默认升序排列</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//[1, 2, 3, 4, 5, 6]---原数组改变</span></code></pre><p><strong>注意</strong>：但是在排序前，会先调用数组的<strong>toString</strong>方法，将每个元素都转成字符之后，再进行排序，此时会按照字符串的排序，逐位比较，进行排序。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token number">52</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">369</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//[1024, 256, 369, 52, 6]---按照第一个字符的大小排序，多位数值的排序会出错</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//[1024, 256, 369, 52, 6]---原数组改变</span></code></pre><p><strong>解决方法</strong>：通过回调函数实现<br><strong>参数</strong>：sort(callback)<br>如果需要按照数值排序，需要传参。sort(callback)，callback为回调函数，该函数应该具有两个参数，比较这两个参数，然后返回一个用于说明这两个值的相对顺序的数字（a-b）。其返回值如下：<br>若 a 小于 b，返回一个小于 0 的值。<br>若 a 等于 b，则返回 0。<br>若 a 大于 b，则返回一个大于 0 的值。</p><h5 id="1-从小到大排序"><a href="#1-从小到大排序" class="headerlink" title="1)从小到大排序"></a>1)从小到大排序</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token number">52</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">369</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//[6, 52, 256, 369, 1024]---排序正常升序</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//[6, 52, 256, 369, 1024]---原数组改变</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> a<span class="token operator">-</span>b<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h5 id="2-从大到小排序"><a href="#2-从大到小排序" class="headerlink" title="2)从大到小排序"></a>2)从大到小排序</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token number">52</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">369</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//[1024, 369, 256, 52, 6]---排序正常降序</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//[1024, 369, 256, 52, 6]---原数组改变</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> b<span class="token operator">-</span>a<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="7-splice"><a href="#7-splice" class="headerlink" title="7.splice()"></a>7.splice()</h3><p><strong>功能</strong>：向数组中添加，或从数组删除，或替换数组中的元素，然后返回被删除/替换的元素。<br><strong>参数</strong>：splice(start,num,data1,data2,…); 所有参数全部可选；分为多种情况</p><p><strong>start</strong>：整数，规定添加/删除项目位置的索引，使用负数可从数组结尾处规定删除的位置<br><strong>num</strong>：整数，规定要删除元素的数量，若为0则不会删除<br><strong>data1，data2，data3…..</strong>:可选，规定需要添加的元素</p><h4 id="（1）不传参时：无操作"><a href="#（1）不传参时：无操作" class="headerlink" title="（1）不传参时：无操作"></a>（1）不传参时：无操作</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//[]---不传参，不操作，没有没删除替换的元素，返回空数组</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">//["Tom","Jack","Lucy","Lily","May"]---无操作，原数组未变，返回原数组</span></code></pre><h4 id="（2）只传入start：表示从索引为start的数据开始删除，直到数组结束"><a href="#（2）只传入start：表示从索引为start的数据开始删除，直到数组结束" class="headerlink" title="（2）只传入start：表示从索引为start的数据开始删除，直到数组结束"></a>（2）只传入start：表示从索引为start的数据开始删除，直到数组结束</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//["Lucy", "Lily", "May"]--从索引为2开始删除，直到结束，返回被删除的数组</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">//["Tom", "Jack"]---原数组改变，返回改变后的数组</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//["Tom","Jack","Lucy","Lily","May"]--从索引为0开始删除，直到结束</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">//[]---原数组数据被全部删除，返回空数组</span></code></pre><h4 id="（3）传入start和num：表示从索引为start的数据开始删除，删除num个"><a href="#（3）传入start和num：表示从索引为start的数据开始删除，删除num个" class="headerlink" title="（3）传入start和num：表示从索引为start的数据开始删除，删除num个"></a>（3）传入start和num：表示从索引为start的数据开始删除，删除num个</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//["Jack", "Lucy", "Lily",]---从索引为2开始删除，删除3个元素</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">//["Tom", "May"]---原数组改变，按顺序返回剩下的元素</span></code></pre><h4 id="（4）传入更多：表示从索引为start的数据开始删除，删除num个，并将第三个参数及后面所有参数，插入到start的位置"><a href="#（4）传入更多：表示从索引为start的数据开始删除，删除num个，并将第三个参数及后面所有参数，插入到start的位置" class="headerlink" title="（4）传入更多：表示从索引为start的数据开始删除，删除num个，并将第三个参数及后面所有参数，插入到start的位置"></a>（4）传入更多：表示从索引为start的数据开始删除，删除num个，并将第三个参数及后面所有参数，插入到start的位置</h4><h5 id="1）删除的数据，等于，添加的数据，数量相同。相当于把某几个数据替换了"><a href="#1）删除的数据，等于，添加的数据，数量相同。相当于把某几个数据替换了" class="headerlink" title="1）删除的数据，等于，添加的数据，数量相同。相当于把某几个数据替换了"></a>1）删除的数据，等于，添加的数据，数量相同。相当于把某几个数据替换了</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//["Lucy", "Lily"]--从索引为2开始删除2个，再把"a""b"插入删除的空隙</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment" spellcheck="true">//["Tom", "Jack", "a", "b", "May"]---原数组改变，相当于被替换了</span></code></pre><h5 id="2）删除的数据，多于，添加的数据。多的空位由后面的数据向前移补上"><a href="#2）删除的数据，多于，添加的数据。多的空位由后面的数据向前移补上" class="headerlink" title="2）删除的数据，多于，添加的数据。多的空位由后面的数据向前移补上"></a>2）删除的数据，多于，添加的数据。多的空位由后面的数据向前移补上</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//["Lucy", "Lily"]--从索引为2开始删除2个，再把"a"插入删除的空隙，多的空隙，后面数据补上来。</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//["Tom", "Jack", "a", "May"]---原数组改变</span></code></pre><h5 id="3-删除的数据，少于，添加的数据。多的数据挤进去，后面的元素都相应后退。"><a href="#3-删除的数据，少于，添加的数据。多的数据挤进去，后面的元素都相应后退。" class="headerlink" title="3)删除的数据，少于，添加的数据。多的数据挤进去，后面的元素都相应后退。"></a>3)删除的数据，少于，添加的数据。多的数据挤进去，后面的元素都相应后退。</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//["Lucy"]--从索引为2开始删除1个，再把"a""b"插入删除的空隙</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment" spellcheck="true">//["Tom", "Jack", "a", "b", "Lily", "May"]---原数组改变</span></code></pre><h4 id="（5）传入更多：表示从索引为start的数据开始删除，删除num个，并将第三个参数及后面所有参数，插入到start的位置"><a href="#（5）传入更多：表示从索引为start的数据开始删除，删除num个，并将第三个参数及后面所有参数，插入到start的位置" class="headerlink" title="（5）传入更多：表示从索引为start的数据开始删除，删除num个，并将第三个参数及后面所有参数，插入到start的位置"></a>（5）传入更多：表示从索引为start的数据开始删除，删除num个，并将第三个参数及后面所有参数，插入到start的位置</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//[]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//["Tom", "Jack", "a", "b", "Lucy", "Lily", "May"]---原数组改变</span></code></pre><h3 id="8-ES6新增：copyWithin"><a href="#8-ES6新增：copyWithin" class="headerlink" title="8.ES6新增：copyWithin()"></a>8.ES6新增：copyWithin()</h3><p><strong>功能</strong>：在当前数组内部，将指定位置的成员复制到其他位置顶替掉原来位置的元素，并返回新数组<br><strong>参数</strong>：copyWithin(target,start=0,end=this.length)</p><p><strong>target</strong>：从该索引位置开始替换元素，如果为负值，则表示从右往左<br><strong>start</strong>：从该索引位置开始读取元素（包括该索引对应的元素）。默认为0，如果为负值，则表示从右往左<br><strong>end</strong>：到该索引位置前停止读取元素（不包括该索引对应的元素）。默认等于数组长度，使用负数可从数组结尾处规定位置开始</p><p><strong>Tip</strong>：数组的长度前后不会改变</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span>，<span class="token string">"Alice"</span><span class="token punctuation">,</span><span class="token string">"Ben"</span><span class="token punctuation">,</span><span class="token string">"Rouse"</span><span class="token punctuation">,</span><span class="token string">"Peter"</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//["Tom", "Lily", "May", "Alice", "May", "Alice", "Ben", "Rouse", "Peter"]</span><span class="token comment" spellcheck="true">//从索引为1的元素开始被替换,从索引为3的元素开始读取要替换的 索引为6的元素前面停止替换</span><span class="token comment" spellcheck="true">//简单来说就是将索引为3,4,5位置的元素复制到索引为1,2,3的位置上.后面的元素不变。</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//负数表示从右到左数索引。-2相当于索引2的位置，-1相当索引为3的位置</span><span class="token comment" spellcheck="true">//[4, 2, 3, 4, 5]</span><span class="token comment" spellcheck="true">//表示将索引为-2的元素复制到索引为0的位置上</span></code></pre><h3 id="9-ES6新增：fill"><a href="#9-ES6新增：fill" class="headerlink" title="9.ES6新增：fill()"></a>9.ES6新增：fill()</h3><p><strong>功能</strong>：使用给定的值，填充到数组中，类似于替换<br><strong>参数</strong>：fill(data,start,end)</p><p><strong>data</strong>：要填充数组的值<br><strong>start</strong>：填充开始的位置，默认值是0<br><strong>end</strong>：填充结束的位置，默认值是this.length(数组长度)</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">,</span><span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//[7, 7, 7]---start和end都为0，默认填充所有元素</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//[7, 7, 7]---原数组改变</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">,</span><span class="token string">"c"</span><span class="token punctuation">,</span><span class="token string">"d"</span><span class="token punctuation">,</span><span class="token string">"e"</span><span class="token punctuation">,</span><span class="token string">"f"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//["a", 7, 7, 7, "e", "f"]---将索引1到4的元素填充为7</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//["a", 7, 7, 7, "e", "f"]---原数组改变</span></code></pre><h2 id="第二类、使用后原数组不变，返回新数组后，仍然可以得到原数组"><a href="#第二类、使用后原数组不变，返回新数组后，仍然可以得到原数组" class="headerlink" title="第二类、使用后原数组不变，返回新数组后，仍然可以得到原数组"></a>第二类、使用后原数组不变，返回新数组后，仍然可以得到原数组</h2><h3 id="1-concat"><a href="#1-concat" class="headerlink" title="1.concat()"></a>1.concat()</h3><p><strong>功能</strong>：用于将两个或多个数组连接到一起<br><strong>参数</strong>：concat(data1,data2,…);</p><p><strong>data</strong>：为数组时，将data合并到原数组；data为具体数据时直接添加到原数组尾部；省略时创建原数组的副本</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> arr2 <span class="token operator">=</span> arr1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//[1,2,3]---原数组</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//[1,2,3]---原数组的副本;看起来和原数组一样，但他们是两个东西，不相等。</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1 <span class="token operator">===</span> arr2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//false---数组也是对象的一种，所有对象都不相等，除非是对象本身等于自己</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//[1,2,3,"hello","world"]---将字符拼接到数组后</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"admin"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//[1,2,3,"a","b",[3,4],{"name":"admin"}]</span><span class="token keyword">var</span> arr3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//[1, 2, 3, 4, 5, 6]---将两个数组拼接</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//[1,2,3]---原数组未改变</span></code></pre><h3 id="2-join"><a href="#2-join" class="headerlink" title="2.join()"></a>2.join()</h3><p><strong>功能</strong>：根据指定分隔符将数组中的所有元素放入一个字符串，并返回这个字符串<br><strong>参数</strong>：join(str);</p><p><strong>str</strong>：默认为”,”号，以传入的字符作为分隔符</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//1,2,3---将数组每个元素用","连接成字符串并返回</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//1-2-3---将数组每个元素用"-"连接成字符串并返回</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//[1,2,3]---原数组未改变</span><span class="token comment" spellcheck="true">//当数组里的元素也是数组或对象时</span><span class="token keyword">var</span> a<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'OBKoro1'</span><span class="token punctuation">,</span><span class="token string">'23'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//OBKoro1,23*test---数组内的还是用","连接（join只对一维数组连接，多维数组时，里面的数组不连接，只是转成字符串），数组外的用"*"连接</span><span class="token keyword">var</span> b<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'OBKoro1'</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token string">'23'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//[object Object]*test---数组内是对象时。会出问题，先转成数组，对象内容显示"Object",再连接。不能显示具体值</span><span class="token comment" spellcheck="true">// 对象转字符串推荐JSON.stringify(obj);</span></code></pre><h3 id="3-slice"><a href="#3-slice" class="headerlink" title="3.slice()"></a>3.slice()</h3><p><strong>功能</strong>：可从已有的数组中返回选定的元素。<br><strong>参数</strong>：slice(start, end)</p><p><strong>start</strong>：为必填，表示从第几位索引开始。若为负数，则表示从后往前计算索引<br><strong>end</strong>：为可填，表示到第几位结束(不包含end位)，省略表示到最后一位；若为负数，则表示从后往前计算索引</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//["Jack","Lucy"]---返回索引为1,2的元素组成的数组</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">//["Jack","Lucy","Lily","May"]---返回索引为1,2,3,4的元素组成的数组</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//["Jack","Lucy","Lily"]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//["Lily","May"]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//["Jack","Lucy"]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment" spellcheck="true">//["Tom","Jack","Lucy","Lily","May"]---原数组未改变</span></code></pre><h3 id="4-toString"><a href="#4-toString" class="headerlink" title="4.toString()"></a>4.toString()</h3><p><strong>功能</strong>：转换成字符串，类似于没有参数的join()。该方法会在数据发生隐式类型转换时被自动调用，如果手动调用，就是直接转为字符串。<br><strong>参数</strong>：无</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'OBKoro1'</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token string">'23'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//1,2,3---转为字符</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//[object Object],test--对象没办法直接转</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//[1,2,3]---原数组未改变</span></code></pre><h3 id="5-valueOf"><a href="#5-valueOf" class="headerlink" title="5.valueOf()"></a>5.valueOf()</h3><p><strong>功能</strong>：返回数组的原始值（一般情况下其实就是数组自身），一般由js在后台调用，并不显式的出现在代码中<br><strong>参数</strong>：无</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//[1,2,3]---返回的是数组本身</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment" spellcheck="true">//[1,2,3]---原数组未变</span><span class="token comment" spellcheck="true">//为了证明返回的是数组自身</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//true</span></code></pre><h3 id="6-indexOf"><a href="#6-indexOf" class="headerlink" title="6.indexOf()"></a>6.indexOf()</h3><p><strong>功能</strong>：根据指定的数据，从左向右，查询某元素在数组中出现的位置，如果不存在指定的元素，返回-1。该方法是查询方法，不会对数组产生改变。<br><strong>参数</strong>：indexOf(value, start);</p><p><strong>value</strong>：必填，要查询的数据；<br><strong>start</strong>：选填，表示开始查询的位置，当start为负数时，从数组的尾部向前数；如果查询不到value的存在，则方法返回-1</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"h"</span><span class="token punctuation">,</span><span class="token string">"e"</span><span class="token punctuation">,</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token string">"o"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//2---字母"l"在数组中的索引，返回第一个索引</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//-1---从索引为4的位置开始查询，未找到返回-1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//-1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// ["h","e","l","l","o"]---原数组未改变</span></code></pre><h3 id="7-lastIndexOf"><a href="#7-lastIndexOf" class="headerlink" title="7.lastIndexOf()"></a>7.lastIndexOf()</h3><p><strong>功能：</strong>根据指定的数据，从右向左，查询在数组中出现的位置，如果不存在指定的数据，返回-1。该方法是查询方法，不会对数组产生改变。<br><strong>参数：</strong>lastIndexOf(value, start);</p><p><strong>value</strong>：必填，要查询的数据；<br><strong>start</strong>：选填，表示开始查询的位置，当start为负数时，从数组的头部向尾部数；如果查询不到value的存在，则方法返回-1</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"h"</span><span class="token punctuation">,</span><span class="token string">"e"</span><span class="token punctuation">,</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token string">"o"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//-1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//-1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">// ["h","e","l","l","o"]---原数组未改变</span></code></pre><h3 id="8-forEach"><a href="#8-forEach" class="headerlink" title="8.forEach()"></a>8.forEach()</h3><p><strong>功能</strong>：用来遍历数组，该方法没有返回值。forEach接收的回调函数会根据数组的每一项执行，该回调函数默认有三个参数，分别为：遍历到的数组的数据，对应的索引，数组自身。<br><strong>参数</strong>：forEach(callback);callback默认有三个参数，分别为value，index，self。</p><p><strong>value</strong>：遍历到的数组元素<br><strong>index</strong>：元素对应的索引<br><strong>self</strong>：数组自身</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> self<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：---第一列为遍历到的数组元素，第二列为对应的索引，第三列为数组自身</span><span class="token comment" spellcheck="true">// 0--Tom--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 1--Jack--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 2--Lucy--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 3--Lily--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 4--May--Tom,Jack,Lucy,Lily,May</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//["Tom","Jack","Lucy","Lily","May"]---原数组未改变</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//undefined---forEach没有返回值</span><span class="token comment" spellcheck="true">//该方法为遍历方法，不会修改原数组</span></code></pre><h3 id="9-map"><a href="#9-map" class="headerlink" title="9.map()"></a>9.map()</h3><p><strong>功能</strong>：1.同forEach功能；2.map的回调函数会将执行结果返回，最后map将所有回调函数的返回值组成新数组返回。<br><strong>参数</strong>：map()接收一个回调函数作为参数，这个回调函数需要有返回值；map(callback);callback默认有三个参数，分别为value，index，self。</p><p><strong>value</strong>：遍历到的数组元素<br><strong>index</strong>：元素对应的索引<br><strong>self</strong>：数组自身</p><h4 id="（1）功能1：同forEach"><a href="#（1）功能1：同forEach" class="headerlink" title="（1）功能1：同forEach"></a>（1）功能1：同forEach</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> self<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：---第一列为遍历到的数组元素，第二列为对应的索引，第三列为数组自身</span><span class="token comment" spellcheck="true">// 0--Tom--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 1--Jack--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 2--Lucy--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 3--Lily--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 4--May--Tom,Jack,Lucy,Lily,May</span></code></pre><h4 id="（2）功能2：每次回调函数的返回值被map组成新数组返回"><a href="#（2）功能2：每次回调函数的返回值被map组成新数组返回" class="headerlink" title="（2）功能2：每次回调函数的返回值被map组成新数组返回"></a>（2）功能2：每次回调函数的返回值被map组成新数组返回</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"hi:"</span><span class="token operator">+</span>value<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//["hi:Tom", "hi:Jack", "hi:Lucy", "hi:Lily", "hi:May"]</span><span class="token comment" spellcheck="true">//可通过此方法批量修改数组，返回新数组。</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//["Tom", "Jack", "Lucy", "Lily", "May"]---原数组未改变</span></code></pre><h3 id="10-filter"><a href="#10-filter" class="headerlink" title="10.filter()"></a>10.filter()</h3><p><strong>功能：</strong>1.同forEach功能；2.filter的回调函数需要返回布尔值，当为true时，将本次数组的数据返回给filter，最后filter将所有回调函数的返回值组成新数组返回（此功能可理解为“过滤”）。<br><strong>参数：</strong>filter()接收一个回调函数作为参数，这个回调函数需要有返回值；filter(callback);callback默认有三个参数，分别为value，index，self</p><p><strong>value</strong>：遍历到的数组元素<br><strong>index</strong>：元素对应的索引<br><strong>self</strong>：数组自身</p><h4 id="（1）功能1：同forEach-1"><a href="#（1）功能1：同forEach-1" class="headerlink" title="（1）功能1：同forEach"></a>（1）功能1：同forEach</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> self<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：---第一列为遍历到的数组元素，第二列为对应的索引，第三列为数组自身</span><span class="token comment" spellcheck="true">// 0--Tom--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 1--Jack--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 2--Lucy--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 3--Lily--Tom,Jack,Lucy,Lily,May</span><span class="token comment" spellcheck="true">// 4--May--Tom,Jack,Lucy,Lily,May</span></code></pre><h4 id="（2）功能2：当回调函数的返回值为true时，本次的数组值返回给filter，被filter组成新数组返回"><a href="#（2）功能2：当回调函数的返回值为true时，本次的数组值返回给filter，被filter组成新数组返回" class="headerlink" title="（2）功能2：当回调函数的返回值为true时，本次的数组值返回给filter，被filter组成新数组返回"></a>（2）功能2：当回调函数的返回值为true时，本次的数组值返回给filter，被filter组成新数组返回</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> value<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//返回元素长度大于3的元素。若有符合条件的元素，返回元素</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//["Jack", "Lucy", "Lily"]</span><span class="token comment" spellcheck="true">//相当于一个筛选器（过滤器），可以在数组中查找需要的内容并返回</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//["Tom", "Jack", "Lucy", "Lily", "May"]---原数组未改变</span></code></pre><h3 id="11-every"><a href="#11-every" class="headerlink" title="11.every()"></a>11.every()</h3><p><strong>功能</strong>：判断数组中每一项是否都满足条件，只有所有项都满足条件，才会返回true。<br><strong>参数</strong>：every()接收一个回调函数作为参数，这个回调函数需要有返回值；every(callback);callback默认有三个参数，分别为value，index，self</p><p><strong>value</strong>：遍历到的数组元素<br><strong>index</strong>：元素对应的索引<br><strong>self</strong>：数组自身</p><h4 id="（1）功能1：当回调函数的返回值为true时，类似于forEach的功能，遍历所有；如果为false，那么停止执行，后面的数据不再遍历，停在第一个返回false的位置。"><a href="#（1）功能1：当回调函数的返回值为true时，类似于forEach的功能，遍历所有；如果为false，那么停止执行，后面的数据不再遍历，停在第一个返回false的位置。" class="headerlink" title="（1）功能1：当回调函数的返回值为true时，类似于forEach的功能，遍历所有；如果为false，那么停止执行，后面的数据不再遍历，停在第一个返回false的位置。"></a>（1）功能1：当回调函数的返回值为true时，类似于forEach的功能，遍历所有；如果为false，那么停止执行，后面的数据不再遍历，停在第一个返回false的位置。</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//demo1:</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：没有返回值，打印了第一个，默认为false，后面的就不再遍历</span><span class="token comment" spellcheck="true">// Tom--0--true</span><span class="token comment" spellcheck="true">//因为回调函数中没有return true，默认返回undefined，等同于返回false</span><span class="token comment" spellcheck="true">//demo2:</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> value<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：</span><span class="token comment" spellcheck="true">// Tom--0--true</span><span class="token comment" spellcheck="true">// abc--1--true</span><span class="token comment" spellcheck="true">// Jack--2--true</span><span class="token comment" spellcheck="true">//因为当遍历到Jack时，回调函数到return返回false，此时Jack已经遍历，但是后面数据就不再被遍历了</span><span class="token comment" spellcheck="true">//demo3:</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：</span><span class="token comment" spellcheck="true">// Tom--0--true</span><span class="token comment" spellcheck="true">// abc--1--true</span><span class="token comment" spellcheck="true">// Jack--2--true</span><span class="token comment" spellcheck="true">// Lucy--3--true</span><span class="token comment" spellcheck="true">// Lily--4--true</span><span class="token comment" spellcheck="true">// May--5--true</span><span class="token comment" spellcheck="true">//因为每个回调函数的返回值都是true，那么会遍历数组所有数据，等同于forEach功能</span></code></pre><h4 id="（2）功能2：当每个回调函数的返回值都为true时，every的返回值为true，只要有一个回调函数的返回值为false，every的返回值都为false"><a href="#（2）功能2：当每个回调函数的返回值都为true时，every的返回值为true，只要有一个回调函数的返回值为false，every的返回值都为false" class="headerlink" title="（2）功能2：当每个回调函数的返回值都为true时，every的返回值为true，只要有一个回调函数的返回值为false，every的返回值都为false"></a>（2）功能2：当每个回调函数的返回值都为true时，every的返回值为true，只要有一个回调函数的返回值为false，every的返回值都为false</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//demo1:</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> value<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//false---只要出现一个false，返回值就为false</span><span class="token comment" spellcheck="true">//demo2:</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> value<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//true---遍历数组全部为true，才能返回true</span></code></pre><h3 id="12-some"><a href="#12-some" class="headerlink" title="12.some()"></a>12.some()</h3><p><strong>功能</strong>：判断数组中是否存在满足条件的项，只要有一项满足条件，就会返回true。<br><strong>参数</strong>：some()接收一个回调函数作为参数，这个回调函数需要有返回值，some(callback);callback默认有三个参数，分别为value，index，self</p><p><strong>value</strong>：遍历到的数组元素<br><strong>index</strong>：元素对应的索引<br><strong>self</strong>：数组自身</p><h4 id="（1）功能1"><a href="#（1）功能1" class="headerlink" title="（1）功能1"></a>（1）功能1</h4><p>因为要判断数组中的每一项，只要有一个回调函数返回true，some都会返回true，所以与every正好相反，当遇到一个回调函数的返回值为true时，可以确定结果，那么停止执行，后面都数据不再遍历，停在第一个返回true的位置；当回调函数的返回值为false时，需要继续向后执行，到最后才能确定结果，所以会遍历所有数据，实现类似于forEach的功能，遍历所有。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//demo1:</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> value<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：</span><span class="token comment" spellcheck="true">// Tom--0--true</span><span class="token comment" spellcheck="true">// abc--1--true</span><span class="token comment" spellcheck="true">// Jack--2--true</span><span class="token comment" spellcheck="true">//demo2:</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：</span><span class="token comment" spellcheck="true">// Tom--0--true</span><span class="token comment" spellcheck="true">//demo3:</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：</span><span class="token comment" spellcheck="true">// Tom--0--true</span><span class="token comment" spellcheck="true">// abc--1--true</span><span class="token comment" spellcheck="true">// Jack--2--true</span><span class="token comment" spellcheck="true">// Lucy--3--true</span><span class="token comment" spellcheck="true">// Lily--4--true</span><span class="token comment" spellcheck="true">// May--5--true</span></code></pre><h4 id="（2）功能2"><a href="#（2）功能2" class="headerlink" title="（2）功能2"></a>（2）功能2</h4><p>与every相反，只要有一个回调函数的返回值都为true，some的返回值为true，所有回调函数的返回值为false，some的返回值才为false</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//demo1:</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> value<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">//true</span><span class="token comment" spellcheck="true">//demo2:</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Tom"</span><span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"Jack"</span><span class="token punctuation">,</span><span class="token string">"Lucy"</span><span class="token punctuation">,</span><span class="token string">"Lily"</span><span class="token punctuation">,</span><span class="token string">"May"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> value<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">//false</span></code></pre><h3 id="13-reduce"><a href="#13-reduce" class="headerlink" title="13.reduce()"></a>13.reduce()</h3><p><strong>功能</strong>：从数组的第一项开始，逐个遍历到最后，迭代数组的所有项，然后构建一个最终返回的值。<br><strong>参数</strong>：reduce()接收一个或两个参数：第一个是回调函数，表示在数组的每一项上调用的函数；第二个参数（可选的）作为归并的初始值，被回调函数第一次执行时的第一个参数接收。<br>reduce(callback,initial);callback默认有四个参数，分别为prev，now，index，self<br>callback返回的任何值都会作为下一次执行的第一个参数。<br>如果initial参数被省略，那么第一次迭代发生在数组的第二项上，因此callback的第一个参数是数组的第一项，第二个参数就是数组的第二项。</p><p><strong>prev</strong>：初始值, 或者计算结束后的返回值<br><strong>now</strong>：当前元素值<br><strong>index</strong>：当前元素的索引<br><strong>self</strong>：数组自身</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//demo1:不省略initial参数，回调函数没有返回值</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prev <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2019</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：</span><span class="token comment" spellcheck="true">// 2019--10--0--true</span><span class="token comment" spellcheck="true">// undefined--20--1--true</span><span class="token comment" spellcheck="true">// undefined--30--2--true</span><span class="token comment" spellcheck="true">// undefined--40--3--true</span><span class="token comment" spellcheck="true">// undefined--50--4--true</span><span class="token comment" spellcheck="true">// 此时回调函数没有return，所以从第二次开始，prev拿到的是undefined</span><span class="token comment" spellcheck="true">//demo2:省略initial参数，回调函数没有返回值</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prev <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：第一次，回调函数的第一个参数是数组的第一项。第二个参数就是数组的第二项</span><span class="token comment" spellcheck="true">// 10--20--1--true</span><span class="token comment" spellcheck="true">// undefined--30--2--true</span><span class="token comment" spellcheck="true">// undefined--40--3--true</span><span class="token comment" spellcheck="true">// undefined--50--4--true</span><span class="token comment" spellcheck="true">// 此时回调函数没有return，所以从第二次开始，prev拿到的是undefined</span><span class="token comment" spellcheck="true">//demo3:不省略initial参数，回调函数有返回值</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prev <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2019</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：</span><span class="token comment" spellcheck="true">// 2019--10--0--true</span><span class="token comment" spellcheck="true">// hello--20--1--true</span><span class="token comment" spellcheck="true">// hello--30--2--true</span><span class="token comment" spellcheck="true">// hello--40--3--true</span><span class="token comment" spellcheck="true">// hello--50--4--true</span><span class="token comment" spellcheck="true">// 此时回调函数有return，所以从第二次开始，prev拿到的是回调函数return的值</span><span class="token comment" spellcheck="true">//demo4:省略initial参数，回调函数有返回值</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prev <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：第一次，回调函数的第一个参数是数组的第一项。第二个参数就是数组的第二项</span><span class="token comment" spellcheck="true">// 10--20--1--true</span><span class="token comment" spellcheck="true">// hello--30--2--true</span><span class="token comment" spellcheck="true">// hello--40--3--true</span><span class="token comment" spellcheck="true">// hello--50--4--true</span><span class="token comment" spellcheck="true">// 此时回调函数有return，所以从第二次开始，prev拿到的是回调函数return的值</span><span class="token comment" spellcheck="true">//demo5：使用reduce计算数组中所有数据的和</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> sum <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> prev <span class="token operator">+</span> now<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//150</span><span class="token comment" spellcheck="true">// 回调函数的最后一次return的结果被返回到reduce方法的身上</span><span class="token comment" spellcheck="true">//demo6：使用reduce计算数组中所有数据的和</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> sum <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> prev <span class="token operator">+</span> now<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//158</span><span class="token comment" spellcheck="true">// 回调函数的最后一次return的结果被返回到reduce方法的身上</span><span class="token comment" spellcheck="true">// 因为reduce有第二个参数initial，在第一次执行时被计算，所以最终结果被加上8</span></code></pre><h3 id="14-reduceRight"><a href="#14-reduceRight" class="headerlink" title="14.reduceRight()"></a>14.reduceRight()</h3><p><strong>功能</strong>：从数组的第一项开始，逐个遍历到最后，迭代数组的所有项，然后构建一个最终返回的值。<br><strong>参数</strong>：reduce()接收一个或两个参数：第一个是回调函数，表示在数组的每一项上调用的函数；第二个参数（可选的）作为归并的初始值，被回调函数第一次执行时的第一个参数接收。<br>reduce(callback,initial);callback默认有四个参数，分别为prev，now，index，self<br>callback返回的任何值都会作为下一次执行的第一个参数。<br>如果initial参数被省略，那么第一次迭代发生在数组的第二项上，因此callback的第一个参数是数组的第一项，第二个参数就是数组的第二项。</p><p><strong>prev</strong>：初始值, 或者计算结束后的返回值<br><strong>now</strong>：当前元素值<br><strong>index</strong>：当前元素的索引<br><strong>self</strong>：数组自身</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//demo1:不省略initial参数，回调函数没有返回值</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prev <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2019</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：</span><span class="token comment" spellcheck="true">//2019--50--4--true</span><span class="token comment" spellcheck="true">//undefined--40--3--true</span><span class="token comment" spellcheck="true">//undefined--30--2--true</span><span class="token comment" spellcheck="true">//undefined--20--1--true</span><span class="token comment" spellcheck="true">//undefined--10--0--true</span><span class="token comment" spellcheck="true">// 此时回调函数没有return，所以从第二次开始，prev拿到的是undefined</span><span class="token comment" spellcheck="true">//demo2:省略initial参数，回调函数没有返回值</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prev <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：第一次，回调函数的第一个参数是数组的第一项。第二个参数就是数组的第二项</span><span class="token comment" spellcheck="true">//50--40--3--true</span><span class="token comment" spellcheck="true">//undefined--30--2--true</span><span class="token comment" spellcheck="true">//undefined--20--1--true</span><span class="token comment" spellcheck="true">//undefined--10--0--true</span><span class="token comment" spellcheck="true">// 此时回调函数没有return，所以从第二次开始，prev拿到的是undefined</span><span class="token comment" spellcheck="true">//demo3:不省略initial参数，回调函数有返回值</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prev <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2019</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：</span><span class="token comment" spellcheck="true">//2019--50--4--true</span><span class="token comment" spellcheck="true">//hello--40--3--true</span><span class="token comment" spellcheck="true">//hello--30--2--true</span><span class="token comment" spellcheck="true">//hello--20--1--true</span><span class="token comment" spellcheck="true">//hello--10--0--true</span><span class="token comment" spellcheck="true">// 此时回调函数有return，所以从第二次开始，prev拿到的是回调函数reduceRight的值</span><span class="token comment" spellcheck="true">//demo4:省略initial参数，回调函数有返回值</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prev <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"--"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 打印结果为：第一次，回调函数的第一个参数是数组的第一项。第二个参数就是数组的第二项</span><span class="token comment" spellcheck="true">//50--40--3--true</span><span class="token comment" spellcheck="true">//hello--30--2--true</span><span class="token comment" spellcheck="true">//hello--20--1--true</span><span class="token comment" spellcheck="true">//hello--10--0--true</span><span class="token comment" spellcheck="true">// 此时回调函数有return，所以从第二次开始，prev拿到的是回调函数reduceRight的值</span><span class="token comment" spellcheck="true">//demo5：使用reduce计算数组中所有数据的和</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> sum <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> prev <span class="token operator">+</span> now<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//150</span><span class="token comment" spellcheck="true">// 回调函数的最后一次return的结果被返回到reduceRight方法的身上</span><span class="token comment" spellcheck="true">//demo6：使用reduce计算数组中所有数据的和</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> sum <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span>now<span class="token punctuation">,</span>index<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> prev <span class="token operator">+</span> now<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//158</span><span class="token comment" spellcheck="true">// 回调函数的最后一次return的结果被返回到reduceRight方法的身上</span><span class="token comment" spellcheck="true">// 因为reduceRight有第二个参数initial，在第一次执行时被计算，所以最终结果被加上8</span></code></pre><h3 id="15-ES6新增：from"><a href="#15-ES6新增：from" class="headerlink" title="15.ES6新增：from()"></a>15.ES6新增：from()</h3><p><strong>功能</strong>：将类数组对象和可遍历对象转化为数组<br><strong>参数</strong>：from(object, mapFunction, thisValue)</p><p><strong>object</strong>：必需，要转换为数组的对象<br><strong>mapFunction</strong>：可选，数组中每个元素要调用的函数<br><strong>thisValue</strong>：可选，映射函数(mapFunction)中的 this 对象</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//["f", "o", "o"]---将类数组对象转换为数组</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//"foo"---不改变原对象</span></code></pre><h3 id="16-ES6新增：of"><a href="#16-ES6新增：of" class="headerlink" title="16.ES6新增：of()"></a>16.ES6新增：of()</h3><p><strong>功能</strong>：将一组值转化为数组<br><strong>参数</strong>：of(element0[, element1[, …[, elementN]]])</p><p><strong>elementN</strong>：任意个参数，将按顺序成为返回数组中的元素</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// [1]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// [1, 2, 3]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>undefined<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [undefined]</span></code></pre><h3 id="17-ES6新增：find"><a href="#17-ES6新增：find" class="headerlink" title="17.ES6新增：find()"></a>17.ES6新增：find()</h3><p><strong>功能</strong>：在数组内部, 找到第一个符合条件的数组成员<br><strong>参数</strong>：find(callback[, thisArg])；callback回调函数接受三个参数（element，index，self）</p><p><strong>element</strong>：可选；当前遍历到的元素<br><strong>index</strong>：可选：当前遍历到的索引<br><strong>self</strong>：可选：数组本身<br><strong>thisArg</strong>：执行回调时用作<code>this</code> 的对象</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> found <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> element <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//12</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//[5, 12, 8, 130, 44]---原数组不便</span></code></pre><h3 id="18-ES6新增数组findIndex"><a href="#18-ES6新增数组findIndex" class="headerlink" title="18.ES6新增数组findIndex()"></a>18.ES6新增数组findIndex()</h3><p><strong>功能</strong>：在数组内部, 找到第一个符合条件的数组成员 ，返回索引，若找不到返回-1<br><strong>参数</strong>：arr.findIndex(callback[, thisArg])；callback回调函数接受三个参数（element，index，self）</p><p><strong>element</strong>：可选；当前遍历到的元素<br><strong>index</strong>：可选：当前遍历到的索引<br><strong>self</strong>：可选：数组本身<br><strong>thisArg</strong>：执行回调时用作<code>this</code> 的对象</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">isLargeNumber</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> element <span class="token operator">></span> <span class="token number">13</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>isLargeNumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//[5, 12, 8, 130, 44]---数组未改变</span></code></pre><h3 id="19-ES7新增：includes"><a href="#19-ES7新增：includes" class="headerlink" title="19.ES7新增：includes()"></a>19.ES7新增：includes()</h3><p>功能：用来判断一个数组是否包含一个指定的值，根据情况，如果包含则返回 true，否则返回false<br>参数： arr.includes(valueToFind[, fromIndex])</p><p><strong>fromIndex</strong>：从<code>fromIndex</code> 索引处开始查找 <code>valueToFind</code>。如果为负值，则按升序从 <code>array.length + fromIndex</code> 的索引开始搜 （即使从末尾开始往前跳 <code>fromIndex</code> 的绝对值个索引，然后往后搜寻）。默认为 0。<br><strong>valueToFind</strong>：需要查找的元素值</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//[1, 2, 3]---原数组未改变</span><span class="token keyword">var</span> pets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'bat'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pets<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pets<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'at'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pets<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//['cat', 'dog', 'bat']---原数组未改变</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript闭包</title>
      <link href="/2020/07/10/javascript-bi-bao/"/>
      <url>/2020/07/10/javascript-bi-bao/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://www.cnblogs.com/heyushuo/p/9975911.html" target="_blank" rel="noopener">https://www.cnblogs.com/heyushuo/p/9975911.html</a></p><p>本文仅做加以解释</p></blockquote><h2 id="闭包是什么"><a href="#闭包是什么" class="headerlink" title="闭包是什么"></a>闭包是什么</h2><p>高级程序设计三中:闭包是指有权访问另外一个函数作用域中的变量的函数.可以理解为(<strong>能够读取其他函数内部变量的函数</strong>)</p><p><strong>闭包的作用:</strong> 正常函数执行完毕后,里面声明的变量被垃圾回收处理掉,但是闭包可以让作用域里的 变量,在函数执行完之后依旧保持没有被垃圾回收处理掉</p><h2 id="闭包的实例"><a href="#闭包的实例" class="headerlink" title="闭包的实例"></a>闭包的实例</h2><h3 id="一般调用方法"><a href="#一般调用方法" class="headerlink" title="一般调用方法"></a>一般调用方法</h3><p>一般的闭包调用方法如下：</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 创建闭包最常见的方式函数作为返回值</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">"kebi"</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//打印kebi    --外部函数访问内部变量</span></code></pre><h3 id="闭包实现计时器"><a href="#闭包实现计时器" class="headerlink" title="闭包实现计时器"></a>闭包实现计时器</h3><p>如果是不适用闭包来实现的话</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//确实实现了需求</span><span class="token comment" spellcheck="true">//但是如果需要第二个计数器呢?</span><span class="token comment" spellcheck="true">//难道要如下这样写吗?</span><span class="token keyword">var</span> count1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">add1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  count1 <span class="token operator">=</span> count1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">add1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//确实实现了需求</span></code></pre><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">addCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> fun1 <span class="token operator">=</span> <span class="token function">addCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//1</span><span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//2</span><span class="token keyword">var</span> fun2 <span class="token operator">=</span> <span class="token function">addCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//1</span><span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//2</span></code></pre><h2 id="闭包常见面试题"><a href="#闭包常见面试题" class="headerlink" title="闭包常见面试题"></a>闭包常见面试题</h2><h3 id="1-for-循环中打印"><a href="#1-for-循环中打印" class="headerlink" title="1. for 循环中打印"></a>1. for 循环中打印</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//4</span><span class="token comment" spellcheck="true">//4</span><span class="token comment" spellcheck="true">//4</span><span class="token comment" spellcheck="true">//4</span></code></pre><p><strong>原因</strong>:js 执行的时候首先<strong>会先执行主线程,异步相关的会存到异步队列里</strong>,当主线程执行<strong>完毕开始执行异步队列</strong>, 主线程执行完毕后,此时 i 的值为 4,说以在执行异步队列的时候,打印出来的都是 4(这里需要大家对 <strong>event loop 有所了解(js 的事件循环机制)</strong>)</p><p>那么如何去修改上面的代码使其正常打印呢</p><h4 id="方法1："><a href="#方法1：" class="headerlink" title="方法1："></a>方法1：</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token function">setTimeout</span><span class="token punctuation">(</span>                <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token punctuation">}</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token number">300</span>              <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 或者</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span>    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> temp <span class="token operator">=</span> i<span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token number">300</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//这个是通过自执行函数返回一个函数,然后在调用返回的函数去获取自执行函数内部的变量,此为闭包</span></code></pre><h4 id="方法2："><a href="#方法2：" class="headerlink" title="方法2："></a>方法2：</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 大部分都认为方法一和方法二都是闭包,我认为方法一是闭包,而方法二是通过创建一个自执行函数,使变量存在这个自执行函数的作用域里</span></code></pre><h3 id="2-真实的获取多个元素并添加点击事件"><a href="#2-真实的获取多个元素并添加点击事件" class="headerlink" title="2.真实的获取多个元素并添加点击事件"></a>2.真实的获取多个元素并添加点击事件</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> op <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> op<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  op<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">alert</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//alert出来的值是一样的</span><span class="token comment" spellcheck="true">// 解决办法一:</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> op<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>    op<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">alert</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 解决办法二:</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> op<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  op<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">alert</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//解决方法三其实和二类似</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> op<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  op<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> temp <span class="token operator">=</span> j<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">alert</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//这个例子和例子一几乎是一样的大家可以参考例子一</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> JavaScript </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端基础面试题</title>
      <link href="/2020/07/10/qian-duan-ji-chu-mian-shi-ti/"/>
      <url>/2020/07/10/qian-duan-ji-chu-mian-shi-ti/</url>
      
        <content type="html"><![CDATA[<blockquote><p>这里面的是我遇到的面试题</p></blockquote><h2 id="JavaScript面试题"><a href="#JavaScript面试题" class="headerlink" title="JavaScript面试题"></a>JavaScript面试题</h2><h3 id="js中-和-区别"><a href="#js中-和-区别" class="headerlink" title="js中==和===区别"></a>js中==和===区别</h3><p>简单来说： == 代表相同， ===代表严格相同, 为啥这么说呢， </p><p>这么理解： 当进行双等号比较时候： 先检查两个操作数数据类型，如果相同， 则进行===比较， 如果不同， 则愿意为你进行一次类型转换， 转换成相同类型后再进行比较， 而===比较时， 如果类型不同，直接就是false.</p><p>操作数1 == 操作数2， 操作数1 === 操作数2</p><p>比较过程：</p><p>　　双等号==： </p><p>　　（1）如果两个值类型相同，再进行三个等号(===)的比较</p><p>　　（2）如果两个值类型不同，也有可能相等，需根据以下规则进行类型转换在比较：</p><p>　　　　1）如果一个是null，一个是undefined，那么相等</p><p>　　　　2）如果一个是字符串，一个是数值，把字符串转换成数值之后再进行比较</p><p>　　</p><p>　　三等号===:</p><p>　　（1）如果类型不同，就一定不相等</p><p>　　（2）如果两个都是数值，并且是同一个值，那么相等；如果其中至少一个是NaN，那么不相等。（判断一个值是否是NaN，只能使用isNaN( ) 来判断）</p><p>　　（3）如果两个都是字符串，每个位置的字符都一样，那么相等，否则不相等。</p><p>　　（4）如果两个值都是true，或是false，那么相等</p><p>　　（5）如果两个值都引用同一个对象或是函数，那么相等，否则不相等</p><p>　　（6）如果两个值都是null，或是undefined，那么相等</p><h3 id="JS如何避免全局变量污染"><a href="#JS如何避免全局变量污染" class="headerlink" title="JS如何避免全局变量污染"></a>JS如何避免全局变量污染</h3><ol><li><p>加上个人标识符</p></li><li><p>匿名函数</p><p>如果是A写的变量跟B写的变量名字一样，那么就会造成变量冲突，此时每个人之间都可以使用匿名函数来开发</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!doctype html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>使用匿名函数解决变量作用域问题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//程序员a写的代码</span>                <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>                <span class="token function">alert</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//程序员b写的代码</span>                <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">89</span><span class="token punctuation">;</span>                <span class="token function">alert</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li></ol><pre><code>       &lt;script&gt;           (function() {               //程序员c写的代码               alert(a);           })();       &lt;/script&gt;       这里每个程序员定义了自己的匿名函数，在不同的函数中定义变量，这个变量就是一个局部变量。 &lt;br /&gt;       用匿名函数将脚本包起来，可以有效控制全局变量，避免冲突。   &lt;/body&gt;</code></pre>   </html>   ```<p>   但是如果是不同人之间要共享一个变量的话，如上代码就用不了了</p><p>   解决方案： 将多个全局变量包装在一起，使用一个hash全局变量，类似于一个集合一样的用。</p><ol start="3"><li>使用命名空间解决问题</li></ol><p>为解决如上问题，可以使用 命名空间的方法</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!doctype html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>使用hash变量作为全局变量<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">//hash全局变量</span>            <span class="token keyword">var</span> GLOBAL <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//程序员a写的代码</span>                <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>                <span class="token function">alert</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//程序员b写的代码:操作全局GLOBAL变量</span>                GLOBAL<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">89</span><span class="token punctuation">;</span>                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"程序员b:"</span> <span class="token operator">+</span> GLOBAL<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//程序员c写的代码访问的就是全局变量</span>                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"程序员c:"</span> <span class="token operator">+</span> GLOBAL<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        在这里使用了GLOBAL作为全局变量名， 在匿名函数间要传递值的话，将这些变量作为全局变量的属性即可。 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>        但GLOBAL是全局变量，它在各个函数间都可以访问到，这很容易让GLOBAL的属性不小心被覆盖掉。 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>        解决方案：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>        命名空间    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>但是这样的话，如果B不小心把GLOBAL重新赋值了，那么其他人用的变量就会出错</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!doctype html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>全局变量GLOBAL中添加定义命名空间的函数<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">//hash全局变量</span>            <span class="token keyword">var</span> GLOBAL <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//   str :表示要生成的命名空间，例如:    GLOBAL.A.name  或是     A.name</span>            GLOBAL<span class="token punctuation">.</span>namespace <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> arr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> o <span class="token operator">=</span> GLOBAL<span class="token punctuation">;</span>                <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"GLOBAL"</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//如果str中的第一部分为GLOBAL的话，命名空间从第二个开始计算</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    o<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> o<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>                    o <span class="token operator">=</span> o<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">/*            * @method 功能A:            * @author 程序员a            * @connect 1234567            * @time 2015-01-01            */</span>            <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//程序员a写的代码</span>                GLOBAL<span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">"A.person"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//程序员a定义了自己的命名空间A,并在Ａ下面定义了子命名空间person</span>                GLOBAL<span class="token punctuation">.</span>A<span class="token punctuation">.</span>person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"zy"</span><span class="token punctuation">;</span>                GLOBAL<span class="token punctuation">.</span>A<span class="token punctuation">.</span>person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>                <span class="token function">alert</span><span class="token punctuation">(</span>GLOBAL<span class="token punctuation">.</span>A<span class="token punctuation">.</span>person<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> GLOBAL<span class="token punctuation">.</span>A<span class="token punctuation">.</span>person<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">/*            * @method 功能B:            * @author 程序员b            * @connect 1234567            * @time 2015-01-01            */</span>            <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//程序员b写的代码:定义自己的命名空间</span>                GLOBAL<span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">"B.student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//程序员a定义了自己的命名空间B,并在B下面定义了子命名空间student</span>                GLOBAL<span class="token punctuation">.</span>B<span class="token punctuation">.</span>student<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"lisi"</span><span class="token punctuation">;</span>                GLOBAL<span class="token punctuation">.</span>B<span class="token punctuation">.</span>student<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span>                <span class="token function">alert</span><span class="token punctuation">(</span>GLOBAL<span class="token punctuation">.</span>B<span class="token punctuation">.</span>student<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> GLOBAL<span class="token punctuation">.</span>B<span class="token punctuation">.</span>student<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">/*            * @method 功能C:            * @author 程序员c            * @connect 1234567            * @time 2015-01-01            */</span>                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"程序员c操作A命名空间下的变量:"</span> <span class="token operator">+</span> GLOBAL<span class="token punctuation">.</span>A<span class="token punctuation">.</span>person<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> GLOBAL<span class="token punctuation">.</span>A<span class="token punctuation">.</span>person<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"程序员c操作B命名空间下的变量:"</span> <span class="token operator">+</span> GLOBAL<span class="token punctuation">.</span>B<span class="token punctuation">.</span>student<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> GLOBAL<span class="token punctuation">.</span>B<span class="token punctuation">.</span>student<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        以上体现的就是合理使用命名空间解决变量冲突的问题。    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="NaN是什么数据类型"><a href="#NaN是什么数据类型" class="headerlink" title="NaN是什么数据类型"></a>NaN是什么数据类型</h3><p><strong>NaN是数字类型的，但是它又可以用isNaN()检测，isNaN() 函数用于检查其参数是否是非数字值</strong></p><p>isNaN() 函数通常用于检测 parseFloat() 和 parseInt() 的结果，以判断它们表示的是否是合法的数字</p><h4 id="isNaN-为false的两种情况"><a href="#isNaN-为false的两种情况" class="headerlink" title="isNaN()为false的两种情况"></a>isNaN()为false的两种情况</h4><pre class=" language-jsx"><code class="language-jsx"><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">//false</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">//false</span></code></pre><p>通俗的讲isNaN()是用来检测非合法数字的，只要不是数字，或者可以转换为数字的都是true<br> <strong>注意isNaN(true) //false   isNaN(false) //false isNaN(undefined) //true</strong><br> 这是因为:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token function">Number</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">//1</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">//0</span><span class="token function">Number</span><span class="token punctuation">(</span>undefined<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">//NaN</span></code></pre><p><strong>在ES6的Number.isNaN()扩展方法没有出现之前，全局的isNaN()方法是比较可靠的方式判断是否为NaN，但是在ES6出来之后，我们可以使用Number.isNaN()方法进行可靠的判断NaN值</strong><br> Number.isNaN()方法的判断过程：首先判断传入的参数是否为数值类型，如果判断为true再使用isNaN()方法进行判断。为false就直接返回flase<br> 所以：</p><pre class=" language-jsx"><code class="language-jsx">Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>undefined<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">//false</span></code></pre><p>由此得出NaN是一个非法数字，更是一个没有固定值的数字<br> 所以：</p><pre class=" language-jsx"><code class="language-jsx"><span class="token number">NaN</span> <span class="token operator">!=</span> <span class="token number">NaN</span>  <span class="token comment" spellcheck="true">// true</span><span class="token number">NaN</span> <span class="token operator">!==</span> <span class="token number">NaN</span>  <span class="token comment" spellcheck="true">// true</span></code></pre><h3 id="和-amp-amp-的问题"><a href="#和-amp-amp-的问题" class="headerlink" title="||和&amp;&amp;的问题"></a>||和&amp;&amp;的问题</h3><pre class=" language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'0 || 1='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1 || 0='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2 || 0='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'0 || 2='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">||</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2 || 1='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1 || 2='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">||</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'  '</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'0 &amp;&amp; 1='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1 &amp;&amp; 0='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2 &amp;&amp; 0='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'0 &amp;&amp; 2='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2 &amp;&amp; 1='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1 &amp;&amp; 2='</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//2</span></code></pre><blockquote><p><strong>&amp;&amp; 是与运算表达式，可以理解为当 &amp;&amp; 前面的值为真时，执行 &amp;&amp; 后面的表达式， &amp;&amp; 前面的表达式为假时，返回false。</strong><br><strong>|| 或运算表达式，可以理解为当 || 前面的值为假时，执行|| 后面的表达式。当 || 前面的表达式为真时，直接返回前面的表达式。</strong></p></blockquote><h3 id="变量声明的问题"><a href="#变量声明的问题" class="headerlink" title="变量声明的问题"></a>变量声明的问题</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">h5course</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//     var a;</span><span class="token comment" spellcheck="true">//     b = 2;</span><span class="token keyword">var</span> a <span class="token operator">=</span> b <span class="token operator">=</span> <span class="token number">2</span>        <span class="token comment" spellcheck="true">//var a=b=2; 等价于 var a=(b=2);</span><span class="token punctuation">}</span>                        <span class="token comment" spellcheck="true">//其中只有a被声明了，b是自动解析为全局变量了</span><span class="token function">h5course</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//a is not defined         false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> b <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//true                         true</span></code></pre><h3 id="变量拼接问题"><a href="#变量拼接问题" class="headerlink" title="变量拼接问题"></a>变量拼接问题</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">11</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">22</span><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A||B='</span> <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">//1122</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>                                    <span class="token comment" spellcheck="true">//33</span></code></pre><h2 id="Vue面试题总结"><a href="#Vue面试题总结" class="headerlink" title="Vue面试题总结"></a>Vue面试题总结</h2><h3 id="1-什么是虚拟-DOM？"><a href="#1-什么是虚拟-DOM？" class="headerlink" title="1.什么是虚拟 DOM？"></a>1.什么是虚拟 DOM？</h3><p>文档对象模型或 DOM 定义了一个接口，该接口允许 JavaScript 之类的语言访问和操作 HTML 文档。元素由树中的节点表示，并且接口允许我们操纵它们。但是此接口需要付出代价，大量非常频繁的 DOM 操作会使页面速度变慢。</p><p>Vue 通过在内存中实现文档结构的虚拟表示来解决此问题，其中虚拟节点（VNode）表示 DOM 树中的节点。当需要操纵时，可以在虚拟 DOM的 内存中执行计算和操作，而不是在真实 DOM 上进行操纵。这自然会更快，并且允许虚拟 DOM 算法计算出最优化的方式来更新实际 DOM 结构。</p><p>一旦计算出，就将其应用于实际的 DOM 树，这就提高了性能，这就是为什么基于虚拟 DOM 的框架（例如 Vue 和 React）如此突出的原因。</p><h2 id="计算机原理题"><a href="#计算机原理题" class="headerlink" title="计算机原理题"></a>计算机原理题</h2><h3 id="讲讲输入完网址按下回车，到看到网页这个过程中发生了什么"><a href="#讲讲输入完网址按下回车，到看到网页这个过程中发生了什么" class="headerlink" title="讲讲输入完网址按下回车，到看到网页这个过程中发生了什么"></a>讲讲输入完网址按下回车，到看到网页这个过程中发生了什么</h3><ul><li>a. 域名解析</li><li>b. 发起TCP的3次握手</li><li>c. 建立TCP连接后发起http请求</li><li>d. 服务器端响应http请求，浏览器得到html代码</li><li>e. 浏览器解析html代码，并请求html代码中的资源</li><li>f. 浏览器对页面进行渲染呈现给用户</li></ul><h3 id="谈谈你对前端性能优化的理解"><a href="#谈谈你对前端性能优化的理解" class="headerlink" title="谈谈你对前端性能优化的理解"></a>谈谈你对前端性能优化的理解</h3><ul><li>a. 请求数量：合并脚本和样式表，CSS Sprites，拆分初始化负载，划分主域</li><li>b. 请求带宽：开启GZip，精简JavaScript，移除重复脚本，图像优化，将icon做成字体</li><li>c. 缓存利用：使用CDN，使用外部JavaScript和CSS，添加Expires头，减少DNS查找，配置ETag，使AjaX可缓存</li><li>d. 页面结构：将样式表放在顶部，将脚本放在底部，尽早刷新文档的输出</li><li>e. 代码校验：避免CSS表达式，避免重定向</li></ul><h3 id="前端-MV-框架的意义"><a href="#前端-MV-框架的意义" class="headerlink" title="前端 MV*框架的意义"></a>前端 MV*框架的意义</h3><p>早期前端都是比较简单，基本以页面为工作单元，内容以浏览型为主，也偶尔有简单的表单操作，基本不太需要框架.</p><p>随着 AJAX 的出现，Web2.0的兴起，人们可以在页面上可以做比较复杂的事情了，然后前端框架才真正出现了。</p><p>如果是页面型产品，多数确实不太需要它，因为页面中的 JavaScript代码，处理交互的绝对远远超过处理模型的，但是如果是应用软件类产品，这就太需要了。</p><p>长期做某个行业软件的公司，一般都会沉淀下来一些业务组件，主要体现在数据模型、业务规则和业务流程，这些组件基本都存在于后端，在前端很少有相应的组织。</p><p>从协作关系上讲，很多前端开发团队每个成员的职责不是很清晰，有了前端的 MV框架，这个状况会大有改观。</p><p>之所以感受不到 MV*框架的重要性，是因为Model部分代码较少，View的相对多一些。如果主要在操作View和Controller，那当然 jQuery 这类库比较好用了。</p><h3 id="请简述盒模型"><a href="#请简述盒模型" class="headerlink" title="请简述盒模型"></a>请简述盒模型</h3><p>IE6盒子模型与W3C盒子模型。</p><p>文档中的每个元素被描绘为矩形盒子。盒子有四个边界：外边距边界margin, 边框边界border, 内边距边界padding与内容边界content。</p><p>CSS3中有个box-sizing属性可以控制盒子的计算方式，</p><p>content-box：padding和border不被包含在定义的width和height之内。对象的实际宽度等于设置的width值和border、padding之和。（W3C盒子模型）</p><p>border-box：padding和border被包含在定义的width和height之内。对象的实际宽度就等于设置的width值。（IE6盒子模型）</p><h3 id="请你谈谈Cookie的弊端"><a href="#请你谈谈Cookie的弊端" class="headerlink" title="请你谈谈Cookie的弊端"></a>请你谈谈Cookie的弊端</h3><ul><li>a. 每个特定的域名下最多生成的cookie个数有限制</li><li>b. IE和Opera 会清理近期最少使用的cookie，Firefox会随机清理cookie</li><li>c. cookie的最大大约为4096字节，为了兼容性，一般不能超过4095字节</li><li>d. 安全性问题。如果cookie被人拦截了，那人就可以取得所有的session信息。</li></ul><h3 id="浏览器本地存储"><a href="#浏览器本地存储" class="headerlink" title="浏览器本地存储"></a>浏览器本地存储</h3><p>在HTML5中提供了sessionStorage和localStorage.</p><p>sessionStorage用于本地存储一个会话（session）中的数据，这些数据只有在同一个会话中的页面才能访问并且当会话结束后数据也随之销毁，是会话级别的存储。</p><p>localStorage用于持久化的本地存储，除非主动删除数据，否则数据是永远不会过期的。</p><h3 id="web-storage和cookie的区别"><a href="#web-storage和cookie的区别" class="headerlink" title="web storage和cookie的区别"></a>web storage和cookie的区别</h3><ul><li>a. Cookie的大小是受限的</li><li>b. 每次你请求一个新的页面的时候Cookie都会被发送过去，这样无形中浪费了带宽</li><li>c. cookie还需要指定作用域，不可以跨域调用</li><li>d. Web Storage拥有setItem,getItem等方法，cookie需要前端开发者自己封装setCookie，getCookie</li><li>e. Cookie的作用是与服务器进行交互，作为HTTP规范的一部分而存在 ，而Web Storage仅仅是为了在本地“存储”数据而生</li><li>f. IE7、IE6中的UserData通过简单的代码封装可以统一到所有的浏览器都支持web storage</li></ul><h3 id="线程与进程的区别"><a href="#线程与进程的区别" class="headerlink" title="线程与进程的区别"></a>线程与进程的区别</h3><ul><li>a. 一个程序至少有一个进程，一个进程至少有一个线程</li><li>b. 线程的划分尺度小于进程，使得多线程程序的并发性高</li><li>c. 进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率</li><li>d. 每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口。但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制</li><li>e. 多线程的意义在于一个应用程序中，有多个执行部分可以同时执行。但操作系统并没有将多个线程看做多个独立的应用，来实现进程的调度和管理以及资源分配</li></ul><h3 id="请说出三种减少页面加载时间的方法"><a href="#请说出三种减少页面加载时间的方法" class="headerlink" title="请说出三种减少页面加载时间的方法"></a>请说出三种减少页面加载时间的方法</h3><ul><li>a. 尽量减少页面中重复的HTTP请求数量</li><li>b. 服务器开启gzip压缩</li><li>c. css样式的定义放置在文件头部</li><li>d. Javascript脚本放在文件末尾</li><li>e. 压缩合并Javascript、CSS代码</li><li>f. 使用多域名负载网页内的多个文件、图片</li></ul><h3 id="你都使用哪些工具来测试代码的性能？"><a href="#你都使用哪些工具来测试代码的性能？" class="headerlink" title="你都使用哪些工具来测试代码的性能？"></a>你都使用哪些工具来测试代码的性能？</h3><p>JSPerf, Dromaeo</p><h3 id="什么叫优雅降级和渐进增强？"><a href="#什么叫优雅降级和渐进增强？" class="headerlink" title="什么叫优雅降级和渐进增强？"></a>什么叫优雅降级和渐进增强？</h3><p>渐进增强 progressive enhancement：</p><p>针对低版本浏览器进行构建页面，保证最基本的功能，然后再针对高级浏览器进行效果、交互等改进和追加功能达到更好的用户体验。</p><p>优雅降级 graceful degradation：</p><p>一开始就构建完整的功能，然后再针对低版本浏览器进行兼容。</p><p>区别：</p><ul><li>a. 优雅降级是从复杂的现状开始，并试图减少用户体验的供给</li><li>b. 渐进增强则是从一个非常基础的，能够起作用的版本开始，并不断扩充，以适应未来环境的需要</li><li>c. 降级（功能衰减）意味着往回看；而渐进增强则意味着朝前看，同时保证其根基处于安全地带</li></ul><h3 id="WEB应用从服务器主动推送Data到客户端有那些方式？"><a href="#WEB应用从服务器主动推送Data到客户端有那些方式？" class="headerlink" title="WEB应用从服务器主动推送Data到客户端有那些方式？"></a>WEB应用从服务器主动推送Data到客户端有那些方式？</h3><ul><li>a. html5 websoket</li><li>b. WebSocket 通过 Flash</li><li>c. XHR长时间连接</li><li>d. XHR Multipart Streaming</li><li>e. 不可见的Iframe</li><li>f. <code>&lt;script&gt;</code>标签的长时间连接(可跨域)</li></ul><h3 id="对前端界面工程师这个职位是怎么样理解的？"><a href="#对前端界面工程师这个职位是怎么样理解的？" class="headerlink" title="对前端界面工程师这个职位是怎么样理解的？"></a>对前端界面工程师这个职位是怎么样理解的？</h3><ul><li>a. 前端是最贴近用户的程序员，前端的能力就是能让产品从 90分进化到 100 分，甚至更好</li><li>b. 参与项目，快速高质量完成实现效果图，精确到1px；</li><li>c. 与团队成员，UI设计，产品经理的沟通；</li><li>d. 做好的页面结构，页面重构和用户体验；</li><li>e. 处理hack，兼容、写出优美的代码格式；</li><li>f. 针对服务器的优化、拥抱最新前端技术。</li></ul><h3 id="平时如何管理你的项目？"><a href="#平时如何管理你的项目？" class="headerlink" title="平时如何管理你的项目？"></a>平时如何管理你的项目？</h3><ul><li>a. 先期团队必须确定好全局样式（globe.css），编码模式(utf-8) 等；</li><li>b. 编写习惯必须一致（例如都是采用继承式的写法，单样式都写成一行）；</li><li>c. 标注样式编写人，各模块都及时标注（标注关键样式调用的地方）；</li><li>d. 页面进行标注（例如 页面 模块 开始和结束）；</li><li>e. CSS跟HTML 分文件夹并行存放，命名都得统一（例如style.css）；</li><li>f. JS 分文件夹存放 命名以该JS功能为准的英文翻译。</li><li>g. 图片采用整合的 images.png png8 格式文件使用 尽量整合在一起使用方便将来的管理</li></ul><h3 id="Flash、Ajax各自的优缺点，在使用中如何取舍？"><a href="#Flash、Ajax各自的优缺点，在使用中如何取舍？" class="headerlink" title="Flash、Ajax各自的优缺点，在使用中如何取舍？"></a>Flash、Ajax各自的优缺点，在使用中如何取舍？</h3><p>Flash：</p><ul><li>a. Flash适合处理多媒体、矢量图形、访问机器</li><li>b. 对CSS、处理文本上不足，不容易被搜索</li></ul><p>Ajax：</p><ul><li>a. Ajax对CSS、文本支持很好，支持搜索</li><li>b. 多媒体、矢量图形、机器访问不足</li></ul><p>共同点：</p><ul><li>a. 与服务器的无刷新传递消息</li><li>b. 可以检测用户离线和在线状态</li><li>c. 操作DOM</li></ul><h3 id="请解释一下-JavaScript-的同源策略"><a href="#请解释一下-JavaScript-的同源策略" class="headerlink" title="请解释一下 JavaScript 的同源策略"></a>请解释一下 JavaScript 的同源策略</h3><p>同源策略指的是：协议，域名，端口相同，同源策略是一种安全协议。</p><p>指一段脚本只能读取来自同一来源的窗口和文档的属性。</p><h3 id="AMD和CMD-规范的区别？"><a href="#AMD和CMD-规范的区别？" class="headerlink" title="AMD和CMD 规范的区别？"></a>AMD和CMD 规范的区别？</h3><p>AMD 提前执行依赖 - 尽早执行，requireJS 是它的实现</p><p>CMD 按需执行依赖 - 懒执行，seaJS 是它的实现</p><h3 id="网站重构的理解"><a href="#网站重构的理解" class="headerlink" title="网站重构的理解"></a>网站重构的理解</h3><p>重构：在不改变外部行为的前提下，简化结构、添加可读性，而在网站前端保持一致的行为。</p><ul><li>a. 使网站前端兼容于现代浏览器(针对于不合规范的CSS、如对IE6有效的)</li><li>b. 对于移动平台的优化，针对于SEO进行优化</li><li>c. 减少代码间的耦合，让代码保持弹性</li><li>d. 压缩或合并JS、CSS、image等前端资源</li></ul><h3 id="浏览器的内核分别是什么"><a href="#浏览器的内核分别是什么" class="headerlink" title="浏览器的内核分别是什么?"></a>浏览器的内核分别是什么?</h3><p>IE浏览器的内核Trident、Mozilla的Gecko、Chrome的Blink（WebKit的分支）、Opera内核原为Presto，现为Blink</p><h3 id="请介绍下cache-control"><a href="#请介绍下cache-control" class="headerlink" title="请介绍下cache-control"></a>请介绍下cache-control</h3><p>每个资源都可以通过 Cache-Control HTTP 头来定义自己的缓存策略</p><p>Cache-Control 指令控制谁在什么条件下可以缓存响应以及可以缓存多久</p><p>Cache-Control 头在 HTTP/1.1 规范中定义，取代了之前用来定义响应缓存策略的头（例如 Expires）。</p><h3 id="前端页面有哪三层构成，分别是什么？作用是什么？"><a href="#前端页面有哪三层构成，分别是什么？作用是什么？" class="headerlink" title="前端页面有哪三层构成，分别是什么？作用是什么？"></a>前端页面有哪三层构成，分别是什么？作用是什么？</h3><ul><li>a. 结构层：由 HTML 或 XHTML 之类的标记语言负责创建，仅负责语义的表达。解决了页面“内容是什么”的问题。</li><li>b. 表示层：由CSS负责创建，解决了页面“如何显示内容”的问题。</li><li>c. 行为层：由脚本负责。解决了页面上“内容应该如何对事件作出反应”的问题。</li></ul><h3 id="知道的网页制作会用到的图片格式有哪些？"><a href="#知道的网页制作会用到的图片格式有哪些？" class="headerlink" title="知道的网页制作会用到的图片格式有哪些？"></a>知道的网页制作会用到的图片格式有哪些？</h3><p>png-8，png-24，jpeg，gif，svg</p><p>Webp：谷歌（google）开发的一种旨在加快图片加载速度的图片格式。图片压缩体积大约只有JPEG的2/3，并能节省大量的服务器带宽资源和数据空间。Facebook Ebay等知名网站已经开始测试并使用WebP格式。</p><p>Apng：全称是“Animated Portable Network Graphics”, 是PNG的位图动画扩展，可以实现png格式的动态图片效果。04年诞生，但一直得不到各大浏览器厂商的支持，直到日前得到 iOS safari 8的支持，有望代替GIF成为下一代动态图标准。</p><h3 id="一次js请求一般情况下有哪些地方会有缓存处理？"><a href="#一次js请求一般情况下有哪些地方会有缓存处理？" class="headerlink" title="一次js请求一般情况下有哪些地方会有缓存处理？"></a>一次js请求一般情况下有哪些地方会有缓存处理？</h3><ul><li>a. 浏览器端存储</li><li>b. 浏览器端文件缓存</li><li>c. HTTP缓存304</li><li>d. 服务器端文件类型缓存</li><li>e. 表现层&amp;DOM缓存</li></ul><h3 id="一个页面上有大量的图片（大型电商网站），加载很慢，你有哪些方法优化这些图片的加载，给用户更好的体验。"><a href="#一个页面上有大量的图片（大型电商网站），加载很慢，你有哪些方法优化这些图片的加载，给用户更好的体验。" class="headerlink" title="一个页面上有大量的图片（大型电商网站），加载很慢，你有哪些方法优化这些图片的加载，给用户更好的体验。"></a>一个页面上有大量的图片（大型电商网站），加载很慢，你有哪些方法优化这些图片的加载，给用户更好的体验。</h3><ul><li>a. 图片懒加载，滚动到相应位置才加载图片。</li><li>b. 图片预加载，如果为幻灯片、相册等，将当前展示图片的前一张和后一张优先下载。</li><li>c. 使用CSSsprite，SVGsprite，Iconfont、Base64等技术，如果图片为css图片的话。</li><li>d. 如果图片过大，可以使用特殊编码的图片，加载时会先加载一张压缩的特别厉害的缩略图，以提高用户体验。</li></ul><h3 id="谈谈以前端角度出发做好SEO需要考虑什么？"><a href="#谈谈以前端角度出发做好SEO需要考虑什么？" class="headerlink" title="谈谈以前端角度出发做好SEO需要考虑什么？"></a>谈谈以前端角度出发做好SEO需要考虑什么？</h3><ul><li>a. 了解搜索引擎如何抓取网页和如何索引网页</li><li>b. meta标签优化</li><li>c. 关键词分析</li><li>d. 付费给搜索引擎</li><li>e. 链接交换和链接广泛度（Link Popularity）</li><li>f. 合理的标签使用</li></ul><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><blockquote><p>文章内有引用于：<br>版权声明：本文为CSDN博主「Eric_qf」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qfxietian/article/details/90608484" target="_blank" rel="noopener">https://blog.csdn.net/qfxietian/article/details/90608484</a></p></blockquote><h3 id="1-lt-img-gt-标签上title属性与alt属性的区别是什么？"><a href="#1-lt-img-gt-标签上title属性与alt属性的区别是什么？" class="headerlink" title="1.&lt;img&gt;标签上title属性与alt属性的区别是什么？"></a>1.<code>&lt;img&gt;</code>标签上title属性与alt属性的区别是什么？</h3><p>alt属性是为了给那些不能看到你文档中图像的浏览者提供文字说明的。且长度必须少于100个英文字符或者用户必须保证替换文字尽可能的短。</p><p>这包括那些使用本来就不支持图像显示或者图像显示被关闭的浏览器的用户，视觉障碍的用户和使用屏幕阅读器的用户等。</p><p>title属性为设置该属性的元素提供建议性的信息。使用title属性提供非本质的额外信息。</p><h3 id="2-请写出至少5个html5新增的标签，并说明其语义和应用场景"><a href="#2-请写出至少5个html5新增的标签，并说明其语义和应用场景" class="headerlink" title="2.请写出至少5个html5新增的标签，并说明其语义和应用场景"></a>2.请写出至少5个html5新增的标签，并说明其语义和应用场景</h3><p>section：定义文档中的一个章节</p><p>nav：定义只包含导航链接的章节</p><p>header：定义页面或章节的头部。它经常包含 logo、页面标题和导航性的目录。</p><p>footer：定义页面或章节的尾部。它经常包含版权信息、法律信息链接和反馈建议用的地址。</p><p>aside：定义和页面内容关联度较低的内容——如果被删除，剩下的内容仍然很合理。</p><h3 id="3-请说说你对标签语义化的理解？"><a href="#3-请说说你对标签语义化的理解？" class="headerlink" title="3.请说说你对标签语义化的理解？"></a>3.请说说你对标签语义化的理解？</h3><ul><li>a. 去掉或者丢失样式的时候能够让页面呈现出清晰的结构</li><li>b. 有利于SEO：和搜索引擎建立良好沟通，有助于爬虫抓取更多的有效信息：爬虫依赖于标签来确定上下文和各个关键字的权重；</li><li>c. 方便其他设备解析（如屏幕阅读器、盲人阅读器、移动设备）以意义的方式来渲染网页；</li><li>d. 便于团队开发和维护，语义化更具可读性，遵循W3C标准的团队都遵循这个标准，可以减少差异化。</li></ul><h3 id="4-Doctype作用-严格模式与混杂模式如何区分？它们有何意义"><a href="#4-Doctype作用-严格模式与混杂模式如何区分？它们有何意义" class="headerlink" title="4.Doctype作用? 严格模式与混杂模式如何区分？它们有何意义?"></a>4.Doctype作用? 严格模式与混杂模式如何区分？它们有何意义?</h3><!DOCTYPE><p> 声明位于文档中的最前面，处于 <html> 标签之前。告知浏览器以何种模式来渲染文档。</p><p>严格模式的排版和 JS 运作模式是，以该浏览器支持的最高标准运行。</p><p>在混杂模式中，页面以宽松的向后兼容的方式显示。模拟老式浏览器的行为以防止站点无法工作。</p><p>DOCTYPE不存在或格式不正确会导致文档以混杂模式呈现。</p><h3 id="5-你知道多少种Doctype文档类型？"><a href="#5-你知道多少种Doctype文档类型？" class="headerlink" title="5.你知道多少种Doctype文档类型？"></a>5.你知道多少种Doctype文档类型？</h3><p>标签可声明三种 DTD 类型，分别表示严格版本、过渡版本以及基于框架的 HTML 文档。</p><p>HTML 4.01 规定了三种文档类型：Strict、Transitional 以及 Frameset。</p><p>XHTML 1.0 规定了三种 XML 文档类型：Strict、Transitional 以及 Frameset。</p><p>Standards （标准）模式（也就是严格呈现模式）用于呈现遵循最新标准的网页，</p><p>Quirks（包容）模式（也就是松散呈现模式或者兼容模式）用于呈现为传统浏览器而设计的网页。</p><h3 id="6-HTML与XHTML——二者有什么区别"><a href="#6-HTML与XHTML——二者有什么区别" class="headerlink" title="6.HTML与XHTML——二者有什么区别"></a>6.HTML与XHTML——二者有什么区别</h3><ul><li>a. XHTML 元素必须被正确地嵌套。</li><li>b. XHTML 元素必须被关闭。</li><li>c. 标签名必须用小写字母。</li><li>d. XHTML 文档必须拥有根元素。</li></ul><h3 id="7-html5有哪些新特性、移除了那些元素？"><a href="#7-html5有哪些新特性、移除了那些元素？" class="headerlink" title="7.html5有哪些新特性、移除了那些元素？"></a>7.html5有哪些新特性、移除了那些元素？</h3><ul><li>a. HTML5 现在已经不是 SGML 的子集，主要是关于图像，位置，存储，多任务等功能的增加。</li><li>b. 拖拽释放(Drag and drop) API</li><li>c. 语义化更好的内容标签（header,nav,footer,aside,article,section）</li><li>d. 音频、视频API(audio,video)</li><li>e. 画布(Canvas) API</li><li>f. 地理(Geolocation) API</li><li>g. 本地离线存储 localStorage 长期存储数据，浏览器关闭后数据不丢失</li><li>h. sessionStorage 的数据在页面会话结束时会被清除</li><li>i. 表单控件，calendar、date、time、email、url、search</li><li>j. 新的技术webworker, websocket等</li></ul><p>移除的元素：</p><ul><li>a. 纯表现的元素：basefont，big，center, s，strike，tt，u；</li><li>b. 对可用性产生负面影响的元素：frame，frameset，noframes；</li></ul><h3 id="8-iframe的优缺点？"><a href="#8-iframe的优缺点？" class="headerlink" title="8.iframe的优缺点？"></a>8.iframe的优缺点？</h3><p>优点：</p><ul><li>a. 解决加载缓慢的第三方内容如图标和广告等的加载问题</li><li>b. iframe无刷新文件上传</li><li>c. iframe跨域通信</li></ul><p>缺点：</p><ul><li>a. iframe会阻塞主页面的Onload事件</li><li>b. 无法被一些搜索引擎索引到</li><li>c. 页面会增加服务器的http请求</li><li>d. 会产生很多页面，不容易管理。</li></ul><h3 id="9-Quirks模式是什么？它和Standards模式有什么区别？"><a href="#9-Quirks模式是什么？它和Standards模式有什么区别？" class="headerlink" title="9.Quirks模式是什么？它和Standards模式有什么区别？"></a>9.Quirks模式是什么？它和Standards模式有什么区别？</h3><p>在写程序时我们也会经常遇到这样的问题，如何保证原来的接口不变，又提供更强大的功能，尤其是新功能不兼容旧功能时。IE6以前的页面大家都不会去写DTD，所以IE6就假定 如果写了DTD，就意味着这个页面将采用对CSS支持更好的布局，而如果没有，则采用兼容之前的布局方式。这就是Quirks模式（怪癖模式，诡异模式，怪异模式）。</p><p>区别：总体会有布局、样式解析和脚本执行三个方面的区别。</p><ul><li>a. 盒模型：在W3C标准中，如果设置一个元素的宽度和高度，指的是元素内容的宽度和高度，而在Quirks 模式下，IE的宽度和高度还包含了padding和border。</li><li>b. 设置行内元素的高宽：在Standards模式下，给<span>等行内元素设置wdith和height都不会生效，而在quirks模式下，则会生效。</li><li>c. 设置百分比的高度：在standards模式下，一个元素的高度是由其包含的内容来决定的，如果父元素没有设置百分比的高度，子元素设置一个百分比的高度是无效的用</li><li>d. 设置水平居中：使用margin:0 auto在standards模式下可以使元素水平居中，但在quirks模式下却会失效。</li></ul><h3 id="10-请阐述table的缺点"><a href="#10-请阐述table的缺点" class="headerlink" title="10.请阐述table的缺点"></a>10.请阐述table的缺点</h3><ul><li>a. 太深的嵌套，比如table&gt;tr&gt;td&gt;h3，会导致搜索引擎读取困难，而且，最直接的损失就是大大增加了冗余代码量。</li><li>b. 灵活性差，比如要将tr设置border等属性，是不行的，得通过td</li><li>c. 代码臃肿，当在table中套用table的时候，阅读代码会显得异常混乱</li><li>d. 混乱的colspan与rowspan，用来布局时，频繁使用他们会造成整个文档顺序混乱。</li><li>e. table需要多次计算才能确定好其在渲染树中节点的属性，通常要花3倍于同等元素的时间。</li><li>f. 不够语义</li></ul><h3 id="11-简述一下src与href的区别"><a href="#11-简述一下src与href的区别" class="headerlink" title="11.简述一下src与href的区别"></a>11.简述一下src与href的区别</h3><p>src用于替换当前元素；href用于在当前文档和引用资源之间确立联系。</p><p>src是source的缩写，指向外部资源的位置，指向的内容将会嵌入到文档中当前标签所在位置</p><p>href是Hypertext Reference的缩写，指向网络资源所在位置，建立和当前元素（锚点）或当前文档（链接）之间的链接</p><h3 id="12-HTML与XHTML——二者有什么区别"><a href="#12-HTML与XHTML——二者有什么区别" class="headerlink" title="12.HTML与XHTML——二者有什么区别?"></a>12.HTML与XHTML——二者有什么区别?</h3><ol><li>HTML 元素必须被正确地嵌套。</li><li>XHTML 元素必须被关闭。</li><li>标签名必须用小写字母。</li><li>XHTML 文档必须拥有根元素。</li></ol><h3 id="13-iframe的优缺点"><a href="#13-iframe的优缺点" class="headerlink" title="13.iframe的优缺点?"></a>13.iframe的优缺点?</h3><p>​    答案：优点：</p><ul><li><p>a. 解决加载缓慢的第三方内容如图标和广告等的加载问题</p></li><li><p>b. iframe无刷新文件上传 c. iframe跨域通信</p></li></ul><p>缺点：</p><ul><li><p>a. iframe会阻塞主页面的Onload事件 b. 无法被一些搜索引擎索引到</p></li><li><p>c. 页面会增加服务器的http请求 d. 会产生很多页面，不容易管理。</p></li></ul><h3 id="14-全屏滚动的原理是什么-用到了CSS的哪些属性"><a href="#14-全屏滚动的原理是什么-用到了CSS的哪些属性" class="headerlink" title="14.全屏滚动的原理是什么?用到了CSS的哪些属性?"></a>14.全屏滚动的原理是什么?用到了CSS的哪些属性?</h3><p>　　答案：原理：有点类似于轮播，整体的元素一直排列下去，假设有5个需要展示的全屏页面，那么高度是500%，只是展示100%，剩下的可以通过transform进行y轴定位，也可以通过margin-top实现</p><p>　　overflow：hidden;transition：all 1000ms ease;</p><h3 id="15-页面导入样式时，使用link和-import有什么区别"><a href="#15-页面导入样式时，使用link和-import有什么区别" class="headerlink" title="15.页面导入样式时，使用link和@import有什么区别?"></a>15.页面导入样式时，使用link和@import有什么区别?</h3><ul><li><p>差别1：本质的差别：link属于XHTML标签，而@import完全是CSS提供的一种方式。</p></li><li><p>差别2：加载顺序的差别：当一个页面被加载的时候(就是被浏览者浏览的时候)，link引用的CSS会同时被加载，而@import引用的CSS会等到页面全部被下载完再被加载。所以有时候浏览@import加载CSS的页面时开始会没有样式(就是闪烁)，网速慢的时候还挺明显。</p></li><li><p>差别3：兼容性的差别：@import是CSS2.1提出的，所以老的浏览器不支持，@import只有在IE5以上的才能识别，而link标签无此问题。</p></li><li><p>差别4：使用dom(document o bject model文档对象模型  )控制样式时的差别：当使用javascript控制dom去改变样式的时候，只能使用link标签，因为@import不是dom可以控制的.</p></li></ul><h3 id="16-before-和-after中双冒号和单冒号有什么区别-解释一下这2个伪元素的作用"><a href="#16-before-和-after中双冒号和单冒号有什么区别-解释一下这2个伪元素的作用" class="headerlink" title="16.::before 和 :after中双冒号和单冒号有什么区别?解释一下这2个伪元素的作用"></a>16.::before 和 :after中双冒号和单冒号有什么区别?解释一下这2个伪元素的作用</h3><p>答案：单冒号(:)用于CSS3伪类，双冒号(::)用于CSS3伪元素。</p><ul><li><p>::before就是以一个子元素的存在，定义在元素主体内容之前的一个伪元素。并不存在于dom之中，只存在在页面之中。</p></li><li><p>:before 和 :after  这两个伪元素，是在CSS2.1里新出现的。起初，伪元素的前缀使用的是单冒号语法，但随着Web的进化，在CSS3的规范里，伪元素的语法被修改成使用双冒号，成为::before  ::after</p></li></ul><h3 id="17-怎么让Chrome支持小于12px-的文字"><a href="#17-怎么让Chrome支持小于12px-的文字" class="headerlink" title="17.怎么让Chrome支持小于12px 的文字?"></a>17.怎么让Chrome支持小于12px 的文字?</h3><p>　答案：p{font-size:10px;-webkit-transform:scale(0.8);}//0.8是缩放比例</p><h3 id="18-简述一下你对HTML语义化的理解"><a href="#18-简述一下你对HTML语义化的理解" class="headerlink" title="18.简述一下你对HTML语义化的理解?"></a>18.简述一下你对HTML语义化的理解?</h3><p>答案：</p><ol><li><p>用正确的标签做正确的事情。</p></li><li><p>html语义化让页面的内容结构化，结构更清晰，便于对浏览器，搜索引擎解析;</p></li><li><p>即使在没有样式CSS情况下也以一种文档格式显示，并且是容易阅读的;</p></li><li><p>搜索引擎的爬虫也依赖于HTML标记确定上下文和各个关键字的权重，利用SEO;</p></li><li><p>使阅读源代码的人对网站更容易将网站分块，便于阅读维护理解。</p></li></ol><h2 id="9道价值20k薪资的“VUE必备面试题”，快来围观！"><a href="#9道价值20k薪资的“VUE必备面试题”，快来围观！" class="headerlink" title="9道价值20k薪资的“VUE必备面试题”，快来围观！"></a>9道价值20k薪资的“VUE必备面试题”，快来围观！</h2><blockquote><p>本文引用于：<a href="https://zhuanlan.zhihu.com/p/142412438" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/142412438</a></p></blockquote><h3 id="（1）v-if和v-for谁的优先级最高？"><a href="#（1）v-if和v-for谁的优先级最高？" class="headerlink" title="（1）v-if和v-for谁的优先级最高？"></a>（1）v-if和v-for谁的优先级最高？</h3><p>当面试官提出这个问题时，显然想要考察应聘者对v-if和v-for的“基本功”，同时还想要考察应聘者<strong>如何将理论应用到操作里</strong>。</p><p>基于以上两点，我们可以拓展问题：</p><p><strong>当v-if和v-for同时出现时，我们应该怎样优化从而获得更好的性能？</strong></p><p>得知了面试官的隐含问题，接下来我们对症下药就可以了。</p><p>首先，在源码中找答案：</p><p>compiler/codegen/index.js（☜文件中的位置）</p><p>做个测试如下：</p><p><img src="https://pic1.zhimg.com/80/v2-3698f55bfe3594ca09f606fdf4588932_720w.jpg" alt="img"></p><p>两者<strong>同级</strong>时，渲染函数如下：</p><p><img src="https://pic2.zhimg.com/80/v2-ccb5285e05aae8d1998f8a68ccf9b097_720w.jpg" alt="img"></p><p><strong>_l包含了isFolder的条件判断☝☝</strong></p><p>两者<strong>不同级</strong>时，渲染函数如下：</p><p><img src="https://pic3.zhimg.com/80/v2-6aeb44409c07b43f66d0af9bb42e4b3f_720w.jpg" alt="img"></p><p><strong>先判断条件再决定是否执行☝☝</strong></p><p><strong>正确解答：</strong></p><p>1、显然v-for优先于v-if被解析（<strong>把你是怎么知道的告诉面试官</strong>）</p><p>2、如果同时出现，每次渲染都会先执行循环再判断条件，无论如何循环都不可避免，浪费了性能</p><p>3、要避免出现这种情况，则在外层嵌套template，在这一层进行v-if判断，然后在内部进行v-for循环</p><p>4、如果条件出现在循环内部，可通过计算属性提前过滤掉那些不需要显示的项</p><p>（2）VUE组件data为什么必须是函数</p><p>我们都知道，<strong>VUE的data实例</strong>必须是函数，那么有没有与之相反的情况呢？答案是肯定的，因为<strong>VUE的根实例</strong>就没有“必须是函数”这个限制的。</p><p>所以，我们在对这道题进行解答之前，我们还要考虑与<strong>“VUE组件data对象实例”</strong>所对应的<strong>“VUE的根实例”。</strong></p><p>通过两者的对比论证，会让我们的答案更加清晰缜密、更有说服力。</p><p><strong>源码中找答案：</strong></p><p>src\core\instance\state.js - initData()</p><p>文件中的位置☝</p><p>通过源码得知：</p><p><strong>函数每次执行都会返回全新data对象实例</strong></p><p>测试代码如下：</p><p><img src="https://pic3.zhimg.com/80/v2-67a4ef1e28f10fadc8550fb4f3e755ff_720w.jpg" alt="img"></p><p>然而程序甚至无法通过vue检测☟☟</p><p><img src="https://picb.zhimg.com/80/v2-87b3472b0a0f900be64ae5a548171259_720w.jpg" alt="img"></p><p><strong>正确解答：</strong></p><p>Vue组件可能存在多个实例，如果使用对象形式定义data，则<strong>会导致它们共用一个data对象</strong>，那么状态变更将会影响所有组件实例，这是不合理的；</p><p><strong>采用函数形式定义，在initData时会将其作为工厂函数返回全新data对象</strong>，有效规避多实例之间状态污染问题。</p><p>而在<strong>Vue根实例</strong>创建过程中则不存在该限制，也是<strong>因为根实例只能有一个</strong>，不需要担心这种情况。</p><h3 id="（3）vue中key的作用和工作原理"><a href="#（3）vue中key的作用和工作原理" class="headerlink" title="（3）vue中key的作用和工作原理"></a>（3）vue中key的作用和工作原理</h3><p>为了表达的更加透彻，我们可以通过对比测试来寻找key的工作原理：</p><p>首先是在源码中找答案，它在文件中的位置是☟</p><p>src\core\vdom\patch.js - updateChildren()</p><p>测试代码如下：</p><p><img src="https://picb.zhimg.com/80/v2-9b3e505467fa22a6daf3c8c07d651391_720w.jpg" alt="img"></p><p>本次案例代码重现的是以下过程☟☟：</p><p><img src="https://pic2.zhimg.com/80/v2-ea901d1d7eabe55b21b0b7cbbc119f60_720w.jpg" alt="img"></p><p>在不使用Key的情况下是这样的☟☟：</p><p><img src="https://pic3.zhimg.com/80/v2-71647c38fe0bfd3875db4b8a14689bc7_720w.jpg" alt="img"></p><p>如果使用Key☟☟：</p><pre><code>// 首次循环patch AA B C D EA B F C D E// 第2次循环patch BB C D EB F C D E// 第3次循环patch EC D EF C D E// 第4次循环patch DC DF C D// 第5次循环patch CCF C// oldCh全部处理结束，newCh中剩下的F，创建F并插入到C前面</code></pre><p><strong>正确解答：</strong></p><p>1、<strong>key的作用主要是为了高效的更新虚拟DOM</strong>，其原理是vue在patch过程中通过key可以精准判断两个节点是否是同一个，从而避免频繁更新不同元素，使得整个patch过程更加高效，减少DOM操作量，提高性能。</p><p>2、另外，若<strong>不设置key还可能在列表更新时引发一些隐蔽的bug</strong></p><p>3、vue中在使用相同标签名元素的过渡切换时，也会<strong>使用到key属性，其目的也是为了让vue可以区分它们，否则vue只会替换其内部属性而不会触发过渡效果。</strong></p><h3 id="（4）你怎么理解vue中的diff算法？"><a href="#（4）你怎么理解vue中的diff算法？" class="headerlink" title="（4）你怎么理解vue中的diff算法？"></a><strong>（4）你怎么理解vue中的diff算法？</strong></h3><p><strong>在分析diff算法之前，我们可以看一下VUE的diff算法模型图：</strong></p><p><img src="https://pic4.zhimg.com/80/v2-99f40beef5c4eb5bca08283be7d2c752_720w.jpg" alt="img"></p><p>接下来还是先从源码入手解决问题：</p><p><strong>源码分析1：必要性</strong></p><p>lifecycle.js - mountComponent()</p><p>组件中可能存在很多个data中的key使用</p><p><strong>源码分析2：执行方式</strong></p><p>patch.js - patchVnode()</p><p>patchVnode是diff发生的地方</p><p>整体策略：深度优先，同层比较</p><p><strong>源码分析3：高效性</strong></p><p>patch.js - updateChildren()</p><p>测试代码如下：</p><p><img src="https://pic4.zhimg.com/80/v2-0453b5b0aad4b0abc9c8a07d3760eb8a_720w.jpg" alt="img"></p><p><strong>正确解答：</strong></p><p>1、<strong>diff算法是虚拟DOM技术的必然产物</strong>：通过新旧虚拟DOM作对比（即diff），将变化的地方更新在真实DOM上；</p><p>另外，也需要diff高效的执行对比过程，从而降低时间复杂度为O(n)。</p><p>2、vue 2.x中为了降低Watcher粒度，每个组件只有一个Watcher与之对应，只有<strong>引入diff才能精确找到发生变化的地方。</strong></p><p>3、vue中diff执行的时刻是组件实例执行其更新函数时，它会比对上一次渲染结果oldVnode和新的渲染结果newVnode，此过程称为<strong>patch</strong>。</p><p>4、<strong>diff过程整体遵循深度优先、同层比较的策略</strong>；两个节点之间比较会根据它们是否拥有子节点或者文本节点做不同操作；</p><p>比较两组子节点是算法的重点，首先假设头尾节点可能相同做4次比对尝试；</p><p>如果没有找到相同节点才按照通用方式遍历查找，查找结束再按情况处理剩下的节点；</p><p><strong>借助key通常可以非常精确找到相同节点，因此整个patch过程非常高效。</strong></p><h3 id="（5）谈一谈对vue组件化的理解？"><a href="#（5）谈一谈对vue组件化的理解？" class="headerlink" title="（5）谈一谈对vue组件化的理解？"></a>（5）谈一谈对vue组件化的理解？</h3><p>听到“理解”两个字我们就要注意了，看似一道开放性的问题，实际是要考察我们对VUE组件化的认知基础。</p><p>我们可以从定义、优点、使用场景和注意事项等方面展开陈述，同时要强调vue中组件化的一些特点。</p><p>始终不变的是“从源码深入解决问题，最终达到深入浅出的效果。”</p><p><strong>源码分析1：组件定义</strong></p><pre class=" language-text"><code class="language-text">src\core\global-api\assets.js（☝文件中的位置）// 组件定义Vue.component('comp', {template: '<div>this is a component</div>'})</code></pre><p>vue-loader会编译template为render函数，最终导出的依然是组件配置对象。☟</p><pre class=" language-text"><code class="language-text"><template><div>        this is a component    </div></template></code></pre><p><strong>源码分析2：组件化优点</strong></p><p>lifecycle.js - mountComponent()</p><p>☝组件、Watcher、渲染函数和更新函数之间的关系</p><p><strong>源码分析3：组件化实现</strong></p><p>构造函数，</p><p>src\core\global-api\extend.js</p><p>实例化及挂载，</p><p>src\core\vdom\patch.js - createElm()</p><p><strong>正确解答：</strong></p><p>1、组件是独立和可复用的代码组织单元。组件系统是 Vue 核心特性之一，它使开发者使用小型、独立和通常可复用的组件构建大型应用；</p><p>2、组件化开发能大幅提高应用开发效率、测试性、复用性等；</p><p>3、组件使用按分类有：页面组件、业务组件、通用组件；</p><p>4、vue的组件是基于配置的，我们通常编写的组件是组件配置而非组件，框架后续会生成其构造函数，它们基于VueComponent，扩展于Vue；</p><p>5、vue中常见组件化技术有：属性prop，自定义事件，插槽等，它们主要用于组件通信、扩展等；</p><p>6、合理的划分组件，有助于提升应用性能；</p><p>7、组件应该是高内聚、低耦合的；</p><p>8、遵循单向数据流的原则。</p><h3 id="（6）谈一谈对vue设计原则的理解？"><a href="#（6）谈一谈对vue设计原则的理解？" class="headerlink" title="（6）谈一谈对vue设计原则的理解？"></a>（6）谈一谈对vue设计原则的理解？</h3><p>和上一题的思路一样，我们首先要明确：关于VUE设计原则，我们要从哪几个方面入手进行详细解答？</p><p>而在vue的官网上，就写着大大的定义和特点：</p><p>渐进式JavaScript框架</p><p>易用、灵活和高效</p><p>所以阐述此题的整体思路按照这个展开即可。</p><p><strong>正确解答：</strong></p><p>首先就是渐进式JavaScript框架：</p><p>与其它大型框架不同的是，Vue 被设计为可以自底向上逐层应用。</p><p>Vue 的核心库只关注视图层，不仅易于上手，还便于与第三方库或既有项目整合。</p><p>另一方面，当与现代化的工具链以及各种支持类库结合使用时，Vue 也完全能够为复杂的单页应用提供驱动。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200711221809.jpg" alt="img"></p><p><strong>易用性</strong></p><p>vue提供数据响应式、声明式模板语法和基于配置的组件系统等核心特性。</p><p>这些使我们只需要关注应用的核心业务即可，只要会写js、html和css就能轻松编写vue应用。</p><p><strong>灵活性</strong></p><p>渐进式框架的最大优点就是灵活性，如果应用足够小，我们可能仅需要vue核心特性即可完成功能；</p><p>随着应用规模不断扩大，我们才可能逐渐引入路由、状态管理、vue-cli等库和工具；</p><p>不管是应用体积还是学习难度都是一个逐渐增加的平和曲线。</p><p><strong>高效性</strong></p><p>超快的虚拟 DOM 和 diff 算法使我们的应用拥有最佳的性能表现。</p><p>追求高效的过程还在继续，vue3中引入Proxy对数据响应式改进以及编译器中对于静态内容编译的改进都会让vue更加高效。</p><h3 id="（7）对MVC、MVP和MVVM的理解"><a href="#（7）对MVC、MVP和MVVM的理解" class="headerlink" title="（7）对MVC、MVP和MVVM的理解"></a><strong>（7）对MVC、MVP和MVVM的理解</strong></h3><p>当我们面对这道考题时，往往有些摸不着头脑，因为MVC、MVP和MVVM的知识点非常广泛，很难做到说清、说透。</p><p>那要怎么才能回答的简洁有条理？让面试官眼前一亮呢？</p><p>来听我给你清晰解读一下这道题的正确思路吧！</p><p>其实在日常工作中，类似MVP、MVC这类前端程序，我们程序员甚至自己都没用过，这恰恰就反映了：</p><p><strong>前端这些年从无到有，从有到优的变迁过程。</strong></p><p>想到这里，我们的解题思路便慢慢浮出水面了，那就是：</p><p><strong>按时间顺序，浅谈MVC、MVP、MVVM等系列产品的更新迭代。</strong></p><p><strong>Web1.0时代</strong></p><p>在web1.0时代，并没有前端的概念。</p><p>开发一个web应用多数采用：</p><p><strong><a href="https://link.zhihu.com/?target=http%3A//ASP.NET/Java/PHP">http://ASP.NET/Java/PHP</a></strong>编写，</p><p>项目通常由多个aspx/jsp/php文件构成。</p><p>每个文件中同时包含了<strong>HTML、CSS、JavaScript、C#/Java/PHP</strong>代码。</p><p>系统整体架构可能是这样子的☟：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200711221829.jpg" alt="img"></p><p>这种架构的好处是简单快捷，但是，缺点也非常明显：JSP代码难以维护</p><p>为了让开发更加便捷，代码更易维护，前后端职责更清晰。便衍生出MVC开发模式和框架，前端展示以模板的形式出现。</p><p>典型的框架就是：</p><p><strong>Spring、Structs、Hibernate。</strong></p><p>整体框架如图所示☟：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200711221829.jpg" alt="img"></p><p>使用这种分层架构，职责清晰，代码易维护。</p><p>但这里的MVC仅限于后端，前后端形成了一定的分离，前端只完成了后端开发中的view层。</p><p>但是，同样的这种模式存在着一些问题：</p><p>1、前端页面开发效率不高</p><p>2、前后端职责不清</p><p><strong>web 2.0时代</strong></p><p>自从Gmail的出现，ajax技术开始风靡全球。有了ajax之后，前后端的职责就更加清晰了。</p><p>因为前端可以通过Ajax与后端进行数据交互，因此，整体的架构图也变化成了下面这幅图☟：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200711221829.jpg" alt="img"></p><p>通过ajax与后台服务器进行数据交换，前端开发人员，只需要开发页面这部分内容，数据可由后台进行提供。</p><p>而且ajax可以使得页面实现部分刷新，减少了服务端负载和流量消耗，用户体验也更佳。</p><p>这时，才开始有专职的前端工程师。同时前端的类库也慢慢的开始发展，最著名的就是jQuery了。</p><p>当然，此架构也存在问题：缺乏可行的开发模式承载更复杂的业务需求，页面内容都杂糅在一起，一旦应用规模增大，就会导致难以维护了。</p><p>因此，前端的MVC也随之而来。</p><p><strong>前后端分离后的架构演变——MVC、MVP和MVVM</strong></p><p><strong>MVC</strong></p><p>前端的MVC与后端类似，具备着View、Controller和Model。</p><p>Model：负责保存应用数据，与后端数据进行同步</p><p>Controller：负责业务逻辑，根据用户行为对Model数据进行修改</p><p>View：负责视图展示，将model中的数据可视化出来。</p><p>三者形成了一个如图所示的模型：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200711221829.jpg" alt="img"></p><p>这样的模型，在理论上是可行的。但往往在实际开发中，并不会这样操作。因为开发过程并不灵活。</p><p>例如，一个小小的事件操作，都必须经过这样的一个流程，那么开发就不再便捷了。</p><p>在实际场景中，我们往往会看到另一种模式，</p><p>如图所示☟：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200711221829.jpg" alt="img"></p><p>这种模式在开发中更加的灵活，backbone.js框架就是这种的模式。</p><p>但是，这种灵活可能导致严重的问题：</p><p>1、数据流混乱：如下图☟</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200711221829.jpg" alt="img"></p><p>2、View比较庞大，而Controller比较单薄：</p><p>由于很多的开发者都会在view中写一些逻辑代码，逐渐的就导致view中的内容越来越庞大，而controller变得越来越单薄。</p><p>既然有缺陷，就会有变革。</p><p>前端的变化中，似乎少了MVP的这种模式，是因为AngularJS早早地将MVVM框架模式带入了前端。</p><p>MVP模式虽然前端开发并不常见，但是在安卓等原生开发中，开发者还是会考虑到它。</p><p><strong>MVP</strong></p><p>MVP与MVC很接近，P指的是Presenter，presenter可以理解为一个中间人。</p><p>它负责着View和Model之间的数据流动，防止View和Model之间直接交流。</p><p>我们可以看一下图示☟</p><p><img src="https://picb.zhimg.com/80/v2-f0329992777c47187eab7825b63417b1_720w.jpg" alt="img"></p><p>我们可以通过看到，presenter负责和Model进行双向交互，还和View进行双向交互。</p><p>这种交互方式，相对于MVC来说少了一些灵活，VIew变成了被动视图，并且本身变得很小。虽然它分离了View和Model。</p><p>但是应用逐渐变大之后，导致presenter的体积增大，难以维护。</p><p>要解决这个问题，或许可以从MVVM的思想中找到答案。</p><p><strong>MVVM</strong></p><p>首先，何为MVVM呢？MVVM可以分解成(Model-View-VIewModel)。</p><p>ViewModel可以理解为在presenter基础上的进阶版。如图所示☟☟：</p><p><img src="https://picb.zhimg.com/80/v2-1e9b8c442d26b2d38e1e3584ca2b983d_720w.jpg" alt="img"></p><p>ViewModel通过实现一套数据响应式机制自动响应Model中数据变化；</p><p>同时Viewmodel会实现一套更新策略自动将数据变化转换为视图更新；</p><p>通过事件监听响应View中用户交互修改Model中数据。</p><p>这样在ViewModel中就减少了大量DOM操作代码。</p><p>MVVM在保持View和Model松耦合的同时，还减少了维护它们关系的代码，使用户专注于业务逻辑，兼顾开发效率和可维护性。</p><p><strong>总结：</strong></p><p>这三者都是框架模式，它们设计的目标都是为了解决Model和View的耦合问题。</p><p>MVC模式出现较早主要应用在后端，如Spring MVC、<a href="https://link.zhihu.com/?target=http%3A//ASP.NET">http://ASP.NET</a> MVC等，在前端领域的早期也有应用，如Backbone.js。</p><p>它的优点是分层清晰，缺点是数据流混乱，灵活性带来的维护性问题。</p><p>MVP模式在是MVC的进化形式，Presenter作为中间层负责MV通信，解决了两者耦合问题，但P层过于臃肿会导致维护问题。</p><p>MVVM模式在前端领域有广泛应用，它不仅解决MV耦合问题，还同时解决了维护两者映射关系的大量繁杂代码和DOM操作代码，在提高开发效率、可读性同时还保持了优越的性能表现。</p><h3 id="（8）你了解哪些Vue性能优化方法？"><a href="#（8）你了解哪些Vue性能优化方法？" class="headerlink" title="（8）你了解哪些Vue性能优化方法？"></a>（8）你了解哪些Vue性能优化方法？</h3><p>相对其他的“陷阱面试题”，这个问题就显得友善了很多，只要我们基础功底扎实，回答得井井有条并不是难事。</p><p>首先，我们要找到VUE性能的现存问题，大部分都是代码层面的，然后具体的提出代码层优化意见就可以了。</p><p>目前我们所知的VUE代码层优化大致为一下11点，村长已经都帮大家整理好了，请大家随意消化一下：</p><p>●路由懒加载</p><p>●keep-alive缓存页面<br>●使用v-show复用DOM<br>●v-for 遍历避免同时使用 v-if<br>●长列表性能优化<br>●事件的销毁<br>●图片懒加载<br>●第三方插件按需引入<br>●无状态的组件标记为函数式组件<br>●子组件分割<br>●变量本地化</p><p>●SSR</p><p>下面是针对这11个优化点给出的具体优化方案：</p><p>●路由懒加载☟</p><pre class=" language-text"><code class="language-text">const router = new VueRouter({  routes: [    { path: '/foo', component: () => import('./Foo.vue') }  ]})</code></pre><p>●keep-alive缓存页面☟</p><template><div id="app"><keep-alive><router-view/></keep-alive></div></template><p>●使用v-show复用DOM☟</p><p><img src="https://pic1.zhimg.com/80/v2-815ec3f9e1d36433e6a00c4457cc4d42_720w.jpg" alt="img"></p><p>●v-for 遍历避免同时使用 v-if☟</p><p><img src="https://pic3.zhimg.com/80/v2-4484890878bbf48fa2e1199e5f40774e_720w.jpg" alt="img"></p><p>●长列表性能优化：</p><p>如果列表是纯粹的数据展示，不会有任何改变，就不需要做响应化☟</p><p><img src="https://pic3.zhimg.com/80/v2-9acd64b9c2020499032017512f7162cb_720w.jpg" alt="img"></p><p>如果是大数据长列表，可采用虚拟滚动，只渲染少部分区域的内容☟</p><p><img src="https://pic1.zhimg.com/80/v2-9ae6d5d466e51b9b6341fc2385dfaec4_720w.jpg" alt="img"></p><p>参考：</p><p>vue-virtual-scroller☟</p><p><a href="https://link.zhihu.com/?target=https%3A//github.com/Akryum/vue-virtual-scroller">https://github.com/Akryum/vue-virtual-scroller</a><br>vue-virtual-scroll-list☟</p><p><a href="https://link.zhihu.com/?target=https%3A//github.com/tangbc/vue-virtual-scroll-list">https://github.com/tangbc/vue-virtual-scroll-list</a></p><p>●事件的销毁：</p><p>Vue 组件销毁时，会自动解绑它的全部指令及事件监听器，但是仅限于组件本身的事件。</p><pre class=" language-text"><code class="language-text">created() {  this.timer = setInterval(this.refresh, 2000)},beforeDestroy() {  clearInterval(this.timer)}</code></pre><p>●图片懒加载：</p><p>对于图片过多的页面，为了加速页面加载速度。</p><p>所以很多时候我们需要将页面内未出现在可视区域内的图片先不做加载， 等到滚动到可视区域后再去加载。</p><pre class=" language-text"><code class="language-text"><img v-lazy="/static/img/1.png"></code></pre><p>参考项目：</p><p>vue-lazyload☟</p><p><a href="https://link.zhihu.com/?target=https%3A//github.com/hilongjw/vue-lazyload">https://github.com/hilongjw/vue-lazyload</a></p><p>●第三方插件按需引入：</p><p>像element-ui这样的第三方组件库可以按需引入，避免体积太大。</p><pre class=" language-text"><code class="language-text">import Vue from 'vue';import { Button, Select } from 'element-ui'; Vue.use(Button) Vue.use(Select)</code></pre><p>●无状态的组件标记为函数式组件☟</p><p><img src="https://pic4.zhimg.com/80/v2-46949fdb4a030fd39c371f32ad391878_720w.jpg" alt="img"></p><p>●子组件分割</p><p><img src="https://picb.zhimg.com/80/v2-fb9b3baf668bed604a322a2844ddc5db_720w.jpg" alt="img"></p><p>●变量本地化</p><p><img src="https://pic4.zhimg.com/80/v2-72e6a07bad21088c992c53ab02a6f534_720w.jpg" alt="img"></p><p>●服务端渲染 - SSR</p><h3 id="（9）你对Vue3-0的新特性有没有了解？"><a href="#（9）你对Vue3-0的新特性有没有了解？" class="headerlink" title="（9）你对Vue3.0的新特性有没有了解？"></a>（9）你对Vue3.0的新特性有没有了解？</h3><p>young村长帮大家总结了Vue3.0改进方向，主要在以下几点：</p><p>●更快</p><p>○虚拟DOM重写</p><p>○优化slots的生成</p><p>○静态树提升</p><p>○静态属性提升</p><p>○基于Proxy的响应式系统</p><p>●更小：</p><p>○通过摇树优化核心库体积</p><p>●更容易维护：</p><p>○TypeScript + 模块化</p><p>●更加友好</p><p>○跨平台：编译器核心和运行时核心与平台无关，使得Vue更容易与任何平台（Web、Android、iOS）一起使用</p><p>●更容易使用</p><p>○改进的TypeScript支持，编辑器能提供强有力的类型检查和错误及警告</p><p>●更好的调试支持</p><p>●独立的响应化模块</p><p>●Composition API</p><p><strong>虚拟 DOM 重写</strong></p><p>期待更多的编译时提示来减少运行时开销，使用更有效的代码来创建虚拟节点。</p><p>组件快速路径+单个调用+子节点类型检测</p><p>▷跳过不必要的条件分支</p><p>▷JS引擎更容易优化</p><p>详情见下图☟</p><p><img src="https://pic3.zhimg.com/80/v2-e3e4ac6bb7d6c4f7e47e55f0b5d10100_720w.jpg" alt="img"></p><p><strong>优化slots生成</strong></p><p>vue3中可以单独重新渲染父级和子级：</p><p>▷确保实例正确的跟踪依赖关系</p><p>▷避免不必要的父子组件重新渲染</p><p>详情见下图☟</p><p><img src="https://pic1.zhimg.com/80/v2-632f478f127d5bb8bead49fc3a250a28_720w.jpg" alt="img"></p><p><strong>静态树提升(Static Tree Hoisting)</strong></p><p>使用静态树提升，这意味着 Vue 3 的编译器将能够检测到什么是静态的，然后将其提升，从而降低了渲染成本。</p><p>▷跳过修补整棵树，从而降低渲染成本</p><p>▷即使多次出现也能正常工作</p><p>详情见下图☟</p><p><img src="https://picb.zhimg.com/80/v2-0256e1050b63013762e4501d1f1e6801_720w.jpg" alt="img"></p><p><strong>静态属性提升</strong></p><p>使用静态属性提升，Vue 3打补丁时将跳过这些属性不会改变的节点。☟</p><p><img src="https://picb.zhimg.com/80/v2-a01cf33b39b505dd0a6b91a8c0245ff0_720w.jpg" alt="img"></p><p><strong>基于 Proxy 的数据响应式</strong></p><p>Vue 2的响应式系统使用：</p><p>Object.defineProperty 的getter 和 setter。</p><p>Vue 3 将使用 ES2015 Proxy 作为其观察机制，这将会带来如下变化：</p><p>●组件实例初始化的速度提高100％</p><p>●使用Proxy节省以前一半的内存开销，加快速度，但是存在低浏览器版本的不兼容</p><p>●为了继续支持 IE11，Vue 3 将发布一个支持旧观察者机制和新 Proxy 版本的构建</p><p><img src="https://pic4.zhimg.com/80/v2-a36fa90fa7744c3d709b32290b039f79_720w.jpg" alt="img"></p><p><strong>高可维护性</strong></p><p>Vue 3 将带来更可维护的源代码。它不仅会使用 TypeScript，而且许多包被解耦，更加模块化。</p><pre class=" language-text"><code class="language-text">created() {  this.timer = setInterval(this.refresh, 2000)},beforeDestroy() {  clearInterval(this.timer)}</code></pre><h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://picb.zhimg.com/80/v2-1868fbe98a13f78aa92a6141319b1e44_720w.jpg" alt="img"></h3>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue开发技巧</title>
      <link href="/2020/07/08/vue-kai-fa-ji-qiao/"/>
      <url>/2020/07/08/vue-kai-fa-ji-qiao/</url>
      
        <content type="html"><![CDATA[<blockquote><p>作者：火狼<br>链接：<a href="https://segmentfault.com/a/1190000020620972" target="_blank" rel="noopener">https://segmentfault.com/a/1190000020620972</a><br>来源：SegmentFault 思否<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote><p>前言<br>Vue 3.x 的Pre-Alpha 版本。后面应该还会有 Alpha、Beta 等版本,预计至少要等到 2020 年第一季度才有可能发布 3.0 正式版;<br>所以应该趁还没出来加紧打好 Vue2.x 的基础;<br>Vue基本用法很容易上手,但是有很多优化的写法你就不一定知道了,本文从列举了 36 个 vue 开发技巧;<br>后续 Vue 3.x 出来后持续更新.</p><h2 id="1-require-context"><a href="#1-require-context" class="headerlink" title="1.require.context()"></a>1.require.context()</h2><p>1.场景:如页面需要导入多个组件,原始写法:</p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> titleCom <span class="token keyword">from</span> <span class="token string">'@/components/home/titleCom'</span><span class="token keyword">import</span> bannerCom <span class="token keyword">from</span> <span class="token string">'@/components/home/bannerCom'</span><span class="token keyword">import</span> cellCom <span class="token keyword">from</span> <span class="token string">'@/components/home/cellCom'</span>components<span class="token punctuation">:</span><span class="token punctuation">{</span>titleCom<span class="token punctuation">,</span>bannerCom<span class="token punctuation">,</span>cellCom<span class="token punctuation">}</span></code></pre><p>2.这样就写了大量重复的代码,利用 require.context 可以写成</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token keyword">const</span> files <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'@/components/home'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">)</span><span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>files<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> name <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">)</span>  modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">files</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span> <span class="token operator">||</span> <span class="token function">files</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>components<span class="token punctuation">:</span>modules</code></pre><p>这样不管页面引入多少组件,都可以使用这个方法</p><p>3.API 方法</p><pre><code>实际上是 webpack 的方法,vue 工程一般基于 webpack,所以可以使用require.context(directory,useSubdirectories,regExp)接收三个参数:directory：说明需要检索的目录useSubdirectories：是否检索子目录regExp: 匹配文件的正则表达式,一般是文件名</code></pre><h2 id="2-watch"><a href="#2-watch" class="headerlink" title="2.watch"></a>2.watch</h2><h3 id="2-1-常用用法"><a href="#2-1-常用用法" class="headerlink" title="2.1 常用用法"></a>2.1 常用用法</h3><p>1.场景:表格初始进来需要调查询接口 getList(),然后input 改变会重新查询</p><pre class=" language-js"><code class="language-js"><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token function">inpVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="2-2-立即执行"><a href="#2-2-立即执行" class="headerlink" title="2.2 立即执行"></a>2.2 立即执行</h3><p>2.可以直接利用 watch 的immediate和handler属性简写</p><pre class=" language-js"><code class="language-js">watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>  inpVal<span class="token punctuation">:</span><span class="token punctuation">{</span>    handler<span class="token punctuation">:</span> <span class="token string">'getList'</span><span class="token punctuation">,</span>      immediate<span class="token punctuation">:</span> <span class="token boolean">true</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="2-3-深度监听"><a href="#2-3-深度监听" class="headerlink" title="2.3 深度监听"></a>2.3 深度监听</h3><p>3.watch 的 deep 属性,深度监听,也就是监听复杂数据类型</p><pre class=" language-js"><code class="language-js">watch<span class="token punctuation">:</span><span class="token punctuation">{</span>  inpValObj<span class="token punctuation">:</span><span class="token punctuation">{</span>    <span class="token function">handler</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span>oldVal<span class="token punctuation">)</span><span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>oldVal<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    deep<span class="token punctuation">:</span><span class="token boolean">true</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>此时发现oldVal和 newVal 值一样;<br>因为它们索引同一个对象/数组,Vue 不会保留修改之前值的副本;<br>所以深度监听虽然可以监听到对象的变化,但是无法监听到具体对象里面那个属性的变化</p><h2 id="3-14种组件通讯"><a href="#3-14种组件通讯" class="headerlink" title="3. 14种组件通讯"></a>3. 14种组件通讯</h2><h3 id="3-1-props"><a href="#3-1-props" class="headerlink" title="3.1 props"></a>3.1 props</h3><p>这个应该非常属性,就是父传子的属性;<br>props 值可以是一个数组或对象;</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 数组:不建议使用</span>props<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">// 对象</span>props<span class="token punctuation">:</span><span class="token punctuation">{</span> inpVal<span class="token punctuation">:</span><span class="token punctuation">{</span>  type<span class="token punctuation">:</span>Number<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//传入值限定类型</span>  <span class="token comment" spellcheck="true">// type 值可为String,Number,Boolean,Array,Object,Date,Function,Symbol</span>  <span class="token comment" spellcheck="true">// type 还可以是一个自定义的构造函数，并且通过 instanceof 来进行检查确认</span>  required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//是否必传</span>  <span class="token keyword">default</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//默认值,对象或数组默认值必须从一个工厂函数获取如 default:()=>[]</span>  validator<span class="token punctuation">:</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 这个值必须匹配下列字符串中的一个</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="3-2-emit"><a href="#3-2-emit" class="headerlink" title="3.2 $emit"></a>3.2 $emit</h3><p>这个也应该非常常见,触发子组件触发父组件给自己绑定的事件,其实就是子传父的方法</p><pre><code>// 父组件&lt;home @title=&quot;title&quot;&gt;// 子组件this.$emit(&#39;title&#39;,[{title:&#39;这是title&#39;}])</code></pre><h3 id="3-3-vuex"><a href="#3-3-vuex" class="headerlink" title="3.3 vuex"></a>3.3 vuex</h3><p>1.这个也是很常用的,vuex 是一个状态管理器<br>2.是一个独立的插件,适合数据共享多的项目里面,因为如果只是简单的通讯,使用起来会比较重<br>3.API</p><pre><code>state:定义存贮数据的仓库 ,可通过this.$store.state 或mapState访问getter:获取 store 值,可认为是 store 的计算属性,可通过this.$store.getter 或       mapGetters访问mutation:同步改变 store 值,为什么会设计成同步,因为mutation是直接改变 store 值,         vue 对操作进行了记录,如果是异步无法追踪改变.可通过mapMutations调用action:异步调用函数执行mutation,进而改变 store 值,可通过 this.$dispatch或mapActions       访问modules:模块,如果状态过多,可以拆分成模块,最后在入口通过...解构引入</code></pre><h3 id="3-4-和listeners"><a href="#3-4-和listeners" class="headerlink" title="3.4 和listeners"></a>3.4 和listeners</h3><p>2.4.0 新增<br>这两个是不常用属性,但是高级用法很常见;<br>1.场景如果父传子有很多值那么在子组件需要定义多个解决attrs获取子传父中未在 props 定义的值</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 父组件</span><span class="token operator">&lt;</span>home title<span class="token operator">=</span><span class="token string">"这是标题"</span> width<span class="token operator">=</span><span class="token string">"80"</span> height<span class="token operator">=</span><span class="token string">"80"</span> imgUrl<span class="token operator">=</span><span class="token string">"imgUrl"</span><span class="token operator">/</span><span class="token operator">></span><span class="token comment" spellcheck="true">// 子组件</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//{title: "这是标题", width: "80", height: "80", imgUrl: "imgUrl"}</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>相对应的如果子组件定义了 props,打印的值就是剔除定义的属性</p><pre class=" language-js"><code class="language-js">props<span class="token punctuation">:</span> <span class="token punctuation">{</span>  width<span class="token punctuation">:</span> <span class="token punctuation">{</span>    type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">''</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//{title: "这是标题", height: "80", imgUrl: "imgUrl"}</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>2.场景子组件需要调用父组件的方法解决父组件的方法可以通过listeners” 传入内部组件——在创建更高层次的组件时非常有用</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 父组件</span><span class="token operator">&lt;</span>home @change<span class="token operator">=</span><span class="token string">"change"</span><span class="token operator">/</span><span class="token operator">></span><span class="token comment" spellcheck="true">// 子组件</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$listeners<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//即可拿到 change 事件</span><span class="token punctuation">}</span></code></pre><p>如果是孙组件要访问父组件的属性和调用方法,直接一级一级传下去就可以</p><p>3.inheritAttrs</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 父组件</span><span class="token operator">&lt;</span>home title<span class="token operator">=</span><span class="token string">"这是标题"</span> width<span class="token operator">=</span><span class="token string">"80"</span> height<span class="token operator">=</span><span class="token string">"80"</span> imgUrl<span class="token operator">=</span><span class="token string">"imgUrl"</span><span class="token operator">/</span><span class="token operator">></span><span class="token comment" spellcheck="true">// 子组件</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//{title: "这是标题", width: "80", height: "80", imgUrl: "imgUrl"}</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>inheritAttrs默认值为true，true的意思是将父组件中除了props外的属性添加到子组件的根节点上(说明，即使设置为true，子组件仍然可以通过$attr获取到props意外的属性)<br>将inheritAttrs:false后,属性就不会显示在根节点上了</p><h3 id="3-5-provide和inject"><a href="#3-5-provide和inject" class="headerlink" title="3.5 provide和inject"></a>3.5 provide和inject</h3><p>2.2.0 新增<br>描述:<br>provide 和 inject 主要为高阶插件/组件库提供用例。并不推荐直接用于应用程序代码中;<br>并且这对选项需要一起使用;<br>以允许一个祖先组件向其所有子孙后代注入一个依赖，不论组件层次有多深，并在起上下游关系成立的时间里始终生效。</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//父组件:</span>provide<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//provide 是一个对象,提供一个属性或方法</span>  foo<span class="token punctuation">:</span> <span class="token string">'这是 foo'</span><span class="token punctuation">,</span>  fooMethod<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'父组件 fooMethod 被调用'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 子或者孙子组件</span>inject<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span><span class="token string">'fooMethod'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//数组或者对象,注入到子组件</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fooMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//在父组件下面所有的子组件都可以利用inject</span></code></pre><p>provide 和 inject 绑定并不是可响应的。这是官方刻意为之的。<br>然而，如果你传入了一个可监听的对象，那么其对象的属性还是可响应的,对象是因为是引用类型</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//父组件:</span>provide<span class="token punctuation">:</span> <span class="token punctuation">{</span>   foo<span class="token punctuation">:</span> <span class="token string">'这是 foo'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token operator">=</span><span class="token string">'这是新的 foo'</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 子或者孙子组件</span>inject<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//子组件打印的还是'这是 foo'</span><span class="token punctuation">}</span></code></pre><h3 id="3-6-和children"><a href="#3-6-和children" class="headerlink" title="3.6 和children"></a>3.6 和children</h3><p>父实例children:子实例</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//父组件</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">//可以拿到 一级子组件的属性和方法</span>  <span class="token comment" spellcheck="true">//所以就可以直接改变 data,或者调用 methods 方法</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//子组件</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//可以拿到 parent 的属性和方法</span><span class="token punctuation">}</span></code></pre><p>和parent 并不保证顺序，也不是响应式的<br>只能拿到一级父组件和子组件</p><h3 id="3-7-refs"><a href="#3-7-refs" class="headerlink" title="3.7 $refs"></a>3.7 $refs</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 父组件</span><span class="token operator">&lt;</span>home ref<span class="token operator">=</span><span class="token string">"home"</span><span class="token operator">/</span><span class="token operator">></span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>home<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//即可拿到子组件的实例,就可以直接操作 data 和 methods</span><span class="token punctuation">}</span></code></pre><h3 id="3-8-root"><a href="#3-8-root" class="headerlink" title="3.8 $root"></a>3.8 $root</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 父组件</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//获取根实例,最后所有组件都是挂载到根实例上</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>$children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//获取根实例的一级子组件</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>$children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>$children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//获取根实例的二级子组件</span><span class="token punctuation">}</span></code></pre><h3 id="3-9-sync"><a href="#3-9-sync" class="headerlink" title="3.9 .sync"></a>3.9 .sync</h3><p>在 <a href="mailto:vue@1.x">vue@1.x</a> 的时候曾作为双向绑定功能存在，即子组件可以修改父组件中的值;<br>在 <a href="mailto:vue@2.0">vue@2.0</a> 的由于违背单项数据流的设计被干掉了;<br>在 <a href="mailto:vue@2.3.0">vue@2.3.0</a>+ 以上版本又重新引入了这个 .sync 修饰符;</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 父组件</span><span class="token operator">&lt;</span>home <span class="token punctuation">:</span>title<span class="token punctuation">.</span>sync<span class="token operator">=</span><span class="token string">"title"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token comment" spellcheck="true">//编译时会被扩展为</span><span class="token operator">&lt;</span>home <span class="token punctuation">:</span>title<span class="token operator">=</span><span class="token string">"title"</span>  @update<span class="token punctuation">:</span>title<span class="token operator">=</span><span class="token string">"val => title = val"</span><span class="token operator">/</span><span class="token operator">></span><span class="token comment" spellcheck="true">// 子组件</span><span class="token comment" spellcheck="true">// 所以子组件可以通过$emit 触发 update 方法改变</span><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"update:title"</span><span class="token punctuation">,</span> <span class="token string">'这是新的title'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="3-10-v-slot"><a href="#3-10-v-slot" class="headerlink" title="3.10 v-slot"></a>3.10 v-slot</h3><p>2.6.0 新增<br>1.slot,slot-cope,scope 在 2.6.0 中都被废弃,但未被移除<br>2.作用就是将父组件的 template 传入子组件<br>3.插槽分类:<br>A.匿名插槽(也叫默认插槽): 没有命名,有且只有一个;</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 父组件</span><span class="token operator">&lt;</span>todo<span class="token operator">-</span>list<span class="token operator">></span>     <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token punctuation">:</span><span class="token keyword">default</span><span class="token operator">></span>       任意内容       <span class="token operator">&lt;</span>p<span class="token operator">></span>我是匿名插槽 <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>todo<span class="token operator">-</span>list<span class="token operator">></span> <span class="token comment" spellcheck="true">// 子组件</span><span class="token operator">&lt;</span>slot<span class="token operator">></span>我是默认值<span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">></span><span class="token comment" spellcheck="true">//v-slot:default写上感觉和具名写法比较统一,容易理解,也可以不用写</span></code></pre><p>B.具名插槽: 相对匿名插槽组件slot标签带name命名的;</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 父组件</span><span class="token operator">&lt;</span>todo<span class="token operator">-</span>list<span class="token operator">></span>     <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token punctuation">:</span>todo<span class="token operator">></span>       任意内容       <span class="token operator">&lt;</span>p<span class="token operator">></span>我是匿名插槽 <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>todo<span class="token operator">-</span>list<span class="token operator">></span> <span class="token comment" spellcheck="true">//子组件</span><span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">"todo"</span><span class="token operator">></span>我是默认值<span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">></span></code></pre><p>C.作用域插槽: 子组件内数据可以被父页面拿到(解决了数据只能从父页面传递给子组件)</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 父组件</span><span class="token operator">&lt;</span>todo<span class="token operator">-</span>list<span class="token operator">></span> <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token punctuation">:</span>todo<span class="token operator">=</span><span class="token string">"slotProps"</span> <span class="token operator">></span>   <span class="token punctuation">{</span><span class="token punctuation">{</span>slotProps<span class="token punctuation">.</span>user<span class="token punctuation">.</span>firstName<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">/</span>todo<span class="token operator">-</span>list<span class="token operator">></span> <span class="token comment" spellcheck="true">//slotProps 可以随意命名</span><span class="token comment" spellcheck="true">//slotProps 接取的是子组件标签slot上属性数据的集合所有v-bind:user="user"</span><span class="token comment" spellcheck="true">// 子组件</span><span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">"todo"</span> <span class="token punctuation">:</span>user<span class="token operator">=</span><span class="token string">"user"</span> <span class="token punctuation">:</span>test<span class="token operator">=</span><span class="token string">"test"</span><span class="token operator">></span>    <span class="token punctuation">{</span><span class="token punctuation">{</span> user<span class="token punctuation">.</span>lastName <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">></span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      user<span class="token punctuation">:</span><span class="token punctuation">{</span>        lastName<span class="token punctuation">:</span><span class="token string">"Zhang"</span><span class="token punctuation">,</span>        firstName<span class="token punctuation">:</span><span class="token string">"yue"</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      test<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// {{ user.lastName }}是默认数据  v-slot:todo 当父页面没有(="slotProps")</span></code></pre><p>3.11 EventBus<br>1.就是声明一个全局Vue实例变量 EventBus , 把所有的通信数据，事件监听都存储到这个变量上;<br>2.类似于 Vuex。但这种方式只适用于极小的项目<br>3.原理就是利用和emit 并实例化一个全局 vue 实现数据共享</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在 main.js</span>Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$eventBus<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 传值组件</span><span class="token keyword">this</span><span class="token punctuation">.</span>$eventBus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'eventTarget'</span><span class="token punctuation">,</span><span class="token string">'这是eventTarget传过来的值'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 接收组件</span><span class="token keyword">this</span><span class="token punctuation">.</span>$eventBus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">"eventTarget"</span><span class="token punctuation">,</span>v<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'eventTarget'</span><span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//这是eventTarget传过来的值</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>4.可以实现平级,嵌套组件传值,但是对应的事件名eventTarget必须是全局唯一的</p><h3 id="3-12-broadcast和dispatch"><a href="#3-12-broadcast和dispatch" class="headerlink" title="3.12 broadcast和dispatch"></a>3.12 broadcast和dispatch</h3><p>vue 1.x 有这两个方法,事件广播和派发,但是 vue 2.x 删除了<br>下面是对两个方法进行的封装</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">broadcast</span><span class="token punctuation">(</span>componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>child <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> name <span class="token operator">=</span> child<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> componentName<span class="token punctuation">)</span> <span class="token punctuation">{</span>  child<span class="token punctuation">.</span>$emit<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  broadcast<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token punctuation">[</span>componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token function">dispatch</span><span class="token punctuation">(</span>componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>      <span class="token keyword">var</span> name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> name <span class="token operator">!==</span> componentName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>      name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>    parent<span class="token punctuation">.</span>$emit<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">broadcast</span><span class="token punctuation">(</span>componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>  broadcast<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="3-13-路由传参"><a href="#3-13-路由传参" class="headerlink" title="3.13 路由传参"></a>3.13 路由传参</h3><p>1.方案一</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 路由定义</span><span class="token punctuation">{</span>  path<span class="token punctuation">:</span> <span class="token string">'/describe/:id'</span><span class="token punctuation">,</span>  name<span class="token punctuation">:</span> <span class="token string">'Describe'</span><span class="token punctuation">,</span>  component<span class="token punctuation">:</span> Describe<span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 页面传参</span><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  path<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`/describe/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 页面获取</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id</code></pre><p>2.方案二</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 路由定义</span><span class="token punctuation">{</span>  path<span class="token punctuation">:</span> <span class="token string">'/describe'</span><span class="token punctuation">,</span>  name<span class="token punctuation">:</span> <span class="token string">'Describe'</span><span class="token punctuation">,</span>  omponent<span class="token punctuation">:</span> Describe<span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 页面传参</span><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  name<span class="token punctuation">:</span> <span class="token string">'Describe'</span><span class="token punctuation">,</span>  params<span class="token punctuation">:</span> <span class="token punctuation">{</span>    id<span class="token punctuation">:</span> id  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 页面获取</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id</code></pre><p>3.方案三</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 路由定义</span><span class="token punctuation">{</span>  path<span class="token punctuation">:</span> <span class="token string">'/describe'</span><span class="token punctuation">,</span>  name<span class="token punctuation">:</span> <span class="token string">'Describe'</span><span class="token punctuation">,</span>  component<span class="token punctuation">:</span> Describe<span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 页面传参</span><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  path<span class="token punctuation">:</span> <span class="token string">'/describe'</span><span class="token punctuation">,</span>    query<span class="token punctuation">:</span> <span class="token punctuation">{</span>      id<span class="token punctuation">:</span> id  `<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 页面获取</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id</code></pre><p>4.三种方案对比<br>方案二参数不会拼接在路由后面,页面刷新参数会丢失<br>方案一和三参数拼接在后面,丑,而且暴露了信息</p><h3 id="3-14-Vue-observable"><a href="#3-14-Vue-observable" class="headerlink" title="3.14 Vue.observable"></a>3.14 Vue.observable</h3><p>2.6.0 新增<br>用法:让一个对象可响应。Vue 内部会用它来处理 data 函数返回的对象;</p><p>返回的对象可以直接用于渲染函数和计算属性内，并且会在发生改变时触发相应的更新;<br>也可以作为最小化的跨组件状态存储器，用于简单的场景。<br>通讯原理实质上是利用Vue.observable实现一个简易的 vuex</p><pre class=" language-html"><code class="language-html">// 文件路径 - /store/store.jsimport Vue from 'vue'export const store = Vue.observable({ count: 0 })export const mutations = {  setCount (count) {    store.count = count  }}//使用<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bookNum<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>数 量<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setCount(count+1)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>{{count}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setCount(count-1)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> mutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../store/store'</span> <span class="token comment" spellcheck="true">// Vue2.6新增API Observable</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  name<span class="token punctuation">:</span> <span class="token string">'Add'</span><span class="token punctuation">,</span>  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>    count <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> store<span class="token punctuation">.</span>count    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    setCount<span class="token punctuation">:</span> mutations<span class="token punctuation">.</span>setCount  <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h2 id="4-render-函数"><a href="#4-render-函数" class="headerlink" title="4.render 函数"></a>4.render 函数</h2><p>1.场景:有些代码在 template 里面写会重复很多,所以这个时候 render 函数就有作用啦</p><pre class=" language-html"><code class="language-html">// 根据 props 生成标签// 初级<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>level <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> 1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>level <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> 2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>level <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> 3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>level <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> 4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>level <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> 5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stong</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>level <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> 6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>// 优化版,利用 render 函数减小了代码重复率<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child</span> <span class="token attr-name">:level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>level<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Hello world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>text/javascript<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'child'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> tag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'strong'</span><span class="token punctuation">,</span> <span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'h2'</span><span class="token punctuation">,</span> <span class="token string">'textarea'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>level<span class="token number">-1</span><span class="token punctuation">]</span>      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>      level<span class="token punctuation">:</span> <span class="token punctuation">{</span>  type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>  required<span class="token punctuation">:</span> <span class="token boolean">true</span>  <span class="token punctuation">}</span>     <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>     <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    name<span class="token punctuation">:</span> <span class="token string">'hehe'</span><span class="token punctuation">,</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> level<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>2.render 和 template 的对比<br>前者适合复杂逻辑,后者适合逻辑简单;<br>后者属于声明是渲染，前者属于自定Render函数;<br>前者的性能较高，后者性能较低。</p><h2 id="5-异步组件"><a href="#5-异步组件" class="headerlink" title="5.异步组件"></a>5.异步组件</h2><p>场景:项目过大就会导致加载缓慢,所以异步组件实现按需加载就是必须要做的事啦<br>1.异步注册组件<br>3种方法</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 工厂函数执行 resolve 回调</span>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'async-webpack-example'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 这个特殊的 `require` 语法将会告诉 webpack</span>  <span class="token comment" spellcheck="true">// 自动将你的构建代码切割成多个包, 这些包</span>  <span class="token comment" spellcheck="true">// 会通过 Ajax 请求加载</span>  <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./my-async-component'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 工厂函数返回 Promise</span>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>  <span class="token string">'async-webpack-example'</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 这个 `import` 函数会返回一个 `Promise` 对象。</span>  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./my-async-component'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 工厂函数返回一个配置化组件对象</span><span class="token keyword">const</span> AsyncComponent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 需要加载的组件 (应该是一个 `Promise` 对象)</span>  component<span class="token punctuation">:</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./MyComponent.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 异步组件加载时使用的组件</span>  loading<span class="token punctuation">:</span> LoadingComponent<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 加载失败时使用的组件</span>  error<span class="token punctuation">:</span> ErrorComponent<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 展示加载时组件的延时时间。默认值是 200 (毫秒)</span>  delay<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 如果提供了超时时间且组件加载也超时了，</span>  <span class="token comment" spellcheck="true">// 则使用加载失败时使用的组件。默认值是：`Infinity`</span>  timeout<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>异步组件的渲染本质上其实就是执行2次或者2次以上的渲染, 先把当前组件渲染为注释节点, 当组件加载成功后, 通过 forceRender 执行重新渲染。或者是渲染为注释节点, 然后再渲染为loading节点, 在渲染为请求完成的组件</p><p>2.路由的按需加载</p><pre class=" language-js"><code class="language-js">webpack<span class="token operator">&lt;</span> <span class="token number">2.4</span> 时<span class="token punctuation">{</span>  path<span class="token punctuation">:</span><span class="token string">'/'</span><span class="token punctuation">,</span>  name<span class="token punctuation">:</span><span class="token string">'home'</span><span class="token punctuation">,</span>  components<span class="token punctuation">:</span>resolve<span class="token operator">=</span><span class="token operator">></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'@/components/home'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>resolve<span class="token punctuation">)</span><span class="token punctuation">}</span>webpack<span class="token operator">></span> <span class="token number">2.4</span> 时<span class="token punctuation">{</span>  path<span class="token punctuation">:</span><span class="token string">'/'</span><span class="token punctuation">,</span>  name<span class="token punctuation">:</span><span class="token string">'home'</span><span class="token punctuation">,</span>  components<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/components/home'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>import()方法由es6提出，import()方法是动态加载，返回一个Promise对象，then方法的参数是加载到的模块。类似于Node.js的require方法，主要import()方法是异步加载的。</p><h2 id="6-动态组件"><a href="#6-动态组件" class="headerlink" title="6.动态组件"></a>6.动态组件</h2><p>场景:做一个 tab 切换时就会涉及到组件动态加载</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>currentTabComponent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span></code></pre><p>但是这样每次组件都会重新加载,会消耗大量性能,所以<keep-alive> 就起到了作用</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>currentTabComponent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span></code></pre><p>这样切换效果没有动画效果,这个也不用着急,可以利用内置的<transition></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>currentTabComponent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span></code></pre><h2 id="7-递归组件"><a href="#7-递归组件" class="headerlink" title="7.递归组件"></a>7.递归组件</h2><p>场景:如果开发一个 tree 组件,里面层级是根据后台数据决定的,这个时候就需要用到动态组件</p><pre class=" language-html"><code class="language-html">// 递归组件: 组件在它的模板内可以递归的调用自己，只要给组件设置name组件就可以了。// 设置那么House在组件模板内就可以递归使用了,不过需要注意的是，// 必须给一个条件来限制数量，否则会抛出错误: max stack size exceeded// 组件递归用来开发一些具体有未知层级关系的独立组件。比如：// 联级选择器和树形控件 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in treeArr<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      子组件，当前层级值： {{index}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>      <span class="token comment" spellcheck="true">&lt;!-- 递归调用自身, 后台判断是否不存在改值 --></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tree</span> <span class="token attr-name">:item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.arr<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.flag<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tree</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 必须定义name，组件内部才能递归调用</span>  name<span class="token punctuation">:</span> <span class="token string">'tree'</span><span class="token punctuation">,</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 接收外部传入的值</span>  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>     item<span class="token punctuation">:</span> <span class="token punctuation">{</span>      type<span class="token punctuation">:</span>Array<span class="token punctuation">,</span>      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>递归组件必须设置name 和结束的阀值</p><h2 id="8-函数式组件"><a href="#8-函数式组件" class="headerlink" title="8.函数式组件"></a>8.函数式组件</h2><p>定义:无状态,无法实例化，内部没有任何生命周期处理方法<br>规则:在 2.3.0 之前的版本中，如果一个函数式组件想要接收 prop，则 props 选项是必须的。</p><pre><code>在 2.3.0 或以上的版本中，你可以省略 props 选项，所有组件上的特性都会被自动隐式解析为 prop在 2.5.0 及以上版本中，如果你使用了单文件组件(就是普通的.vue 文件),可以直接在 template 上声明functional组件需要的一切都是通过 context 参数传递</code></pre><p>context 属性有:<br>1.props：提供所有 prop 的对象<br>2.children: VNode 子节点的数组<br>3.slots: 一个函数，返回了包含所有插槽的对象<br>4.scopedSlots: (2.6.0+) 一个暴露传入的作用域插槽的对象。也以函数形式暴露普通插槽。<br>5.data：传递给组件的整个数据对象，作为 createElement 的第二个参数传入组件<br>6.parent：对父组件的引用<br>7.listeners: (2.3.0+) 一个包含了所有父组件为当前组件注册的事件监听器的对象。这是 data.on 的一个别名。<br>8.injections: (2.3.0+) 如果使用了 inject 选项，则该对象包含了应当被注入的属性</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>template functional<span class="token operator">></span>  <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in props.arr"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre><h2 id="9-components和-Vue-component"><a href="#9-components和-Vue-component" class="headerlink" title="9.components和 Vue.component"></a>9.components和 Vue.component</h2><p>components:局部注册组件</p><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>  components<span class="token punctuation">:</span><span class="token punctuation">{</span>home<span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Vue.component:全局注册组件</p><pre class=" language-js"><code class="language-js">Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'home'</span><span class="token punctuation">,</span>home<span class="token punctuation">)</span></code></pre><h2 id="10-Vue-extend"><a href="#10-Vue-extend" class="headerlink" title="10.Vue.extend"></a>10.Vue.extend</h2><p>场景:vue 组件中有些需要将一些元素挂载到元素上,这个时候 extend 就起到作用了<br>是构造一个组件的语法器<br>写法:</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 创建构造器</span><span class="token keyword">var</span> Profile <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  template<span class="token punctuation">:</span> <span class="token string">'&lt;p>{{extendData}}&lt;/br>实例传入的数据为:{{propsExtend}}&lt;/p>'</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//template对应的标签最外层必须只有一个标签</span>  data<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      extendData<span class="token punctuation">:</span> <span class="token string">'这是extend扩展的数据'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  props<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'propsExtend'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 创建的构造器可以挂载到元素上,也可以通过 components 或 Vue.component()注册使用</span><span class="token comment" spellcheck="true">// 挂载到一个元素上。可以通过propsData传参.</span><span class="token keyword">new</span> <span class="token class-name">Profile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>propsData<span class="token punctuation">:</span><span class="token punctuation">{</span>propsExtend<span class="token punctuation">:</span><span class="token string">'我是实例传入的数据'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app-extend'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 通过 components 或 Vue.component()注册</span>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'Profile'</span><span class="token punctuation">,</span>Profile<span class="token punctuation">)</span></code></pre><h2 id="11-mixins"><a href="#11-mixins" class="headerlink" title="11.mixins"></a>11.mixins</h2><p>场景:有些组件有些重复的 js 逻辑,如校验手机验证码,解析时间等,mixins 就可以实现这种混入<br>mixins 值是一个数组</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> mixin<span class="token operator">=</span><span class="token punctuation">{</span>    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dealTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token function">dealTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是mixin的dealTime里面的方法'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>  mixins<span class="token punctuation">:</span><span class="token punctuation">[</span>mixin<span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h2 id="12-extends"><a href="#12-extends" class="headerlink" title="12.extends"></a>12.extends</h2><p>extends用法和mixins很相似,只不过接收的参数是简单的选项对象或构造函数,所以extends只能单次扩展一个组件</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> extend<span class="token operator">=</span><span class="token punctuation">{</span>    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dealTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token function">dealTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是mixin的dealTime里面的方法'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>  <span class="token keyword">extends</span><span class="token punctuation">:</span>extend<span class="token punctuation">}</span></code></pre><h2 id="13-Vue-use"><a href="#13-Vue-use" class="headerlink" title="13.Vue.use()"></a>13.Vue.use()</h2><p>场景:我们使用 element时会先 import,再 Vue.use()一下,实际上就是注册组件,触发 install 方法;<br>这个在组件调用会经常使用到;<br>会自动组织多次注册相同的插件.</p><h2 id="14-install"><a href="#14-install" class="headerlink" title="14.install"></a>14.install</h2><p>场景:在 Vue.use()说到,执行该方法会触发 install<br>是开发vue的插件,这个方法的第一个参数是 Vue 构造器，第二个参数是一个可选的选项对象(可选)</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> MyPlugin <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  MyPlugin<span class="token punctuation">.</span>install <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 2. 添加全局资源,第二个参数传一个值默认是update对应的值</span>    Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>      <span class="token function">bind</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> oldVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//做绑定的准备工作,添加时间监听</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'指令my-directive的bind执行啦'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      inserted<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//获取绑定的元素</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'指令my-directive的inserted执行啦'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      update<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//根据获得的新值执行对应的更新</span>      <span class="token comment" spellcheck="true">//对于初始值也会调用一次</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'指令my-directive的update执行啦'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      componentUpdated<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'指令my-directive的componentUpdated执行啦'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      unbind<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//做清理操作</span>      <span class="token comment" spellcheck="true">//比如移除bind时绑定的事件监听器</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'指令my-directive的unbind执行啦'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// 3. 注入组件</span>    Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      created<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'注入组件的created被调用啦'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'options的值为'</span><span class="token punctuation">,</span>options<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// 4. 添加实例方法</span>    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$myMethod <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>methodOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'实例方法myMethod被调用啦'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//调用MyPlugin</span>  Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>MyPlugin<span class="token punctuation">,</span><span class="token punctuation">{</span>someOption<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">//3.挂载</span>  <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">'#app'</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>更多请戳 vue中extend，mixins，extends，components,install的几个操作</p><h2 id="15-Vue-nextTick"><a href="#15-Vue-nextTick" class="headerlink" title="15. Vue.nextTick"></a>15. Vue.nextTick</h2><p>2.1.0 新增<br>场景:页面加载时需要让文本框获取焦点<br>用法:在下次 DOM 更新循环结束之后执行延迟回调。在修改数据之后立即使用这个方法，获取更新后的 DOM</p><pre class=" language-js"><code class="language-js"><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//因为 mounted 阶段 dom 并未渲染完毕,所以需要$nextTick</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>inputs<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//通过 $refs 获取dom 并绑定 focus 方法</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h2 id="16-Vue-directive"><a href="#16-Vue-directive" class="headerlink" title="16.Vue.directive"></a>16.Vue.directive</h2><h3 id="16-1-使用"><a href="#16-1-使用" class="headerlink" title="16.1 使用"></a>16.1 使用</h3><p>场景:官方给我们提供了很多指令,但是我们如果想将文字变成指定的颜色定义成指令使用,这个时候就需要用到Vue.directive</p><pre><code>// 全局定义Vue.directive(&quot;change-color&quot;,function(el,binding,vnode){  el.style[&quot;color&quot;]= binding.value;})// 使用&lt;template&gt;&lt;div v-change-color=“color”&gt;{{message}}&lt;/div&gt;&lt;/template&gt;&lt;script&gt;  export default{    data(){      return{        color:&#39;green&#39;      }    }  }&lt;/script&gt;</code></pre><h3 id="16-2-生命周期"><a href="#16-2-生命周期" class="headerlink" title="16.2 生命周期"></a>16.2 生命周期</h3><p>1.bind 只调用一次，指令第一次绑定到元素时候调用，用这个钩子可以定义一个绑定时执行一次的初始化动作。<br>2.inserted:被绑定的元素插入父节点的时候调用(父节点存在即可调用，不必存在document中)<br>3.update: 被绑定与元素所在模板更新时调用，而且无论绑定值是否有变化，通过比较更新前后的绑定值，忽略不必要的模板更新<br>4.componentUpdate :被绑定的元素所在模板完成一次更新更新周期的时候调用<br>5.unbind: 只调用一次，指令月元素解绑的时候调用</p><h2 id="17-Vue-filter"><a href="#17-Vue-filter" class="headerlink" title="17. Vue.filter"></a>17. Vue.filter</h2><p>场景:时间戳转化成年月日这是一个公共方法,所以可以抽离成过滤器使用</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 使用</span><span class="token comment" spellcheck="true">// 在双花括号中</span><span class="token punctuation">{</span><span class="token punctuation">{</span> message <span class="token operator">|</span> capitalize <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 在 `v-bind` 中</span><span class="token operator">&lt;</span>div v<span class="token operator">-</span>bind<span class="token punctuation">:</span>id<span class="token operator">=</span><span class="token string">"rawId | formatId"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token comment" spellcheck="true">// 全局注册</span>Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'stampToYYMMDD'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 处理逻辑</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 局部注册</span>filters<span class="token punctuation">:</span> <span class="token punctuation">{</span>  stampToYYMMDD<span class="token punctuation">:</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 处理逻辑</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 多个过滤器全局注册</span><span class="token comment" spellcheck="true">// /src/common/filters.js</span><span class="token keyword">let</span> dateServer <span class="token operator">=</span> value <span class="token operator">=</span><span class="token operator">></span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(\d{4})(\d{2})(\d{2})/g</span><span class="token punctuation">,</span> <span class="token string">'$1-$2-$3'</span><span class="token punctuation">)</span> <span class="token keyword">export</span> <span class="token punctuation">{</span> dateServer <span class="token punctuation">}</span><span class="token comment" spellcheck="true">// /src/main.js</span><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> custom <span class="token keyword">from</span> <span class="token string">'./common/filters/custom'</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>custom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=</span><span class="token operator">></span> Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> custom<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="18-Vue-compile"><a href="#18-Vue-compile" class="headerlink" title="18.Vue.compile"></a>18.Vue.compile</h2><p>场景:在 render 函数中编译模板字符串。只在独立构建时有效</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> res <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">'&lt;div>&lt;span>{{ msg }}&lt;/span>&lt;/div>'</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    msg<span class="token punctuation">:</span> <span class="token string">'hello'</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  render<span class="token punctuation">:</span> res<span class="token punctuation">.</span>render<span class="token punctuation">,</span>  staticRenderFns<span class="token punctuation">:</span> res<span class="token punctuation">.</span>staticRenderFns<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h2 id="19-Vue-version"><a href="#19-Vue-version" class="headerlink" title="19.Vue.version"></a>19.Vue.version</h2><p>场景:有些开发插件需要针对不同 vue 版本做兼容,所以就会用到 Vue.version<br>用法:Vue.version()可以获取 vue 版本</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> version <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>version<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span>version <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// Vue v2.x.x</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>version <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// Vue v1.x.x</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// Unsupported versions of Vue</span><span class="token punctuation">}</span></code></pre><h2 id="20-Vue-set"><a href="#20-Vue-set" class="headerlink" title="20.Vue.set()"></a>20.Vue.set()</h2><p>场景:当你利用索引直接设置一个数组项时或你修改数组的长度时,由于 Object.defineprototype()方法限制,数据不响应式更新</p><p>不过vue.3.x 将利用 proxy 这个问题将得到解决<br>解决方案:</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 利用 set</span><span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>index<span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 利用数组 push(),splice()</span></code></pre><p>21.Vue.config.keyCodes<br>场景:自定义按键修饰符别名</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 将键码为 113 定义为 f2</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>keyCodes<span class="token punctuation">.</span>f2 <span class="token operator">=</span> <span class="token number">113</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> @keyup<span class="token punctuation">.</span>f2<span class="token operator">=</span><span class="token string">"add"</span><span class="token operator">/</span><span class="token operator">></span></code></pre><h2 id="22-Vue-config-performance"><a href="#22-Vue-config-performance" class="headerlink" title="22.Vue.config.performance"></a>22.Vue.config.performance</h2><p>场景:监听性能</p><p>Vue.config.performance = true<br>只适用于开发模式和支持 performance.mark API 的浏览器上</p><h2 id="23-Vue-config-errorHandler"><a href="#23-Vue-config-errorHandler" class="headerlink" title="23.Vue.config.errorHandler"></a>23.Vue.config.errorHandler</h2><p>1.场景:指定组件的渲染和观察期间未捕获错误的处理函数<br>2.规则:</p><pre><code>  从 2.2.0 起，这个钩子也会捕获组件生命周期钩子里的错误。同样的，当这个钩子是 undefined 时，被捕获的错误会通过 console.error 输出而避免应用崩溃  从 2.4.0 起，这个钩子也会捕获 Vue 自定义事件处理函数内部的错误了  从 2.6.0 起，这个钩子也会捕获 v-on DOM 监听器内部抛出的错误。另外，如果任何被覆盖的钩子或处理函数返回一个 Promise 链 (例如 async 函数)，则来自其 Promise 链的错误也会被处理</code></pre><p>3.使用</p><pre class=" language-js"><code class="language-js">Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>errorHandler <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// handle error</span>  <span class="token comment" spellcheck="true">// `info` 是 Vue 特定的错误信息，比如错误所在的生命周期钩子</span>  <span class="token comment" spellcheck="true">// 只在 2.2.0+ 可用</span><span class="token punctuation">}</span></code></pre><h2 id="24-Vue-config-warnHandler"><a href="#24-Vue-config-warnHandler" class="headerlink" title="24.Vue.config.warnHandler"></a>24.Vue.config.warnHandler</h2><p>2.4.0 新增<br>1.场景:为 Vue 的运行时警告赋予一个自定义处理函数,只会在开发者环境下生效<br>2.用法:</p><pre class=" language-js"><code class="language-js">Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>warnHandler <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> trace<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// `trace` 是组件的继承关系追踪</span><span class="token punctuation">}</span></code></pre><h2 id="25-v-pre"><a href="#25-v-pre" class="headerlink" title="25.v-pre"></a>25.v-pre</h2><p>场景:vue 是响应式系统,但是有些静态的标签不需要多次编译,这样可以节省性能</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>span v<span class="token operator">-</span>pre<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">this</span> will not be compiled <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>   显示的是<span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">this</span> will not be compiled <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>span v<span class="token operator">-</span>pre<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>msg<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>     即使data里面定义了msg这里仍然是显示的<span class="token punctuation">{</span><span class="token punctuation">{</span>msg<span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="26-v-cloak"><a href="#26-v-cloak" class="headerlink" title="26.v-cloak"></a>26.v-cloak</h2><p>场景:在网速慢的情况下,在使用vue绑定数据的时候，渲染页面时会出现变量闪烁<br>用法:这个指令保持在元素上直到关联实例结束编译。和 CSS 规则如 [v-cloak] { display: none } 一起用时，这个指令可以隐藏未编译的 Mustache 标签直到实例准备完毕</p><pre class=" language-html"><code class="language-html">// template 中<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#app<span class="token punctuation">"</span></span> <span class="token attr-name">v-cloak</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{value.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>// css 中[v-cloak] {    display: none;}</code></pre><p>这样就可以解决闪烁,但是会出现白屏,这样可以结合骨架屏使用</p><h2 id="27-v-once"><a href="#27-v-once" class="headerlink" title="27.v-once"></a>27.v-once</h2><p>场景:有些 template 中的静态 dom 没有改变,这时就只需要渲染一次,可以降低性能开销</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>span v<span class="token operator">-</span>once<span class="token operator">></span> 这时只需要加载一次的标签<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span></code></pre><p>v-once 和 v-pre 的区别:<br>v-once只渲染一次；v-pre不编译,原样输出</p><h2 id="28-事件修饰符"><a href="#28-事件修饰符" class="headerlink" title="28.事件修饰符"></a>28.事件修饰符</h2><pre><code>.stop:阻止冒泡.prevent:阻止默认行为.self:仅绑定元素自身触发.once: 2.1.4 新增,只触发一次.passive: 2.3.0 新增,滚动事件的默认行为 (即滚动行为) 将会立即触发,不能和.prevent 一起使用</code></pre><h2 id="29-按键修饰符和按键码"><a href="#29-按键修饰符和按键码" class="headerlink" title="29.按键修饰符和按键码"></a>29.按键修饰符和按键码</h2><p>场景:有的时候需要监听键盘的行为,如按下 enter 去查询接口等</p><pre><code>// 对应键盘上的关键字.enter.tab.delete (捕获“删除”和“退格”键).esc.space.up.down.left.right</code></pre><h2 id="30-Vue-router"><a href="#30-Vue-router" class="headerlink" title="30.Vue-router"></a>30.Vue-router</h2><p>场景:Vue-router 是官方提供的路由插件</p><h3 id="30-1-缓存和动画"><a href="#30-1-缓存和动画" class="headerlink" title="30.1 缓存和动画"></a>30.1 缓存和动画</h3><p>1.路由是使用官方组件 vue-router,使用方法相信大家非常熟悉;<br>2.这里我就叙述下路由的缓存和动画;<br>3.可以用exclude(除了)或者include(包括),2.1.0 新增来坐判断</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>transition<span class="token operator">></span>  <span class="token operator">&lt;</span>keep<span class="token operator">-</span>alive <span class="token punctuation">:</span>include<span class="token operator">=</span><span class="token string">"['a', 'b']"</span><span class="token operator">></span>  <span class="token comment" spellcheck="true">//或include="a,b" :include="/a|b/",a 和 b 表示组件的 name</span>  <span class="token comment" spellcheck="true">//因为有些页面,如试试数据统计,要实时刷新,所以就不需要缓存</span>    <span class="token operator">&lt;</span>router<span class="token operator">-</span>view<span class="token operator">/</span><span class="token operator">></span> <span class="token comment" spellcheck="true">//路由标签</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>keep<span class="token operator">-</span>alive<span class="token operator">></span>  <span class="token operator">&lt;</span>router<span class="token operator">-</span>view exclude<span class="token operator">=</span><span class="token string">"c"</span><span class="token operator">/</span><span class="token operator">></span>   <span class="token comment" spellcheck="true">// c 表示组件的 name值</span><span class="token operator">&lt;</span><span class="token operator">/</span>transition<span class="token operator">></span></code></pre><p>注:匹配首先检查组件自身的 name 选项，如果 name 选项不可用，则匹配它的局部注册名称 (父组件 components 选项的键值)。匿名组件不能被匹配<br>4.用 v-if 做判断,组件会重新渲染,但是不用一一列举组件 name</p><h3 id="30-2-全局路由钩子"><a href="#30-2-全局路由钩子" class="headerlink" title="30.2 全局路由钩子"></a>30.2 全局路由钩子</h3><p>1.router.beforeEach</p><pre class=" language-js"><code class="language-js">router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'全局前置守卫：beforeEach -- next需要调用'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//一般登录拦截用这个,也叫导航钩子守卫</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token operator">===</span> <span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>2.router.beforeResolve (v 2.5.0+)<br>和beforeEach类似，区别是在导航被确认之前，同时在所有组件内守卫和异步路由组件被解析之后，解析守卫就被调用<br>即在 beforeEach之后调用</p><p>3.router.afterEach<br>全局后置钩子<br>在所有路由跳转结束的时候调用<br>这些钩子不会接受 next 函数也不会改变导航本身</p><h3 id="30-3-组件路由钩子"><a href="#30-3-组件路由钩子" class="headerlink" title="30.3 组件路由钩子"></a>30.3 组件路由钩子</h3><p>1.beforeRouteEnter<br>在渲染该组件的对应路由被确认前调用，用法和参数与router.beforeEach类似，next需要被主动调用<br>此时组件实例还未被创建，不能访问this<br>可以通过传一个回调给 next来访问组件实例。在导航被确认的时候执行回调，并且把组件实例作为回调方法的参数</p><pre class=" language-js"><code class="language-js">beforeRouteEnter <span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 这里还无法访问到组件实例，this === undefined</span>  <span class="token function">next</span><span class="token punctuation">(</span> vm <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 通过 `vm` 访问组件实例</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>2.beforeRouteUpdate (v 2.2+)<br>在当前路由改变，并且该组件被复用时调用，可以通过this访问实例， next需要被主动调用，不能传回调</p><p>3.beforeRouteLeave<br>导航离开该组件的对应路由时调用，可以访问组件实例 this，next需要被主动调用，不能传回调</p><h3 id="30-4-路由模式"><a href="#30-4-路由模式" class="headerlink" title="30.4 路由模式"></a>30.4 路由模式</h3><p>设置 mode 属性:hash或 history</p><h3 id="30-5-Vue-router"><a href="#30-5-Vue-router" class="headerlink" title="30.5 Vue.$router"></a>30.5 Vue.$router</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>跳转到不同的url，但这个方法回向history栈添加一个记录，点击后退会返回到上一个页面<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>不会有记录<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>n可为正数可为负数。正数返回上一个页面<span class="token punctuation">,</span>类似 window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span></code></pre><p>30.6 Vue.$route<br>表示当前跳转的路由对象,属性有:<br>name:路由名称<br>path:路径<br>query:传参接收值<br>params:传参接收值<br>fullPath:完成解析后的 URL，包含查询参数和 hash 的完整路径<br>matched:路由记录副本<br>redirectedFrom:如果存在重定向，即为重定向来源的路由的名字</p><pre class=" language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">:</span>获取通过 params 或<span class="token operator">/</span><span class="token punctuation">:</span>id传参的参数<span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">:</span>获取通过 query 传参的参数</code></pre><h3 id="30-7-router-view-的-key"><a href="#30-7-router-view-的-key" class="headerlink" title="30.7 router-view 的 key"></a>30.7 router-view 的 key</h3><p>场景:由于 Vue 会复用相同组件, 即 /page/1 =&gt; /page/2 或者 /page?id=1 =&gt; /page?id=2 这类链接跳转时, 将不在执行created, mounted之类的钩子</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>router<span class="token operator">-</span>view <span class="token punctuation">:</span>key<span class="token operator">=</span><span class="token string">"$route.fullpath"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">></span></code></pre><p>这样组件的 created 和 mounted 就都会执行</p><h2 id="31-Object-freeze"><a href="#31-Object-freeze" class="headerlink" title="31.Object.freeze"></a>31.Object.freeze</h2><p>场景:一个长列表数据,一般不会更改,但是vue会做getter和setter的转换<br>用法:是ES5新增的特性，可以冻结一个对象，防止对象被修改<br>支持:vue 1.0.18+对其提供了支持，对于data或vuex里使用freeze冻结了的对象，vue不会做getter和setter的转换<br>注意:冻结只是冻结里面的单个属性,引用地址还是可以更改</p><pre class=" language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// vue不会对list里的object做getter、setter绑定</span>        list<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">[</span>            <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    mounted <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 界面不会有响应,因为单个属性被冻结</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 下面两种做法，界面都会响应</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token number">200</span> <span class="token punctuation">}</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">[</span>        <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token number">200</span> <span class="token punctuation">}</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h2 id="32-调试-template"><a href="#32-调试-template" class="headerlink" title="32.调试 template"></a>32.调试 template</h2><p>场景:在Vue开发过程中, 经常会遇到template模板渲染时JavaScript变量出错的问题, 此时也许你会通过console.log来进行调试<br>这时可以在开发环境挂载一个 log 函数</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// main.js</span>Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$log <span class="token operator">=</span> window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>log<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 组件内部</span><span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token function">$log</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre><h2 id="33-vue-loader-小技巧"><a href="#33-vue-loader-小技巧" class="headerlink" title="33.vue-loader 小技巧"></a>33.vue-loader 小技巧</h2><h3 id="33-1-preserveWhitespace"><a href="#33-1-preserveWhitespace" class="headerlink" title="33.1 preserveWhitespace"></a>33.1 preserveWhitespace</h3><p>场景:开发 vue 代码一般会有空格,这个时候打包压缩如果不去掉空格会加大包的体积<br>配置preserveWhitespace可以减小包的体积</p><pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>  vue<span class="token punctuation">:</span> <span class="token punctuation">{</span>    preserveWhitespace<span class="token punctuation">:</span> <span class="token boolean">false</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="33-2-transformToRequire"><a href="#33-2-transformToRequire" class="headerlink" title="33.2 transformToRequire"></a>33.2 transformToRequire</h3><p>场景:以前在写 Vue 的时候经常会写到这样的代码：把图片提前 require 传给一个变量再传给组件</p><pre class=" language-html"><code class="language-html">// page 代码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>avatar</span> <span class="token attr-name">:img-src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>imgSrc<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>avatar</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    created <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./assets/default-avatar.png'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>现在:通过配置 transformToRequire 后，就可以直接配置，这样vue-loader会把对应的属性自动 require 之后传给组件</p><pre class=" language-html"><code class="language-html">// page 代码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>avatar</span> <span class="token attr-name">:img-src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>imgSrc<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>avatar</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    created <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./assets/default-avatar.png'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h2 id="34-为路径设置别名"><a href="#34-为路径设置别名" class="headerlink" title="34.为路径设置别名"></a>34.为路径设置别名</h2><p>1.场景:在开发过程中，我们经常需要引入各种文件，如图片、CSS、JS等，为了避免写很长的相对路径（../），我们可以为不同的目录配置一个别名</p><p>2.vue-cli 2.x 配置</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在 webpack.base.config.js中的 resolve 配置项，在其 alias 中增加别名</span>resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token string">'vue$'</span><span class="token punctuation">:</span> <span class="token string">'vue/dist/vue.esm.js'</span><span class="token punctuation">,</span>      <span class="token string">'@'</span><span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>3.vue-cli 3.x 配置</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在根目录下创建vue.config.js</span><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token keyword">function</span> resolve <span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  chainWebpack<span class="token punctuation">:</span> config <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias      <span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// key,value自行定义，比如.set('@@', resolve('src/components'))</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="35-img-加载失败"><a href="#35-img-加载失败" class="headerlink" title="35.img 加载失败"></a>35.img 加载失败</h2><p>场景:有些时候后台返回图片地址不一定能打开,所以这个时候应该加一张默认图片</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在根目录下创建vue.config.js</span><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token keyword">function</span> resolve <span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  chainWebpack<span class="token punctuation">:</span> config <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias      <span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// key,value自行定义，比如.set('@@', resolve('src/components'))</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="36-css"><a href="#36-css" class="headerlink" title="36.css"></a>36.css</h2><h3 id="36-1-局部样式"><a href="#36-1-局部样式" class="headerlink" title="36.1 局部样式"></a>36.1 局部样式</h3><p>1.Vue中style标签的scoped属性表示它的样式只作用于当前模块，是样式私有化.</p><p>2.渲染的规则/原理：<br>给HTML的DOM节点添加一个 不重复的data属性 来表示 唯一性<br>在对应的 CSS选择器 末尾添加一个当前组件的 data属性选择器来私有化样式，如：.demo[data-v-2311c06a]{}<br>如果引入 less 或 sass 只会在最后一个元素上设置</p><pre class=" language-html"><code class="language-html">// 原始代码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      Vue.js scoped    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>less<span class="token punctuation">"</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style language-css">  <span class="token selector"><span class="token class">.demo</span></span><span class="token punctuation">{</span>    <span class="token selector">font-size: 16px;    <span class="token class">.content</span></span><span class="token punctuation">{</span>      <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>// 浏览器渲染效果<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-v-fed36922</span><span class="token punctuation">></span></span>  Vue.js scoped<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector"><span class="token class">.demo</span><span class="token attribute">[data-v-039c5b43]</span> </span><span class="token punctuation">{</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">14</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.demo</span> <span class="token class">.content</span><span class="token attribute">[data-v-039c5b43]</span> </span><span class="token punctuation">{</span> //<span class="token number">.</span>demo 上并没有加 data 属性  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h3 id="36-2-deep-属性"><a href="#36-2-deep-属性" class="headerlink" title="36.2 deep 属性"></a>36.2 deep 属性</h3><pre class=" language-css"><code class="language-css"><span class="token selector">// 上面样式加一个 /deep/&lt;style lang="less" scoped>  <span class="token class">.demo</span></span><span class="token punctuation">{</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">14</span>px<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token selector"><span class="token class">.demo</span> /deep/ <span class="token class">.content</span></span><span class="token punctuation">{</span>    <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token selector">&lt;/style>// 浏览器编译后&lt;style type="text/css"><span class="token class">.demo</span><span class="token attribute">[data-v-039c5b43]</span> </span><span class="token punctuation">{</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">14</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.demo</span><span class="token attribute">[data-v-039c5b43]</span> <span class="token class">.content</span> </span><span class="token punctuation">{</span>  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span><span class="token punctuation">}</span>&lt;/style></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 转载 </tag>
            
            <tag> 实用技巧 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器兼容问题</title>
      <link href="/2020/07/08/liu-lan-qi-jian-rong-wen-ti/"/>
      <url>/2020/07/08/liu-lan-qi-jian-rong-wen-ti/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://www.cnblogs.com/angel648/p/11392262.html" target="_blank" rel="noopener">https://www.cnblogs.com/angel648/p/11392262.html</a></p></blockquote><h1 id="前端H5常见浏览器兼容性问题解决方案"><a href="#前端H5常见浏览器兼容性问题解决方案" class="headerlink" title="前端H5常见浏览器兼容性问题解决方案"></a><a href="https://www.cnblogs.com/angel648/p/11392262.html" target="_blank" rel="noopener">前端H5常见浏览器兼容性问题解决方案</a></h1><p>不同浏览器的内核也不尽相同，所以各个浏览器对网页的解析存在一定的差异。<br>浏览器内核主要分为两种，一是渲染引擎，另一个是js 引擎，内核更加倾向于说渲染引擎。<br>常见的浏览器内核：<br><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200708172652.png" alt=""></p><p>不同浏览器的默认样式存在差异，可以使用 <code>Normalize.css</code> 抹平这些差异。</p><h3 id="1-不同浏览器的标签默认的外补丁和内补丁不同"><a href="#1-不同浏览器的标签默认的外补丁和内补丁不同" class="headerlink" title="1.不同浏览器的标签默认的外补丁和内补丁不同"></a><strong>1.不同浏览器的标签默认的外补丁和内补丁不同</strong></h3><p>问题症状：随便写几个标签，不加样式控制的情况下，各自的margin 和padding差异较大。</p><p>碰到频率:100%</p><p>解决方案：CSS里  *{margin:0;padding:0;}</p><p>备注：这个是最常见的也是最易解决的一个浏览器兼容性问题，几乎所有的CSS文件开头都会用通配符*来设置各个标签的内外补丁是0。</p><h3 id="2-块属性标签float后，又有横行的margin情况下，在IE6显示margin比设置的大"><a href="#2-块属性标签float后，又有横行的margin情况下，在IE6显示margin比设置的大" class="headerlink" title="2.块属性标签float后，又有横行的margin情况下，在IE6显示margin比设置的大"></a><strong>2.块属性标签float后，又有横行的margin情况下，在IE6显示margin比设置的大</strong></h3><p>问题症状:常见症状是IE6中后面的一块被顶到下一行</p><p>碰到频率：90%（稍微复杂点的页面都会碰到，float布局最常见的浏览器兼容问题）</p><p>解决方案：在float的标签样式控制中加入 display:inline;将其转化为行内属性</p><p>备注：我们最常用的就是div+CSS布局了，而div就是一个典型的块属性标签，横向布局的时候我们通常都是用div float实现的，横向的间距设置如果用margin实现，这就是一个必然会碰到的兼容性问题。</p><h3 id="3-设置较小高度标签（一般小于10px），在IE6，IE7，遨游中高度超出自己设置高度"><a href="#3-设置较小高度标签（一般小于10px），在IE6，IE7，遨游中高度超出自己设置高度" class="headerlink" title="3.设置较小高度标签（一般小于10px），在IE6，IE7，遨游中高度超出自己设置高度"></a><strong>3.设置较小高度标签（一般小于10px），在IE6，IE7，遨游中高度超出自己设置高度</strong></h3><p>问题症状：IE6、7和遨游里这个标签的高度不受控制，超出自己设置的高度</p><p>碰到频率：60%</p><p>解决方案：给超出高度的标签设置overflow:hidden;或者设置行高line-height 小于你设置的高度。</p><p>备注：这种情况一般出现在我们设置小圆角背景的标签里。出现这个问题的原因是IE8之前的浏览器都会给标签一个最小默认的行高的高度。即使你的标签是空的，这个标签的高度还是会达到默认的行高。</p><h3 id="4-行内属性标签，设置display-block后采用float布局，又有横行的margin的情况，IE6间距bug"><a href="#4-行内属性标签，设置display-block后采用float布局，又有横行的margin的情况，IE6间距bug" class="headerlink" title="4.行内属性标签，设置display:block后采用float布局，又有横行的margin的情况，IE6间距bug"></a><strong>4.行内属性标签，设置display:block后采用float布局，又有横行的margin的情况，IE6间距bug</strong></h3><p>问题症状：IE6里的间距比超过设置的间距</p><p>碰到几率：20%</p><p>解决方案：在display:block;后面加入display:inline;display:table;</p><p>备注：行内属性标签，为了设置宽高，我们需要设置display:block;(除了input标签比较特殊)。在用float布局并有横向的margin后，在IE6下，他就具有了块属性float后的横向margin的bug。不过因为它本身就是行内属性标签，所以我们再加上display:inline的话，它的高宽就不可设了。这时候我们还需要在display:inline后面加入display:talbe。</p><h3 id="5-图片默认有间距"><a href="#5-图片默认有间距" class="headerlink" title="5.图片默认有间距"></a><strong>5.图片默认有间距</strong></h3><p>问题症状：几个img标签放在一起的时候，有些浏览器会有默认的间距，加了问题一中提到的通配符也不起作用。</p><p>碰到几率：20%</p><p>解决方案：使用float属性为img布局</p><p>备注：因为img标签是行内属性标签，所以只要不超出容器宽度，img标签都会排在一行里，但是部分浏览器的img标签之间会有个间距。去掉这个间距使用float是正道。（我的一个学生使用负margin，虽然能解决，但负margin本身就是容易引起浏览器兼容问题的用法，所以我禁止他们使用）</p><h3 id="6-标签最低高度设置min-height不兼容"><a href="#6-标签最低高度设置min-height不兼容" class="headerlink" title="6.标签最低高度设置min-height不兼容"></a><strong>6.标签最低高度设置min-height不兼容</strong></h3><p>问题症状：因为min-height本身就是一个不兼容的CSS属性，所以设置min-height时不能很好的被各个浏览器兼容</p><p>碰到几率：5%</p><p>解决方案：如果我们要设置一个标签的最小高度200px，需要进行的设置为：{min-height:200px; height:auto !important; height:200px; overflow:visible;}</p><p>备注：在B/S系统前端开时，有很多情况下我们又这种需求。当内容小于一个值（如300px）时。容器的高度为300px；当内容高度大于这个值时，容器高度被撑高，而不是出现滚动条。这时候我们就会面临这个兼容性问题。</p><h3 id="7-透明度的兼容CSS设置"><a href="#7-透明度的兼容CSS设置" class="headerlink" title="7.透明度的兼容CSS设置"></a><strong>7.透明度的兼容CSS设置</strong></h3><pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.transparent_class</span> </span><span class="token punctuation">{</span>        <span class="token property">filter</span><span class="token punctuation">:</span><span class="token function">alpha</span><span class="token punctuation">(</span>opacity=<span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token property">-moz-opacity</span><span class="token punctuation">:</span><span class="token number">0.5</span><span class="token punctuation">;</span>        <span class="token property">-khtml-opacity</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">;</span>        <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>   </code></pre><p>如果我们熟悉标签的默认属性的话，就能很好的理解为什么会出现兼容问题以及怎么去解决这些兼容问题。</p><p>◆IE6认识的hacker 是下划线_ 和星号 *</p><p>◆IE7 遨游认识的hacker是星号 *</p><p>比如这样一个CSS设置：</p><p>height:300px;<em>height:200px;_height:100px;<br>IE6浏览器在读到height:300px的时候会认为高时300px；继续往下读，他也认识</em>heihgt， 所以当IE6读到*height:200px的时候会覆盖掉前一条的相冲突设置，认为高度是200px。继续往下读，IE6还认识_height,所以他又会覆盖掉200px高的设置，把高度设置为100px；</p><p>IE7和遨游也是一样的从高度300px的设置往下读。当它们读到*height200px的时候就停下了，因为它们不认识_height。所以它们会把高度解析为200px，剩下的浏览器只认识第一个height:300px;所以他们会把高度解析为300px。因为优先级相同且想冲突的属性设置后一个会覆盖掉前一个，所以书写的次序是很重要的。</p><h3 id="8-IE6双边距问题-在-IE6中设置了float-同时又设置margin-就会出现边距问题"><a href="#8-IE6双边距问题-在-IE6中设置了float-同时又设置margin-就会出现边距问题" class="headerlink" title="8.IE6双边距问题:在 IE6中设置了float , 同时又设置margin , 就会出现边距问题"></a><strong>8.IE6双边距问题:在 IE6中设置了float , 同时又设置margin , 就会出现边距问题</strong></h3><p>解决方案：设置display:inline;</p><h3 id="9-当标签的高度设置小于10px，在IE6、IE7中会超出自己设置的高度"><a href="#9-当标签的高度设置小于10px，在IE6、IE7中会超出自己设置的高度" class="headerlink" title="9.当标签的高度设置小于10px，在IE6、IE7中会超出自己设置的高度"></a><strong>9.当标签的高度设置小于10px，在IE6、IE7中会超出自己设置的高度</strong></h3><p>解决方案：超出高度的标签设置overflow:hidden,或者设置line-height的值小于你的设置高度</p><h3 id="10-图片默认有间距"><a href="#10-图片默认有间距" class="headerlink" title="10.图片默认有间距"></a><strong>10.图片默认有间距</strong></h3><p>解决方案：使用float 为img 布局</p><h3 id="11-IE9一下浏览器不能使用opacity"><a href="#11-IE9一下浏览器不能使用opacity" class="headerlink" title="11.IE9一下浏览器不能使用opacity"></a><strong>11.IE9一下浏览器不能使用opacity</strong></h3><p>解决方案：<br>opacity: 0.5;filter: alpha(opacity = 50);filter: progid:DXImageTransform.Microsoft.Alpha(style = 0, opacity = 50);</p><h3 id="12-边距重叠问题；当相邻两个元素都设置了margin-边距时，margin-将取最大值，舍弃最小值；"><a href="#12-边距重叠问题；当相邻两个元素都设置了margin-边距时，margin-将取最大值，舍弃最小值；" class="headerlink" title="12.边距重叠问题；当相邻两个元素都设置了margin 边距时，margin 将取最大值，舍弃最小值；"></a><strong>12.边距重叠问题；当相邻两个元素都设置了margin 边距时，margin 将取最大值，舍弃最小值；</strong></h3><p>解决方案：为了不让边重叠，可以给子元素增加一个父级元素，并设置父级元素为overflow:hidden；</p><h3 id="13-cursor-hand-显示手型在safari-上不支持"><a href="#13-cursor-hand-显示手型在safari-上不支持" class="headerlink" title="13.cursor:hand 显示手型在safari 上不支持"></a><strong>13.cursor:hand 显示手型在safari 上不支持</strong></h3><p>解决方案：统一使用 cursor:pointer</p><h3 id="14-两个块级元素，父元素设置了overflow-auto；子元素设置了position-relative-且高度大于父元素，在IE6、IE7会被隐藏而不是溢出；"><a href="#14-两个块级元素，父元素设置了overflow-auto；子元素设置了position-relative-且高度大于父元素，在IE6、IE7会被隐藏而不是溢出；" class="headerlink" title="14.两个块级元素，父元素设置了overflow:auto；子元素设置了position:relative ;且高度大于父元素，在IE6、IE7会被隐藏而不是溢出；"></a><strong>14.两个块级元素，父元素设置了overflow:auto；子元素设置了position:relative ;且高度大于父元素，在IE6、IE7会被隐藏而不是溢出；</strong></h3><p>解决方案：父级元素设置position:relative</p><h3 id="15-IE6-背景闪烁的问题"><a href="#15-IE6-背景闪烁的问题" class="headerlink" title="15.IE6 背景闪烁的问题"></a>15.IE6 背景闪烁的问题</h3><p>问题：链接、按钮用 <code>CSSsprites</code> 作为背景，在 <code>ie6</code> 下会有背景图闪烁的现象。原因是 <code>IE6</code> 没有将背景图缓存，每次触发 <code>hover</code> 的时候都会重新加载</p><p>解决：可以用 <code>JavaScript</code> 设置 <code>ie6</code> 缓存这些图片：</p><pre class=" language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">"BackgroundImageCache"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="16-解决在-IE6-下，列表与日期错位的问题"><a href="#16-解决在-IE6-下，列表与日期错位的问题" class="headerlink" title="16.解决在 IE6 下，列表与日期错位的问题"></a>16.解决在 IE6 下，列表与日期错位的问题</h3><p>日期<code>&lt;span&gt;</code> 标签放在标题 <code>&lt;a&gt;</code> 标签之前即可</p><h3 id="17-解决-IE6-不支持-min-height-属性的问题"><a href="#17-解决-IE6-不支持-min-height-属性的问题" class="headerlink" title="17.解决 IE6 不支持 min-height 属性的问题"></a>17.解决 <code>IE6</code> 不支持 <code>min-height</code> 属性的问题</h3><pre class=" language-css"><code class="language-css"><span class="token property">min-height</span><span class="token punctuation">:</span> <span class="token number">350</span>px<span class="token punctuation">;</span><span class="token property">_height</span><span class="token punctuation">:</span> <span class="token number">350</span>px<span class="token punctuation">;</span></code></pre><h3 id="18-让-IE7-IE8-支持-CSS3-background-size属性"><a href="#18-让-IE7-IE8-支持-CSS3-background-size属性" class="headerlink" title="18.让 IE7 IE8 支持 CSS3 background-size属性"></a>18.让 <code>IE7 IE8</code> 支持 <code>CSS3 background-size</code>属性</h3><p>由于 background-size 是 CSS3 新增的属性，所以 IE 低版本自然就不支持了，但是老外写了一个 htc 文件，名叫 <a href="https://link.juejin.im/?target=标签">background-size polyfill</a>，使用该文件能够让 IE7、IE8 支持 background-size 属性。其原理是创建一个 img 元素插入到容器中，并重新计算宽度、高度、left、top 等值，模拟 background-size 的效果。</p><pre class=" language-css"><code class="language-css"><span class="token selector">html </span><span class="token punctuation">{</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">body </span><span class="token punctuation">{</span>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span>  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url">url('img/37.png')</span><span class="token punctuation">;</span>  <span class="token property">background-repeat</span><span class="token punctuation">:</span> no-repeat<span class="token punctuation">;</span>  <span class="token property">background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span>  <span class="token property">-ms-behavior</span><span class="token punctuation">:</span> <span class="token url">url('css/backgroundsize.min.htc')</span><span class="token punctuation">;</span>  <span class="token property">behavior</span><span class="token punctuation">:</span> <span class="token url">url('css/backgroundsize.min.htc')</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="19-IE6-7-line-height-失效的问题"><a href="#19-IE6-7-line-height-失效的问题" class="headerlink" title="19.IE6-7 line-height 失效的问题"></a>19.IE6-7 <code>line-height</code> 失效的问题</h3><p>问题：在<code>ie</code> 中 <code>img</code> 与文字放一起时，<code>line-height</code> 不起作用</p><p>解决：都设置成 <code>float</code></p><h3 id="width-100"><a href="#width-100" class="headerlink" title="width:100%"></a><code>width:100%</code></h3><p><code>width:100%</code> 这个东西在 <code>ie</code> 里用很方便，会向上逐层搜索 <code>width</code> 值，忽视浮动层的影响.</p><p><code>Firefox</code> 下搜索至浮动层结束，如此，只能给中间的所有浮动层加 <code>width:100%</code>才行，累啊。</p><pre><code>opera` 这点倒学乖了，跟了 `ie</code></pre><h3 id="cursor-hand"><a href="#cursor-hand" class="headerlink" title="cursor:hand"></a><code>cursor:hand</code></h3><p>显示手型 <code>cursor: hand</code>，ie6/7/8、opera 都支持，但是safari 、 ff 不支持</p><pre><code>cursor: pointer;</code></pre><h3 id="20-td-自动换行的问题"><a href="#20-td-自动换行的问题" class="headerlink" title="20.td 自动换行的问题"></a>20.td 自动换行的问题</h3><p>问题：<code>table</code> 宽度固定，<code>td</code> 自动换行</p><p>解决：设置 <code>Table</code> 为 <code>table-layout: fixed</code>，<code>td</code> 为 <code>word-wrap: break-word</code></p><h3 id="21-让层显示在-FLASH-之上"><a href="#21-让层显示在-FLASH-之上" class="headerlink" title="21.让层显示在 FLASH 之上"></a>21.让层显示在 <code>FLASH</code> 之上</h3><p>想让层的内容显示在 flash 上，把 FLASH 设置透明即可</p><pre><code>1、&lt;param name=&quot; wmode &quot; value=&quot;transparent&quot; /&gt;2、&lt;param name=&quot;wmode&quot; value=&quot;opaque&quot;/&gt;</code></pre><h3 id="22-键盘事件-keyCode-兼容性写法"><a href="#22-键盘事件-keyCode-兼容性写法" class="headerlink" title="22.键盘事件 keyCode 兼容性写法"></a>22.键盘事件 <code>keyCode</code> 兼容性写法</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> inp <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'inp'</span><span class="token punctuation">)</span><span class="token keyword">var</span> result <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">getKeyCode</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  e <span class="token operator">=</span> e <span class="token operator">?</span> e <span class="token punctuation">:</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>event <span class="token operator">?</span> window<span class="token punctuation">.</span>event <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> e<span class="token punctuation">.</span>keyCode <span class="token operator">?</span> e<span class="token punctuation">.</span>keyCode <span class="token punctuation">:</span> e<span class="token punctuation">.</span>which<span class="token punctuation">}</span>inp<span class="token punctuation">.</span>onkeypress <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  result<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token function">getKeyCode</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="23-求窗口大小的兼容写法"><a href="#23-求窗口大小的兼容写法" class="headerlink" title="23.求窗口大小的兼容写法"></a>23.求窗口大小的兼容写法</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 浏览器窗口可视区域大小（不包括工具栏和滚动条等边线）</span><span class="token comment" spellcheck="true">// 1600 * 525</span><span class="token keyword">var</span> client_w <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientWidth <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span><span class="token keyword">var</span> client_h <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 网页内容实际宽高（包括工具栏和滚动条等边线）</span><span class="token comment" spellcheck="true">// 1600 * 8</span><span class="token keyword">var</span> scroll_w <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollWidth <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollWidth<span class="token punctuation">;</span><span class="token keyword">var</span> scroll_h <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollHeight <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 网页内容实际宽高 (不包括工具栏和滚动条等边线）</span><span class="token comment" spellcheck="true">// 1600 * 8</span><span class="token keyword">var</span> offset_w <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>offsetWidth <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span><span class="token keyword">var</span> offset_h <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>offsetHeight <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 滚动的高度</span><span class="token keyword">var</span> scroll_Top <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop<span class="token operator">||</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span></code></pre><h3 id="24-DOM-事件处理程序的兼容写法"><a href="#24-DOM-事件处理程序的兼容写法" class="headerlink" title="24.DOM 事件处理程序的兼容写法"></a>24.DOM 事件处理程序的兼容写法</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> eventshiv <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// event兼容</span>    getEvent<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> event <span class="token operator">?</span> event <span class="token punctuation">:</span> window<span class="token punctuation">.</span>event<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// &lt;span class="hljs-built_in">type&lt;/span>兼容</span>getType<span class="token punctuation">:</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">function</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span><span class="token keyword">return</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> event<span class="token punctuation">.</span>type<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// target兼容</span>getTarget<span class="token punctuation">:</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">function</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span><span class="token keyword">return</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> event<span class="token punctuation">.</span>target <span class="token operator">?</span> event<span class="token punctuation">.</span>target <span class="token punctuation">:</span> event<span class="token punctuation">.</span>srcelem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 添加事件句柄</span>addHandler<span class="token punctuation">:</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">function</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span>type<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">if</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">(</span>elem<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>        elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span>type<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span> listener<span class="token punctuation">,</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-literal"</span><span class="token operator">></span><span class="token boolean">false</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">else</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">if</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">(</span>elem<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        elem<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-string"</span><span class="token operator">></span><span class="token string">'on'</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token operator">+</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span>type<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">else</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 在这里由于.与&lt;span class="hljs-string">'on'&lt;/span>字符串不能链接，只能用 []</span>        elem<span class="token punctuation">[</span><span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-string"</span><span class="token operator">></span><span class="token string">'on'</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token operator">+</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span>type<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">]</span> <span class="token operator">=</span> listener<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 移除事件句柄</span>removeHandler<span class="token punctuation">:</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">function</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span>type<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">if</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">(</span>elem<span class="token punctuation">.</span>removeEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>        elem<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span>type<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span> listener<span class="token punctuation">,</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-literal"</span><span class="token operator">></span><span class="token boolean">false</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">else</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">if</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">(</span>elem<span class="token punctuation">.</span>detachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        elem<span class="token punctuation">.</span><span class="token function">detachEvent</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-string"</span><span class="token operator">></span><span class="token string">'on'</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token operator">+</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span>type<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">else</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">{</span>        elem<span class="token punctuation">[</span><span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-string"</span><span class="token operator">></span><span class="token string">'on'</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token operator">+</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span>type<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 添加事件代理</span>addAgent<span class="token punctuation">:</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">function</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">(</span>elem<span class="token punctuation">,</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span>type<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span> agent<span class="token punctuation">,</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>    elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-built_in"</span><span class="token operator">></span>type<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">function</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">if</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>agent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            listener<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// this 指向 e.target</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 取消默认行为</span>preventDefault<span class="token punctuation">:</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">function</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">if</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>preventDefault<span class="token punctuation">)</span> <span class="token punctuation">{</span>        event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">else</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">{</span>        event<span class="token punctuation">.</span>returnValue <span class="token operator">=</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-literal"</span><span class="token operator">></span><span class="token boolean">false</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 阻止事件冒泡</span>stopPropagation<span class="token punctuation">:</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">function</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">if</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>stopPropagation<span class="token punctuation">)</span> <span class="token punctuation">{</span>        event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-keyword"</span><span class="token operator">></span><span class="token keyword">else</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> <span class="token punctuation">{</span>        event<span class="token punctuation">.</span>cancelBubble <span class="token operator">=</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"hljs-literal"</span><span class="token operator">></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2 id="vue解决浏览器兼容问题"><a href="#vue解决浏览器兼容问题" class="headerlink" title="vue解决浏览器兼容问题"></a>vue解决浏览器兼容问题</h2><p>在使用 <code>Normalize.css</code> 的基础上，还会出现旧版本的浏览器出现没有ES6语法的情况，那么这个可以使用webpack去导入polyfil，使得浏览器可以借助于polyfill的补丁去识别ES6语法</p><p>步骤一：</p><pre><code>npm i babel-polyfill --save-dev</code></pre><p>步骤二：</p><pre class=" language-js"><code class="language-js">在src同级目录下新建vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js文件配置如下module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    configureWebpack<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// devServer是跨域配置</span>        devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>            proxy<span class="token punctuation">:</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//名字可以自定义，这里我用的是api/</span>                <span class="token string">'/api/'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                    target<span class="token punctuation">:</span> <span class="token string">'https://www.163.com'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//设置你调用的接口域名和端口号 别忘了加http</span>                    ws<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 是否代理websockets</span>                    changeOrigin<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//这里设置是否跨域</span>                    pathRewrite<span class="token punctuation">:</span> <span class="token punctuation">{</span>                        <span class="token string">'^/api/'</span><span class="token punctuation">:</span> <span class="token string">'https://www.163.com'</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    chainWebpack<span class="token punctuation">:</span> config <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 其他配置</span>    config<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'babel-polyfill'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// main是入口js文件</span>    <span class="token comment" spellcheck="true">// 其他配置</span>   <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript深拷贝和浅拷贝</title>
      <link href="/2020/07/07/javascript-shen-kao-bei-he-qian-kao-bei/"/>
      <url>/2020/07/07/javascript-shen-kao-bei-he-qian-kao-bei/</url>
      
        <content type="html"><![CDATA[<blockquote><p>作者：super_wei<br>链接：<a href="https://www.jianshu.com/p/0b66b8462860" target="_blank" rel="noopener">https://www.jianshu.com/p/0b66b8462860</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote><p>我们通常在对数据进行拷贝的时候会踩到数据拷贝的坑中，主要是对数据和指针的引用区别，这篇文章就主要分析深、浅拷贝的区别和方式</p><h2 id="堆-amp-栈"><a href="#堆-amp-栈" class="headerlink" title="堆&amp;栈"></a>堆&amp;栈</h2><p>如下图所示，两者都是存放临时数据的地方。</p><p>栈是先进后出的，就像一个桶，后进去的先出来，它下面本来有的东西要等其他出来之后才能出来。</p><p>堆是在程序运行时，而不是在程序编译时，申请某个大小的内存空间。即动态分配内存，对其访问和对一般内存的访问没有区别。对于堆，我们可以随心所欲的进行增加变量和删除变量，不用遵循次序。</p><p>数据类型分为基础类型和引用类型，在我们声明数据的时候，基础类型时存放到栈里面，引用类型时存放到堆里面，在拷贝的时候是直接从栈这边去取，获取基本类型时直接获取值本身，而引用类型只是在栈这边存的是一个指向堆相应地址的指针。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707182252" alt=""></p><h2 id="赋值、深浅拷贝的区别"><a href="#赋值、深浅拷贝的区别" class="headerlink" title="赋值、深浅拷贝的区别"></a>赋值、深浅拷贝的区别</h2><p>赋值：当我们把一个对象赋值给一个新的变量时，<strong>赋的其实是该对象的在栈中的地址，而不是堆中的数据</strong>。也就是两个对象指向的是同一个存储空间，无论哪个对象发生改变，其实都是改变的存储空间的内容，因此，两个对象是联动的。</p><p>浅拷贝：浅拷贝是创建一个新对象，这个对象有着原始对象属性值的一份精确拷贝。如果属性是基本类型，拷贝的就是基本类型的值，如果属性是引用类型，拷贝的就是指向堆的地址 ，所以<strong>如果一个拷贝对象改变了其中的一个地址，则另一个拷贝对象的该地址也会发生改变</strong>。</p><p>深拷贝： 深拷贝是将一个对象从内存中完整的拷贝一份出来,从堆内存中开辟一个新的区域存放新对象,且<strong>修该拷贝后的对象不会影响到原有的对象；</strong></p><p>赋值：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707182305" alt=""></p><p>浅拷贝：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707182314" alt=""></p><p>深拷贝：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707182324" alt=""></p><h2 id="深拷贝和浅拷贝详解"><a href="#深拷贝和浅拷贝详解" class="headerlink" title="深拷贝和浅拷贝详解"></a>深拷贝和浅拷贝详解</h2><blockquote><p>本文知识点引用于：<a href="http://caibaojian.com/javascript-array-copy.html" target="_blank" rel="noopener">http://caibaojian.com/javascript-array-copy.html</a></p></blockquote><p>案例：</p><p>array1：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>undefined<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><h3 id="js的原生方法"><a href="#js的原生方法" class="headerlink" title="js的原生方法"></a>js的原生方法</h3><h4 id="slice-方法"><a href="#slice-方法" class="headerlink" title="slice()方法"></a>slice()方法</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> c1 <span class="token operator">=</span> array1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="concat-方法"><a href="#concat-方法" class="headerlink" title="concat()方法"></a>concat()方法</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> cc1 <span class="token operator">=</span> array1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="from-方法"><a href="#from-方法" class="headerlink" title="from()方法"></a>from()方法</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> fc1 <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>array1<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="push-方法"><a href="#push-方法" class="headerlink" title="push()方法"></a>push()方法</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> pc1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>pc1<span class="token punctuation">,</span>array1<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="map-方法"><a href="#map-方法" class="headerlink" title="map()方法"></a>map()方法</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> mc1 <span class="token operator">=</span> array1<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> item<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>以上几种方法都能实现数组的<code>浅拷贝</code>，即数组的每一项只能是原始类型的数据，如果数组的项包含引用类型，如数组（即js中的二维数组），对象等，以上方法复制的项只是引用。</p><p>还有一种方法是，使用<a href="http://caibaojian.com/t/json" target="_blank" rel="noopener">JSON</a>进行转换，先将数组序列化为json字符串，然后再将字符串转换成json对象即可。</p><h3 id="JSON方法的详解"><a href="#JSON方法的详解" class="headerlink" title="JSON方法的详解"></a>JSON方法的详解</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> jsonc <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>array1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这种方法可以变相的实现<code>深拷贝</code>,但是这种方法也有其限制：<a href="http://caibaojian.com/javascript-array-copy.html" target="_blank" rel="noopener">·</a></p><ul><li>首先，数组中的项如果是<code>undefined</code>，那么转换后将变为<code>null</code></li><li>如果数组的项为对象，那么对象之间不可相互引用。会造成循环引用，无法JSON序列化。</li></ul><h2 id="总结：性能分析"><a href="#总结：性能分析" class="headerlink" title="总结：性能分析"></a>总结：性能分析</h2><p>以上几种方法都可以实现数组的拷贝，那么，每种方法的性能如何呢，我使用<code>console.time()</code>和<code>console.timeEnd()</code>跟踪当数组大小为100-10000000时，每个方法所用的时间。注意，这里数组每一项都是随机的5种原始值的一个，不包含引用类型</p><table><thead><tr><th align="left">数组大小</th><th align="left">forof</th><th align="left">slice</th><th>concat</th><th>from</th><th>push</th><th>map</th><th>json</th></tr></thead><tbody><tr><td align="left">100</td><td align="left">0.593ms</td><td align="left">0.038ms</td><td>0.034ms</td><td>0.404ms</td><td>0.054ms</td><td>0.193ms</td><td>0.042ms</td></tr><tr><td align="left">1000</td><td align="left">1.606ms</td><td align="left">0.052ms</td><td>0.044ms</td><td>1.311ms</td><td>0.090ms</td><td>0.897ms</td><td>0.124ms</td></tr><tr><td align="left">10000</td><td align="left">2.272ms</td><td align="left">0.097ms</td><td>0.093ms</td><td>3.294ms</td><td>0.145ms</td><td>1.845ms</td><td>0.772ms</td></tr><tr><td align="left">100000</td><td align="left">14.665ms</td><td align="left">0.901ms</td><td>0.730ms</td><td>22.283ms</td><td>4.002ms</td><td>15.894ms</td><td>9.101ms</td></tr><tr><td align="left">1000000</td><td align="left">175.663ms</td><td align="left">16.051ms</td><td>8.400ms</td><td>235.900ms</td><td>Maximum call stack size exceeded</td><td>144.058ms</td><td>97.946ms</td></tr><tr><td align="left">10000000</td><td align="left">1597.242ms</td><td align="left">83.860ms</td><td>124.781ms</td><td>2425.540ms</td><td>Maximum call stack size exceeded</td><td>1424.344ms</td><td>1043.772ms</td></tr></tbody></table><blockquote><p>当数组大小超过1000000时，push方式就挂了，报错：<code>Maximum call stack size exceeded</code></p></blockquote><p>webkit浏览器使用cocat().非webkit使用slice()。<a href="http://caibaojian.com/javascript-array-copy.html" target="_blank" rel="noopener">·</a></p><p>补上之前文章的另外另种实现：</p><h3 id="简单的引用复制"><a href="#简单的引用复制" class="headerlink" title="简单的引用复制"></a>简单的引用复制</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">shallowClone</span><span class="token punctuation">(</span>copyObj<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token keyword">in</span> copyObj<span class="token punctuation">)</span> <span class="token punctuation">{</span>    obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> copyObj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> obj<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token punctuation">{</span>  a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  b<span class="token punctuation">:</span> <span class="token punctuation">{</span> f<span class="token punctuation">:</span> <span class="token punctuation">{</span> g<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  c<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token function">shallowClone</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>b<span class="token punctuation">.</span>f <span class="token operator">===</span> x<span class="token punctuation">.</span>b<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// true</span></code></pre><h3 id="Object-assign"><a href="#Object-assign" class="headerlink" title="Object.assign()"></a>Object.assign()</h3><p>Object.assign() 方法可以把任意多个的源对象自身的可枚举属性拷贝给目标对象，然后返回目标对象。<a href="http://caibaojian.com/javascript-array-copy.html" target="_blank" rel="noopener">·</a></p><pre><code>//code from http://caibaojian.com/javascript-array-copy.htmlvar x = {  a: 1,  b: { f: { g: 1 } },  c: [ 1, 2, 3 ]};var y = Object.assign({}, x);console.log(y.b.f === x.b.f);     // true</code></pre><h3 id="深度拷贝"><a href="#深度拷贝" class="headerlink" title="深度拷贝"></a>深度拷贝</h3><h3 id="方法1：使用-JSON-方法"><a href="#方法1：使用-JSON-方法" class="headerlink" title="方法1：使用 JSON 方法"></a>方法1：使用 JSON 方法</h3><p>JSON.stringify(array) 然后再 JSON.parse()。示例：<a href="http://caibaojian.com/javascript-array-copy.html" target="_blank" rel="noopener">·</a></p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//code from http://caibaojian.com/javascript-array-copy.html</span><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>arr2 <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> arr2<span class="token punctuation">)</span><span class="token punctuation">;</span>arr2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>arr2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>此方法存在对古老浏览器的兼容性问题。如确需要作兼容，可引入如下兼容文件解决：<a href="http://caibaojian.com/javascript-array-copy.html" target="_blank" rel="noopener">·</a></p><p><a href="https://github.com/douglascrockford/JSON-js/blob/master/json2.js" target="_blank" rel="noopener">https://github.com/douglascrockford/JSON-js/blob/master/json2.js</a></p><p><strong>注意：</strong>如果数组值为函数，上述方法还是不行的</p><p><strong>注意：</strong>如果数组值为函数，上述方法还是不行的。<a href="http://caibaojian.com/javascript-array-copy.html" target="_blank" rel="noopener">·</a></p><h3 id="方法2：深度复制的完全实现"><a href="#方法2：深度复制的完全实现" class="headerlink" title="方法2：深度复制的完全实现"></a>方法2：深度复制的完全实现</h3><p>考虑到多维数组的嵌套，以及数组值为对象的情况，可以作如下原型扩展（当然写为普通函数实现也是可以的，原型扩展是不建议的方式）：</p><pre class=" language-js"><code class="language-js">Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>clone <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>o<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">return</span> o<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>clone <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">return</span> arr<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//测试1 Object</span><span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Rattz'</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>hello<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">"I'm "</span> <span class="token operator">+</span> name<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> obj2 <span class="token operator">=</span> obj1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>obj2<span class="token punctuation">.</span>age<span class="token operator">++</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//测试2 Array</span><span class="token keyword">var</span> fun <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span>log<span class="token punctuation">}</span><span class="token punctuation">,</span>arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">,</span> fun<span class="token punctuation">]</span><span class="token punctuation">,</span>arr2 <span class="token operator">=</span> arr1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> arr2<span class="token punctuation">)</span><span class="token punctuation">;</span>arr2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token string">'Mike'</span><span class="token punctuation">;</span>arr2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>arr2<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> arr2<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>原文链接：<a href="http://caibaojian.com/javascript-array-copy.html" target="_blank" rel="noopener">http://caibaojian.com/javascript-array-copy.html</a></p><h3 id="方法3：使用-jQuery-的-extend-方法"><a href="#方法3：使用-jQuery-的-extend-方法" class="headerlink" title="方法3：使用 jQuery 的 extend 方法"></a>方法3：使用 <a href="http://caibaojian.com/jquery/" target="_blank" rel="noopener">jQuery</a> 的 extend 方法</h3><p>如果你在使用 jQuery，那么最简单的方法是使用 extend 插件方法。示例：<a href="http://caibaojian.com/javascript-array-copy.html" target="_blank" rel="noopener">·</a></p><pre><code>//code from http://caibaojian.com/javascript-array-copy.htmlvar arr1 = [1, 2, [3, 4], {a: 5, b: 6}, 7],arr2 = $.extend(true, [], arr1);console.log(arr1, arr2);arr2[1] = 10;console.log(arr1, arr2);</code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>节流函数和防抖函数</title>
      <link href="/2020/07/07/jie-liu-han-shu-he-fang-dou-han-shu/"/>
      <url>/2020/07/07/jie-liu-han-shu-he-fang-dou-han-shu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文参考于：<a href="https://www.jianshu.com/p/1051bfbf8714" target="_blank" rel="noopener">https://www.jianshu.com/p/1051bfbf8714</a></p></blockquote><p>项目上线后，经常会报出用户一直点击导致连续出发事件引发体验上的问题，尤其是在监听浏览器滚动scroll，页面调整resise的时候，这个时候我们就需要通过节流/防抖来优化这个问题；</p><p>其实节流函数就是在多少秒内能执行一次函数，而防抖函数就是比如是公交车，只要是有乘客还没上车就继续等待，就是把乘客上车这多个函数类比为一个函数，等所有乘客上完车后才继续开车进行下一个函数</p><h2 id="防抖："><a href="#防抖：" class="headerlink" title="防抖："></a>防抖：</h2><p>防抖就是指在某个时间内再次触发事件则会进行重新计时，也就是说一直触发事件则时间在不断重置；举个例子：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span>args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            method<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="节流："><a href="#节流：" class="headerlink" title="节流："></a>节流：</h3><p>所谓节流，就是指在高频触发事件时，只有在大于设定的周期时间内才去触发一次，触发后这个周期时间清零重新开始计算，和防抖的区别就是为了确保在这个周期时间只执行一次；</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">var</span> last <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">var</span> now <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>now <span class="token operator">-</span> last <span class="token operator">></span> delay<span class="token punctuation">)</span><span class="token punctuation">{</span>            method<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>            last <span class="token operator">=</span> now         <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>超全面的js事件委托机制</title>
      <link href="/2020/07/07/chao-quan-mian-de-js-shi-jian-wei-tuo-ji-zhi/"/>
      <url>/2020/07/07/chao-quan-mian-de-js-shi-jian-wei-tuo-ji-zhi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>这两个是我看到的比较全面讲解事件委托机制的文章：</p><p><a href="https://zhuanlan.zhihu.com/p/103070950" target="_blank" rel="noopener">知乎文章</a></p><p><a href="https://juejin.im/post/5e739534e51d4526f23a4150" target="_blank" rel="noopener">掘金文章</a></p><p><a href="https://www.cnblogs.com/bfgis/p/5460191.html" target="_blank" rel="noopener">北风吹雪的文章</a></p></blockquote><h2 id="掘金"><a href="#掘金" class="headerlink" title="掘金"></a>掘金</h2><blockquote><p>作者：wang二狗<br>链接：<a href="https://juejin.im/post/5e739534e51d4526f23a4150" target="_blank" rel="noopener">https://juejin.im/post/5e739534e51d4526f23a4150</a><br>来源：掘金<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote><p>要理解<code>DOM</code>相关事件，我们先要理解<code>“事件流”</code>这个概念，事件流描述的是从页面中接收事件的顺序。</p><p>事件冒泡：事件开始由最具体的元素接收，然后逐级向上传播到较为不具体的节点或文档。</p><p>事件捕获：事件开始由不太具体的节点接收，然后逐级向下传播到最具体的节点。它与事件冒泡是个相反的过程。</p><p><code>DOM2</code> 级事件规定的事件流包括三个阶段：事件捕获、目标阶段、事件冒泡。</p><h3 id="事件委托"><a href="#事件委托" class="headerlink" title="事件委托"></a>事件委托</h3><p>事件委托，通俗的说就是将元素的事件委托给它的父级或者更外级的元素处理，它的实现机制就是事件冒泡。</p><p>假设有一个列表，要求点击列表项弹出对应的字段：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>myLink<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>aaa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>bbb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ccc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code></pre><h3 id="不使用事件委托"><a href="#不使用事件委托" class="headerlink" title="不使用事件委托"></a>不使用事件委托</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> myLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myLink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> li <span class="token operator">=</span> myLink<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> li<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  li<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> e <span class="token operator">=</span> event <span class="token operator">||</span> window<span class="token punctuation">.</span>event<span class="token punctuation">;</span>    <span class="token keyword">var</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>target <span class="token operator">||</span> e<span class="token punctuation">.</span>srcElement<span class="token punctuation">;</span>    <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>存在问题：</p><ul><li>给每一个列表都绑定事件，消耗内存</li><li>当有动态添加的元素时，需要重新给元素绑定事件</li></ul><h3 id="8k的前端写出的事件委托"><a href="#8k的前端写出的事件委托" class="headerlink" title="8k的前端写出的事件委托"></a>8k的前端写出的事件委托</h3><p>事实上很多同学在网上看到的事件委托的方法都是错的，虽然是错的，但是你面试的时候也可能会过，因为面你的面试官可能也不知道正确的事件委托应该怎么写。</p><p>下面我们就来看一下错误版的事件委托是怎么写的：</p><pre class=" language-js"><code class="language-js"> ul<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 执行某个函数</span>     <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="20k的前端写出的事件委托"><a href="#20k的前端写出的事件委托" class="headerlink" title="20k的前端写出的事件委托"></a>20k的前端写出的事件委托</h3><p>错误版事件委托的<code>bug</code> 在于，如果用户点击的是 <code>li</code>里面的 <code>span</code>，就没法触发 <code>fn</code>，这显然不对。</p><p>那下面我们来看一下正确的事件委托应该怎么写：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">delegate</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> eventType<span class="token punctuation">,</span> selector<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>     element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>       <span class="token keyword">let</span> el <span class="token operator">=</span> e<span class="token punctuation">.</span>target       <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">===</span> el<span class="token punctuation">)</span> <span class="token punctuation">{</span>           el <span class="token operator">=</span> <span class="token keyword">null</span>           <span class="token keyword">break</span>         <span class="token punctuation">}</span>         el <span class="token operator">=</span> el<span class="token punctuation">.</span>parentNode       <span class="token punctuation">}</span>       el <span class="token operator">&amp;&amp;</span> fn<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> e<span class="token punctuation">,</span> el<span class="token punctuation">)</span>     <span class="token punctuation">}</span><span class="token punctuation">)</span>     <span class="token keyword">return</span> element   <span class="token punctuation">}</span></code></pre><p>思路是点击 <code>span</code>后，递归遍历 <code>span</code> 的祖先元素看其中有没有 <code>ul</code> 里面的 <code>li</code>。</p><p><strong>事件委托的优点</strong></p><ul><li>只需要将同类元素的事件委托给父级或者更外级的元素，不需要给所有的元素都绑定事件，减少内存占用空间，提升性能。</li><li>动态新增的元素无需重新绑定事件</li></ul><p><strong>需要注意的点</strong></p><ul><li>事件委托的实现依靠的冒泡，因此不支持事件冒泡的事件就不适合使用事件委托。</li><li>不是所有的事件绑定都适合使用事件委托，不恰当使用反而可能导致不需要绑定事件的元素也被绑定上了事件。</li></ul><blockquote><p>告诫自己，即使再累也不要忘记学习，成功没有捷径可走，只有一步接着一步走下去。 共勉！</p></blockquote><h2 id="知乎"><a href="#知乎" class="headerlink" title="知乎"></a>知乎</h2><h3 id="什么是事件机制"><a href="#什么是事件机制" class="headerlink" title="什么是事件机制"></a>什么是事件机制</h3><p>JavaScript 事件机制描述的是事件在 DOM 里面的传递顺序，以及我们可以对这些事件做出如何的响应。</p><p>DOM事件流（event flow ）存在三个阶段：事件捕获阶段、处于目标阶段、事件冒泡阶段。</p><p>事件捕获（event capturing）： 通俗的理解就是，当鼠标点击或者触发dom事件时，浏览器会从根节点开始<strong>由外到内</strong>进行事件传播，即点击了子元素，如果父元素通过事件捕获方式注册了对应的事件的话，会先触发父元素绑定的事件。</p><p>事件冒泡（dubbed bubbling）： 与事件捕获恰恰相反，事件冒泡顺序是<strong>由内到外</strong>进行事件传播，直到根节点。无论是事件捕获还是事件冒泡，它们都有一个共同的行为，就是事件传播，它就像一跟引线，只有通过引线才能将绑在引线上的鞭炮（事件监听器）引爆， 试想一下，如果引线不导火了，那鞭炮就只有一响了！！！</p><p>dom标准事件流的触发的先后顺序为 ：<strong>先捕获再冒泡，即当触发dom事件时，会先进行事件捕获，捕获到事件源之后通过事件传播进行事件冒泡</strong>。</p><p>不同的浏览器对此有着不同的实现，IE10及以下不支持捕获型事件，所以就少了一个事件捕获阶段，IE11、Chrome 、Firefox、Safari等浏览器则同时存在。</p><p>说到事件冒泡与捕获就不得不提一下两个用于事件绑定的方法addEventListener 、</p><p>attachEvent 。当然还有其它的事件绑定的方式这里不做介绍。</p><p>addEventListener(event, listener, useCapture)</p><p>·参数定义：event—（事件名称，如click，不带on）， listener—事件监听函数，</p><p>useCapture—是否采用事件捕获进行事件捕捉， <strong>默认为false，即采用事件冒泡方式</strong></p><p>addEventListener在 IE11、Chrome 、Firefox、Safari等浏览器都得到支持。</p><p>attachEvent(event,listener)</p><p>·参数定义：event—（事件名称，如onclick，带on）， listener—事件监听函数。</p><p>attachEvent主要用于IE浏览器，并且仅在IE10及以下才支持，IE11已经废了这个方法了</p><p>（微软还是挺识趣的，慢慢向标准靠拢）。</p><h3 id="事件冒泡"><a href="#事件冒泡" class="headerlink" title="事件冒泡"></a>事件冒泡</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175420.jpg" alt=""></p><p>事件开始时由最具体的元素接受，然后逐级向上传播到较为不具体的元素</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zh-cn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>js事件机制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">            <span class="token selector"><span class="token id">#parent</span></span><span class="token punctuation">{</span>                <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span><span class="token number">200</span>px<span class="token punctuation">;</span>                <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span>                <span class="token property">background</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token selector"><span class="token id">#child</span></span><span class="token punctuation">{</span>                <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> orange<span class="token punctuation">;</span>            <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 父元素            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>child<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 子元素            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">var</span> parent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> child <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-body"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            parent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            child<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>通过”addEventListener”方法，采用事件冒泡方式给dom元素注册click事件，点击子元素会发生什么呢？如果你对事件冒泡有一定了解的话那你肯定知道上面的代码会输出的顺序，没错，如下图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175512.jpg" alt=""></p><p>事件触发顺序是由内到外的，这就是事件冒泡，虽然只点击子元素，但是它的父元素也会触发相应的事件，其实这是合理的，因为子元素在父元素里面，点击子元素也就相当于变相的点击了父元素，这样理解对吧？这里有同学可能要问了，如果点击子元素不想触发父元素的事件怎么办？肯定可以的，那就是停止事件传播—<strong>event.stopPropagation();</strong></p><h3 id="事件捕获"><a href="#事件捕获" class="headerlink" title="事件捕获"></a>事件捕获</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175524.jpg" alt=""></p><p>不太具体的节点更早接受事件，而最具体的元素最后接受事件，和事件冒泡相反修改上面栗子中的代码，给parent元素注册一个捕获事件，如下</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> parent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> child <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-body"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>parent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-parent---事件传播"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//新增事件捕获事件代码</span>parent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-parent--事件捕获"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>child<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>如果你看明白了我前面说的那些，你就知道这个栗子的输出顺序了。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175548.jpg" alt=""></p><p>父元素通过事件捕获的方式注册了click事件，所以在事件捕获阶段就会触发，然后到了目标阶段，即事件源，之后进行事件传播，parent同时也用冒泡方式注册了click事件，所以这里会触发冒泡事件，最后到根节点。这就是整个事件流程。</p><h3 id="DOM事件流"><a href="#DOM事件流" class="headerlink" title="DOM事件流"></a>DOM事件流</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175559.jpg" alt=""></p><p>DOM2级事件规定事件流包括三个阶段，事件捕获阶段，处于目标阶段，时间冒泡阶段， 首先发生的是事件捕获，为截取事件提供机会，然后是实际目标接受事件，最后是冒泡阶段</p><p>注：Opera、Firefox、Sarfari都支持DOM事件流，IE不支持事件流，只支持时间冒泡</p><p>当一个事件发生以后，它会在不同的DOM节点之间传播（propagation）。这种传播分为三个阶段：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175607.jpg" alt=""></p><p>第一阶段：从window对象传导到目标节点，称为“捕获阶段”(capture phase)。第二阶段：在目标节点上触发，称为“目标阶段”(target phase)。</p><p>第三阶段：从目标节点传导回window对象，称为“冒泡阶段”(bubbling phase)。</p><h4 id="事件委托-1"><a href="#事件委托-1" class="headerlink" title="事件委托"></a>事件委托</h4><p>事件委托其实也叫事件代理。</p><p>定义：事件代理就是利用事件冒泡，只指定一个事件处理程序，就可以管理某一类型的所有事件。(delegation)。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ul<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//...</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>上面代码的click 事件的监听函数定义在<code>&lt;ul&gt;</code> 节点，但是实际上，它处理额是子节点<code>&lt;li&gt;</code> 的click事件。这样的好处是，只要定义一个监听函数，就能处理多个子节点的事件，且以后再添加子节点，监听函数依然有效。</p><p><strong>那什么样的事件可以用事件委托，什么样的事件不可以用呢？</strong></p><p>适合用事件委托的事件：click，mousedown，mouseup，keydown，keyup，keypress 。值得注意的是，mouseover 和mouseout 虽然也有事件冒泡，但是处理它们的时候需要特别的注意，因为需要经常计算它们的位置，处理起来不太容易。</p><p>不适合的就有很多了，举个例子，mousemove，每次都要计算它的位置，非常不好把控，在不如说focus，blur之类的，本身就没用冒泡的特性，自然就不能用事件委托了。</p><p>更加详细内容可查看：<a href="https://link.zhihu.com/?target=https%3A//blog.lbinin.com/frontEnd/JavaScript/JS-Event-Binding.html%23%E5%B0%81%E8%A3%85">Js 中事件绑定、事件代理和事件委托</a></p><h3 id="误区"><a href="#误区" class="headerlink" title="误区"></a>误区</h3><p><strong>在同一个对象上注册事件，并不一定按照注册顺序执行</strong></p><p>之所以如此是因为事件目的地节点既绑定了冒泡事件也绑定了捕获事件，此时的执行顺序按照绑定的先后顺序执行（情况比较少见）。</p><p>举例</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zh-cn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>js事件机制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">            <span class="token selector"><span class="token id">#parent</span></span><span class="token punctuation">{</span>                <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span><span class="token number">200</span>px<span class="token punctuation">;</span>                <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token selector"><span class="token id">#child</span></span><span class="token punctuation">{</span>                <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> orange<span class="token punctuation">;</span>            <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 父元素            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>child<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 子元素            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">var</span> parent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> child <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// document.body.addEventListener("click",function(e){</span>            <span class="token comment" spellcheck="true">//    console.log("click-body");</span>            <span class="token comment" spellcheck="true">// },false); child.addEventListener("click",function(e){ console.log("click-child");</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            child<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-child-捕获"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            parent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            parent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-parent-捕获"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>点击子DIV执行结果：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175707.jpg" alt=""></p><p>交换子div事件，如下：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zh-cn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>js事件机制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">            <span class="token selector"><span class="token id">#parent</span></span><span class="token punctuation">{</span>                <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span><span class="token number">200</span>px<span class="token punctuation">;</span>                <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token selector"><span class="token id">#child</span></span><span class="token punctuation">{</span>                <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> orange<span class="token punctuation">;</span>            <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 父元素            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>child<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 子元素            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">var</span> parent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> child <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// document.body.addEventListener("click",function(e){</span>            <span class="token comment" spellcheck="true">//    console.log("click-body");</span>            <span class="token comment" spellcheck="true">// },false);</span>            child<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-child-捕获"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            child<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            parent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            parent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-parent-捕获"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>点击子DIV执行结果：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175745.jpg" alt=""></p><p>由于子DIV上绑定了捕获和冒泡事件，所以此时的执行顺序是按照绑定的执行顺序。实际这种情况很少。</p><h3 id="event-stopPropagation"><a href="#event-stopPropagation" class="headerlink" title="event.stopPropagation()"></a>event.stopPropagation()</h3><h3 id="就是阻止事件的冒泡"><a href="#就是阻止事件的冒泡" class="headerlink" title="就是阻止事件的冒泡"></a>就是阻止事件的冒泡</h3><p>这个表述不能说他错误，但是是不完整的，他除了阻止事件的冒泡，还阻止事件的继续捕获，简而言之就是阻止事件的进一步传播 。下面的例子可以看到：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zh-cn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>js事件机制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">            <span class="token selector"><span class="token id">#parent</span></span><span class="token punctuation">{</span>                <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span><span class="token number">200</span>px<span class="token punctuation">;</span>                <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token selector"><span class="token id">#child</span></span><span class="token punctuation">{</span>                <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> orange<span class="token punctuation">;</span>            <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 父元素            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>child<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 子元素            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">var</span> parent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> child <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            child<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-child-捕获"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//    child.addEventListener("click",function(e){</span>            <span class="token comment" spellcheck="true">//    console.log("click-child");</span>            <span class="token comment" spellcheck="true">// },false);</span>            <span class="token comment" spellcheck="true">// parent.addEventListener("click",function(e){</span>            <span class="token comment" spellcheck="true">//    console.log("click-parent");</span>            <span class="token comment" spellcheck="true">// },false);</span>            parent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-parent-捕获"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>执行结果：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175817.jpg" alt=""></p><h3 id="eturn-false-阻止默认行为"><a href="#eturn-false-阻止默认行为" class="headerlink" title="eturn false;阻止默认行为"></a>eturn false;阻止默认行为</h3><p>return false;事件处理过程中，阻止了事件冒泡，也阻止了默认行为（比如刚才它就没有执行超链接的跳转）</p><p>return false 不仅阻止了事件往上冒泡，而且阻止了事件本身。event.stopPropagation() 则只阻止事件的进一步传播，不阻止事件本身。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175831.jpg" alt=""></p><h3 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h3><h4 id="stopImmediatePropagation-的使用"><a href="#stopImmediatePropagation-的使用" class="headerlink" title="stopImmediatePropagation 的使用"></a>stopImmediatePropagation 的使用</h4><p>这玩意儿是 w3c 的东西，使用的也不是特别多，我们知道 stopPropagation 可以阻止事件的进一步传播，但是他阻止不了该元素上绑定的其他函数的执行，比如我们在 obj 上绑定了 func1 和 func2，如果我们在 func1 中使用了 stopPropagation ，那 func2 依然还是会执行出来。倘若这里使用 stopImmediatePropagation，结果就不一样了，他不仅阻止事件的传播，还阻止 func2 的执行。如：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175846.jpg" alt=""></p><p>结果是：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175855.jpg" alt=""></p><p>而改成evt.stopImmediatePropagation();之后，阻止了第二个监听事件的触发：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175904.jpg" alt=""></p><p>结果是：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707175911.jpg" alt=""></p><h4 id="setCapture-和-releaseCapture"><a href="#setCapture-和-releaseCapture" class="headerlink" title="setCapture 和 releaseCapture"></a>setCapture 和 releaseCapture</h4><p>这两个是 IE 下的事件绑定函数，只要我们在某个元素上 setCapture 了，那么你在任何地方的鼠标操作（mouseXXX之类的动作）都会在这个元素上触发（前提是你在这个元素上绑定了事件），releaseCapture 或者本窗口失去聚焦才会释放这个绑定~</p><h2 id="其余文章"><a href="#其余文章" class="headerlink" title="其余文章"></a>其余文章</h2><p>DOM事件流（event flow ）存在三个阶段：<strong>事件捕获阶段、处于目标阶段、事件冒泡阶段。</strong></p><p><strong>事件捕获*（\</strong>***event capturing***<em>\</em>）*：<strong>通俗的理解就是，当鼠标点击或者触发dom事件时，浏览器会从根节点开始</strong>由外到内**进行事件传播，即点击了子元素，如果父元素通过事件捕获方式注册了对应的事件的话，会先触发父元素绑定的事件。</p><p><strong>事件冒泡\</strong>*（***dubbed bubbling***）**<em>：*</em>与事件捕获恰恰相反，事件冒泡顺序是由内到外进行事件传播，直到根节点。</p><p>无论是事件捕获还是事件冒泡，它们都有一个共同的行为，就是<strong>事件传播</strong>，它就像一跟引线，只有通过引线才能将绑在引线上的鞭炮（事件监听器）引爆，试想一下，如果引线不导火了，那鞭炮就只有一响了！！！</p><p><img src="https://images2015.cnblogs.com/blog/616676/201605/616676-20160504214913779-1679422822.png" alt=""></p><p>　dom标准事件流的触发的先后顺序为：<strong>先捕获再冒泡</strong>，即当触发dom事件时，会先进行事件捕获，捕获到事件源之后通过事件传播进行事件冒泡。不同的浏览器对此有着不同的实现，IE10及以下不支持捕获型事件，所以就少了一个事件捕获阶段，IE11、Chrome 、Firefox、Safari等浏览器则同时存在。</p><p>说到事件冒泡与捕获就不得不提一下两个用于事件绑定的方法addEventListener、attachEvent。当然还有其它的事件绑定的方式这里不做介绍。　</p><p>　　<strong><em>addEventListener(event, listener, useCapture)\</em></strong>　　</p><p>　　　　<em>·参数定义：</em>event—（事件名称，如click，不带on），listener—事件监听函数，<em>useCapture—</em>是否采用事件捕获进行事件捕捉，</p><p>　　　　　　　　默认为false，即采用事件冒泡方式</p><p>　　　　addEventListener在 IE11、Chrome 、Firefox、Safari等浏览器都得到支持。</p><p>　　<strong><em>attachEvent(event,listener)\</em></strong>　　</p><p>　　　　·<em>参数定义</em>：event—（事件名称，如onclick，带on），listener—事件监听函数。</p><p>　　　　attachEvent主要用于IE浏览器，并且仅在IE10及以下才支持，IE11已经废了这个方法了（微软还是挺识趣的，慢慢向标准靠拢）。</p><p>说了一箩筐定义，下面就用上面这两个方法通过栗子来解释一下事件捕获与事件冒泡的具体表现行为差异。</p><p><strong>事件冒泡</strong></p><p>栗1：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zh-cn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>js事件机制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">        <span class="token selector"><span class="token id">#parent</span></span><span class="token punctuation">{</span>            <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span><span class="token number">200</span>px<span class="token punctuation">;</span>            <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>            <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span>            <span class="token property">background</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token selector"><span class="token id">#child</span></span><span class="token punctuation">{</span>            <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>            <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span>            <span class="token property">background</span><span class="token punctuation">:</span> orange<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        父元素        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>child<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            子元素        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">        <span class="token keyword">var</span> parent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> child <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-body"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        parent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        child<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>通过”addEventListener”方法，采用事件冒泡方式给dom元素注册click事件，点击子元素会发生什么呢？如果你对事件冒泡有一定了解的话那你肯定知道上面的代码会输出的顺序，没错，如下图所示：</p><p><img src="https://images2015.cnblogs.com/blog/616676/201605/616676-20160504213440576-1991228150.png" alt=""></p><p>事件触发顺序是由内到外的，这就是事件冒泡，虽然只点击子元素，但是它的父元素也会触发相应的事件，其实这是合理的，因为子元素在父元素里面，点击子元素也就相当于变相的点击了父元素，这样理解对吧？</p><p>这里有同学可能要问了，如果点击子元素不想触发父元素的事件怎么办？肯定可以的，那就是停止事件传播—event.stopPropagation();</p><p>修改栗1的代码，在子元素的监听函数中加入停止事件传播的操作</p><p>栗2：</p><pre class=" language-js"><code class="language-js">child<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>　　console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  　e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在点击子元素的时候就只弹出了子元素那条信息，父元素的事件没有触发，因为事件已经停止传播了，冒泡阶段也就停止了。</p><p>事件冒泡差不多就讲述完了，别急，捕获还没说呢!</p><p><strong>事件捕获</strong></p><p>栗3，修改栗子1中的代码，给parent元素注册一个捕获事件，如下</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> parent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> child <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-body"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        parent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-parent---事件传播"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>　　　　 　　　　 <span class="token comment" spellcheck="true">//新增事件捕获事件代码</span>        parent<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-parent--事件捕获"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        child<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"click-child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>如果你看明白了我前面说的那些，你就知道这个栗子的输出顺序了。</p><p><img src="https://images2015.cnblogs.com/blog/616676/201605/616676-20160504222708232-1050048205.png" alt=""></p><p>父元素通过事件捕获的方式注册了click事件，所以在事件捕获阶段就会触发，然后到了目标阶段，即事件源，之后进行事件传播，parent同时也用冒泡方式注册了click事件，所以这里会触发冒泡事件，最后到根节点。这就是整个事件流程。</p><p>上面介绍了事件冒泡、事件捕获、事件传播，下面讲一下如果通过以上三个知识点进行<strong>事件**</strong>委托**</p><p>委托在JQuery中已经得到了实现，即通过$(<em>selector</em>).on(<em>event,childSelector,data,function,map</em>)实现委托，一般用于动态生成的元素，当然JQuery也是通过原声的js去实现的，下面举一个简单的栗子，通过js实现通过parent元素给child元素注册click事件</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> parent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"parent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> child <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"child"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>parent<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token string">"child"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"您点击了child元素"</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>虽然没有直接只child元素注册click事件，可是点击child元素时却弹出了提示信息。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>this作用域</title>
      <link href="/2020/07/07/this-zuo-yong-yu/"/>
      <url>/2020/07/07/this-zuo-yong-yu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://www.cnblogs.com/Nancy-wang/p/6928395.html" target="_blank" rel="noopener">https://www.cnblogs.com/Nancy-wang/p/6928395.html</a></p></blockquote><p>javascript中this的指向一直是困扰我很久的问题，在使用中出错的机率也非常大。在面向对象语言中，它代表了当前对象的一个引用，而在js中却经常让我觉得混乱，它不是固定不变的，而是随着它的执行环境的改变而改变。</p><p><strong>在Javascript中this总是指向调用它所在方法的对象。因为this是在函数运行时，自动生成的一个内部对象，只能在函数内部使用。</strong></p><p>下面我们分几种情况深入分析this的用法：</p><h2 id="1-全局函数的调用"><a href="#1-全局函数的调用" class="headerlink" title="1.全局函数的调用"></a>1.全局函数的调用</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">globalTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"global this"</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">globalTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//global this</span></code></pre><p>以上代码中，globalTest()是全局性的方法，属于全局性调用，因此this就代表全局对象window。为了充分证明this是window,对代码做如下更改：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">"global this"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">globalTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">globalTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//global this</span></code></pre><p>name作为一个全局变量，运行结果仍然是“global this”，说明this指向的是window。在方法体中我们尝试更改全局name，再次调用方法输出“rename global this”， 说明全局的name在方法内部被更改。代码如下：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">"global this"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">globalTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"rename global this"</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">globalTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//rename global this</span></code></pre><p>根据以上三段代码，我们得出结论：<strong>对于全局的方法调用，this指向的是全局对象window,即调用方法所在的对象。</strong></p><h2 id="2-对象方法的调用"><a href="#2-对象方法的调用" class="headerlink" title="2.对象方法的调用"></a>2.对象方法的调用</h2><p><strong>如果函数作为对象的方法调用，this指向的是这个上级对象，即调用方法的对象。</strong> 在以下代码中，this指向的是obj对象。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"ooo"</span><span class="token punctuation">;</span>obj<span class="token punctuation">.</span>show <span class="token operator">=</span> showName<span class="token punctuation">;</span>obj<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ooo</span></code></pre><p><img src="https://images2015.cnblogs.com/blog/976193/201706/976193-20170601132206383-723154773.png" alt=""></p><h2 id="3-构造函数的调用"><a href="#3-构造函数的调用" class="headerlink" title="3.构造函数的调用"></a>3.构造函数的调用</h2><p><strong>构造函数中的this指向新创建的对象本身。</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"showName function"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//showName function</span></code></pre><p>上述代码中，我们通过new关键字创建一个对象的实例，new关键字可以改变this的指向，将这个this指向对象obj。<br>我们再增加一个全局的name,用以证明this指向的不是global:</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">"global name"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"showName function"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//showName function</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//global name</span></code></pre><p>在构造函数的内部，我们对this.name进行赋值，但并没有改变全局变量name。</p><h2 id="4-apply-call调用时的this"><a href="#4-apply-call调用时的this" class="headerlink" title="4.apply/call调用时的this"></a>4.apply/call调用时的this</h2><p><strong>apply和call都是为了改变函数体内部的this指向。</strong> 其具体的定义如下：</p><h3 id="call方法"><a href="#call方法" class="headerlink" title="call方法:"></a><strong>call方法:</strong></h3><p>语法：call(thisObj，Object)<br>定义：调用一个对象的一个方法，以另一个对象替换当前对象。<br>说明：<br>call 方法可以用来代替另一个对象调用一个方法。call 方法可将一个函数的对象上下文从初始的上下文改变为由 thisObj 指定的新对象。<br>如果没有提供 thisObj 参数，那么 Global 对象被用作 thisObj。</p><h3 id="apply方法"><a href="#apply方法" class="headerlink" title="apply方法:"></a><strong>apply方法:</strong></h3><p>语法：apply(thisObj，[argArray])<br>定义：应用某一对象的一个方法，用另一个对象替换当前对象。</p><p>说明：<br>如果 argArray 不是一个有效的数组或者不是 arguments 对象，那么将导致一个 TypeError。<br>如果没有提供 argArray 和 thisObj 任何一个参数，那么 Global 对象将被用作 thisObj， 并且无法被传递任何参数。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">"Global value"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">FunA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">"AAA"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">FunB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">FunB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Global value 因为是在全局中调用的FunB(),this.value指向全局的value</span>FunB<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Global value,this指向window对象，因此this.value指向全局的value</span>FunB<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FunA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//AAA, this指向参数new FunA()，即FunA对象</span>FunB<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Global value</span>FunB<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FunA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//AAA</span></code></pre><p>在上述代码中，this的指向在call和apply中是一致的，只不过是调用参数的形式不一样。call是一个一个调用参数，而apply是调用一个数组。具体的会在以后的博文中单独阐述。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决ajax回调地狱</title>
      <link href="/2020/07/07/jie-jue-ajax-hui-diao-di-yu/"/>
      <url>/2020/07/07/jie-jue-ajax-hui-diao-di-yu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://blog.csdn.net/weixin_44701229/article/details/105015212" target="_blank" rel="noopener">https://blog.csdn.net/weixin_44701229/article/details/105015212</a></p></blockquote><h2 id="什么是ajax回调地狱"><a href="#什么是ajax回调地狱" class="headerlink" title="什么是ajax回调地狱"></a>什么是ajax回调地狱</h2><h3 id="回调函数是什么"><a href="#回调函数是什么" class="headerlink" title="回调函数是什么"></a>回调函数是什么</h3><p>回调函数是由于JavaScript是单线程运行所以需要按流程执行，便有了回调函数一般添加callback。</p><p>例如：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> ignition <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>     <span class="token function">callback</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">var</span> drive <span class="token operator">=</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"let's go"</span> <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">ignitio</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> drive<span class="token punctuation">)</span></code></pre><p>上述为点火之后才能开车。 调用点火函数传入第二参数为函数开车，当点火执行完了才能开车。</p><h3 id="回调地狱是什么"><a href="#回调地狱是什么" class="headerlink" title="回调地狱是什么"></a>回调地狱是什么</h3><p>ajax回调地狱意如其名多层嵌套导致回调变得繁琐</p><p>例如：</p><pre class=" language-js"><code class="language-js">    <span class="token function">ajax1</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">ajax2</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">ajax3</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><h3 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h3><p>promise可以理解为一个自动机器人，它有三种状态：等待中（pending） 完成了 （resolved） 拒绝了（rejected），当他觉得你的要求可以通过便会返回给你resolved，若是你的要求达不到它便会返回给你rejected拒绝你。当然先展示一下具体的用法</p><pre class=" language-js"><code class="language-js"> <span class="token keyword">let</span> parkplay <span class="token operator">=</span> <span class="token punctuation">(</span>who<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"去游乐园玩啦！"</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token function">parkplay</span><span class="token punctuation">(</span><span class="token string">"me"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//去玩游乐圆玩先买票</span>            <span class="token keyword">return</span> <span class="token function">Buytickets</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//买票入园后游乐设施前排队</span>            <span class="token keyword">return</span> <span class="token function">queue</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//开始玩啦</span>            <span class="token keyword">return</span> <span class="token function">playing</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>运用Promise代码不仅简结且更易修改.</p><h3 id="async和await"><a href="#async和await" class="headerlink" title="async和await"></a>async和await</h3><p>async和await可以理解为进阶玩法，更加简洁明了，它就是Generator函数的语法糖。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> parkplay <span class="token operator">=</span> <span class="token punctuation">(</span>who<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>           <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>               <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"去游乐园玩啦！"</span><span class="token punctuation">)</span>           <span class="token punctuation">}</span><span class="token punctuation">)</span>       <span class="token punctuation">}</span>       <span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>           <span class="token keyword">let</span> parkplay_result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">parkplay</span><span class="token punctuation">(</span><span class="token string">"me"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">let</span> buytickets_result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">buytickets</span><span class="token punctuation">(</span>parkplay_result<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">let</span> queue_result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">queue</span><span class="token punctuation">(</span>buytickets_result<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">let</span> playing_result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">playing</span><span class="token punctuation">(</span>queue_result<span class="token punctuation">)</span>       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>promise(async和await)由于可以链式调用 对于开发这种多层嵌套的代码很方便，降低了代码的维护难度等等。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>apply、bind、call区别</title>
      <link href="/2020/07/07/apply-bind-call-qu-bie/"/>
      <url>/2020/07/07/apply-bind-call-qu-bie/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://blog.csdn.net/u010176097/article/details/80348447" target="_blank" rel="noopener">https://blog.csdn.net/u010176097/article/details/80348447</a></p></blockquote><p>call()、apply()、bind()是用来改变this的指向的。</p><p>一 举个例子</p><p>一个叫喵喵的猫喜欢吃鱼，一个叫汪汪的小狗喜欢啃骨头，用代码实现如下：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> cat <span class="token operator">=</span> <span class="token punctuation">{</span>  name<span class="token punctuation">:</span><span class="token string">"喵喵"</span><span class="token punctuation">,</span>  eatFish<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>param1<span class="token punctuation">,</span>param2<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"吃鱼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"this的指向=>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>param1<span class="token punctuation">,</span>param2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">var</span> dog <span class="token operator">=</span> <span class="token punctuation">{</span>    name<span class="token punctuation">:</span><span class="token string">"汪汪"</span><span class="token punctuation">,</span>    eatBone<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>param1<span class="token punctuation">,</span>param2<span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"啃骨头"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"this的指向=>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>param1<span class="token punctuation">,</span>param2<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>有一天，小狗汪汪和喵喵共进午餐的时候，汪汪说自己想尝尝小鱼干的味道，但是因为有刺，喵喵就想了个办法，说自己先吃，完了喂给汪汪</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//第一种，用call方法</span>cat<span class="token punctuation">.</span>eatFish<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>dog<span class="token punctuation">,</span><span class="token string">"旺财-13岁"</span><span class="token punctuation">,</span><span class="token string">"call"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//第二种，用apply方法，参数不一样</span>cat<span class="token punctuation">.</span>eatFish<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>dog<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">"旺财-13岁"</span><span class="token punctuation">,</span><span class="token string">"apply"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707172542" alt=""></p><p>这样，汪汪就吃到了美味的鱼干。可是汪汪每吨都想来点小鱼干，喵喵还要工作去捉老鼠，所以它们又想了一个办法，喵喵把吃鱼的方法教给汪汪。这样，每次汪汪就可以自己吃小鱼干了。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> eatFishFun <span class="token operator">=</span> cat<span class="token punctuation">.</span>eatFish<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>dog<span class="token punctuation">,</span><span class="token string">"旺财-13岁"</span><span class="token punctuation">,</span><span class="token string">"bind"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//返回的是方法</span><span class="token function">eatFishFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707172557" alt=""></p><p>bind()方法在这里再多说一下，bind的时候传的参数会预先传给返回的方法，调用方法时就不用再传参数了。</p><p>撇开上面的例子，看看一个特殊情况：</p><p>如果call()和apply()的第一个参数是null或者undefined，那么this的指向就是全局变量，在浏览器里就是window对象。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707172610" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP工作原理</title>
      <link href="/2020/07/07/http-gong-zuo-yuan-li-1/"/>
      <url>/2020/07/07/http-gong-zuo-yuan-li-1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://www.cnblogs.com/klb561/p/9221754.html" target="_blank" rel="noopener">https://www.cnblogs.com/klb561/p/9221754.html</a></p></blockquote><p>HTTP协议（HyperText Transfer Protocol，超文本传输协议）是用于从WWW服务器传输超文本到本地浏览器的传送协议。它可以使浏览器更加高效，使网络传输减少。它不仅保证计算机正确快速地传输超文本文档，还确定传输文档中的哪一部分，以及哪部分内容首先显示(如文本先于图形)等。</p><p>​     在了解HTTP如何工作之前，我们先了解计算机之间的通信。</p><h2 id="2-计算机相互之间的通信"><a href="#2-计算机相互之间的通信" class="headerlink" title="2. 计算机相互之间的通信"></a>2. 计算机相互之间的通信</h2><p>​    互联网的关键技术就是TCP/IP协议。两台计算机之间的通信是通过TCP/IP协议在因特网上进行的。实际上这个是两个协议：</p><p>​    TCP : Transmission Control Protocol 传输控制协议和IP： Internet Protocol 网际协议。</p><p>​    IP：计算机之间的通信</p><p>​     IP协议是计算机用来相互识别的通信的一种机制，每台计算机都有一个IP.用来在internet上标识这台计算机。 IP 负责在因特网上发送和接收数据包。通过 IP，消息（或者其他数据）被分割为小的独立的包，并通过因特网在计算机之间传送。IP 负责将每个包路由至它的目的地。</p><p>​    IP协议仅仅是允许计算机相互发消息，但它并不检查消息是否以发送的次序到达而且没有损坏（只检查关键的头数据）。为了提供消息检验功能，直接在IP协议上设计了传输控制协议TCP.</p><p>​    </p><p>​    TCP : 应用程序之间的通信</p><p>​    TCP确保数据包以正确的次序到达，并且尝试确认数据包的内容没有改变。TCP在IP地址之上引端口（port），它允许计算机通过网络提供各种服务。一些端口号为不同的服务保留，而且这些端口号是众所周知。</p><p>​    服务或者守护进程：在提供服务的机器上，有程序监听特定端口上的通信流。例如大多数电子邮件通信流出现在端口25上，用于wwww的HTTP通信流出现在80端口上。</p><p>​    当应用程序希望通过 TCP 与另一个应用程序通信时，它会发送一个通信请求。这个请求必须被送到一个确切的地址。在双方“握手”之后，TCP 将在两个应用程序之间建立一个全双工 (full-duplex) 的通信，占用两个计算机之间整个的通信线路。TCP 用于从应用程序到网络的数据传输控制。TCP 负责在数据传送之前将它们分割为 IP 包，然后在它们到达的时候将它们重组。</p><p>​    TCP/IP 就是TCP 和 IP 两个协议在一起协同工作，有上下层次的关系。</p><p>​    TCP 负责应用软件（比如你的浏览器）和网络软件之间的通信。IP 负责计算机之间的通信。TCP 负责将数据分割并装入 IP 包，IP 负责将包发送至接收者，传输过程要经IP路由器负责根据通信量、网络中的错误或者其他参数来进行正确地寻址，然后在它们到达的时候重新组合它们。</p><h2 id="3-HTTP协议所在的协议层"><a href="#3-HTTP协议所在的协议层" class="headerlink" title="3. HTTP协议所在的协议层"></a>3. HTTP协议所在的协议层</h2><p>   HTTP是基于TCP协议之上的。在<a href="http://blog.csdn.net/hguisu/article/details/7249611" target="_blank" rel="noopener">TCP/IP协议参考模型</a>的各层对应的协议如下图,其中HTTP是应用层的协议。</p><p>   <img src="http://hi.csdn.net/attachment/201202/10/0_1328873949qWNw.gif" alt="img"></p><h2 id="4-HTTP请求响应模型"><a href="#4-HTTP请求响应模型" class="headerlink" title="4. HTTP请求响应模型"></a>4. HTTP请求响应模型</h2><p>​    HTTP由请求和响应构成，是一个标准的客户端服务器模型（B/S）。HTTP协议永远都是客户端发起请求，服务器回送响应。见下图:</p><p>  <img src="http://img.my.csdn.net/uploads/201303/16/1363438271_3285.jpg" alt="img"></p><p>​    HTTP是一个无状态的协议。无状态是指客户机（Web浏览器）和服务器之间不需要建立持久的连接，这意味着当一个客户端向服务器端发出请求，然后服务器返回响应(response)，连接就被关闭了，在服务器端不保留连接的有关信息.HTTP遵循请求(Request)/应答(Response)模型。客户机（浏览器）向服务器发送请求，服务器处理请求并返回适当的应答。所有HTTP连接都被构造成一套请求和应答。</p><h2 id="5-HTTP工作过程"><a href="#5-HTTP工作过程" class="headerlink" title="5. HTTP工作过程"></a>5. HTTP工作过程</h2><p>   一次HTTP操作称为一个事务，其工作整个过程如下：</p><p>   1 ) 、地址解析，</p><p>   如用客户端浏览器请求这个页面：<a href="http://localhost:8080/simple.htm" target="_blank" rel="noopener">http://localhost.com:8080/index.htm</a></p><p>   从中分解出协议名、主机名、端口、对象路径等部分，对于我们的这个地址，解析得到的结果如下：<br>   协议名：http<br>   主机名：localhost.com<br>   端口：8080<br>   对象路径：/index.htm</p><p>   在这一步，需要域名系统DNS解析域名localhost.com,得主机的IP地址。</p><p>  2）、封装HTTP请求数据包</p><p>   把以上部分结合本机自己的信息，封装成一个HTTP请求数据包</p><p>   3）封装成TCP包，建立TCP连接（TCP的三次握手）</p><p>​    在HTTP工作开始之前，客户机（Web浏览器）首先要通过网络与服务器建立连接，该连接是通过TCP来完成的，该协议与IP协议共同构建Internet，即著名的TCP/IP协议族，因此Internet又被称作是TCP/IP网络。HTTP是比TCP更高层次的应用层协议，根据规则，只有低层协议建立之后才能进行更高层协议的连接，因此，首先要建立TCP连接，一般TCP连接的端口号是80。这里是8080端口</p><p>   4）客户机发送请求命令</p><p>​    建立连接后，客户机发送一个请求给服务器，请求方式的格式为：统一资源标识符（URI：Uniform Resource Identifier）、协议版本号，后边是MIME信息包括请求修饰符、客户机信息和可能的内容。</p><p>   5）服务器响应</p><p>   服务器接到请求后，给予相应的响应信息，其格式为一个状态行，包括信息的协议版本号、一个成功或错误的代码，后边是MIME信息包括服务器信息、实体信息和可能的内容。</p><p>​    实体消息是服务器向浏览器发送头信息后，它会发送一个空白行来表示头信息的发送到此结束，接着，它就以Content-Type应答头信息所描述的格式发送用户所请求的实际数据</p><p>   6）服务器关闭TCP连接</p><p>   一般情况下，一旦Web服务器向浏览器发送了请求数据，它就要关闭TCP连接，然后如果浏览器或者服务器在其头信息加入了这行代码</p><p>  Connection:keep-alive</p><p>  TCP连接在发送后将仍然保持打开状态，于是，浏览器可以继续通过相同的连接发送请求。保持连接节省了为每个请求建立新连接所需的时间，还节约了网络带宽。</p><h2 id="6-HTTP协议栈中各层数据流"><a href="#6-HTTP协议栈中各层数据流" class="headerlink" title="6. HTTP协议栈中各层数据流"></a>6. HTTP协议栈中各层数据流</h2><p>​       首先我们看看客户端请求的时候，数据在各层协议的数据组织如下图：</p><p>​     <img src="http://hi.csdn.net/attachment/201202/10/0_13288738519K11.gif" alt="img"></p><p>​      而服务器解析客户机请求就是反向操作的过程，如下图：</p><p>​      <img src="http://hi.csdn.net/attachment/201202/10/0_1328873896s7sG.gif" alt="img"><br>​    </p><p>​    客户机发起一次请求的时候：</p><p>​    客户机会将请求封装成http数据包–&gt;封装成Tcp数据包–&gt;封装成Ip数据包—&gt;封装成数据帧—&gt;硬件将帧数据转换成bit流（二进制数据）–&gt;最后通过物理硬件（网卡芯片）发送到指定地点。</p><p>​    服务器硬件首先收到bit流……. 然后转换成ip数据包。于是通过ip协议解析Ip数据包，然后又发现里面是tcp数据包，就通过tcp协议解析Tcp数据包，接着发现是http数据包通过http协议再解析http数据包得到数据。</p><h2 id="6-HTTPS实现原理"><a href="#6-HTTPS实现原理" class="headerlink" title="6. HTTPS实现原理"></a>6. HTTPS实现原理</h2><p>​       HTTPS（全称：Hypertext Transfer Protocol over Secure Socket Layer），是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL。其所用的端口号是443。</p><p>​     SSL：安全套接层，是netscape公司设计的主要用于web的安全传输协议。这种协议在WEB上获得了广泛的应用。通过证书认证来确保客户端和网站服务器之间的通信数据是加密安全的。</p><p>   有两种基本的加解密<a href="http://lib.csdn.net/base/datastructure" target="_blank" rel="noopener">算法</a>类型：</p><p>   1）对称加密（symmetric encryption）：密钥只有一个，加密解密为同一个密码，且加解密速度快，典型的对称加密<a href="http://lib.csdn.net/base/datastructure" target="_blank" rel="noopener">算法</a>有DES、AES，RC5，3DES等；</p><p>​    对称加密主要问题是共享秘钥，除你的计算机（客户端）知道另外一台计算机（服务器）的私钥秘钥，否则无法对通信流进行加密解密。解决这个问题的方案非对称秘钥。</p><p>   2）非对称加密：使用两个秘钥：公共秘钥和私有秘钥。私有秘钥由一方密码保存（一般是服务器保存），另一方任何人都可以获得公共秘钥。</p><p>   这种密钥成对出现（且根据公钥无法推知私钥，根据私钥也无法推知公钥），加密解密使用不同密钥（公钥加密需要私钥解密），相对对称加密速度较慢，典型的非对称加密算法有RSA、DSA等。</p><p>  下面看一下https的通信过程：</p><p>  <img src="http://img.my.csdn.net/uploads/201303/19/1363688966_6720.jpg" alt="img"></p><p>​    过程大致如下：</p><p>​    1） SSL客户端通过TCP和服务器建立连接之后（443端口），并且在一般的tcp连接协商（握手）过程中请求证书。</p><p>​       即客户端发出一个消息给服务器，这个消息里面包含了自己可实现的算法列表和其它一些需要的消息，SSL的服务器端会回应一个数据包，这里面确定了这次通信所需要的算法，然后服务器向客户端返回证书。（证书里面包含了服务器信息：域名。申请证书的公司，公共秘钥）。         </p><p>​    2）Client在收到服务器返回的证书后，判断签发这个证书的公共签发机构，并使用这个机构的公共秘钥确认签名是否有效，客户端还会确保证书中列出的域名就是它正在连接的域名。</p><p>​    3）  如果确认证书有效，那么生成对称秘钥并使用服务器的公共秘钥进行加密。然后发送给服务器，服务器使用它的私钥对它进行解密，这样两台计算机可以开始进行对称加密进行通信。</p><p>https通信的优点：</p><p>1）客户端产生的密钥只有客户端和服务器端能得到；</p><p>2）加密的数据只有客户端和服务器端才能得到明文；</p><p>3）客户端到服务端的通信是安全的。</p><h2 id="7-HTTP各种长度限制"><a href="#7-HTTP各种长度限制" class="headerlink" title="7. HTTP各种长度限制"></a>7. HTTP各种长度限制</h2><h3 id="1-URI长度限制"><a href="#1-URI长度限制" class="headerlink" title="1. URI长度限制"></a>1. URI长度限制</h3><p>在Http1.1协议中并没有提出针对URI的长度进行限制，RFC协议里面是这样描述的，HTTP协议并不对URI的长度做任何的限制，服务器端必须能够处理任何它们所提供服务多能接受的URI，并且能够处理无限长度的URI,如果服务器不能处理过长的URI,那么应该返回414状态码。</p><p>虽然Http协议规定了，但是Web服务器和浏览器对URI都有自己的长度限制。</p><p>服务器的限制:我接触的最多的服务器类型就是Nginx和Tomcat,对于url的长度限制，它们都是通过控制http请求头的长度来进行限制的，nginx的配置参数为large_client_header_buffers，tomcat的请求配置参数为maxHttpHeaderSize,都是可以自己去进行设置。</p><p>浏览器的限制:每种浏览器也会对url的长度有所限制，下面是几种常见浏览器的url长度限制:(单位:字符)</p><p>IE : 2803</p><p>Firefox:65536</p><p>Chrome:8182</p><p>Safari:80000</p><p>Opera:190000</p><p>对于get请求，在url的长度限制范围之内，请求的参数个数没有限制。</p><h3 id="2-Post数据的长度限制"><a href="#2-Post数据的长度限制" class="headerlink" title="2. Post数据的长度限制"></a>2. Post数据的长度限制</h3><p>Post数据的长度限制与url长度限制类似，也是在Http协议中没有规定长度限制,长度限制可以在服务器端配置最大http请求头长度的方式来实现。</p><h3 id="3-Cookie的长度限制"><a href="#3-Cookie的长度限制" class="headerlink" title="3. Cookie的长度限制"></a>3. Cookie的长度限制</h3><p>Cookie的长度限制分这么几个方面来总结。</p><p>(1) 浏览器所允许的每个域下的最大cookie数目,没有去自己测试，从网上找到的资料大概是这么个情况</p><p>IE :原先为20个，后来升级为50个</p><p>Firefox: 50个</p><p>Opera:30个</p><p>Chrome:180个</p><p>Safari:无限制</p><p>当Cookie数超过限制数时浏览器的行为：IE和Opera会采用LRU算法将老的不常使用的Cookie清除掉，Firefox的行为是随机踢出某些Cookie的值。当然无论怎样的策略，还是尽量不要让Cookie数目超过浏览器所允许的范围。</p><p>(2) 浏览器所允许的每个Cookie的最大长度</p><p>Firefox和Safari:4079字节</p><p>Opera:4096字节</p><p>IE:4095字节</p><p>(3) 服务器中Http请求头长度的限制。Cookie会被附在每次http请求头中传递给服务器，因此还会受到服务器请求头长度的影响。</p><h3 id="4-Html5-LocalStorage"><a href="#4-Html5-LocalStorage" class="headerlink" title="4. Html5 LocalStorage"></a>4. Html5 LocalStorage</h3><p>Html5提供了本地存储机制来供Web应用在客户端存储数据，尽管这个并不属于Http协议的一部分，但是随着Html5的流行，我们可能需要越来越多使用LocalStorage,甚至当它普及的时候跟它打交道就会同今天我们跟Cookie打交道一样多。</p><p>对于LocalStorage的长度限制，同Cookie的限制类似，也是浏览器针对域来限制,只不过cookie限制的是个数，LocalStorage限制的是长度:</p><p>Firefox\Chrome\Opera都是允许每个域的最大长度为5MB</p><p>但是这次IE比较大方，允许的最大长度是10MB</p><p>客户端通过发送 HTTP 请求向服务器请求对资源的访问。 它向服务器传递了一个数据块，也就是请求信息，HTTP 请求由三部分组成：请求行、 请求头和请求正文。</p><p> 请求行：请求方法 URI 协议/版本</p><p> 请求头(Request Header)</p><p> 请求正文</p><p>下面是一个HTTP请求的数据：</p><pre><code>POST /index.php HTTP/1.1Host: localhostUser-Agent: Mozilla/5.0 (Windows NT 5.1; rv:10.0.2) Gecko/20100101 Firefox/10.0.2Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.5Accept-Encoding: gzip, deflateConnection: keep-aliveReferer: http://localhost/Content-Length：25Content-Type：application/x-www-form-urlencodedusername=aa&amp;password=1234</code></pre><h3 id="1、请求行：请求方法URI协议-版本"><a href="#1、请求行：请求方法URI协议-版本" class="headerlink" title="1、请求行：请求方法URI协议/版本"></a>1、请求行：请求方法URI协议/版本</h3><p> 请求的第一行是“方法 URL 协议/版本”，并以 回车换行作为结尾。请求行以空格分隔。格式如下：</p><p>POST /index.php HTTP/1.1</p><p>以上代码中“GET”代表请求方法，“//ndex.php”表示URI，“HTTP/1.1代表协议和协议的版本。</p><p>​    根据HTTP标准，HTTP请求可以使用多种请求方法。例如：HTTP1.1支持7种请求方法：GET、POST、HEAD、OPTIONS、PUT、DELETE和TARCE。在Internet应用中，最常用的方法是GET和POST。</p><p>​     URL完整地指定了要访问的网络资源，通常只要给出相对于服务器的根目录的相对目录即可，因此总是以“/”开头，最后，协议版本声明了通信过程中使用HTTP的版本。  </p><h4 id="请求方法"><a href="#请求方法" class="headerlink" title="请求方法"></a>请求方法</h4><p>在 HTTP 协议中，HTTP 请求可以使用多种请求方法，这些方法指明了要以何种方式来访问 Request-URI 所标识的资源。HTTP1.1 支持的请求方法如下表所示：</p><p>HTTP1.1 中的请求方式：</p><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>GET</td><td>请求获取由 Request-URI 所标识的资源</td></tr><tr><td>POST</td><td>请求服务器接收在请求中封装的实体，并将其作为由 Request-Line 中的 Request-URI 所标识的资源的一部分</td></tr><tr><td>HEAD</td><td>请求获取由 Request-URI 所标识的资源的响应消息报头</td></tr><tr><td>PUT</td><td>请求服务器存储一个资源，并用 Request-URI 作为其标识符</td></tr><tr><td>DELETE</td><td>请求服务器删除由 Request-URI 所标识的资源</td></tr><tr><td>TRACE</td><td>请求服务器回送到的请求信息，主要用于测试或诊断</td></tr><tr><td>CONNECT</td><td>保留将来使用</td></tr><tr><td>OPTIONS</td><td>请求查询服务器的性能，或者查询与资源相关的选项和需求</td></tr></tbody></table><p>重点介绍 GET、POST 和 HEAD 三个方法：</p><p>（1）GET</p><p>​    GET 方法用于获取由 Request-URI 所标识的资源的信息，常见的形式是：</p><p>​    GET Request-URI HTTP/1.1<br>​    GET方法是默认的HTTP请求方法，例如当我们通过在浏览器的地址栏中直接输入网址的方式去访问网页的时候，浏览器采用的就是 GET 方法向服务器获取资源。</p><p>​    我们可以使用GET方法来提交表单数据，用GET方法提交的表单数据只经过了简单的编码，同时它将作为URL的一部分向服务器发送，因此，如果使用GET方法来提交表单数据就存在着安全隐患上。例如：<br>​     <a href="http://127.0.0.1/login.jsp?Name=zhangshi&Age=30&Submit=%CC%25E+%BD%BB" target="_blank" rel="noopener">Http://localhost/login.php?username=aa&amp;password=1234</a></p><p>​    从上面的URL请求中，很容易就可以辩认出表单提交的内容。（？之后的内容）另外由于GET方法提交的数据是作为URL请求的一部分所以提交的数据量不能太大。这是因为浏览器对url的长度有限制</p><p>​    各种浏览器也会对url的长度有所限制，下面是几种常见浏览器的url长度限制:(单位:字符)</p><p>IE : 2803</p><p>Firefox:65536</p><p>Chrome:8182</p><p>Safari:80000</p><p>Opera:190000 </p><p>（2）POST</p><p>​     POST方法是GET方法的一个替代方法，它主要是向Web服务器提交表单数据，尤其是大批量的数据。 在请求头信息结束之后的两个回车换行之后（实际是空一行），就是表单提交的数据。如上面提到的post表单数据：</p><p>​    username=aa&amp;password=1234</p><p>​    POST方法克服了GET方法的一些缺点。通过POST方法提交表单数据时，数据不是作为URL请求的一部分而是作为标准数据传送给Web服务器，这就克服了GET方法中的信息无法保密和数据量太小的缺点。因此，出于安全的考虑以及对用户隐私的尊重，通常表单提交时采用POST方法。</p><p>　 从编程的角度来讲，如果用户通过GET方法提交数据，则数据存放在QUERY＿STRING环境变量中，而POST方法提交的数据则可以从标准输入流中获取。</p><p> GET与POST方法有以下区别：</p><p>   1、 在客户端，Get方式在通过URL提交数据，数据在URL中可以看到；POST方式，数据放在HTTP包的body中。</p><p>   2、 GET方式提交的数据大小有限制（因为浏览器对URL的长度有限制），而POST则没有此限制。</p><p>   3、安全性问题。正如在（1）中提到，使用 Get 的时候，参数会显示在地址栏上，而 Post 不会。所以，如果这些数据是中文数据而且是非敏感数据，那么使用 get；如果用户输入的数据不是中文字符而且包含敏感数据，那么还是使用 post为好。</p><p>   4.、服务器取值方式不一样。GET方式取值，如php可以使用$_GET来取得变量的值，而POST方式通过$_POST来获取变量的值。</p><p>（3）HEAD</p><p>   HEAD 方法与 GET 方法几乎是相同的，它们的区别在于 HEAD 方法只是请求消息报头，而不是完整的内容。对于 HEAD 请求的回应部分来说，它的 HTTP 头部中包含的信息与通过 GET 请求所得到的信息是相同的。利用这个方法，不必传输整个资源内容，就可以得到 Request-URI 所标识的资源的信息。这个方法通常被用于测试超链接的有效性，是否可以访问，以及最近是否更新。</p><p>  要注意的是，在 HTML 文档中，书写 get 和 post，大小写都可以，但在 HTTP 协议中的 GET 和 POST 只能是大写形式。</p><h3 id="2-请求头"><a href="#2-请求头" class="headerlink" title="2. 请求头"></a>2. 请求头</h3><p>每个头域由一个域名，冒号（:）和域值三部分组成。域名是大小写无关的，域值前可以添加任何数量的空格符，头域可以被扩展为多行，在每行开始处，使用至少一个空格或制表符。</p><p>HTTP最常见的请求头如下：</p><h4 id="Transport-头域"><a href="#Transport-头域" class="headerlink" title="Transport 头域"></a>Transport 头域</h4><blockquote><p>Connection：</p><p>作用：表示是否需要持久连接。</p><p>如果服务器看到这里的值为“Keep-Alive”，或者看到请求使用的是HTTP 1.1（HTTP 1.1默认进行持久连接）,它就可以利用持久连接的优点，当页面包含多个元素时（例如Applet，图片），显著地减少下载所需要的时间。要实现这一点，服务器需要在应答中发送一个Content-Length头，最简单的实现方法是：先把内容写入 ByteArrayOutputStream，然后在正式写出内容之前计算它的大小；</p><p>例如：　Connection: keep-alive  当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，如果客户端再次访问这个服务器上的 网页，会继续使用这一条已经建立的连接</p><p>例如： Connection: close 代表一个Request完成后，客户端和服务器之间用于传输HTTP数据的TCP连接会关闭， 当客户端再次发送Request，需要重新建立TCP连接。</p><p>Host（发送请求时，该报头域是必需的）</p><p>Host请求报头域主要用于指定被请求资源的Internet主机和端口号，它通常从HTTP URL中提取出来的。</p><p>eg：<a href="https://blog.csdn.net/index.html" target="_blank" rel="noopener">http://；localhost/index.html</a><br>浏览器发送的请求消息中，就会包含Host请求报头域，如下：<br>Host：<a href="http://www.guet.edu.cn/" target="_blank" rel="noopener">localhos</a>t</p><p>此处使用缺省端口号80，若指定了端口号8080，则变成：Host：localhost:8080</p></blockquote><h4 id="Client-头域"><a href="#Client-头域" class="headerlink" title="Client 头域"></a>Client 头域</h4><blockquote><p>Accept：</p><p>作用：浏览器可以接受的媒体类型（MIME类型）,</p><p>例如： Accept: text/html  代表浏览器可以接受服务器回发的类型为 text/html  也就是我们常说的html文档, 如果服务器无法返回text/html类型的数据，服务器应该返回一个406错误(non acceptable)。</p><p>通配符 * 代表任意类型。例如  Accept: <em>/</em>  代表浏览器可以处理所有类型，(一般浏览器发给服务器都是发这个)</p><p>Accept-Encoding：</p><p>作用： 浏览器申明自己接收的编码方法，通常指定压缩方法，是否支持压缩，支持什么压缩方法（gzip，deflate），（注意：这不是只字符编码）;</p><p>例如： Accept-Encoding: gzip, deflate。Server能够向支持gzip/deflate的浏览器返回经gzip或者deflate编码的HTML页面。 许多情形下这可以减少5到10倍的下载时间，也节省带宽。</p><p>Accept-Language：</p><p>作用： 浏览器申明自己接收的语言。 </p><p>语言跟字符集的区别：中文是语言，中文有多种字符集，比如big5，gb2312，gbk等等；</p><p>例如： Accept-Language:zh-cn 。如果请求消息中没有设置这个报头域，服务器假定客户端对各种语言都可以接受。</p><p>User-Agent：</p><p>作用：告诉HTTP服务器， 客户端使用的操作系统和浏览器的名称和版本.</p><p>我们上网登陆论坛的时候，往往会看到一些欢迎信息，其中列出了你的操作系统的名称和版本，你所使用的浏览器的名称和版本，这往往让很多人感到很神奇，实际上， 服务器应用程序就是从User-Agent这个请求报头域中获取到这些信息User-Agent请求报头域允许客户端将它的操作系统、浏览器和其它属性告诉服务器。</p><p>例如： User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; CIBA; .NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET4.0C; InfoPath.2; .NET4.0E)</p><p>Accept-Charset：</p><p>作用：浏览器申明自己接收的字符集，这就是本文前面介绍的各种字符集和字符编码，如gb2312，utf-8（通常我们说Charset包括了相应的字符编码方案）；</p><p>例如：Accept-Charset:iso-8859-1,gb2312.如果在请求消息中没有设置这个域，缺省是任何字符集都可以接受。</p><p>Authorization：授权信息，通常出现在对服务器发送的WWW-Authenticate头的应答中；</p><p>Authorization请求报头域主要用于证明客户端有权查看某个资源。当浏览器访问一个页面时，如果收到服务器的响应代码为401（未授权），可以发送一个包含Authorization请求报头域的请求，要求服务器对其进行验证。</p></blockquote><h4 id="Cookie-Login-头域"><a href="#Cookie-Login-头域" class="headerlink" title="Cookie/Login 头域"></a>Cookie/Login 头域</h4><blockquote><p>Cookie:</p><p>作用： 最重要的header, 将cookie的值发送给HTTP 服务器</p></blockquote><h4 id="Entity头域"><a href="#Entity头域" class="headerlink" title="Entity头域"></a>Entity头域</h4><blockquote><p>Content-Length</p><p>作用：发送给HTTP服务器数据的长度。即请求消息正文的长度；</p><p>例如： Content-Length: 38</p><p>Content-Type：</p><p>作用：</p><p>例如：Content-Type: application/x-www-form-urlencoded</p></blockquote><h4 id="Miscellaneous-头域"><a href="#Miscellaneous-头域" class="headerlink" title="Miscellaneous 头域"></a>Miscellaneous 头域</h4><blockquote><p>Referer:</p><p>作用： 提供了Request的上下文信息的服务器，告诉服务器我是从哪个链接过来的，比如从我主页上链接到一个朋友那里， 他的服务器就能够从HTTP Referer中统计出每天有多少用户点击我主页上的链接访问  他的网站。</p><p>例如: Referer:<a href="http://translate.google.cn/?hl=zh-cn&amp;tab=wT" target="_blank" rel="noopener">http://translate.google.cn/?hl=zh-cn&amp;tab=wT</a></p></blockquote><h4 id="Cache-头域"><a href="#Cache-头域" class="headerlink" title="Cache 头域"></a>Cache 头域</h4><blockquote><p>If-Modified-Since：</p><p>作用： 把浏览器端缓存页面的最后修改时间发送到服务器去，服务器会把这个时间与服务器上实际文件的最后修改时间进行对比。如果时间一致，那么返回304，客户端就直接使用本地缓存文件。如果时间不一致，就会返回200和新的文件内容。客户端接到之后，会丢弃旧文件，把新文件缓存起来，并显示在浏览器中。</p><p>例如：If-Modified-Since: Thu, 09 Feb 2012 09:07:57 GMT。</p><p>If-None-Match：</p><p>作用: If-None-Match和ETag一起工作，工作原理是在HTTP Response中添加ETag信息。 当用户再次请求该资源时，将在HTTP Request 中加入If-None-Match信息(ETag的值)。如果服务器验证资源的ETag没有改变（该资源没有更新），将返回一个304状态告诉客户端使用本地缓存文件。否则将返回200状态和新的资源和Etag. 使用这样的机制将提高网站的性能</p><p>例如: If-None-Match: “03f2b33c0bfcc1:0”</p><p>Pragma：</p><p>作用： 防止页面被缓存， 在HTTP/1.1版本中，它和Cache-Control:no-cache作用一模一样</p><p>Pargma只有一个用法， 例如： Pragma: no-cache</p><p>注意: 在HTTP/1.0版本中，只实现了Pragema:no-cache, 没有实现Cache-Control</p><p>Cache-Control：</p><p>作用: 这个是非常重要的规则。 这个用来指定Response-Request遵循的缓存机制。各个指令含义如下</p><p>Cache-Control:Public  可以被任何缓存所缓存（）</p><p>Cache-Control:Private   内容只缓存到私有缓存中</p><p>Cache-Control:no-cache 所有内容都不会被缓存</p></blockquote><h2 id="2-HTTP响应格式"><a href="#2-HTTP响应格式" class="headerlink" title="2. HTTP响应格式"></a>2. HTTP响应格式</h2><p>   在接收和解释请求消息后，服务器会返回一个 HTTP 响应消息。与 HTTP 请求类似，HTTP 响应也是由三个部分组成，分别是：状态行、消息报头和响应正文。如：</p><pre><code></code></pre><p>HTTP/1.1 200 OK Date: Sun, 17 Mar 2013 08:12:54 GMT Server: Apache/2.2.8 (Win32) PHP/5.2.5 X-Powered-By: PHP/5.2.5 Set-Cookie: PHPSESSID=c0huq7pdkmm5gg6osoe3mgjmm3; path=/ Expires: Thu, 19 Nov 1981 08:52:00 GMT Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0 Pragma: no-cache Content-Length: 4393 Keep-Alive: timeout=5, max=100 Connection: Keep-Alive Content-Type: text/html; charset=utf-8</p><html> <head> <title>HTTP响应示例<title> <meta name="generator" content="Hexo 4.2.1"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head> <body> Hello HTTP! </body> </html><h3 id="1、状态行"><a href="#1、状态行" class="headerlink" title="1、状态行"></a>1、状态行</h3><p>​    状态行由协议版本、数字形式的状态代码，及相应的状态描述组成，各元素之间以空格分隔，结尾时回车换行符，格式如下：</p><p>HTTP-Version Status-Code Reason-Phrase CRLF</p><p>HTTP-Version 表示服务器 HTTP 协议的版本，Status-Code 表示服务器发回的响应代码，Reason-Phrase 表示状态代码的文本描述，CRLF 表示回车换行。例如：</p><p>HTTP/1.1 200 OK (CRLF)</p><p>   状态代码与状态描述</p><p>   状态代码由 3 位数字组成， 表示请求是否被理解或被满足，状态描述给出了关于状态码的简短的文字描述。状态码的第一个数字定义了响应类别，后面两位数字没有具体分类。第一个数字有 5 种取值，如下所示。</p><ul><li>1xx：指示信息——表示请求已经接受，继续处理</li><li>2xx：成功——表示请求已经被成功接收、理解、接受。</li><li>3xx：重定向——要完成请求必须进行更进一步的操作</li><li>4xx：客户端错误——客户端请求有错误或请求无法实现</li><li>5xx：服务器端错误——服务器未能实现合法的请求。</li></ul><p>常见状态代码、状态描述、说明：<br>200 OK   //客户端请求成功</p><p>303：重定向，即从原url重定向到新的url。 例如php 的hear函数header（”localtion:/index.php”）</p><p>400 Bad Request //客户端请求有语法错误，不能被服务器所理解<br>401 Unauthorized //请求未经授权，这个状态代码必须和WWW-Authenticate报头域一起使用<br>403 Forbidden //服务器收到请求，但是拒绝提供服务，一般是服务器路径没有权限或者是其他权限相关问题<br>404 Not Found //请求资源不存在，eg：输入了错误的URL<br>500 Internal Server Error //服务器发生不可预期的错误：一般来说，这个问题都会在服务器端的源代码出现错误时出现，比如出现死循环。</p><p>502 Bad Gateway//作为网关或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效的响应。比如LNMP ,php-fpm没有启动就会报502错误。</p><p>503 Server Unavailable //服务器当前不能处理客户端的请求，一段时间后可能恢复正常，比如java 容器部署war的时候，就出现503,<br>                      或者是nginx处理的文件没有权限。</p><p>504 Gateway Time-out：作为网关或者代理工作的服务器尝试执行请求时，未能及时从上游服务器（URI标识出的服务器，例如HTTP、FTP、LDAP）或者辅助服务器（例如DNS）收到响应，比如nginx和php-fpm， php设置sleep（200），就会收到504 Gateway Time-out。注意：某些代理服务器在DNS查询超时时会返回400或者500错误</p><h3 id="2、响应正文"><a href="#2、响应正文" class="headerlink" title="2、响应正文"></a>2、响应正文</h3><p>响应正文就是服务器返回的资源的内容，响应头和正文之间也必须用空行分隔。如：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>HTTP响应示例<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  Hello HTTP!  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span> </code></pre><h3 id="3-、响应头信息"><a href="#3-、响应头信息" class="headerlink" title="3 、响应头信息"></a>3 、响应头信息</h3><p>HTTP最常见的响应头如下所示：</p><h4 id="Cache头域"><a href="#Cache头域" class="headerlink" title="Cache头域"></a>Cache头域</h4><blockquote><p>Date：</p><p>作用：生成消息的具体时间和日期，即当前的GMT时间。</p><p>例如：　Date: Sun, 17 Mar 2013 08:12:54 GMT</p><p>Expires：</p><p>作用: 浏览器会在指定过期时间内使用本地缓存，指明应该在什么时候认为文档已经过期，从而不再缓存它。</p><p>例如: Expires: Thu, 19 Nov 1981 08:52:00 GMT　　</p><p>Vary</p><p>作用：</p><p>例如: Vary: Accept-Encoding</p></blockquote><h4 id="Cookie-Login-头域-1"><a href="#Cookie-Login-头域-1" class="headerlink" title="Cookie/Login 头域"></a>Cookie/Login 头域</h4><blockquote><p>P3P</p><p>作用: 用于跨域设置Cookie, 这样可以解决iframe跨域访问cookie的问题</p><p>例如: P3P: CP=CURa ADMa DEVa PSAo PSDo OUR BUS UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR</p><p>Set-Cookie</p><p>作用： 非常重要的header, 用于把cookie 发送到客户端浏览器， 每一个写入cookie都会生成一个Set-Cookie.</p><p>例如: Set-Cookie: PHPSESSID=c0huq7pdkmm5gg6osoe3mgjmm3; path=/</p></blockquote><h4 id="Entity实体头域："><a href="#Entity实体头域：" class="headerlink" title="Entity实体头域："></a>Entity实体头域：</h4><p>​      实体内容的属性，包括实体信息类型，长度，压缩方法，最后一次修改时间，数据有效性等。</p><blockquote><p>ETag：</p><p>作用: 和If-None-Match 配合使用。 （实例请看上节中If-None-Match的实例）</p><p>例如: ETag: “03f2b33c0bfcc1:0”</p><p>Last-Modified：</p><p>作用： 用于指示资源的最后修改日期和时间。（实例请看上节的If-Modified-Since的实例）</p><p>例如: Last-Modified: Wed, 21 Dec 2011 09:09:10 GMT</p><p>Content-Type：</p><p>作用：WEB服务器告诉浏览器自己响应的对象的类型和字符集,</p><p>例如:</p><p>​    Content-Type: text/html; charset=utf-8</p><p>　　Content-Type:text/html;charset=GB2312</p><p>　　Content-Type: image/jpeg</p><p>Content-Length：</p><p>指明实体正文的长度，以字节方式存储的十进制数字来表示。在数据下行的过程中，Content-Length的方式要预先在服务器中缓存所有数据，然后所有数据再一股脑儿地发给客户端。</p><p>　　例如: Content-Length: 19847</p><p>Content-Encoding：</p><p>作用：文档的编码（Encode）方法。一般是压缩方式。</p><p>WEB服务器表明自己使用了什么压缩方法（gzip，deflate）压缩响应中的对象。利用gzip压缩文档能够显著地减少HTML文档的下载时间。</p><p>例如：Content-Encoding：gzip</p><p>Content-Language：</p><p>作用： WEB服务器告诉浏览器自己响应的对象的语言者</p><p>例如： Content-Language:da</p></blockquote><h4 id="Miscellaneous-头域-1"><a href="#Miscellaneous-头域-1" class="headerlink" title="Miscellaneous 头域"></a>Miscellaneous 头域</h4><blockquote><p>Server：</p><p>作用：指明HTTP服务器的软件信息</p><p>例如:Apache/2.2.8 (Win32) PHP/5.2.5</p><p>X-Powered-By：</p><p>作用：表示网站是用什么技术开发的</p><p>例如： X-Powered-By: PHP/5.2.5</p></blockquote><h4 id="Transport头域"><a href="#Transport头域" class="headerlink" title="Transport头域"></a>Transport头域</h4><blockquote><p>Connection：</p><p>例如：　Connection: keep-alive  当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接</p><p>例如： Connection: close 代表一个Request完成后，客户端和服务器之间用于传输HTTP数据的TCP连接会关闭， 当客户端再次发送Request，需要重新建立TCP连接。</p></blockquote><h4 id="Location头域"><a href="#Location头域" class="headerlink" title="Location头域"></a>Location头域</h4><blockquote><p>Location：</p><p>作用： 用于重定向一个新的位置， 包含新的URL地址</p><p>实例请看304状态实例</p></blockquote><h3 id="HTTP协议是无状态的和Connection-keep-alive的区别"><a href="#HTTP协议是无状态的和Connection-keep-alive的区别" class="headerlink" title="HTTP协议是无状态的和Connection: keep-alive的区别"></a>HTTP协议是无状态的和Connection: keep-alive的区别</h3><p>　　无状态是指协议对于事务处理没有记忆能力，服务器不知道客户端是什么状态。从另一方面讲，打开一个服务器上的网页和你之前打开这个服务器上的网页之间没有任何联系。</p><p>　　HTTP是一个无状态的面向连接的协议，无状态不代表HTTP不能保持TCP连接，更不能代表HTTP使用的是UDP协议（无连接）。</p><p>　　从HTTP/1.1起，默认都开启了Keep-Alive，保持连接特性，简单地说，当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。</p><p>　　Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间。</p><h2 id="3-浏览器缓存"><a href="#3-浏览器缓存" class="headerlink" title="3. 浏览器缓存"></a>3. 浏览器缓存</h2><p>​     </p><p>​    浏览器缓存：包括页面html缓存和图片js，css等资源的缓存。如下图，浏览器缓存是基于把页面信息保存到用户本地电脑硬盘里。</p><p>​    <img src="http://img.my.csdn.net/uploads/201303/17/1363512688_4762.png" alt="img"></p><h3 id="1、缓存的优点："><a href="#1、缓存的优点：" class="headerlink" title="1、缓存的优点："></a>1、缓存的优点：</h3><p>   1）服务器响应更快：因为请求从缓存服务器（离客户端更近）而不是源服务器被相应，这个过程耗时更少，让服务器看上去响应更快。</p><p>   2）减少网络带宽消耗：当副本被重用时会减低客户端的带宽消耗；客户可以节省带宽费用，控制带宽的需求的增长并更易于管理。</p><h3 id="1、缓存工作原理"><a href="#1、缓存工作原理" class="headerlink" title="1、缓存工作原理"></a>1、缓存工作原理</h3><p>​    页面缓存状态是由http header决定的，一个浏览器请求信息，一个是服务器响应信息。主要包括Pragma: no-cache、Cache-Control、 Expires、 Last-Modified、If-Modified-Since。其中Pragma: no-cache由HTTP/1.0规定，Cache-Control由HTTP/1.1规定。</p><p>​    工作原理图：</p><p><img src="http://img.my.csdn.net/uploads/201303/17/1363512757_1013.png" alt="img"></p><p>从图中我们可以看到原理主要分三步：</p><ol><li>第一次请求：浏览器通过http的header报头，附带Expires，Cache-Control，Last-Modified/Etag向服务器请求，此时服务器记录第一次请求的Last-Modified/Etag          </li><li>再次请求：当浏览器再次请求的时候，请求头附带Expires，Cache-Control，If-Modified-Since/Etag向服务器请求</li><li>服务器根据第一次记录的Last-Modified/Etag和再次请求的If-Modified-Since/Etag做对比，判断是否需要更新，服务器通过这两个头判断本地资源未发生变化，客 户端不需要重新下载，返回304响应。常见流程如下图所示：</li></ol><p><img src="http://img.my.csdn.net/uploads/201303/19/1363670410_3844.jpg" alt="img"></p><h3 id="与缓存相关的HTTP扩展消息头"><a href="#与缓存相关的HTTP扩展消息头" class="headerlink" title="与缓存相关的HTTP扩展消息头"></a>与缓存相关的HTTP扩展消息头</h3><p>  Expires：设置页面过期时间，格林威治时间GMT</p><p>  Cache-Control：更细致的控制缓存的内容</p><p>  Last-Modified：请求对象最后一次的修改时间 用来判断缓存是否过期 通常由文件的时间信息产生 </p><p>  ETag：响应中资源的校验值，在服务器上某个时段是唯一标识的。ETag是一个可以 与Web资源关联的记号（token），和Last-Modified功能才不多，也是一个标识符，一般和Last-Modified一起使用，加强服务器判断的准确度。</p><p>  Date：服务器的时间</p><p>  If-Modified-Since：客户端存取的该资源最后一次修改的时间，用来和服务器端的Last-Modified做比较</p><p>  If-None-Match：客户端存取的该资源的检验值，同ETag。</p><p>Cache-Control的主要参数<br>   Cache-Control: private/public Public 响应会被缓存，并且在多用户间共享。 Private 响应只能够作为私有的缓存，不能再用户间共享。<br>   Cache-Control: no-cache：不进行缓存<br>   Cache-Control: max-age=x：缓存时间 以秒为单位<br>   Cache-Control: must-revalidate：如果页面是过期的 则去服务器进行获取。</p><p>我们nginx测试：</p><pre class=" language-nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">{</span>    <span class="token keyword">listen</span>    <span class="token number">8081</span><span class="token punctuation">;</span>    <span class="token keyword">server_name</span>  <span class="token number">10.163</span><span class="token punctuation">.</span><span class="token number">1.175</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">!=</span> <span class="token string">'www.test1.com'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>      \#<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>$ <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>test1<span class="token punctuation">.</span>com<span class="token operator">/</span>$<span class="token number">1</span> permanent<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm <span class="token keyword">index</span><span class="token punctuation">.</span>php<span class="token punctuation">;</span>    <span class="token keyword">root</span>  <span class="token operator">/</span>home<span class="token operator">/</span>www<span class="token operator">/</span>app<span class="token operator">/</span><span class="token punctuation">;</span>    <span class="token keyword">access_log</span>  <span class="token operator">/</span>mnt<span class="token operator">/</span>app<span class="token operator">/</span>nginx<span class="token operator">/</span>logs<span class="token operator">/</span>test1<span class="token punctuation">.</span>home<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>    <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token punctuation">.</span><span class="token operator">*</span>\<span class="token punctuation">.</span>zip<span class="token operator">?</span>$    <span class="token punctuation">{</span>        <span class="token keyword">access_log</span> off<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token punctuation">.</span><span class="token operator">*</span>\<span class="token punctuation">.</span>txt<span class="token operator">?</span>$ <span class="token punctuation">{</span>        <span class="token keyword">access_log</span> off<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token punctuation">.</span><span class="token operator">*</span>\<span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token operator">|</span>bmp<span class="token operator">|</span>swf<span class="token punctuation">)</span>$    <span class="token punctuation">{</span>        <span class="token keyword">expires</span>    30d<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token punctuation">.</span><span class="token operator">*</span>\<span class="token punctuation">.</span><span class="token punctuation">(</span>js<span class="token operator">|</span>css<span class="token operator">|</span>zip<span class="token punctuation">)</span><span class="token operator">?</span>$    <span class="token punctuation">{</span>        <span class="token keyword">expires</span>    12h<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">-</span>e <span class="token variable">$request_filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">+</span><span class="token punctuation">)</span>$ <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>php<span class="token operator">?</span>url<span class="token operator">=</span>$<span class="token number">1</span> last<span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token punctuation">.</span><span class="token operator">*</span>\<span class="token punctuation">.</span><span class="token punctuation">(</span>php<span class="token operator">|</span>php5<span class="token punctuation">)</span><span class="token operator">?</span>$    <span class="token punctuation">{</span>        \#<span class="token keyword">fastcgi_pass</span>  unix<span class="token punctuation">:</span><span class="token operator">/</span>tmp<span class="token operator">/</span>php<span class="token operator">-</span>cgi<span class="token punctuation">.</span>sock<span class="token punctuation">;</span>        <span class="token keyword">fastcgi_pass</span> <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">9000</span><span class="token punctuation">;</span>        <span class="token keyword">fastcgi_index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>php<span class="token punctuation">;</span>        <span class="token keyword">include</span> fastcgi<span class="token punctuation">.</span>conf<span class="token punctuation">;</span>        <span class="token keyword">add_header</span> Content<span class="token operator">-</span>Type text<span class="token operator">/</span>html<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>然后我们代理两个域名指向同一个端口：</p><pre class=" language-nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">{</span>  <span class="token keyword">listen</span>  <span class="token number">80</span><span class="token punctuation">;</span>  <span class="token keyword">server_name</span>  www<span class="token punctuation">.</span>test1<span class="token punctuation">.</span>com  test1<span class="token punctuation">.</span>com<span class="token punctuation">;</span>  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>    <span class="token keyword">proxy_pass</span>     <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">8081</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span>  Host       <span class="token variable">$host</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span>  X<span class="token operator">-</span>Real<span class="token operator">-</span>IP     <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span>  X<span class="token operator">-</span>Forward<span class="token operator">-</span>For   <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span> Access<span class="token operator">-</span>Control<span class="token operator">-</span><span class="token keyword">Allow</span><span class="token operator">-</span>Origin <span class="token operator">*</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_next_upstream</span> http_502 http_504 error <span class="token keyword">timeout</span> invalid_header<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">server</span> <span class="token punctuation">{</span>  <span class="token keyword">listen</span>  <span class="token number">80</span><span class="token punctuation">;</span>  <span class="token keyword">server_name</span>  www<span class="token punctuation">.</span>test2<span class="token punctuation">.</span>com  test2<span class="token punctuation">.</span>com<span class="token punctuation">;</span>  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>    <span class="token keyword">proxy_pass</span>     <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">8081</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span>  Host       <span class="token variable">$host</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span>  X<span class="token operator">-</span>Real<span class="token operator">-</span>IP     <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span>  X<span class="token operator">-</span>Forward<span class="token operator">-</span>For   <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span> Access<span class="token operator">-</span>Control<span class="token operator">-</span><span class="token keyword">Allow</span><span class="token operator">-</span>Origin <span class="token operator">*</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_next_upstream</span> http_502 http_504 error <span class="token keyword">timeout</span> invalid_header<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>我们访问<a href="http://www.test2.com，直接指向www.test1.com，http是304响应。" target="_blank" rel="noopener">www.test2.com，直接指向www.test1.com，http是304响应。</a></p><p>当我们把8081端口的配置去掉</p><pre class=" language-nginx"><code class="language-nginx">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">!=</span> <span class="token string">'www.test1.com'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>      \#<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>$ <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>test1<span class="token punctuation">.</span>com<span class="token operator">/</span>$<span class="token number">1</span> permanent<span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>  重启nginx，同一个访问<a href="http://www.test2.com，发现还是直接跳转到www.test1.com。" target="_blank" rel="noopener">www.test2.com，发现还是直接跳转到www.test1.com。</a></p><p>这是因为浏览器304缓存的问题。我们直接使用新浏览器访问，就直接访问就不会跳转啦。</p>]]></content>
      
      
      <categories>
          
          <category> 程序员基本知识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTTP </tag>
            
            <tag> 程序员基本知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP工作原理相关</title>
      <link href="/2020/07/07/http-gong-zuo-yuan-li/"/>
      <url>/2020/07/07/http-gong-zuo-yuan-li/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://www.jianshu.com/p/5dc1793a4d10" target="_blank" rel="noopener">https://www.jianshu.com/p/5dc1793a4d10</a></p></blockquote><h3 id="1-OSI-七层模型"><a href="#1-OSI-七层模型" class="headerlink" title="1. OSI 七层模型"></a>1. OSI 七层模型</h3><p>OSI（Open System Interconnection，开放系统互连）七层网络模型称为开放式系统互联参考模型 ，是一个逻辑上的定义，一个规范，它把网络从逻辑上分为了7层。每一层都有相关、相对应的物理设备，比如路由器，交换机。OSI 七层模型是一种框架性的设计方法 ，建立七层模型的主要目的是为解决异种网络互连时所遇到的兼容性问题，其最主要的功能使就是帮助不同类型的主机实现数据传输。OSI采用了分层的结构化技术，共分七层，物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707151226" alt="img"></p><ol><li><p>物理层：提供为建立、维护和拆除物理链路所需要的机械的、电气的、功能的和规程的特性；有关的物理链路上传输非结构的位流以及故障检测指示。</p></li><li><p>数据链路层：在网络层实体间提供数据发送和接收的功能和过程；提供数据链路的流控。</p></li><li><p>网络层：控制分组传送系统的操作、路由选择、拥护控制、网络互连等功能，它的作用是将具体的物理传送对高层透明。</p></li><li><p>传输层：提供建立、维护和拆除传送连接的功能；选择网络层提供最合适的服务；在系统之间提供可靠的透明的数据传送，提供端到端的错误恢复和流量控制。</p></li><li><p>会话层：提供两进程之间建立、维护和结束会话连接的功能；提供交互会话的管理功能，如三种数据流方向的控制，即一路交互、两路交替和两路同时会话模式 。</p></li><li><p>表示层：代表应用进程协商数据表示；完成数据转换、格式化和文本压缩。</p></li><li><p>应用层：提供OSI用户服务，例如事务处理程序、文件传送协议和网络管理等。</p></li></ol><h3 id="2-HTTP-的工作原理"><a href="#2-HTTP-的工作原理" class="headerlink" title="2. HTTP 的工作原理"></a>2. HTTP 的工作原理</h3><p>HTTP(HyperText Transfer Protocol超文本传输协议)是一套计算机通过网络进行通信的规则。HTTP的工作流程可分为四步：</p><ul><li>客户端与服务器建立连接。当我们在浏览器输入网址或者当我们点击链接时，HTTP开始工作。</li><li>建立连接后，客户机发送一个请求给服务器，如当我们在浏览器地址栏输入<a href="https://link.jianshu.com?t=http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a>，浏览器将我们的请求封装成HTTP报文，请求报文的格式为：统一资源标识符（URL）、协议版本号，后边是MIME信息包括请求修饰符、客户机信息和可能的内容。打开浏览器控制台Network，可看到浏览器发送的请求。</li></ul><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707151247" alt=""></p><ul><li>服务器接到请求后，给予相应的响应信息，其格式为一个状态行，包括信息的协议版本号、一个成功或错误的代码，后边是MIME信息包括服务器信息、实体信息和可能的内容。</li><li>客户端接收服务器所返回的信息通过浏览器显示在用户的显示屏上，然后客户机与服务器断开连接。</li></ul><h3 id="3-URI-和常见的协议"><a href="#3-URI-和常见的协议" class="headerlink" title="3. URI 和常见的协议"></a>3. URI 和常见的协议</h3><h4 id="URI和URL"><a href="#URI和URL" class="headerlink" title="URI和URL"></a>URI和URL</h4><p><strong>URL（统一资源定位符）是URI（统一资源标识符）的一个子集</strong>。<br> URI由两个主要的子集构成</p><ol><li><p>URL：通过描述资源的位置来描述资源</p></li><li><p>URN：通过名字来识别资源，和位置无关<br> 如下几种URI：</p></li></ol><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707151300" alt=""></p><p>绝对URI的格式：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707151310" alt="《图解HTTP》.jpg"></p><p><strong>常见的协议以及对应端口号</strong><br> （1）FTP    文件传输协议，使用21端口。<br> （2）HTTP：超文本传输协议。默认80端口。<br> （3）HTTPs：具有安全性的ssl加密传输协议，端口号443.<br> （4）Telnet：它是一种用于远程登陆的端口，用户可以以自己的身份远程连接到计算机上，通过这种端口可以提供一种基于DOS模式下的通信服务。如以前的BBS是纯字符界面的，支持BBS的服务器将23端口打开，对外提供服务。<br> （5）SMTP： 简单邮件传送协议，25端口。<br> （6）POP3：它是和SMTP对应，POP3用于接收邮件。110端口。</p><h3 id="4-HTTP-协议和服务器交互的方法"><a href="#4-HTTP-协议和服务器交互的方法" class="headerlink" title="4. HTTP 协议和服务器交互的方法"></a>4. HTTP 协议和服务器交互的方法</h3><p>HTTP最大的作用就是客户端发送请求，服务器给出响应，客户端想服务器发送请求的方式有很多。</p><ul><li><strong>GET</strong><br> GET是最常用的方法，通常用于请求服务器发送某个资源。我们平时在浏览器输入网页地址，就是给服务器发送了一个get请求，希望得到这个网页。</li><li><strong>POST</strong><br> POST用于想服务器发送数据，通常用来支持HTML的表单（input、select、textarea），表单中的数据会被发送到服务器。</li><li><strong>HEAD</strong><br> HEAD方法和GET类似，但是在服务器的响应中没有资源的内容，只有资源的一些基本信息，主要用于：</li></ul><ol><li>在不获取资源的情况下获取资源信息（类型、大小等）。</li><li>通过状态码产看资源是否存在。</li><li>通过查看首部，测试资源是否被修改了。</li></ol><ul><li><strong>PUT</strong><br> 和GET从服务器获取资源相反，PUT用于想服务器写入资源。PUT的语义就是让服务器用请求的主体部分创建一个请求URL命名的文档，如果存在就替换</li><li><strong>TRACE</strong><br> 客户端发送一个请求的时候，这个请求可能会穿过防火墙、代理、网关和一些其它应用程序，没个中间节点都可能修改HTTP请求，TRACE方法允许客户端在最终请求发往服务器的时候，看看它变成了什么样子。<br> TRACE请求会在目的服务器端发送一个“闭环”诊断，行程最后一站服务器会弹回一条TRACE响应，并在响应主题中携带它收到的原始请求报文。</li><li><strong>DELETE</strong><br> DELETE方法用于要求服务器删除请求的URL，和PUT一样，服务器可能会不支持。</li><li><strong>OPTIONS</strong><br> OPTIONS方法用于请求 web服务器告知其支持的各种功能。</li></ul><h3 id="5-状态码"><a href="#5-状态码" class="headerlink" title="5. 状态码"></a>5. 状态码</h3><p>HTTP状态码，反映了Web服务器处理HTTP请求状态。HTTP应答码由3位数字构成，其中首位数字定义了应答码的类型：<br> 　　<br> 1XX－信息类(Information),表示收到Web浏览器请求，正在进一步的处理中<br> 2XX－成功类（Successful）,表示用户请求被正确接收，理解和处理例如：200 OK成功<br> 3XX-重定向类(Redirection),表示请求没有成功，客户必须采取进一步的动作。如</p><ul><li>301：Moved Permanently，客户请求的文档在其他地方，新的URL在Location头中给出，浏览器应该自动地访问新的URL。</li><li>304： Not Modified 客户端有缓冲的文档并发出了一个条件性的请求（一般是提供If-Modified-Since头表示客户只想比指定日期更新的文档）。服务器告 诉客户，原来缓冲的文档还可以继续使用。</li></ul><p>4XX-客户端错误(Client Error)，表示客户端提交的请求有错误 例如：404 NOT Found，意味着请求中所引用的文档不存在。<br> 5XX-服务器错误(Server Error)表示服务器不能完成对请求的处理：如 500  对于我们Web开发人员来说掌握HTTP应答码有。503 Service Unavailable 服务器由于维护或者负载过重未能应答。</p>]]></content>
      
      
      <categories>
          
          <category> 程序员基本知识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTTP </tag>
            
            <tag> 程序员基本知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>promise详解</title>
      <link href="/2020/07/07/promise-xiang-jie/"/>
      <url>/2020/07/07/promise-xiang-jie/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://www.jianshu.com/p/dbda3053da20" target="_blank" rel="noopener">https://www.jianshu.com/p/dbda3053da20</a></p></blockquote><h2 id="1-Promise-all-并行执行promise"><a href="#1-Promise-all-并行执行promise" class="headerlink" title="1.Promise.all 并行执行promise"></a>1.Promise.all 并行执行promise</h2><blockquote><p>getA和getB并行执行，然后输出结果。如果有一个错误，就抛出错误</p></blockquote><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">/** * 每一个promise都必须返回resolve结果才正确 * 每一个promise都不处理错误 */</span><span class="token keyword">const</span> getA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">//模拟异步任务</span>   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=</span><span class="token operator">></span> result<span class="token punctuation">)</span><span class="token keyword">const</span> getB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">// resolve(3);</span>     <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Error in getB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=</span><span class="token operator">></span> result<span class="token punctuation">)</span>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>getA<span class="token punctuation">,</span> getB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>getA和getB并行执行，然后输出结果。总是返回resolve结果</p></blockquote><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">/** * 每一个promise自己处理错误 */</span><span class="token keyword">const</span> getA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">//模拟异步任务</span>   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=</span><span class="token operator">></span> result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> getB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">// resolve(3);</span>     <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Error in getB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=</span><span class="token operator">></span> result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token operator">=</span><span class="token operator">></span>e<span class="token punctuation">)</span>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>getA<span class="token punctuation">,</span> getB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="2-顺序执行promise"><a href="#2-顺序执行promise" class="headerlink" title="2.顺序执行promise"></a>2.顺序执行promise</h2><blockquote><p>先getA然后getB执行，最后addAB</p></blockquote><h3 id="2-1-方法一——连续使用then链式操作"><a href="#2-1-方法一——连续使用then链式操作" class="headerlink" title="2.1 方法一——连续使用then链式操作"></a>2.1 方法一——连续使用then链式操作</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">return</span>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                 <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">getB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">{</span>               <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">addAB</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span>  obj<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span>  <span class="token function">getA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">{</span>         obj<span class="token punctuation">.</span>a<span class="token operator">=</span>a<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">getB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>         obj<span class="token punctuation">.</span>b<span class="token operator">=</span>b<span class="token punctuation">;</span>         <span class="token keyword">return</span> obj<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token keyword">return</span>  <span class="token function">addAB</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>obj<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-2-方法二——使用promise构建队列"><a href="#2-2-方法二——使用promise构建队列" class="headerlink" title="2.2 方法二——使用promise构建队列"></a>2.2 方法二——使用promise构建队列</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> res<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 构建队列</span>    <span class="token keyword">function</span> <span class="token function">queue</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> sequence <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>        sequence <span class="token operator">=</span> sequence<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>            res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> res        <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> sequence    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 执行队列</span>    <span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">[</span>getA<span class="token punctuation">,</span>getB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">addAB</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-3方法三——使用async、await实现类似同步编程"><a href="#2-3方法三——使用async、await实现类似同步编程" class="headerlink" title="2.3方法三——使用async、await实现类似同步编程"></a>2.3方法三——使用async、await实现类似同步编程</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">queue</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> fn <span class="token keyword">of</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> data<span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token keyword">await</span> res<span class="token punctuation">}</span><span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">[</span>getA<span class="token punctuation">,</span>getB<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">addAB</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token operator">></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>实现异步队列函数的三种方式</p><blockquote><p>方法一——连续使用then链式操作<br>方法二——使用promise构建队列<br>方法三——使用async、await实现类似同步编程，async函数内部实现同步</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
            <tag> ES6语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>十大经典排序算法</title>
      <link href="/2020/07/02/shi-da-jing-dian-pai-xu-suan-fa/"/>
      <url>/2020/07/02/shi-da-jing-dian-pai-xu-suan-fa/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://www.cnblogs.com/onepixel/articles/7674659.html" target="_blank" rel="noopener">https://www.cnblogs.com/onepixel/articles/7674659.html</a></p></blockquote><h2 id="算法概述"><a href="#算法概述" class="headerlink" title="算法概述"></a>算法概述</h2><h3 id="1-算法分类"><a href="#1-算法分类" class="headerlink" title="1. 算法分类"></a>1. 算法分类</h3><p>十种常见排序算法可以分为两大类：</p><ul><li><strong>比较类排序</strong>：通过比较来决定元素间的相对次序，由于其时间复杂度不能突破O(nlogn)，因此也称为非线性时间比较类排序。</li><li><strong>非比较类排序</strong>：不通过比较来决定元素间的相对次序，它可以突破基于比较排序的时间下界，以线性时间运行，因此也称为线性时间非比较类排</li></ul><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702171618.png" alt=""></p><h3 id="2-算法复杂度"><a href="#2-算法复杂度" class="headerlink" title="2.算法复杂度"></a>2.算法复杂度</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702171637.png" alt=""></p><h3 id="3-相关概念"><a href="#3-相关概念" class="headerlink" title="3 相关概念"></a>3 相关概念</h3><ul><li><strong>稳定</strong>：如果a原本在b前面，而a=b，排序之后a仍然在b的前面。</li><li><strong>不稳定</strong>：如果a原本在b的前面，而a=b，排序之后 a 可能会出现在 b 的后面。</li><li><strong>时间复杂度</strong>：对排序数据的总的操作次数。反映当n变化时，操作次数呈现什么规律。</li><li><strong>空间复杂度：</strong>是指算法在计算机</li></ul><p>内执行时所需存储空间的度量，它也是数据规模n的函数。</p><h2 id="1、冒泡排序（Bubble-Sort）"><a href="#1、冒泡排序（Bubble-Sort）" class="headerlink" title="1、冒泡排序（Bubble Sort）"></a>1、冒泡排序（Bubble Sort）</h2><p>冒泡排序是一种简单的排序算法。它重复地走访过要排序的数列，一次比较两个元素，如果它们的顺序错误就把它们交换过来。走访数列的工作是重复地进行直到没有再需要交换，也就是说该数列已经排序完成。这个算法的名字由来是因为越小的元素会经由交换慢慢“浮”到数列的顶端。 </p><h3 id="1-1-算法描述"><a href="#1-1-算法描述" class="headerlink" title="1.1 算法描述"></a>1.1 算法描述</h3><ul><li>比较相邻的元素。如果第一个比第二个大，就交换它们两个；</li><li>对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对，这样在最后的元素应该会是最大的数；</li><li>针对所有的元素重复以上的步骤，除了最后一个；</li><li>重复步骤1~3，直到排序完成。</li></ul><h3 id="1-2-动图演示"><a href="#1-2-动图演示" class="headerlink" title="1.2 动图演示"></a><strong>1.2 动图演示</strong></h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702171734.gif" alt=""></p><h3 id="1-3-代码实现"><a href="#1-3-代码实现" class="headerlink" title="1.3 代码实现"></a>1.3 代码实现</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">bubbleSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>    varlen <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>vari <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>varj <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 相邻元素两两对比</span>                vartemp <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 元素交换</span>                arr<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    returnarr<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="2、选择排序（Selection-Sort）"><a href="#2、选择排序（Selection-Sort）" class="headerlink" title="2、选择排序（Selection Sort）"></a>2、选择排序（Selection Sort）</h2><p>选择排序(Selection-sort)是一种简单直观的排序算法。它的工作原理：首先在未排序序列中找到最小（大）元素，存放到排序序列的起始位置，然后，再从剩余未排序元素中继续寻找最小（大）元素，然后放到已排序序列的末尾。以此类推，直到所有元素均排序完毕。 </p><h3 id="2-1-算法描述"><a href="#2-1-算法描述" class="headerlink" title="2.1 算法描述"></a>2.1 算法描述</h3><p>n个记录的直接选择排序可经过n-1趟直接选择排序得到有序结果。具体算法描述如下：</p><ul><li>初始状态：无序区为R[1..n]，有序区为空；</li><li>第i趟排序(i=1,2,3…n-1)开始时，当前有序区和无序区分别为R[1..i-1]和R(i..n）。该趟排序从当前无序区中-选出关键字最小的记录 R[k]，将它与无序区的第1个记录R交换，使R[1..i]和R[i+1..n)分别变为记录个数增加1个的新有序区和记录个数减少1个的新无序区；</li><li>n-1趟结束，数组有序化了。</li></ul><h3 id="2-2-动图演示"><a href="#2-2-动图演示" class="headerlink" title="2.2 动图演示"></a><strong>2.2 动图演示</strong></h3><p><img src="https://images2017.cnblogs.com/blog/849589/201710/849589-20171015224719590-1433219824.gif" alt=""></p><h3 id="2-3-代码实现"><a href="#2-3-代码实现" class="headerlink" title="2.3 代码实现"></a>2.3 代码实现</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">selectionSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>    varlen <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    varminIndex<span class="token punctuation">,</span> temp<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>vari <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        minIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>varj <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">// 寻找最小的数</span>                minIndex <span class="token operator">=</span> j<span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">// 将最小数的索引保存</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        temp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    returnarr<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="2-4-算法分析"><a href="#2-4-算法分析" class="headerlink" title="2.4 算法分析"></a>2.4 算法分析</h3><p>表现最稳定的排序算法之一，因为无论什么数据进去都是O(n2)的时间复杂度，所以用到它的时候，数据规模越小越好。唯一的好处可能就是不占用额外的内存空间了吧。理论上讲，选择排序可能也是平时排序一般人想到的最多的排序方法了吧。</p><h2 id="3、插入排序（Insertion-Sort）"><a href="#3、插入排序（Insertion-Sort）" class="headerlink" title="3、插入排序（Insertion Sort）"></a>3、插入排序（Insertion Sort）</h2><p>插入排序（Insertion-Sort）的算法描述是一种简单直观的排序算法。它的工作原理是通过构建有序序列，对于未排序数据，在已排序序列中从后向前扫描，找到相应位置并插入。</p><h3 id="3-1-算法描述"><a href="#3-1-算法描述" class="headerlink" title="3.1 算法描述"></a>3.1 算法描述</h3><p>一般来说，插入排序都采用in-place在数组上实现。具体算法描述如下：</p><ul><li>从第一个元素开始，该元素可以认为已经被排序；</li><li>取出下一个元素，在已经排序的元素序列中从后向前扫描；</li><li>如果该元素（已排序）大于新元素，将该元素移到下一位置；</li><li>重复步骤3，直到找到已排序的元素小于或者等于新元素的位置；</li><li>将新元素插入到该位置后；</li><li>重复步骤2~5。</li></ul><h3 id="3-2-动图演示"><a href="#3-2-动图演示" class="headerlink" title="3.2 动图演示"></a>3.2 动图演示</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702171908.gif" alt=""></p><h3 id="3-2-代码实现"><a href="#3-2-代码实现" class="headerlink" title="3.2 代码实现"></a>3.2 代码实现</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">insertionSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>    varlen <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    varpreIndex<span class="token punctuation">,</span> current<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>vari <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        preIndex <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        current <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>preIndex <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>preIndex<span class="token punctuation">]</span> <span class="token operator">></span> current<span class="token punctuation">)</span> <span class="token punctuation">{</span>            arr<span class="token punctuation">[</span>preIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>preIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>            preIndex<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        arr<span class="token punctuation">[</span>preIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> current<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    returnarr<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="3-4-算法分析"><a href="#3-4-算法分析" class="headerlink" title="3.4 算法分析"></a>3.4 算法分析</h3><p>插入排序在实现上，通常采用in-place排序（即只需用到O(1)的额外空间的排序），因而在从后向前扫描过程中，需要反复把已排序元素逐步向后挪位，为最新元素提供插入空间。</p><h2 id="4、希尔排序（Shell-Sort）"><a href="#4、希尔排序（Shell-Sort）" class="headerlink" title="4、希尔排序（Shell Sort）"></a>4、希尔排序（Shell Sort）</h2><p>1959年Shell发明，第一个突破O(n2)的排序算法，是简单插入排序的改进版。它与插入排序的不同之处在于，它会优先比较距离较远的元素。希尔排序又叫<strong>缩小增量排序</strong>。</p><h3 id="4-1-算法描述"><a href="#4-1-算法描述" class="headerlink" title="4.1 算法描述"></a>4.1 算法描述</h3><p>先将整个待排序的记录序列分割成为若干子序列分别进行直接插入排序，具体算法描述：</p><ul><li>选择一个增量序列t1，t2，…，tk，其中ti&gt;tj，tk=1；</li><li>按增量序列个数k，对序列进行k 趟排序；</li><li>每趟排序，根据对应的增量ti，将待排序列分割成若干长度为m 的子序列，分别对各子表进行直接插入排序。仅增量因子为1 时，整个序列作为一个表来处理，表长度即为整个序列的长度。</li></ul><h3 id="4-2-动图演示"><a href="#4-2-动图演示" class="headerlink" title="4.2 动图演示"></a>4.2 动图演示</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702172314.gif" alt=""></p><h4 id="4-3-代码实现"><a href="#4-3-代码实现" class="headerlink" title="4.3 代码实现"></a>4.3 代码实现</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">shellSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>    varlen <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>vargap <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>len <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> gap <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> gap <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>gap <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 注意：这里和动图演示的不一样，动图是分组执行，实际操作是多个分组交替执行</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>vari <span class="token operator">=</span> gap<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            varj <span class="token operator">=</span> i<span class="token punctuation">;</span>            varcurrent <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span>j <span class="token operator">-</span> gap <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> current <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> gap<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                 arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> gap<span class="token punctuation">]</span><span class="token punctuation">;</span>                 j <span class="token operator">=</span> j <span class="token operator">-</span> gap<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> current<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    returnarr<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="4-4-算法分析"><a href="#4-4-算法分析" class="headerlink" title="4.4 算法分析"></a>4.4 算法分析</h3><p>希尔排序的核心在于间隔序列的设定。既可以提前设定好间隔序列，也可以动态的定义间隔序列。动态定义间隔序列的算法是《算法（第4版）》的合著者Robert Sedgewick提出的。　</p><h2 id="5、归并排序（Merge-Sort）"><a href="#5、归并排序（Merge-Sort）" class="headerlink" title="5、归并排序（Merge Sort）"></a>5、归并排序（Merge Sort）</h2><p>归并排序是建立在归并操作上的一种有效的排序算法。该算法是采用分治法（Divide and Conquer）的一个非常典型的应用。将已有序的子序列合并，得到完全有序的序列；即先使每个子序列有序，再使子序列段间有序。若将两个有序表合并成一个有序表，称为2-路归并。 </p><h3 id="5-1-算法描述"><a href="#5-1-算法描述" class="headerlink" title="5.1 算法描述"></a>5.1 算法描述</h3><ul><li>把长度为n的输入序列分成两个长度为n/2的子序列；</li><li>对这两个子序列分别采用归并排序；</li><li>将两个排序好的子序列合并成一个最终的排序序列。</li></ul><h3 id="5-2-动图演示"><a href="#5-2-动图演示" class="headerlink" title="5.2 动图演示"></a>5.2 动图演示</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702172356.gif" alt=""></p><h3 id="5-3-代码实现"><a href="#5-3-代码实现" class="headerlink" title="5.3 代码实现"></a>5.3 代码实现</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>    varlen <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        returnarr<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    varmiddle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>len <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        left <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> middle<span class="token punctuation">)</span><span class="token punctuation">,</span>        right <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>middle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">returnmerge</span><span class="token punctuation">(</span><span class="token function">mergeSort</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">merge</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>    varresult <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span>length<span class="token operator">></span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> right<span class="token punctuation">.</span>length<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>left<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> right<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>right<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span>length<span class="token punctuation">)</span>        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>right<span class="token punctuation">.</span>length<span class="token punctuation">)</span>        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>right<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    returnresult<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="5-4-算法分析"><a href="#5-4-算法分析" class="headerlink" title="5.4 算法分析"></a>5.4 算法分析</h3><p>归并排序是一种稳定的排序方法。和选择排序一样，归并排序的性能不受输入数据的影响，但表现比选择排序好的多，因为始终都是O(nlogn）的时间复杂度。代价是需要额外的内存空间。</p><h2 id="6、快速排序（Quick-Sort）"><a href="#6、快速排序（Quick-Sort）" class="headerlink" title="6、快速排序（Quick Sort）"></a>6、快速排序（Quick Sort）</h2><p>快速排序的基本思想：通过一趟排序将待排记录分隔成独立的两部分，其中一部分记录的关键字均比另一部分的关键字小，则可分别对这两部分记录继续进行排序，以达到整个序列有序。</p><h3 id="6-1-算法描述"><a href="#6-1-算法描述" class="headerlink" title="6.1 算法描述"></a>6.1 算法描述</h3><p>快速排序使用分治法来把一个串（list）分为两个子串（sub-lists）。具体算法描述如下：</p><ul><li>从数列中挑出一个元素，称为 “基准”（pivot）；</li><li>重新排序数列，所有元素比基准值小的摆放在基准前面，所有元素比基准值大的摆在基准的后面（相同的数可以到任一边）。在这个分区退出之后，该基准就处于数列的中间位置。这个称为分区（partition）操作；</li><li>递归地（recursive）把小于基准值元素的子数列和大于基准值元素的子数列排序。</li></ul><h3 id="6-2-动图演示"><a href="#6-2-动图演示" class="headerlink" title="6.2 动图演示"></a>6.2 动图演示</h3><p><img src="https://images2017.cnblogs.com/blog/849589/201710/849589-20171015230936371-1413523412.gif" alt=""></p><h3 id="6-3-代码实现"><a href="#6-3-代码实现" class="headerlink" title="6.3 代码实现"></a>6.3 代码实现</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>    varlen <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">,</span>        partitionIndex<span class="token punctuation">,</span>        left <span class="token operator">=</span> typeofleft <span class="token operator">!=</span> <span class="token string">'number'</span><span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> left<span class="token punctuation">,</span>        right <span class="token operator">=</span> typeofright <span class="token operator">!=</span> <span class="token string">'number'</span><span class="token operator">?</span> len <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">:</span> right<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>        partitionIndex <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> partitionIndex<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> partitionIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    returnarr<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">partition</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left <span class="token punctuation">,</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">// 分区操作</span>    varpivot <span class="token operator">=</span> left<span class="token punctuation">,</span>                      <span class="token comment" spellcheck="true">// 设定基准值（pivot）</span>        index <span class="token operator">=</span> pivot <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>vari <span class="token operator">=</span> index<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> right<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>            index<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>           <span class="token punctuation">}</span>    <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> pivot<span class="token punctuation">,</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    returnindex<span class="token number">-1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>    vartemp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="7、堆排序（Heap-Sort）"><a href="#7、堆排序（Heap-Sort）" class="headerlink" title="7、堆排序（Heap Sort）"></a>7、堆排序（Heap Sort）</h2><p>堆排序（Heapsort）是指利用堆这种数据结构所设计的一种排序算法。堆积是一个近似完全二叉树的结构，并同时满足堆积的性质：即子结点的键值或索引总是小于（或者大于）它的父节点。</p><h3 id="7-1-算法描述"><a href="#7-1-算法描述" class="headerlink" title="7.1 算法描述"></a>7.1 算法描述</h3><ul><li>将初始待排序关键字序列(R1,R2….Rn)构建成大顶堆，此堆为初始的无序区；</li><li>将堆顶元素R[1]与最后一个元素R[n]交换，此时得到新的无序区(R1,R2,……Rn-1)和新的有序区(Rn),且满足R[1,2…n-1]&lt;=R[n]；</li><li>由于交换后新的堆顶R[1]可能违反堆的性质，因此需要对当前无序区(R1,R2,……Rn-1)调整为新堆，然后再次将R[1]与无序区最后一个元素交换，得到新的无序区(R1,R2….Rn-2)和新的有序区(Rn-1,Rn)。不断重复此过程直到有序区的元素个数为n-1，则整个排序过程完成。</li></ul><h3 id="7-2-动图演示"><a href="#7-2-动图演示" class="headerlink" title="7.2 动图演示"></a>7.2 动图演示</h3><p><img src="https://images2017.cnblogs.com/blog/849589/201710/849589-20171015231308699-356134237.gif" alt=""></p><h3 id="7-3-代码实现"><a href="#7-3-代码实现" class="headerlink" title="7.3 代码实现"></a>7.3 代码实现</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> len<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 因为声明的多个函数都需要数据长度，所以把len设置成为全局变量</span><span class="token keyword">function</span> <span class="token function">buildMaxHeap</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">// 建立大顶堆</span>    len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>vari <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>len<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">heapify</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">heapify</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">// 堆调整</span>    varleft <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>        right <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span>        largest <span class="token operator">=</span> i<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>left <span class="token operator">&lt;</span> len <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>largest<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        largest <span class="token operator">=</span> left<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>right <span class="token operator">&lt;</span> len <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>largest<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        largest <span class="token operator">=</span> right<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>largest <span class="token operator">!=</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> largest<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">heapify</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> largest<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>    vartemp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">heapSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">buildMaxHeap</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>vari <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>        len<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token function">heapify</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    returnarr<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="8、计数排序（Counting-Sort）"><a href="#8、计数排序（Counting-Sort）" class="headerlink" title="8、计数排序（Counting Sort）"></a>8、计数排序（Counting Sort）</h2><p>计数排序不是基于比较的排序算法，其核心在于将输入的数据值转化为键存储在额外开辟的数组空间中。 作为一种线性时间复杂度的排序，计数排序要求输入的数据必须是有确定范围的整数。</p><h3 id="8-1-算法描述"><a href="#8-1-算法描述" class="headerlink" title="8.1 算法描述"></a>8.1 算法描述</h3><ul><li>找出待排序的数组中最大和最小的元素；</li><li>统计数组中每个值为i的元素出现的次数，存入数组C的第i项；</li><li>对所有的计数累加（从C中的第一个元素开始，每一项和前一项相加）；</li><li>反向填充目标数组：将每个元素i放在新数组的第C(i)项，每放一个元素就将C(i)减去1。</li></ul><h3 id="8-2-动图演示"><a href="#8-2-动图演示" class="headerlink" title="8.2 动图演示"></a>8.2 动图演示</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702172556.gif" alt=""></p><h3 id="8-3-代码实现"><a href="#8-3-代码实现" class="headerlink" title="8.3 代码实现"></a>8.3 代码实现</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">countingSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> maxValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    varbucket <span class="token operator">=</span> <span class="token function">newArray</span><span class="token punctuation">(</span>maxValue <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        sortedIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        arrLen <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">,</span>        bucketLen <span class="token operator">=</span> maxValue <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>vari <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arrLen<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>bucket<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            bucket<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        bucket<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>varj <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bucketLen<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>bucket<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            arr<span class="token punctuation">[</span>sortedIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">;</span>            bucket<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    returnarr<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="8-4-算法分析"><a href="#8-4-算法分析" class="headerlink" title="8.4 算法分析"></a>8.4 算法分析</h3><p>计数排序是一个稳定的排序算法。当输入的元素是 n 个 0到 k 之间的整数时，时间复杂度是O(n+k)，空间复杂度也是O(n+k)，其排序速度快于任何比较排序算法。当k不是很大并且序列比较集中时，计数排序是一个很有效的排序算法。</p><h2 id="9、桶排序（Bucket-Sort）"><a href="#9、桶排序（Bucket-Sort）" class="headerlink" title="9、桶排序（Bucket Sort）"></a>9、桶排序（Bucket Sort）</h2><p>桶排序是计数排序的升级版。它利用了函数的映射关系，高效与否的关键就在于这个映射函数的确定。桶排序 (Bucket sort)的工作的原理：假设输入数据服从均匀分布，将数据分到有限数量的桶里，每个桶再分别排序（有可能再使用别的排序算法或是以递归方式继续使用桶排序进行排）。</p><h3 id="9-1-算法描述"><a href="#9-1-算法描述" class="headerlink" title="9.1 算法描述"></a>9.1 算法描述</h3><ul><li>设置一个定量的数组当作空桶；</li><li>遍历输入数据，并且把数据一个一个放到对应的桶里去；</li><li>对每个不是空的桶进行排序；</li><li>从不是空的桶里把排好序的数据拼接起来。 </li></ul><h3 id="9-2-图片演示"><a href="#9-2-图片演示" class="headerlink" title="9.2 图片演示"></a>9.2 图片演示</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702172632.png" alt=""></p><h3 id="9-3-代码实现"><a href="#9-3-代码实现" class="headerlink" title="9.3 代码实现"></a>9.3 代码实现</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">bucketSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> bucketSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      returnarr<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    vari<span class="token punctuation">;</span>    varminValue <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    varmaxValue <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> minValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>          minValue <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 输入数据的最小值</span>      <span class="token punctuation">}</span> <span class="token function">elseif</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> maxValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>          maxValue <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 输入数据的最大值</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 桶的初始化</span>    varDEFAULT_BUCKET_SIZE <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 设置桶的默认数量为5</span>    bucketSize <span class="token operator">=</span> bucketSize <span class="token operator">||</span> DEFAULT_BUCKET_SIZE<span class="token punctuation">;</span>    varbucketCount <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>maxValue <span class="token operator">-</span> minValue<span class="token punctuation">)</span> <span class="token operator">/</span> bucketSize<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>      varbuckets <span class="token operator">=</span> <span class="token function">newArray</span><span class="token punctuation">(</span>bucketCount<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> buckets<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        buckets<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 利用映射函数将数据分配到各个桶中</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        buckets<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> minValue<span class="token punctuation">)</span> <span class="token operator">/</span> bucketSize<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    arr<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> buckets<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">insertionSort</span><span class="token punctuation">(</span>buckets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment" spellcheck="true">// 对每个桶进行排序，这里使用了插入排序</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>varj <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> buckets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>buckets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                             <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    returnarr<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="9-4-算法分析"><a href="#9-4-算法分析" class="headerlink" title="9.4 算法分析"></a>9.4 算法分析</h3><p>桶排序最好情况下使用线性时间O(n)，桶排序的时间复杂度，取决与对各个桶之间数据进行排序的时间复杂度，因为其它部分的时间复杂度都为O(n)。很显然，桶划分的越小，各个桶之间的数据越少，排序所用的时间也会越少。但相应的空间消耗就会增大。 </p><h2 id="10、基数排序（Radix-Sort）"><a href="#10、基数排序（Radix-Sort）" class="headerlink" title="10、基数排序（Radix Sort）"></a>10、基数排序（Radix Sort）</h2><p>基数排序是按照低位先排序，然后收集；再按照高位排序，然后再收集；依次类推，直到最高位。有时候有些属性是有优先级顺序的，先按低优先级排序，再按高优先级排序。最后的次序就是高优先级高的在前，高优先级相同的低优先级高的在前。</p><h3 id="10-1-算法描述"><a href="#10-1-算法描述" class="headerlink" title="10.1 算法描述"></a>10.1 算法描述</h3><ul><li>取得数组中的最大数，并取得位数；</li><li>arr为原始数组，从最低位开始取每个位组成radix数组；</li><li>对radix进行计数排序（利用计数排序适用于小范围数的特点）；</li></ul><h3 id="10-2-动图演示"><a href="#10-2-动图演示" class="headerlink" title="10.2 动图演示"></a>10.2 动图演示</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702172707.gif" alt=""></p><h3 id="10-3-代码实现"><a href="#10-3-代码实现" class="headerlink" title="10.3 代码实现"></a>10.3 代码实现</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">radixSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> maxDigit<span class="token punctuation">)</span> <span class="token punctuation">{</span>    varmod <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    vardev <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>vari <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxDigit<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">,</span> dev <span class="token operator">*</span><span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> mod <span class="token operator">*</span><span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>varj <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            varbucket <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">%</span> mod<span class="token punctuation">)</span> <span class="token operator">/</span> dev<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>counter<span class="token punctuation">[</span>bucket<span class="token punctuation">]</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                counter<span class="token punctuation">[</span>bucket<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            counter<span class="token punctuation">[</span>bucket<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        varpos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>varj <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> counter<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            varvalue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>counter<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value <span class="token operator">=</span> counter<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                      arr<span class="token punctuation">[</span>pos<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>                <span class="token punctuation">}</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    returnarr<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="10-4-算法分析"><a href="#10-4-算法分析" class="headerlink" title="10.4 算法分析"></a>10.4 算法分析</h3><p>基数排序基于分别排序，分别收集，所以是稳定的。但基数排序的性能比桶排序要略差，每一次关键字的桶分配都需要O(n)的时间复杂度，而且分配之后得到新的关键字序列又需要O(n)的时间复杂度。假如待排数据可以分为d个关键字，则基数排序的时间复杂度将是O(d*2n) ，当然d要远远小于n，因此基本上还是线性级别的。</p><p>基数排序的空间复杂度为O(n+k)，其中k为桶的数量。一般来说n&gt;&gt;k，因此额外空间需要大概n个左右。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 前端面试题 </tag>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端路由的实现方法</title>
      <link href="/2020/07/02/qian-duan-lu-you-de-shi-xian-fang-fa/"/>
      <url>/2020/07/02/qian-duan-lu-you-de-shi-xian-fang-fa/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：</p><p><a href="https://zhuanlan.zhihu.com/p/88895539" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/88895539</a></p><p>作者：whincwu</p></blockquote><blockquote><p>在单页应用如此流行的今天，曾经令人惊叹的前端路由已经成为各大框架的基础标配，每个框架都提供了强大的路由功能，导致路由实现变的复杂。想要搞懂路由内部实现还是有些困难的，但是如果只想了解路由实现基本原理还是比较简单的。本文针对前端路由主流的实现方式 hash 和 history，提供了原生JS/React/Vue 共计六个版本供参考，每个版本的实现代码约 25~40 行左右（含空行）。</p></blockquote><h2 id="什么是前端路由？"><a href="#什么是前端路由？" class="headerlink" title="什么是前端路由？"></a><strong>什么是前端路由？</strong></h2><p>路由的概念来源于服务端，在服务端中路由描述的是 URL 与处理函数之间的映射关系。</p><p>在 Web 前端单页应用 SPA(Single Page Application)中，路由描述的是 URL 与 UI 之间的映射关系，这种映射是单向的，即 URL 变化引起 UI 更新（无需刷新页面）。</p><h2 id="如何实现前端路由？"><a href="#如何实现前端路由？" class="headerlink" title="如何实现前端路由？"></a><strong>如何实现前端路由？</strong></h2><p>要实现前端路由，需要解决两个核心问题：</p><ol><li>如何改变 URL 却不引起页面刷新？</li><li>如何检测 URL 变化了？</li></ol><p>下面分别使用 hash 和 history 两种实现方式回答上面的两个核心问题。</p><p><strong>hash 实现</strong></p><ol><li>hash 是 URL 中 hash (<code>#</code>) 及后面的那部分，常用作锚点在页面内进行导航，改变 URL 中的 hash 部分不会引起页面刷新</li><li>通过 <a href="https://link.zhihu.com/?target=https%3A//developer.mozilla.org/en-US/docs/Web/API/Window/hashchange_event">hashchange</a> 事件监听 URL 的变化，改变 URL 的方式只有这几种：通过浏览器前进后退改变 URL、通过<code>标签改变 URL、通过wind</code>ow.location改变URL，这几种情况改变 URL 都会触发 hashchange 事件</li></ol><p><strong>history 实现</strong></p><ol><li>history 提供了 pushState 和 replaceState 两个方法，这两个方法改变 URL 的 path 部分不会引起页面刷新</li><li>history 提供类似 hashchange 事件的 <a href="https://link.zhihu.com/?target=https%3A//developer.mozilla.org/en-US/docs/Web/API/Window/popstate_event">popstate</a> 事件，但 popstate 事件有些不同：通过浏览器前进后退改变 URL 时会触发 popstate 事件，通过<code>pushState/replaceState</code>或标签改变 URL 不会触发 popstate 事<code>件。好在我们可以拦截 pushState/r</code>eplaceState的调用和标签的点击事件来检测 URL 变化，所以监听 URL 变化可以实现，只是没有 hashchange 那么方便。</li></ol><h2 id="原生JS版前端路由实现"><a href="#原生JS版前端路由实现" class="headerlink" title="原生JS版前端路由实现"></a><strong>原生JS版前端路由实现</strong></h2><p>基于上节讨论的两种实现方式，分别实现 hash 版本和 history 版本的路由，示例使用原生 HTML/JS 实现，不依赖任何框架。</p><h3 id="基于-hash-实现"><a href="#基于-hash-实现" class="headerlink" title="基于 hash 实现"></a><strong>基于 hash 实现</strong></h3><p>运行效果：</p><p><img src="https://pic2.zhimg.com/80/v2-782e7d62701ec552ad321e80cded2c9d_720w.jpg" alt="img"></p><p>HTML 部分：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>ref="">    <span class="token comment" spellcheck="true">&lt;!-- 定义路由 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#/home<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#/about<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>about<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>ref="">    <span class="token comment" spellcheck="true">&lt;!-- 渲染路由对应的 UI --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>routeView<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><p>JavaScript 部分：</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 页面加载完不会触发 hashchange，这里主动触发一次 hashchange 事件</span>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> onLoad<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 监听路由变化</span>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> onHashChange<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 路由视图</span><span class="token keyword">var</span> routerView <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">function</span> onLoad <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  routerView <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#routeView'</span><span class="token punctuation">)</span>  <span class="token function">onHashChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 路由变化时，根据路由渲染对应 UI</span><span class="token keyword">function</span> onHashChange <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token string">'#/home'</span><span class="token punctuation">:</span>      routerView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'Home'</span>      <span class="token keyword">return</span>    <span class="token keyword">case</span> <span class="token string">'#/about'</span><span class="token punctuation">:</span>      routerView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'About'</span>      <span class="token keyword">return</span>    <span class="token keyword">default</span><span class="token punctuation">:</span>      <span class="token keyword">return</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="基于-history-实现"><a href="#基于-history-实现" class="headerlink" title="基于 history 实现"></a><strong>基于 history 实现</strong></h3><p>运行效果：</p><p><img src="https://pic2.zhimg.com/80/v2-18fe5194ce0179a4385c9ec342150199_720w.jpg" alt="img"></p><p>HTML 部分：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/home<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/about<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>about<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>routeView<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><p>JavaScript 部分：</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 页面加载完不会触发 hashchange，这里主动触发一次 hashchange 事件</span>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> onLoad<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 监听路由变化</span>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> onPopState<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 路由视图</span><span class="token keyword">var</span> routerView <span class="token operator">=</span> <span class="token keyword">null</span><span class="token keyword">function</span> onLoad <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  routerView <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#routeView'</span><span class="token punctuation">)</span>  <span class="token function">onPopState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> href<span class="token operator">=</span><span class="token string">""</span><span class="token operator">></span>  <span class="token comment" spellcheck="true">// 拦截 &lt;a> 标签点击事件默认行为， 点击时使用 pushState 修改 URL并更新手动 UI，从而实现点击链接更新 URL 和 UI 的效果。</span>  <span class="token keyword">var</span> linkList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'a[href]'</span><span class="token punctuation">)</span>  linkList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>el <span class="token operator">=</span><span class="token operator">></span> el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token function">onPopState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 路由变化时，根据路由渲染对应 UI</span><span class="token keyword">function</span> onPopState <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token string">'/home'</span><span class="token punctuation">:</span>      routerView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'Home'</span>      <span class="token keyword">return</span>    <span class="token keyword">case</span> <span class="token string">'/about'</span><span class="token punctuation">:</span>      routerView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'About'</span>      <span class="token keyword">return</span>    <span class="token keyword">default</span><span class="token punctuation">:</span>      <span class="token keyword">return</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="React-版前端路由实现"><a href="#React-版前端路由实现" class="headerlink" title="React 版前端路由实现"></a><strong>React 版前端路由实现</strong></h2><h3 id="基于-hash-实现-1"><a href="#基于-hash-实现-1" class="headerlink" title="基于 hash 实现"></a><strong>基于 hash 实现</strong></h3><p>运行效果：</p><p><img src="https://pic1.zhimg.com/80/v2-ac57cbef2ae205c65fc5542d79653f48_720w.jpg" alt="img"></p><p>使用方式和 react-router 类似：</p><pre class=" language-html"><code class="language-html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BrowserRouter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/home<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>about<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>    &lt;Route path="/home" render={() => <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>} />    &lt;Route path="/about" render={() => <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>About<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>} />  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BrowserRouter</span><span class="token punctuation">></span></span></code></pre><p>BrowserRouter 实现</p><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">BrowserRouter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>  state <span class="token operator">=</span> <span class="token punctuation">{</span>    currentPath<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">extractHashPath</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  onHashChange <span class="token operator">=</span> e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> currentPath <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">extractHashPath</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>newURL<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onHashChange:"</span><span class="token punctuation">,</span> currentPath<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> currentPath <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"hashchange"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onHashChange<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"hashchange"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onHashChange<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token operator">&lt;</span>RouteContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>currentPath<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>currentPath<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>RouteContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Route 实现</p><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token punctuation">,</span> render <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>RouteContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>    <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span>currentPath<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> currentPath <span class="token operator">===</span> path <span class="token operator">&amp;&amp;</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>RouteContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Link 实现</p><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> to<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>a <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> href<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"#"</span> <span class="token operator">+</span> to<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span></code></pre><h3 id="基于-history-实现-1"><a href="#基于-history-实现-1" class="headerlink" title="基于 history 实现"></a><strong>基于 history 实现</strong></h3><p>运行效果：</p><p><img src="https://pic2.zhimg.com/80/v2-8949a60fe0ae19b988b1cdfd341303f9_720w.jpg" alt="img"></p><p>使用方式和 react-router 类似：</p><pre class=" language-html"><code class="language-html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HistoryRouter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/home<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>about<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>    &lt;Route path="/home" render={() => <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>} />    &lt;Route path="/about" render={() => <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>About<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>} />  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HistoryRouter</span><span class="token punctuation">></span></span></code></pre><p>HistoryRouter 实现</p><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HistoryRouter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>  state <span class="token operator">=</span> <span class="token punctuation">{</span>    currentPath<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">extractUrlPath</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  onPopState <span class="token operator">=</span> e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> currentPath <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">extractUrlPath</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onPopState:"</span><span class="token punctuation">,</span> currentPath<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> currentPath <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"popstate"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onPopState<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"popstate"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onPopState<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token operator">&lt;</span>RouteContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>currentPath<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>currentPath<span class="token punctuation">,</span> onPopState<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onPopState<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>RouteContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Route 实现</p><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token punctuation">,</span> render <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>RouteContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>    <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span>currentPath<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> currentPath <span class="token operator">===</span> path <span class="token operator">&amp;&amp;</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>RouteContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Link 实现</p><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> to<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>RouteContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>    <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> onPopState <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>      <span class="token operator">&lt;</span>a        href<span class="token operator">=</span><span class="token string">""</span>        <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span>        onClick<span class="token operator">=</span><span class="token punctuation">{</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">onPopState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span>      <span class="token operator">/</span><span class="token operator">></span>    <span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>RouteContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="Vue-版本前端路由实现"><a href="#Vue-版本前端路由实现" class="headerlink" title="Vue 版本前端路由实现"></a><strong>Vue 版本前端路由实现</strong></h2><h3 id="基于-hash-实现-2"><a href="#基于-hash-实现-2" class="headerlink" title="基于 hash 实现"></a><strong>基于 hash 实现</strong></h3><p>运行效果：</p><p><img src="https://pic1.zhimg.com/80/v2-b36cfec355473686eaba52e4ce02e7b4_720w.jpg" alt="img"></p><p>使用方式和 vue-router 类似（vue-router 通过插件机制注入路由，但是这样隐藏了实现细节，为了保持代码直观，这里没有使用 Vue 插件封装）：</p><pre class=" language-js"><code class="language-js">    <span class="token operator">&lt;</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>ul<span class="token operator">></span>        <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>router<span class="token operator">-</span>link to<span class="token operator">=</span><span class="token string">"/home"</span><span class="token operator">></span>home<span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>link<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>        <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>router<span class="token operator">-</span>link to<span class="token operator">=</span><span class="token string">"/about"</span><span class="token operator">></span>about<span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>link<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>      <span class="token operator">&lt;</span>router<span class="token operator">-</span>view<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token string">'/home'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    template<span class="token punctuation">:</span> <span class="token string">'&lt;h2>Home&lt;/h2>'</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token string">'/about'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    template<span class="token punctuation">:</span> <span class="token string">'&lt;h2>About&lt;/h2>'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">'.vue.hash'</span><span class="token punctuation">,</span>  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token string">'router-view'</span><span class="token punctuation">:</span> RouterView<span class="token punctuation">,</span>    <span class="token string">'router-link'</span><span class="token punctuation">:</span> RouterLink  <span class="token punctuation">}</span><span class="token punctuation">,</span>  beforeCreate <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$routes <span class="token operator">=</span> routes  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>router-view 实现:</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>  <span class="token operator">&lt;</span>component <span class="token punctuation">:</span>is<span class="token operator">=</span><span class="token string">"routeView"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token keyword">import</span> utils <span class="token keyword">from</span> <span class="token string">'~/utils.js'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  data <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      routeView<span class="token punctuation">:</span> <span class="token keyword">null</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  created <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>boundHashChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onHashChange<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  beforeMount <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boundHashChange<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  mounted <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onHashChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boundHashChange<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    onHashChange <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> path <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">extractHashPath</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>routeView <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>$routes<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">null</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'vue:hashchange:'</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>router-link 实现:</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>  <span class="token operator">&lt;</span>a @click<span class="token punctuation">.</span>prevent<span class="token operator">=</span><span class="token string">"onClick"</span> href<span class="token operator">=</span><span class="token string">''</span><span class="token operator">></span><span class="token operator">&lt;</span>slot<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>    to<span class="token punctuation">:</span> String  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    onClick <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token string">'#'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><h3 id="基于-history-实现-2"><a href="#基于-history-实现-2" class="headerlink" title="基于 history 实现"></a><strong>基于 history 实现</strong></h3><p>运行效果：</p><p><img src="https://pic1.zhimg.com/80/v2-a4c3343e8fb38d6590e02cba1173dc10_720w.jpg" alt="img"></p><p>使用方式和 vue-router 类似：</p><pre class=" language-js"><code class="language-js">    <span class="token operator">&lt;</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>ul<span class="token operator">></span>        <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>router<span class="token operator">-</span>link to<span class="token operator">=</span><span class="token string">"/home"</span><span class="token operator">></span>home<span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>link<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>        <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>router<span class="token operator">-</span>link to<span class="token operator">=</span><span class="token string">"/about"</span><span class="token operator">></span>about<span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>link<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>      <span class="token operator">&lt;</span>router<span class="token operator">-</span>view<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token string">'/home'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    template<span class="token punctuation">:</span> <span class="token string">'&lt;h2>Home&lt;/h2>'</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token string">'/about'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    template<span class="token punctuation">:</span> <span class="token string">'&lt;h2>About&lt;/h2>'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">'.vue.history'</span><span class="token punctuation">,</span>  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token string">'router-view'</span><span class="token punctuation">:</span> RouterView<span class="token punctuation">,</span>    <span class="token string">'router-link'</span><span class="token punctuation">:</span> RouterLink  <span class="token punctuation">}</span><span class="token punctuation">,</span>  created <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$routes <span class="token operator">=</span> routes    <span class="token keyword">this</span><span class="token punctuation">.</span>boundPopState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onPopState<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  beforeMount <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boundPopState<span class="token punctuation">)</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span>  beforeDestroy <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boundPopState<span class="token punctuation">)</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    onPopState <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>router-view 实现：</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>  <span class="token operator">&lt;</span>component <span class="token punctuation">:</span>is<span class="token operator">=</span><span class="token string">"routeView"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token keyword">import</span> utils <span class="token keyword">from</span> <span class="token string">'~/utils.js'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  data <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      routeView<span class="token punctuation">:</span> <span class="token keyword">null</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  created <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>boundPopState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onPopState<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  beforeMount <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boundPopState<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boundPopState<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    onPopState <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> path <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">extractUrlPath</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>routeView <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>$routes<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">null</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Vue] popstate:'</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>router-link 实现:</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>  <span class="token operator">&lt;</span>a @click<span class="token punctuation">.</span>prevent<span class="token operator">=</span><span class="token string">"onClick"</span> href<span class="token operator">=</span><span class="token string">''</span><span class="token operator">></span><span class="token operator">&lt;</span>slot<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>    to<span class="token punctuation">:</span> String  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    onClick <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a><strong>小结</strong></h2><p>前端路由的核心实现原理很简单，但是结合具体框架后，框架增加了很多特性，如动态路由、路由参数、路由动画等等，这些导致路由实现变的复杂。本文去粗取精只针对前端路由最核心部分的实现进行分析，并基于 hash 和 history 两种模式，分别提供原生JS/React/Vue 三种实现，共计六个实现版本供参考，希望对你有所帮助。</p><p>所有的示例的代码放在 Github 仓库：<a href="https://link.zhihu.com/?target=https%3A//github.com/whinc/web-router-principle">https://github.com/whinc/web-router-principle</a></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a><strong>参考</strong></h2><ul><li><a href="https://link.zhihu.com/?target=http%3A//www.cnblogs.com/xiaobie123/p/6357724.html">详解单页面路由的几种实现原理</a></li><li><a href="https://link.zhihu.com/?target=https%3A//github.com/youngwind/blog/issues/109">单页面应用路由实现原理：以 React-Router 为例</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS继承的实现方法</title>
      <link href="/2020/07/02/js-ji-cheng-de-shi-xian-fang-fa/"/>
      <url>/2020/07/02/js-ji-cheng-de-shi-xian-fang-fa/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://www.cnblogs.com/cythia/p/11175343.html" target="_blank" rel="noopener">https://www.cnblogs.com/cythia/p/11175343.html</a></p></blockquote><h2 id="ES5的继承方式"><a href="#ES5的继承方式" class="headerlink" title="ES5的继承方式"></a>ES5的继承方式</h2><h3 id="方式一-借助构造函数实现继承"><a href="#方式一-借助构造函数实现继承" class="headerlink" title="方式一:借助构造函数实现继承"></a>方式一:借助构造函数实现继承</h3><p>这里使用的原理就是在Child里面,把Parent的this指向改为是Child的this指向,从而实现继承</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token punctuation">}</span>Parent<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>saiHi <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Parent<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>gender <span class="token operator">=</span> gender<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">let</span> child <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"王磊"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 王磊</span>child<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Uncaught TypeError:child.sayHi is not a function</span></code></pre><p><strong>缺点:只能解决属性的继承,使用属性的值不重复,但是父级类别的方法不能继承</strong></p><h3 id="方式二-借助原型链实现继承"><a href="#方式二-借助原型链实现继承" class="headerlink" title="方式二:借助原型链实现继承"></a>方式二:借助原型链实现继承</h3><p>第二种方式就是把Child的原型改为是Parent的实例,从而实现继承</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> gender<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>gender <span class="token operator">=</span> gender<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">}</span>Parent<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>eat <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"晚餐时间到"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span><span class="token punctuation">}</span>Child<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token string">"李白"</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> child <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>child<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>list<span class="token punctuation">,</span> child2<span class="token punctuation">.</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1,2,3] [1,2,3]</span>child<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1,2,3,4]        </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1,2,3,4]</span></code></pre><p><strong>缺点:因为Child的原型对象都是New Parent,所以实例化出来的对象的属性都是一样的,而且Parent上面的引用类型只要有一个实例对象修改了,其他也会跟着修改.因为他们原型对象都是共用的</strong></p><h3 id="方式三-组合型"><a href="#方式三-组合型" class="headerlink" title="方式三:组合型"></a>方式三:组合型</h3><p>方式三的话是结合了方式一和方式二来实现继承</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span>school<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>school <span class="token operator">=</span> school<span class="token punctuation">;</span><span class="token punctuation">}</span>Person<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>skill <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"学习"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span>school<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Parent<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> school<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>gender <span class="token operator">=</span> gender<span class="token punctuation">;</span><span class="token punctuation">}</span>Student<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Person<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span><span class="token keyword">let</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"广铁一中"</span><span class="token punctuation">,</span> <span class="token string">"王菲菲"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token string">"女"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>prototype <span class="token operator">===</span> Person<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span></code></pre><p><strong>缺点:父类的原型对象调用了两次,没有必要,而且student实例的构造函数是来自于Person</strong></p><h3 id="方式四-组合方式优化"><a href="#方式四-组合方式优化" class="headerlink" title="方式四:组合方式优化"></a>方式四:组合方式优化</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> play<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>play <span class="token operator">=</span> play<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> play<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Parent<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> play<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span><span class="token punctuation">}</span>Child<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Parent<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span><span class="token keyword">let</span> child <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"玩"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">,</span> <span class="token string">"吃"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> child2<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>prototype <span class="token operator">===</span> child2<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token boolean">true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 构造函数指向的是Parent</span></code></pre><p><strong>缺点:child实例的构造函数来自于Parent</strong></p><h3 id="方式五-组方式优化"><a href="#方式五-组方式优化" class="headerlink" title="方式五: 组方式优化"></a>方式五: 组方式优化</h3><p>只是这种方式的话,你必须得理解Object.create()方法的使用,他创建的对象是在原型上面的</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> play<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>play <span class="token operator">=</span> play<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> play<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Parent<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> play<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span><span class="token punctuation">}</span>Child<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Parent<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 隔离了父类和子类的构造函数,父类的添加到了__proto__属性上</span>Child<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Child<span class="token keyword">let</span> child <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"玩"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">,</span> <span class="token string">"吃"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
            <tag> ES6语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>virtual DOM原理</title>
      <link href="/2020/07/02/virtualdom-yuan-li/"/>
      <url>/2020/07/02/virtualdom-yuan-li/</url>
      
        <content type="html"><![CDATA[<blockquote><p>文章内有版权所在，不方便转载，所以只贴出链接</p><p><a href="https://blog.csdn.net/dichu2296/article/details/102233749?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase" target="_blank" rel="noopener">推荐文章</a></p><p><a href="https://blog.csdn.net/weixin_41223912/article/details/83385820?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.nonecase" target="_blank" rel="noopener">参考文章1</a></p><p><a href="https://blog.csdn.net/dichu2296/article/details/102233749?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase" target="_blank" rel="noopener">参考文章2</a></p><p><a href="https://blog.csdn.net/u013369549/article/details/86287418?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase" target="_blank" rel="noopener">详解文章</a></p></blockquote><h2 id="原理简介"><a href="#原理简介" class="headerlink" title="原理简介"></a>原理简介</h2><p>1，数据和模板相结合生成虚拟dom</p><p>2，虚拟dom转化成真实dom渲染到页面上</p><p>3，当数据发生改变时，新的数据和模板相结合会生成新的虚拟dom</p><p>4，新旧虚拟dom进行比对找差异</p><p>5，找到差异后根据差异改变dom</p><p>6，老的虚拟dom被清除，新的虚拟dom变成老的虚拟dom</p><h2 id="简明原理"><a href="#简明原理" class="headerlink" title="简明原理"></a>简明原理</h2><h3 id="1、定义："><a href="#1、定义：" class="headerlink" title="1、定义："></a>1、定义：</h3><p>虚拟DOM其实就是一棵以 <code>JavaScript 对象</code>( VNode 节点)作为基础的树，用对象属性来描述节点， 实际上它只是一层对真实 DOM 的抽象。最终可以通过一系列操作使这棵树映射到真实环境上。</p><p>相当于在js与DOM之间做了一个缓存，利用patch<code>（diff算法）</code>对比新旧虚拟DOM记录到一个对象中按需更新， 最后创建真实的DOM</p><h3 id="2、虚拟dom原理流程"><a href="#2、虚拟dom原理流程" class="headerlink" title="2、虚拟dom原理流程"></a>2、虚拟dom原理流程</h3><p><strong><code>模板 ==&gt; 渲染函数 ==&gt; 虚拟DOM树 ==&gt; 真实DOM</code></strong></p><p>vuejs通过编译将模板（template）转成渲染函数（render），执行渲染函数可以得到一个虚拟节点树</p><p>在对 Model 进行操作的时候，会触发对应 Dep 中的 Watcher 对象。Watcher 对象会调用对应的 update 来修改视图。</p><p>图解：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702112853" alt=""></p><blockquote><p><strong>渲染函数：</strong> 渲染函数是用来生成<code>Virtual DOM</code>的。<br><strong>VNode虚拟节点：</strong> 它可以代表一个真实的dom节点。通过 <code>createElement</code> 方法能将 <code>VNode</code> 渲染成 <code>dom</code> 节点。简单地说，vnode可以理解成<code>节点描述对象</code>，它描述了应该怎样去创建真实的DOM节点<br><strong>patch(也叫做patching算法)：</strong> 虚拟DOM最核心的部分，它可以将vNode渲染成真实的DOM，这个过程是<code>对比新旧虚拟节点</code>之间有哪些不同，然后根据对比结果找出需要更新的的节点进行更新</p></blockquote><h3 id="3、虚拟DOM好处"><a href="#3、虚拟DOM好处" class="headerlink" title="3、虚拟DOM好处"></a>3、虚拟DOM好处</h3><p>具备跨平台的优势–由于 Virtual DOM 是以 <code>JavaScript 对象</code>为基础而不依赖真实平台环境，所以使它具有了跨平台的能力，比如说浏览器平台、Weex、Node 等。<br>操作 DOM 慢，js运行效率高。我们可以将DOM对比操作放在<code>JS层</code>，提高效率。运用patching算法来计算出真正需要更新的节点，最大限度地<code>减少DOM操作</code>，从而显著提高性能。Virtual DOM 本质上就是在 JS 和 DOM 之间做了一个缓存。<br>提升渲染性能 Virtual DOM的优势不在于单次的操作，而是在大量、频繁的数据更新下，能够对视图进行<code>合理、高效的更新</code><br>虚拟DOM就是为了<code>解决浏览器性能问题</code>而被设计出来的</p><h2 id="详细原理"><a href="#详细原理" class="headerlink" title="详细原理"></a>详细原理</h2><h4 id="原理讲解"><a href="#原理讲解" class="headerlink" title="原理讲解"></a>原理讲解</h4><p>Vue的核心是双向绑定和虚拟DOM</p><ul><li><p>虚拟Dom（vdom） 参考：Vue原理解析之Virtual Dom， ppt</p><p>Dom操作是比较浪费时间和性能的，当数据量很大时，更新DOM是非常耗费性能的操作。<br>当我们使用Javascript来修改我们的页面，浏览器已经做了一些工作，以找到DOM节点进行更改，例如：</p><p>document.getElementById(‘myId’).appendChild(myNewNode);<br>1<br>在现代的应用中，会有成千上万数量个DOM节点。所以在数据更新的时候产生的计算非常昂贵。<br>琐碎且频繁的更新会使页面缓慢，同时这也是不可避免的。虚拟Dom技术就是用于提高页面更新的速度。</p><p>简单来讲虚拟Dom技术的核心就是使用js对象来替代dom节点。<br>举个栗子：</p><p>DOM节点在HTML文档中的表现通常是这样的</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>list<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>Item 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>Item 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span></code></pre><p>DOM节点也可以表示为一个JavaScript对象，就像这样</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//用Javascript代码表示DOM节点的伪代码</span>Let domNode <span class="token operator">=</span> <span class="token punctuation">{</span>  tag<span class="token punctuation">:</span> <span class="token string">'ul'</span>  attributes<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token string">'list'</span> <span class="token punctuation">}</span>  children<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token comment" spellcheck="true">//这里是 li</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>当我们更新虚拟节点时<span class="token comment" spellcheck="true">//更新虚拟DOM的代码</span>domNode<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'&lt;ul>Item 3&lt;/ul>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>如果我们用一个虚拟DOM，而不是直接调用像.getElementById的方法，这样只操作JavaScript对象，这样是相当方便的。</p><p>然后，再把更改的部分更新到真正的DOM，方法如下：</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//这个方法是调用DOM API来更改真正DOM的 它会分批执行从而获取更高的效率</span><span class="token function">sync</span><span class="token punctuation">(</span>originalDomNode<span class="token punctuation">,</span> domNode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>双向绑定</p><p>几种实现双向绑定的做法</p><p> 目前几种主流的mvc(vm)框架都实现了单向数据绑定，而我所理解的双向数据绑定无非就是在单向绑定的基础上给可输入元素（input、textare等）添加了change(input)事件，来动态修改model和 view，并没有多高深。所以无需太过介怀是实现的单向或双向绑定。</p><ul><li>发布者-订阅者模式（backbone.js）</li><li>脏值检查（angular.js） </li><li>数据劫持（vue.js）</li></ul><p><strong>发布者-订阅者模式:</strong> 一般通过sub, pub的方式实现数据和视图的绑定监听，更新数据方式通常做法是 vm.set(‘property’, value)，这里有篇文章讲的比较详细，有兴趣可点这里</p><p>这种方式现在毕竟太low了，我们更希望通过 vm.property = value这种方式更新数据，同时自动更新视图，于是有了下面两种方式</p><p><strong>脏值检查:</strong> angular.js 是通过脏值检测的方式比对数据是否有变更，来决定是否更新视图，最简单的方式就是通过 setInterval() 定时轮询检测数据变动，当然Google不会这么low，angular只有在指定的事件触发时进入脏值检测，大致如下：</p><ul><li>DOM事件，譬如用户输入文本，点击按钮等。( ng-click )</li><li>XHR响应事件 ( $http )</li><li>浏览器Location变更事件 ( $location )</li><li>Timer事件( timeout,timeout , timeout,interval )<br>执行 $digest() 或 $apply()</li></ul><p><strong>数据劫持:</strong> vue.js 则是采用数据劫持结合发布者-订阅者模式的方式，通过Object.defineProperty()来劫持各个属性的setter，getter，在数据变动时发布消息给订阅者，触发相应的监听回调。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707162855" alt=""></p><ul><li>当前台显示view发生变化了，它会实时反应到viewModel上，如果有需要，viewModel 会通过ajax等方法将改变的数据 传递给后台model</li><li>从后台model获取过来的数据，通过vm将值响应到前台UI上</li></ul><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707162907" alt=""></p><p>vm的核心是view 和 data</p><ul><li>当data 有变化的时候它通过Object.defineProperty(）方法中的set方法进行监控，并调用在此之前已经定义好data 和view的关系了的回调函数，来通知view进行数据的改变</li><li>而view 发生改变则是通过底层的input 事件来进行data的响应更改</li></ul><p>vue是通过Object.defineProperty()来实现数据劫持的</p><p>Object.defineProperty( )是用来做什么的？它可以来控制一个对象属性的一些特有操作，比如读写权、是否可以枚举，这里我们主要先来研究下它对应的两个描述属性get和set</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> Book<span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">var</span> name<span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>   Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Book<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>       <span class="token keyword">set</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>            name<span class="token operator">=</span> value<span class="token punctuation">;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你取了一个书名叫做'</span><span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span><span class="token punctuation">,</span>       <span class="token keyword">get</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span><span class="token string">'《'</span><span class="token operator">+</span> name<span class="token operator">+</span> <span class="token string">'》'</span>       <span class="token punctuation">}</span>   <span class="token punctuation">}</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Book<span class="token punctuation">)</span>   Book<span class="token punctuation">.</span>name<span class="token operator">=</span> <span class="token string">'vue权威指南'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 你取了一个书名叫做vue权威指南</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Book<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 《vue权威指南》</span>   <span class="token comment" spellcheck="true">// get 是在读取那么属性的时候触发的</span>   <span class="token comment" spellcheck="true">// set 是在设置属性值的时候触发的</span></code></pre><p>实现方法： <strong>观察者模式</strong></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707162951" alt=""></p><p>Observer（Objec.defineProperty中的set）</p><p>Observer（Objec.defineProperty中的set）监听data的变化，当data有变化的时候通知观察者列表Dep（里面有与data变化对应的update函数）,watcher负责向观察者列表里添加（订阅）对应的更新函数，Dep里的更新函数执行完了之后将最新的值更新到view上。</p><p>具体的代码实现可参考：<a href="https://www.cnblogs.com/libin-1/p/6893712.html" target="_blank" rel="noopener">https://www.cnblogs.com/libin-1/p/6893712.html</a></p><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p> 需预备es6一些语法，比较常用的es6的语法, es5的写法也可以，尽量使用javascript新标准</p><h4 id="什么是ES5"><a href="#什么是ES5" class="headerlink" title="什么是ES5"></a>什么是ES5</h4><p> 作为ECMAScript第五个版本（第四版因为过于复杂废弃了），增加特性如下。</p></li><li><p>strict模式</p><p>严格模式，限制一些用法，‘use strict’;</p></li><li><p>Array增加方法</p><p>增加了every、some 、forEach、filter 、indexOf、lastIndexOf、isArray、map、reduce、reduceRight方法</p><p>PS： 还有其他方法 Function.prototype.bind、String.prototype.trim、Date.now</p></li><li><p>Object方法</p><p>Object.getPrototypeOf</p><p>Object.create</p><p>Object.getOwnPropertyNames</p><p>Object.defineProperty</p><p>Object.getOwnPropertyDescriptor</p><p>Object.defineProperties</p><p>Object.keys</p><p>Object.preventExtensions / Object.isExtensible</p><p>Object.seal / Object.isSealed</p><p>Object.freeze / Object.isFrozen</p><p>PS：只讲有什么，不讲是什么。</p></li></ul><h4 id="什么是ES6"><a href="#什么是ES6" class="headerlink" title="什么是ES6"></a>什么是ES6</h4><p> ECMAScript6在保证向下兼容的前提下，提供大量新特性</p><h4 id="ES6特性如下"><a href="#ES6特性如下" class="headerlink" title="ES6特性如下"></a>ES6特性如下</h4><ul><li><p>块级作用域 关键字let, 常量const</p></li><li><p>赋值解构</p><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> singer <span class="token operator">=</span> <span class="token punctuation">{</span> first<span class="token punctuation">:</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> last<span class="token punctuation">:</span> <span class="token string">"Dylan"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">{</span> first<span class="token punctuation">:</span> f<span class="token punctuation">,</span> last<span class="token punctuation">:</span> l <span class="token punctuation">}</span> <span class="token operator">=</span> singer<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//  f = "Bob", l = "Dylan"</span><span class="token keyword">let</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// a =1  ,b =2 , c =3</span><span class="token keyword">let</span> <span class="token punctuation">[</span>all<span class="token punctuation">,</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token regex">/^(\d\d\d\d)-(\d\d)-(\d\d)$/</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"2015-10-25"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// x = 1, y = 2</span></code></pre></li><li><p>函数参数 - 默认值、参数打包、 数组展开（Default 、Rest 、Spread）</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//es6</span><span class="token keyword">function</span> <span class="token function">findArtist</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'lu'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token string">'26'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token operator">...</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//es5</span><span class="token keyword">function</span> <span class="token function">findArtist</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> _name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'lu'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> _age <span class="token operator">=</span> age <span class="token operator">||</span> <span class="token string">'26'</span><span class="token punctuation">;</span>    <span class="token operator">...</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//Rest</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">...</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// y is an Array</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> x <span class="token operator">*</span> y<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ['hello', true]</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">6</span><span class="token comment" spellcheck="true">//Spread</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token operator">+</span> z<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// Pass each elem of array as argument</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">6</span></code></pre></li><li><p>箭头函数 Arrow functions</p><p>简化了<a href="http://caibaojian.com/c/code" target="_blank" rel="noopener">代码</a>形式，默认return表达式结果</p><pre class=" language-js"><code class="language-js">cont b <span class="token operator">=</span> a <span class="token operator">=</span><span class="token operator">></span> a <span class="token operator">+</span> <span class="token string">'(demo)'</span><span class="token punctuation">;</span>cont b <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> <span class="token string">'(demo)'</span><span class="token punctuation">}</span></code></pre></li><li><p>字符串模板 Template strings</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> time <span class="token operator">=</span> <span class="token string">"today"</span><span class="token punctuation">;</span><span class="token template-string"><span class="token string">`Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, how are you </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>time<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?`</span></span><span class="token comment" spellcheck="true">// return "Hello Bob, how are you today?"</span></code></pre></li><li><p>Iterators（迭代器）+ for…of</p><pre class=" language-js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> n <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 打印a、b、c</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> info<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> val<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></li><li><p>Class</p><p>Class，有constructor、extends、super，但本质上是语法糖（对语言的功能并没有影响，但是更方便<a href="http://caibaojian.com/a-programmer/" target="_blank" rel="noopener">程序员</a>使用）。</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//es6</span><span class="token keyword">class</span> <span class="token class-name">Artist</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" performs "</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Singer</span> <span class="token keyword">extends</span> <span class="token class-name">Artist</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> song<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>song <span class="token operator">=</span> song<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"["</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>song <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//es5</span><span class="token keyword">function</span> <span class="token function">Artist</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>perform <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" performs "</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>Artist<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>perform <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" performs "</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">Singer</span><span class="token punctuation">(</span>song<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>song <span class="token operator">=</span> song<span class="token punctuation">;</span>    Artist<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>perform <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"["</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>song <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// es6</span><span class="token keyword">let</span> james <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singer</span><span class="token punctuation">(</span><span class="token string">"Etta James"</span><span class="token punctuation">,</span> <span class="token string">"At last"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>james <span class="token keyword">instanceof</span> <span class="token class-name">Artist</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// true</span>james <span class="token keyword">instanceof</span> <span class="token class-name">Singer</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// true</span>james<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "Etta James performs [At last]"</span><span class="token comment" spellcheck="true">//es5</span> Singer<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Artist<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> Singer<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Artist<span class="token punctuation">;</span> <span class="token keyword">var</span> james <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singer</span><span class="token punctuation">(</span><span class="token string">"Etta James"</span><span class="token punctuation">,</span> <span class="token string">"At last"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Modules</p><p>ES6的内置模块功能借鉴了CommonJS和AMD各自的优点：</p><p>(1).具有CommonJS的精简语法、唯一导出出口(single exports)和循环依赖(cyclic dependencies)的特点。</p><p>(2).类似AMD，支持异步加载和可配置的模块加载。</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// lib/math.js</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">var</span> pi <span class="token operator">=</span> <span class="token number">3.141593</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// app.js</span><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> math <span class="token keyword">from</span> <span class="token string">"lib/math"</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"2π = "</span> <span class="token operator">+</span> math<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>pi<span class="token punctuation">,</span> math<span class="token punctuation">.</span>pi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// otherApp.js</span><span class="token keyword">import</span> <span class="token punctuation">{</span>sum<span class="token punctuation">,</span> pi<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"lib/math"</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"2π = "</span> <span class="token operator">+</span> <span class="token function">sum</span><span class="token punctuation">(</span>pi<span class="token punctuation">,</span> pi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Module Loaders<span class="token punctuation">:</span><span class="token comment" spellcheck="true">// Dynamic loading – ‘System’ is default loader</span>System<span class="token punctuation">.</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'lib/math'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"2π = "</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>pi<span class="token punctuation">,</span> m<span class="token punctuation">.</span>pi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Directly manipulate module cache</span>System<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">,</span> <span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$<span class="token punctuation">:</span> $<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// WARNING: not yet finalized</span><span class="token comment" spellcheck="true">//es5 </span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;script language=javascript src='*.js'>&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ul><ul><li><p>Map + Set + WeakMap + WeakSet</p><p>四种集合类型，WeakMap、WeakSet作为属性键的对象如果没有别的变量在引用它们，则会被回收释放掉。</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// Sets</span><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"goodbye"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Maps</span><span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>m<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>m<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">;</span>m<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">34</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//WeakMap</span><span class="token keyword">var</span> wm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>wm<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">{</span> extra<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>wm<span class="token punctuation">.</span>size <span class="token operator">===</span> undefined<span class="token comment" spellcheck="true">// Weak Sets</span><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ws<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Because the added object has no other references, it will not be held in the set</span></code></pre></li></ul><ul><li><p>Math + Number + String + Array + Object APIs</p><p>一些新的API</p><pre class=" language-js"><code class="language-js">Number<span class="token punctuation">.</span>EPSILONNumber<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// false</span>Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">"NaN"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// false</span>Math<span class="token punctuation">.</span><span class="token function">acosh</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 1.762747174039086</span>Math<span class="token punctuation">.</span><span class="token function">hypot</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 5</span>Math<span class="token punctuation">.</span><span class="token function">imul</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 2</span><span class="token string">"abcde"</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"cd"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span><span class="token string">"abc"</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// "abcabcabc"</span>Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// Returns a real Array</span>Array<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// Similar to new Array(...), but without special one-arg behavior</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [0,7,7]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">></span> x <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 3</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">></span> x <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 1</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [1, 2, 3, 1, 2]</span><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// iterator [0, "a"], [1,"b"], [2,"c"]</span><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// iterator 0, 1, 2</span><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// iterator "a", "b", "c"</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>Point<span class="token punctuation">,</span> <span class="token punctuation">{</span> origin<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></li></ul><ul><li><p>Proxies</p><p>使用代理（Proxy）监听对象的操作，然后可以做一些相应事情。对象属性拦截修改。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!`</span></span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span>world <span class="token operator">===</span> <span class="token string">'Hello, world!'</span><span class="token punctuation">;</span></code></pre><p>可监听的操作： get、set、has、deleteProperty、apply、construct、getOwnPropertyDescriptor、defineProperty、getPrototypeOf、setPrototypeOf、enumerate、ownKeys、preventExtensions、isExtensible。</p></li><li><p>Symbols</p><p>Symbol是一种基本类型。Symbol 通过调用symbol函数产生，它接收一个可选的名字参数，该函数返回的symbol是唯一的。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> key <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> key2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>key <span class="token operator">==</span> key2  <span class="token comment" spellcheck="true">//false</span></code></pre></li><li><p>Promises</p><p>Promises是处理异步操作的对象，使用了 Promise 对象之后可以用一种链式调用的方式来组织代码，让代码更加直观（类似<a href="http://caibaojian.com/jquery/" target="_blank" rel="noopener">jQuery</a>的deferred 对象）。</p><p>这里我建议使用es6 新更新 的 async 异步操作，更简洁方便</p><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">fakeAjax</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// setTimeouts are for effect, typically we would handle XHR</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// no url, promise rejected</span><span class="token function">fakeAjax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fail'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ul><p>  // Ajax 是异步的，异步函数调用异步函数<br>  async a () {<br>    const response = await Ajax();<br>    return response.id;<br>  }</p><p>  async c() {<br>      const result = await this.a();<br>  }</p><p>  // 调用异步函数<br>  b () {<br>    a().then(result =&gt; {<br>      console.log(result);<br>    })<br>  }</p><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>详解diff算法</title>
      <link href="/2020/07/02/xiang-jie-diff-suan-fa/"/>
      <url>/2020/07/02/xiang-jie-diff-suan-fa/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于</p><p><a href="https://blog.csdn.net/M6i37JK/article/details/78140159?utm_medium=distribute.pc_relevant_right.none-task-blog-BlogCommendFromMachineLearnPai2-4.nonecase&amp;depth_1-utm_source=distribute.pc_relevant_right.none-task-blog-BlogCommendFromMachineLearnPai2-4.nonecase" target="_blank" rel="noopener">https://blog.csdn.net/M6i37JK/article/details/78140159?utm_medium=distribute.pc_relevant_right.none-task-blog-BlogCommendFromMachineLearnPai2-4.nonecase&amp;depth_1-utm_source=distribute.pc_relevant_right.none-task-blog-BlogCommendFromMachineLearnPai2-4.nonecase</a></p><p>本文只做加以个人解释，文章为转载并非原创</p></blockquote><blockquote><p>作者简介：汪玉林，高级工程师，增值产品部前端Leader，目前团队负责手Q游戏中心、手Q游戏运营、手Q阅读等项目，有丰富的Web前端架构经验。 </p></blockquote><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>Vue的核心是双向绑定和虚拟DOM（下文我们简称为vdom），关于双向绑定可以参阅木琴的文章<a href="http://mp.weixin.qq.com/s?__biz=MzI3NTM1MjExMg==&mid=2247483789&idx=1&sn=e7297ec3443007015117637709f27521&scene=21#wechat_redirect" target="_blank" rel="noopener">《剖析Vue原理&amp;实现双向绑定MVVM》</a>，vdom是树状结构，其节点为vnode，vnode和浏览器DOM中的Node一一对应，通过vnode的elm属性可以访问到对应的Node。</p><p>vdom因为是纯粹的JS对象，所以操作它会很高效，但是vdom的变更最终会转换成DOM操作，为了实现高效的DOM操作，一套高效的虚拟DOM diff算法显得很有必要。</p><p>Vue的diff算法是基于snabbdom改造过来的，感兴趣的朋友可以选择查阅。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702104737.png" alt=""></p><p>这是一张很经典的图，出自《React’s diff algorithm》，Vue的diff算法也同样，<strong>即仅在同级的vnode间做diff</strong>，递归地进行同级vnode的diff，最终实现整个DOM树的更新。那同级vnode diff的细节又是怎样的呢？正是本文所要讲的。</p><h2 id="二、例子"><a href="#二、例子" class="headerlink" title="二、例子"></a>二、例子</h2><p>我们在下文中将使用这个简化的例子来讲述diff的过程</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702104819.png" alt=""></p><p>如上图的例子，更新前是1到10排列的Node列表，更新后是乱序排列的Node列表。罗列一下图中有以下几种类型的节点变化情况：</p><p>（1）、头部相同、尾部相同的节点：如1、10</p><p>（2）、头尾相同的节点：如2、9（处理完头部相同、尾部相同节点之后）</p><p>（3）、新增的节点：11</p><p>（4）、删除的节点：8</p><p>（5）、其他节点：3、4、5、6、7</p><h2 id="三、简单的diff"><a href="#三、简单的diff" class="headerlink" title="三、简单的diff"></a>三、简单的diff</h2><p>简单的diff算法可以这样设计：</p><p>逐个遍历newVdom的节点，找到它在oldVdom中的位置，如果找到了就移动对应的DOM元素，如果没找到说明是新增节点，则新建一个节点插入。遍历完成之后如果oldVdom中还有没处理过的节点，则说明这些节点在newVdom中被删除了，删除它们即可。</p><p>仔细思考一下，几乎每一步都要做移动DOM的操作，这在DOM整体结构变化不大时的开销是很大的，实际上DOM变化不大的情况现实中经常发生，很多时候我们只需要变更某个节点的文本而已。</p><p>接下来我们看一下Vue的diff实现</p><h2 id="四、Vue的diff实现"><a href="#四、Vue的diff实现" class="headerlink" title="四、Vue的diff实现"></a>四、Vue的diff实现</h2><p>上图例子中我画上了oldStart+oldEnd，newStart+newEnd这样2对指针，分别对应oldVdom和newVdom的起点和终点。起止点之前的节点是待处理的节点，Vue不断对vnode进行处理同时移动指针直到其中任意一对起点和终点相遇。处理过的节点Vue会在oldVdom和newVdom中同时将它标记为已处理（标记方法后文中有介绍）。Vue通过以下措施来提升diff的性能。</p><h3 id="（一）、优先处理特殊场景"><a href="#（一）、优先处理特殊场景" class="headerlink" title="（一）、优先处理特殊场景"></a>（一）、优先处理特殊场景</h3><p>（1）、头部的同类型节点、尾部的同类型节点</p><p>这类节点更新前后位置没有发生变化，所以不用移动它们对应的DOM</p><p>（2）、头尾/尾头的同类型节点</p><p>这类节点位置很明确，不需要再花心思查找，直接移动DOM就好</p><p>处理了这些场景之后，<strong>一方面一些不需要做移动的DOM得到快速处理，另一方面待处理节点变少，缩小了后续操作的处理范围，性能也得到提升</strong></p><h3 id="（二）、“原地复用”"><a href="#（二）、“原地复用”" class="headerlink" title="（二）、“原地复用”"></a>（二）、“原地复用”</h3><p>“原地复用”是指Vue会尽可能复用DOM，尽可能不发生DOM的移动。<strong>Vue在判断更新前后指针是否指向同一个节点，其实不要求它们真实引用同一个DOM节点，实际上它仅判断指向的是否是同类节点（比如2个不同的div，在DOM上它们是不一样的，但是它们属于同类节点），如果是同类节点，那么Vue会直接复用DOM，这样的好处是不需要移动DOM。</strong>再看上面的实例，假如10个节点都是div，那么整个diff过程中就没有移动DOM的操作了。</p><p>“原地复用”在Vue的官方文档中有提到，虽然带来了好处，但是也会产生一些问题，朋友们可以复习一下</p><p><a href="https://cn.vuejs.org/v2/guide/list.html#key" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/list.html#key</a></p><p><a href="https://cn.vuejs.org/v2/guide/conditional.html#用-key-管理可复用的元素" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/conditional.html#用-key-管理可复用的元素</a></p><h2 id="五、按步解剖实例"><a href="#五、按步解剖实例" class="headerlink" title="五、按步解剖实例"></a>五、按步解剖实例</h2><h3 id="（一）、整体视图"><a href="#（一）、整体视图" class="headerlink" title="（一）、整体视图"></a><strong>（一）、整体视图</strong></h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702104840.png" alt=""></p><p>先看一张整体视图，整个diff分两部分：</p><p>（1）、第一部分是一个循环，循环内部是一个分支逻辑，每次循环只会进入其中的一个分支，<strong>每次循环会处理一个节点，处理之后将节点标记为已处理（oldVdom和newVdom都要进行标记，如果节点只出现在其中某一个vdom中，则另一个vdom中不需要进行标记），标记的方法有2种，当节点正好在vdom的指针处，移动指针将它排除到未处理列表之外即可，否则就要采用其他方法，Vue的做法是将节点设置为undefined。</strong></p><p>（2）、循环结束之后，可能newVdom或者oldVdom中还有未处理的节点，如果是newVdom中有未处理节点，则这些节点是新增节点，做新增处理。如果是oldVdom中有这类节点，则这些是需要删除的节点，相应在DOM树中删除之</p><p><strong>整个过程是逐步找到更新前后vdom的差异，然后将差异反应到DOM树上（也就是patch），特别要提一下Vue的patch是即时的，并不是打包所有修改最后一起操作DOM（React则是将更新放入队列后集中处理），朋友们会问这样做性能很差吧？实际上现代浏览器对这样的DOM操作做了优化，并无差别。</strong></p><h3 id="（二）、逐步解析"><a href="#（二）、逐步解析" class="headerlink" title="（二）、逐步解析"></a>（二）、逐步解析</h3><p>（1）、处理头部的同类型节点，即oldStart和newStart指向同类节点的情况，如下图中的节点1</p><p>这种情况下，将节点1的变更更新到DOM，然后对其进行标记，标记方法是oldStart和newStart后移1位即可，过程中不需要移动DOM（<strong>更新DOM或许是要的，比如属性变更了，文本内容变更了等等</strong>）</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702104852.png" alt=""></p><p>（2）、处理尾部的同类型节点，即oldEnd和newEnd指向同类节点的情况，如下图中的节点10</p><p>与情况（1）类似，这种情况下，将节点10的变更更新到DOM，然后oldEnd和newEnd前移1位进行标记，同样也不需要移动DOM</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702104912.png" alt=""></p><p>（3）、处理头尾/尾头的同类型节点，即oldStart和newEnd，以及oldEnd和newStart指向同类节点的情况，如下图中的节点2和节点9</p><p>先看节点2，其实是往后移了，移到哪里？移到oldEnd指向的节点（即节点9）后面，移动之后标记该节点，将oldStart后移1位，newEnd前移一位</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702105916.png" alt=""></p><p>操作结束之后情况如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702105933.png" alt=""></p><p>同样地，节点9也是类似的处理，处理完之后成了下面这样</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702105949.png" alt=""></p><p>（4）、处理新增的节点</p><p>newStart来到了节点11的位置，在oldVdom中找不到节点11，说明它是新增的</p><p>那么就创建一个新的节点，插入DOM树，插到什么位置？插到oldStart指向的节点（即节点3）前面，然后将newStart后移1位标记为已处理（注意oldVdom中没有节点11，所以标记过程中它的指针不需要移动），处理之后如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702110004.png" alt=""></p><p>（5）、处理更新的节点</p><p>经过第（4）步之后，newStart来到了节点7的位置，在oldVdom中能找到它而且不在指针位置（<strong>查找oldVdom中oldStart到oldEnd区间内的节点</strong>），说明它的位置移动了</p><p>那么需要在DOM树中移动它，移到哪里？移到oldStart指向的节点（即节点3）前面，<strong>与此同时将节点标记为已处理，跟前面几种情况有点不同，newVdom中该节点在指针下，可以移动newStart进行标记，而在oldVdom中该节点不在指针处，所以采用设置为undefined的方式来标记（一定要标记吗？后面会提到）</strong></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702110020.png" alt=""></p><p>处理之后就成了下面这样</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702110040.png" alt=""></p><p>（6）、处理3、4、5、6节点</p><p>经过第（5）步处理之后，我们看到了令人欣慰的一幕，newStart和oldStart又指向了同一个节点（即都指向节点3），很简单，按照（1）中的做法只需移动指针即可，非常高效，3、4、5、6都如此处理，处理完之后如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702110059.png" alt=""></p><p>（7）、处理需删除的节点</p><p>经过前6步处理之后（实际上前6步是循环进行的），朋友们看newStart跨过了newEnd，它们相遇啦！而这个时候，oldStart和oldEnd还没有相遇，说明这2个指针之间的节点（包括它们指向的节点，即上图中的节点7、节点8）是此次更新中被删掉的节点。</p><p>OK，那我们在DOM树中将它们删除，<strong>再回到前面我们对节点7做了标记，为什么标记是必需的？标记的目的是告诉Vue它已经处理过了，是需要出现在新DOM中的节点，不要删除它，所以在这里只需删除节点8。</strong></p><p><strong>在应用中也可能会遇到oldVdom的起止点相遇了，但是newVdom的起止点没有相遇的情况，这个时候需要对newVdom中的未处理节点进行处理，这类节点属于更新中被加入的节点，需要将他们插入到DOM树中。</strong></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200702110117.png" alt=""></p><p>至此，整个diff过程结束了</p><p>Vue的diff算法与动态规划算法中的经典案例“计算a到b的最小编辑距离”看上去有些相似，实际完全不同，Vue的diff相对来说轻量很多，感兴趣的朋友可以查阅相关资料进行了解。</p><p>好啦，感谢你的阅读，希望能帮助你理解Vue的diff算法，在阅读过程中遇到的问题也欢迎一起交流！</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue2.0和3.0的响应式原理解析</title>
      <link href="/2020/07/01/vue2-0-he-3-0-de-xiang-ying-shi-yuan-li-jie-xi/"/>
      <url>/2020/07/01/vue2-0-he-3-0-de-xiang-ying-shi-yuan-li-jie-xi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文参考于：</p><p><a href="https://www.jianshu.com/p/d137fbdc06ff" target="_blank" rel="noopener">https://www.jianshu.com/p/d137fbdc06ff</a></p><p><a href="https://www.cnblogs.com/jiajialove/p/11323105.html（这个说的比较好）" target="_blank" rel="noopener">https://www.cnblogs.com/jiajialove/p/11323105.html（这个说的比较好）</a></p><p><a href="https://segmentfault.com/a/1190000019700618?utm_source=sf-related（这个很详细）" target="_blank" rel="noopener">https://segmentfault.com/a/1190000019700618?utm_source=sf-related（这个很详细）</a></p><p><a href="https://blog.csdn.net/xiaoxiaole0313/article/details/104624019/（图解Vue3.0响应式）" target="_blank" rel="noopener">https://blog.csdn.net/xiaoxiaole0313/article/details/104624019/（图解Vue3.0响应式）</a></p></blockquote><h2 id="Vue2-0响应式"><a href="#Vue2-0响应式" class="headerlink" title="Vue2.0响应式"></a>Vue2.0响应式</h2><h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><blockquote><p>总结：Vue 的响应式原理是核心是通过 <code>ES5</code> 的保护对象的 <code>Object.defindeProperty</code> 中的访问器属性中的 <code>get</code> 和 <code>set</code> 方法，<code>data</code> 中声明的属性都被添加了访问器属性，当读取 <code>data</code> 中的数据时自动调用 <code>get</code> 方法，当修改 <code>data</code> 中的数据时，自动调用 <code>set</code> 方法，检测到数据的变化，会通知观察者 <code>Wacher</code>，观察者 <code>Wacher</code>自动触发重新<code>render</code> 当前组件（子组件不会重新渲染）,生成新的<code>虚拟 DOM 树</code>，Vue 框架会遍历并对比<code>新虚拟 DOM 树</code>和<code>旧虚拟 DOM 树</code>中每个节点的差别，并记录下来，最后，加载操作，将所有记录的不同点，局部修改到<code>真实 DOM 树</code>上。</p></blockquote><h3 id="响应式架构图"><a href="#响应式架构图" class="headerlink" title="响应式架构图"></a>响应式架构图</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200701174626.png" alt="架构图"></p><p>虚拟DOM (Virtaul DOM): 用 js 对象模拟的，保存当前视图内所有 DOM 节点对象基本描述属性和节点间关系的树结构。用 js 对象，描述每个节点，及其父子关系，形成虚拟 DOM 对象树结构。</p><h3 id="Vue2-0响应式核心步骤"><a href="#Vue2-0响应式核心步骤" class="headerlink" title="Vue2.0响应式核心步骤"></a>Vue2.0响应式核心步骤</h3><h4 id="1-observe-data"><a href="#1-observe-data" class="headerlink" title="1. observe(data)"></a>1. observe(data)</h4><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200701175936" alt="observe(data)"></p><p>如上图所示，observe函数所做的工作就是遍历data的每一个属性，对这些属性依次做响应式处理</p><h4 id="2-defineProperty-data-key-handler）"><a href="#2-defineProperty-data-key-handler）" class="headerlink" title="2.defineProperty(data,key,handler）"></a>2.defineProperty(data,key,handler）</h4><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200701180004" alt="defineProperty(data,key,handler）"></p><p>而所谓的响应式处理，则是拦截属性的get、set方法做订阅-发布处理。订阅-发布处理，就是在属性被调用的使用，触发get代理函数，订阅调用该属性的组件(将组件存放到一个订阅者数组中进行保存，这里的Dep.target暂时可以理解为一个全局变量，代表着的是当前正在渲染的Vue组件)。 而在属性被修改时，触发set代理函数，在set代理函数里，通知订阅者数组里面的每一个订阅者（组件）进行视图更新。</p><h4 id="3-Dep"><a href="#3-Dep" class="headerlink" title="3.Dep"></a>3.Dep</h4><p>上文中提到的Dep，是一个依赖类，将它理解成一个订阅者。当对一个属性进行响应式处理的时候，就会实例化一个Dep实例，并将用到这个属性的组件全部存放在subs数组里。当属性被修改时，则通知subs数组里的所有组件进行更新。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200701180045" alt="Dep"></p><h4 id="4-Watcher"><a href="#4-Watcher" class="headerlink" title="4. Watcher"></a>4. Watcher</h4><p>上面我们说到，dep.subs里面存的是用到该属性的组件，这个说法实际上不完全对。准确来说，dep.subs里面存的是用到该属性的组件所对应的一个Watcher实例。什么是Watcher？每一个组件在渲染之前，会对其自身的template模版进行解析编译，生成一个render函数（用于创建虚拟dom）。然后，会实例化一个Watcher对象，在实例化的过程中，会将之前生成的render函数作为参数传入进去执行。而在执行render的过程中，势必会触发相应属性的get函数，将这个watcher实例添加到相应属性的订阅者数组subs当中。等这些属性进行被修改时，就会通知这个watcher，再次调用这个watcher里面的render函数，进行虚拟dom的diff和更新。</p><h3 id="Vue2-0的不足"><a href="#Vue2-0的不足" class="headerlink" title="Vue2.0的不足"></a>Vue2.0的不足</h3><p>1.动态添加响应式属性必须用Vue.set</p><p>2.直接操作数组索引无法触发视图更新</p><p>3.数据的响应式处理和视图未完全解耦</p><h2 id="Vue3-0响应式"><a href="#Vue3-0响应式" class="headerlink" title="Vue3.0响应式"></a>Vue3.0响应式</h2><h3 id="Vue3-0响应式原理框架图"><a href="#Vue3-0响应式原理框架图" class="headerlink" title="Vue3.0响应式原理框架图"></a>Vue3.0响应式原理框架图</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200701182307" alt="img"></p><h3 id="Vue3-0响应式的核心步骤"><a href="#Vue3-0响应式的核心步骤" class="headerlink" title="Vue3.0响应式的核心步骤"></a>Vue3.0响应式的核心步骤</h3><h4 id="1-reactive-data"><a href="#1-reactive-data" class="headerlink" title="1.reactive(data)"></a>1.reactive(data)</h4><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200701182113" alt="reactive(data)"></p><h4 id="2-Proxy-data-handler"><a href="#2-Proxy-data-handler" class="headerlink" title="2.Proxy(data,handler)"></a>2.Proxy(data,handler)</h4><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200701182130" alt="Proxy(data,handler)"></p><p>从上图代码可以看出，Vue3.0响应式相对于Vue2.0的最大区别在于用到了es6中的方法Proxy。这个方法不需要循环遍历data的每个属性，对每个属性都做一遍响应式处理。而是直接代理了整个data对象，拦截这个对象所包含的所有属性的get、set方法。这么做的好处:</p><p>1.就是在我们动态为data添加一个属性时，不用做任何处理，这个属性就已经是响应式的了。</p><p>2.数组的任何操作也都可以触发响应。</p><h4 id="3-effect-fn"><a href="#3-effect-fn" class="headerlink" title="3.effect(fn)"></a>3.effect(fn)</h4><p>上面的设计，其实已经解决了Vue2.0的前两个不足。而为了解决第三个不足， Vue3.0提出了effect函数，其用法如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200701182215" alt="img"></p><p>当我们调用effect执行某个函数时，首先会执行一次这个函数。之后每次obj.name修改时，执行一次该函数。那么effect是怎么实现这个功能的？</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200701182224" alt="img"></p><p>我们来看这个effect函数做了什么？简单来说，effect会先将传入的回调函数保存起来，然后第一次执行cb(),在执行的过程中，触发了obj.name属性的get代理函数，在代理函数里面做订阅track(target), 而track函数则会将存在全局数组中的cb函数取出来，保存在map中,类似于map.set(‘name’,cb)。之后，在name属性被修改的时候，会触发name属性的set代理函数，在代理函数里面执行trigger。最后，trigger会将之前存在map里的订阅着取出来执行，map.get(‘name’)()</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebKit内核的渲染过程</title>
      <link href="/2020/06/29/webkit-de-xuan-ran-guo-cheng/"/>
      <url>/2020/06/29/webkit-de-xuan-ran-guo-cheng/</url>
      
        <content type="html"><![CDATA[<h2 id="第一阶段：从网页的-URL-到构建完-DOM-树"><a href="#第一阶段：从网页的-URL-到构建完-DOM-树" class="headerlink" title="第一阶段：从网页的 URL 到构建完 DOM 树"></a>第一阶段：从网页的 URL 到构建完 DOM 树</h2><p>从网页 URL 到 DOM 树</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200629174505" alt="从网页 URL 到 DOM 树"></p><p>具体过程如下：</p><p>当用户输入网页 URL 的时候，WebKit 调用其资源加载器加载该 URL 对应的网页<br>加载器依赖网络模块建立连接，发送请求并接收答复<br>WebKit 接收到各种网页或者资源的数据，其中某些资源可能是同步或异步获取的<br>网页被交给 HTML 解释器转变成一系列的词语（Token）<br>解释器根据词语构建节点（Node），形成 DOM 树<br>如果节点是 JavaScript 代码的话，调用 JavaScript 引擎解释并执行<br>JavaScript 代码可能会修改 DOM 树的结构<br>如果节点需要依赖其他资源，例如图片，CSS，视频等，调用资源加载器来加载它们，但是它们是异步的，不会阻碍当前 DOM 树的继续创建；如果是 JavaScript 资源 URL（没有标记异步方式），则需要停止当前 DOM 树的创建，直到 JavaScript 的资源加载并被 JavaScript 引擎执行后才继续 DOM 树的创建<br>在上述过程中，网页在加载和渲染的过程中会触发 “DOMContentLoaded” 事件和 “onload” 事件，分别在 DOM 树构建完之后，以及 DOM 树建完并且网页所依赖的资源都加载完之后发生，因为某些资源的加载并不会阻碍 DOM 树的创建，所以这两个事件多数时候不是同时发生的。</p><h2 id="第二阶段：从-DOM-树到构建完-WebKit-的绘图上下文"><a href="#第二阶段：从-DOM-树到构建完-WebKit-的绘图上下文" class="headerlink" title="第二阶段：从 DOM 树到构建完 WebKit 的绘图上下文"></a>第二阶段：从 DOM 树到构建完 WebKit 的绘图上下文</h2><p>从 CSS 和 DOM 树到绘图上下文</p><p>具体过程如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200629174520" alt="从 CSS 和 DOM 树到绘图上下文"></p><p>CSS 文件被 CSS 解释器解释成内部表示结构<br>CSS 解释器工作完之后，在 DOM 树上附加解释后的样式信息，这就是 RenderObject 树<br>RenderObject 节点在创建的同时，WebKit 会根据网页的层次结构创建 RenderLayer 树，同时构建一个虚拟的绘图上下文。<br>RenderObject 树的建立并不表示 DOM 树会被销毁，事实上，上述图中的四个内部表示结构一直存在，直到网页被销毁，因为它们对于网页的渲染起了非常大的作用。</p><h2 id="第三阶段：从绘图上下文到生成最终的图像"><a href="#第三阶段：从绘图上下文到生成最终的图像" class="headerlink" title="第三阶段：从绘图上下文到生成最终的图像"></a>第三阶段：从绘图上下文到生成最终的图像</h2><p>从绘图上下文到最终的图像</p><p>具体过程如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200629174528" alt="从绘图上下文到最终的图像"></p><p>绘图上下文是一个与平台无关的抽象类，它将每个绘图操作桥接到不同的具体实现类，也就是绘图具体实现类<br>绘图实现类也可能有简单的实现，也可能有复杂的实现。在 Chromium 中，它的实现相当复杂，需要 Chromium 的合成器来完成复杂的多进程和 GPU 加速机制<br>绘图实现类将 2D 图形库或者 3D 图形库绘制的结果保存下来，交给浏览器来同浏览器界面一起显示<br>这个过程实际上可能不像图中描述的那么简单，现在浏览器为了绘图上的高效性和安全性，可能会在这一过程中引入复杂的机制。而且，绘图也从之前单纯的软件渲染，到现在的 GPU 硬件渲染、混合渲染模型等方式。</p><blockquote><p>tips：<br>上面介绍的是一个完整的渲染过程。现代网页很多是动态网页，这意味着在渲染完成之后，由于网页的动画或者用户的交互，浏览器其实一直在不停地重复执行渲染过程。</p></blockquote><blockquote><p>参考<br>《webkit技术内幕》<br>————————————————<br>版权声明：本文为CSDN博主「userkang」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/userkang/java/article/details/80836614" target="_blank" rel="noopener">https://blog.csdn.net/userkang/java/article/details/80836614</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>elementui样式修改</title>
      <link href="/2020/06/24/elementui-yang-shi-xiu-gai/"/>
      <url>/2020/06/24/elementui-yang-shi-xiu-gai/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文的部分内容引用于<a href="https://www.cnblogs.com/my466879168/p/12091439.html，本文做案例翻译和加上个人理解" target="_blank" rel="noopener">https://www.cnblogs.com/my466879168/p/12091439.html，本文做案例翻译和加上个人理解</a></p></blockquote><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>因为在vue的文件里面，为了保护每个vue文件的样式不冲突，在样式里面是有个scoped的，所以导致在vue文件里面直接覆盖elementui的样式是不启作用的，这里讲解一下vue文件内改变全局elementui样式的方法</p><h2 id="不使用scoped"><a href="#不使用scoped" class="headerlink" title="不使用scoped"></a>不使用scoped</h2><p>这个方法很简单不把scored加上即可，但是这样会造成样式污染</p><pre class=" language-css"><code class="language-css"><span class="token selector">&lt;style>    <span class="token class">.my</span></span><span class="token punctuation">{</span>        <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.my</span> <span class="token class">.el-input__inner</span></span><span class="token punctuation">{</span>        <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">15</span>px<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/* 这个样式起效果 */</span>    <span class="token punctuation">}</span><span class="token selector">&lt;/style>&lt;style scoped>    <span class="token class">.el-input__inner</span></span><span class="token punctuation">{</span>        <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 这个样式不起效果 */</span>    <span class="token punctuation">}</span>&lt;/style></code></pre><p>当然直接这样做的话是会污染全局变量的，所以一般的做法是用一个父类去包含</p><p>比如：</p><pre class=" language-css"><code class="language-css"><span class="token selector">&lt;template>    &lt;div class="my">        &lt;div class="el-input__inner">&lt;/div>    &lt;/div>&lt;/template>&lt;style>    <span class="token class">.my</span></span><span class="token punctuation">{</span>        <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.my</span> <span class="token class">.el-input__inner</span></span><span class="token punctuation">{</span>        <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">15</span>px<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/* 这个样式起效果 */</span>    <span class="token punctuation">}</span><span class="token selector">&lt;/style>&lt;style scoped lang="less">  <span class="token class">.my</span></span><span class="token punctuation">{</span>      <span class="token selector"><span class="token class">.el-input__inner</span></span><span class="token punctuation">{</span>      <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 这个样式不起效果 */</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>&lt;/style></code></pre><h2 id="使用deep样式穿透"><a href="#使用deep样式穿透" class="headerlink" title="使用deep样式穿透"></a>使用deep样式穿透</h2><pre class=" language-css"><code class="language-css"><span class="token selector">&lt;template>        &lt;div class="el-input__inner">&lt;/div>&lt;/template>&lt;style scoped>    <span class="token class">.el-input__inner</span></span><span class="token punctuation">{</span>        <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/* 这个不起作用 */</span>    <span class="token punctuation">}</span>    <span class="token selector">/deep/ <span class="token class">.el-input__inner</span></span><span class="token punctuation">{</span>        <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/* 这个起作用 */</span>    <span class="token punctuation">}</span>&lt;/style></code></pre><h2 id="使用-gt-gt-gt-穿透"><a href="#使用-gt-gt-gt-穿透" class="headerlink" title="使用&gt;&gt;&gt;穿透"></a>使用&gt;&gt;&gt;穿透</h2><pre class=" language-css"><code class="language-css"><span class="token selector">&lt;template>        &lt;div class="el-input__inner">&lt;/div>&lt;/template>&lt;style scoped>    <span class="token class">.el-input__inner</span></span><span class="token punctuation">{</span>        <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/* 这个不起作用 */</span>    <span class="token punctuation">}</span>    <span class="token selector">>>> <span class="token class">.el-input__inner</span></span><span class="token punctuation">{</span>        <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/* 这些起作用 */</span>        <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token hexcode">#eceef2</span><span class="token punctuation">;</span>        <span class="token property">outline</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>&lt;/style></code></pre><h2 id="important来增加权重"><a href="#important来增加权重" class="headerlink" title="!important来增加权重"></a>!important来增加权重</h2><p>有些样式是行内样式权重比较高则需要使用上面的几种方法来保证可以修改样式并且添加上!important来增加权重</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>请输入内容<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">300</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style language-css">    <span class="token selector"><span class="token class">.my</span> >>> <span class="token class">.el-input__inner</span></span><span class="token punctuation">{</span>        <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span>        <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token hexcode">#eceef2</span><span class="token punctuation">;</span>        <span class="token property">outline</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">400</span>px!important<span class="token punctuation">;</span>    <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><blockquote><p>本文转载于：<a href="https://www.cnblogs.com/my466879168/p/12091439.html" target="_blank" rel="noopener">https://www.cnblogs.com/my466879168/p/12091439.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue实现文件下载</title>
      <link href="/2020/06/24/vue-shi-xian-wen-jian-xia-zai/"/>
      <url>/2020/06/24/vue-shi-xian-wen-jian-xia-zai/</url>
      
        <content type="html"><![CDATA[<blockquote><p>download.js这个插件会造成只下载文件地址，只能下载图片和视频地址，对于pdf和word之类的内容只有文件的下载地址</p><p>这个是我根据别人的方法封装成一个工具类，在vue中直接引入就可以使用了</p></blockquote><p>在工具类中引入写入下载方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200624173554.png" alt="工具类截图"></p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> downloadfile <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'http://192.168.1.34:8000/media/'</span> <span class="token operator">+</span> url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token punctuation">{</span> responseType<span class="token punctuation">:</span> <span class="token string">'blob'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> content <span class="token operator">=</span> res<span class="token punctuation">.</span>data      <span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token keyword">let</span> fileName <span class="token operator">=</span> url      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'download'</span> <span class="token keyword">in</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 非IE下载</span>        <span class="token keyword">let</span> elink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>        elink<span class="token punctuation">.</span>download <span class="token operator">=</span> fileName        elink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>        elink<span class="token punctuation">.</span>href <span class="token operator">=</span> URL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elink<span class="token punctuation">)</span>        elink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        URL<span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>elink<span class="token punctuation">.</span>href<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 释放URL 对象</span>        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>elink<span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// IE10+下载</span>        navigator<span class="token punctuation">.</span><span class="token function">msSaveBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>然后在vue文件中直接引入即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200624173657.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日常总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uniapp性能优化建议</title>
      <link href="/2020/06/23/uniapp-xing-neng-you-hua-jian-yi/"/>
      <url>/2020/06/23/uniapp-xing-neng-you-hua-jian-yi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文引用于<a href="http://www.javanx.cn/20191022/uni-app/" target="_blank" rel="noopener">http://www.javanx.cn/20191022/uni-app/</a></p></blockquote><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><code>Uni-App</code>，从了解到开发，相信大家都会觉得<code>Uni-App</code>性能不好，其实也这是非原生的弊病。<code>React Native</code>、<code>Flutter</code>等，非原生框架，性能上都会或多或少的折损。但各个框架，都会做出<a href="http://www.javanx.cn/tag/性能提升/" target="_blank" rel="noopener">性能提升</a>建议，所以开发者在开发前，多了解一下，后面维护升级等就会更方便一点，否则项目越来越大，后续开发就会越来越难。</p><p><img src="http://cdn.javanx.cn/wp-content/themes/lensnews2.2/images/201909/11/20191018142550.png" alt="&lt;code&gt;&lt;a href=">uni-app: 如何高效开发uni app?” /&gt;</p><p>现在我们就从<code>uni-app</code>运行<a href="http://www.javanx.cn/tag/原理/" target="_blank" rel="noopener">原理</a>上，了解一下，在哪些方面存在性能折损问题？</p><h1 id="运行原理"><a href="#运行原理" class="headerlink" title="运行原理"></a>运行原理</h1><h2 id="逻辑层和视图层分离，非H5端通信有折损"><a href="#逻辑层和视图层分离，非H5端通信有折损" class="headerlink" title="逻辑层和视图层分离，非H5端通信有折损"></a>逻辑层和视图层分离，非H5端通信有折损</h2><p><code>uni-app</code> 在非H5端运行时，从架构上分为逻辑层和视图层两个部分。逻辑层负责储存数据和执行业务逻辑，视图层负责页面渲染。</p><p>页面加载时，联网和逻辑运算在逻辑层（Android是<code>v8</code>，iOS是<code>jscore</code>），然后会传递数据给视图层渲染。这种通信有损耗。同样，在视图层操作时，比如拖动页面，要实时传递事件给逻辑层接收，也是有损耗的。</p><p><img src="http://cdn.javanx.cn/wp-content/themes/lensnews2.2/images/201909/11/20191018142551.png" alt="&lt;code&gt;uni-app&lt;/code&gt;: 如何高效开发uni app?"></p><h2 id="App端渲染引擎可切换"><a href="#App端渲染引擎可切换" class="headerlink" title="App端渲染引擎可切换"></a>App端渲染引擎可切换</h2><p>在App端，<code>nvue</code> 页面的视图层是由原生引擎渲染的，<code>vue</code> 页面的视图层是os的 <code>webview</code> 渲染的。 <code>uni-app</code> 的 <code>webview</code> 渲染经过优化，性能也足够好。它比 <code>nvue</code> 弱的地方主要在于启动速度和可左右拖动的长列表。</p><h2 id="app-vue和小程序的数据更新，分页面级和组件级"><a href="#app-vue和小程序的数据更新，分页面级和组件级" class="headerlink" title="app-vue和小程序的数据更新，分页面级和组件级"></a>app-vue和<a href="http://www.javanx.cn/tag/小程序/" target="_blank" rel="noopener">小程序</a>的数据更新，分页面级和组件级</h2><p>对于复杂页面，更新某个区域的数据时，需要把这个区域做成组件，这样更新数据时就只更新这个组件，否则会整个页面的数据更新，造成点击延迟卡顿。 这就是自定义组件编译模式的特点。</p><p>比如微博长列表页面，点击一个点赞图标，赞数要立即+1，此时这个点赞图标一定要做成组件。否则这个+1会引发页面级所有数据的更新。</p><p>app-nvue和h5不存在此问题。造成差异的原因是小程序目前只提供了组件差量更新的机制，不能自动计算所有页面差量。</p><p><img src="http://cdn.javanx.cn/wp-content/themes/lensnews2.2/images/201909/11/20191018142552.png" alt="&lt;code&gt;uni-app&lt;/code&gt;: 如何高效开发uni app?"></p><h1 id="优化建议"><a href="#优化建议" class="headerlink" title="优化建议"></a>优化建议</h1><h2 id="使用自定义组件模式"><a href="#使用自定义组件模式" class="headerlink" title="使用自定义组件模式"></a>使用自定义组件模式</h2><p>使用自定义组件模式，在 <code>manifest</code> 中配置自定义组件模式（HBuilderX1.9起新建项目默认即为自定义组件模式）。</p><p>在复杂页面中，页面中嵌套大量组件，如果是非自定义组件模式，更新一个组件会导致整个页面数据更新。而自定义组件模式则可以单独更新一个组件的数据。</p><p>在App端，除了上述好处，自定义组件模式还新增了一个独立的js引擎，加快启动速度、减少js阻塞。</p><p>之前的非自定义组件模式已经不再推荐，如果你的应用还是非自定义组模式，请尽快升级。</p><h2 id="避免使用大图"><a href="#避免使用大图" class="headerlink" title="避免使用大图"></a>避免使用大图</h2><p>页面中若大量使用大图资源，会造成页面切换的卡顿，导致系统内存升高，甚至白屏崩溃。</p><p>尤其是不要把多张大图缩小后显示在一个屏幕内，比如上传图片前选了数张几M体积的照片，然后缩小在一个屏幕中展示多张几M的大图，非常容易白屏崩溃。</p><p>推荐通过阿里云oss，来压缩图片处理。</p><p><img src="http://cdn.javanx.cn/wp-content/themes/lensnews2.2/images/201909/11/20191018142553.png" alt="&lt;code&gt;uni-app&lt;/code&gt;: 如何高效开发uni app?"></p><h2 id="优化数据更新"><a href="#优化数据更新" class="headerlink" title="优化数据更新"></a>优化数据更新</h2><p>在 <code>uni-app</code> 中，定义在 <code>data</code> 里面的数据每次变化时都会通知视图层重新渲染页面。 所以如果不是视图所需要的变量，可以不定义在 <code>data</code> 中，可在外部定义变量或直接挂载在vue实例上，以避免造成资源浪费。</p><h2 id="长列表"><a href="#长列表" class="headerlink" title="长列表"></a>长列表</h2><p>长列表中如果每个<code>item</code>有一个点赞按钮，点击后点赞数字+1，此时点赞组件必须是一个单独引用的组件，才能做到差量数据更新。否则会造成整个列表数据重载。（要求自定义组件模式）</p><p>长列表中每个<code>item</code>并不一定需要做成组件，取决于你的业务中是否需要差量更新某一行item的数据，如没有此类需求则不应该引入大量组件。（点击item后背景变色，属于css调整，没有更新data数据和渲染，不涉及这个问题）</p><p>app端<code>nvue</code>的长列表应该使用<code>list</code>组件，有自动的渲染资源回收机制。vue页面使用页面滚动的性能，好于使用<code>scroll-view</code>的区域滚动。</p><p>如需要左右滑动的长列表，请参考“在HBuilderX新建<code>uni-app</code>项目” 的 新闻模板，那是一个标杆实现。自己用<code>swiper</code>和<code>scroll-view</code>做很容易引发性能问题。</p><p><img src="http://cdn.javanx.cn/wp-content/themes/lensnews2.2/images/201909/11/20191018142554.jpg" alt="&lt;code&gt;uni-app&lt;/code&gt;: 如何高效开发uni app?"></p><h2 id="减少一次性渲染的节点数量"><a href="#减少一次性渲染的节点数量" class="headerlink" title="减少一次性渲染的节点数量"></a>减少一次性渲染的节点数量</h2><p>页面初始化时，逻辑层如果一次性向视图层传递很大的数据，使视图层一次性渲染大量节点，可能造成通讯变慢、页面切换卡顿，所以建议以局部更新页面的方式渲染页面。</p><p>如：服务端返回100条数据，可进行分批加载，一次加载50条，500ms 后进行下一次加载。</p><h2 id="减少节点嵌套层级"><a href="#减少节点嵌套层级" class="headerlink" title="减少节点嵌套层级"></a>减少节点嵌套层级</h2><p>深层嵌套的节点在页面初始化构建时往往需要更多的内存占用，并且在遍历节点时也会更慢些，所以建议减少深层的节点嵌套。</p><h2 id="避免视图层和逻辑层频繁进行通讯"><a href="#避免视图层和逻辑层频繁进行通讯" class="headerlink" title="避免视图层和逻辑层频繁进行通讯"></a>避免视图层和逻辑层频繁进行通讯</h2><p>减少 <code>scroll-view</code> 组件的 <code>scroll</code> 事件监听，当监听 <code>scroll-view</code> 的滚动事件时，视图层会频繁的向逻辑层发送数据；</p><p>监听 <code>scroll-view</code> 组件的滚动事件时，不要实时的改变 <code>scroll-top/scroll-left</code> 属性，因为监听滚动时，视图层向逻辑层通讯，改变 <code>scroll-top/scroll-left</code> 时，逻辑层又向视图层通讯，这样就可能造成通讯卡顿。</p><p>注意 <code>onPageScroll</code> 的使用，<code>onPageScroll</code> 进行监听时，视图层会频繁的向逻辑层发送数据；<br>多使用<code>css</code>动画，而不是通过js的定时器操作界面做动画</p><p><img src="http://cdn.javanx.cn/wp-content/themes/lensnews2.2/images/201909/11/20191018142555.jpg" alt="&lt;code&gt;uni-app&lt;/code&gt;: 如何高效开发uni app?"></p><h2 id="优化页面切换动画"><a href="#优化页面切换动画" class="headerlink" title="优化页面切换动画"></a>优化页面切换动画</h2><p>页面初始化时若存在大量图片或原生组件渲染和大量数据通讯，会发生新页面渲染和窗体进入动画抢资源，造成页面切换卡顿、掉帧。建议延时100ms~300ms渲染图片或复杂原生组件，分批进行数据通讯，以减少一次性渲染的节点数量。</p><p>App端动画效果可以自定义。<code>popin/popout</code>的双窗体联动挤压动画效果对资源的消耗更大，如果动画期间页面里在执行耗时的js，可能会造成动画掉帧。此时可以使用消耗资源更小的动画效果，比如<code>slide-in-right/slide-out-right</code>。</p><h2 id="优化样式渲染速度"><a href="#优化样式渲染速度" class="headerlink" title="优化样式渲染速度"></a>优化样式渲染速度</h2><p>如果页面背景是深色，在vue页面中可能会发生新窗体刚开始动画时是灰白色背景，动画结束时才变为深色背景，造成闪屏。这是因为webview的背景生效太慢的问题。此时需将样式写在 <code>App.vue</code> 里，可以加速页面样式渲染速度。<code>App.vue</code> 里面的样式是全局样式，每次新开页面会优先加载 <code>App.vue</code> 里面的样式，然后加载普通 <code>vue</code> 页面的样式。另外<code>nvue</code>页面不存在此问题，也可以更改为<code>nvue</code>页面。</p><h2 id="使用-nvue-代替-vue"><a href="#使用-nvue-代替-vue" class="headerlink" title="使用 nvue 代替 vue"></a>使用 nvue 代替 vue</h2><p>在 <code>App</code> 端 <code>uni-app</code> 的 <code>nvue</code> 页面可是基于 <code>weex</code> 定制的原生渲染引擎，实现了页面原生渲染能力、提高了页面流畅性。若对页面性能要求较高可以使用此方式开发。</p><p><img src="http://cdn.javanx.cn/wp-content/themes/lensnews2.2/images/201909/11/20191018142556.jpg" alt="&lt;code&gt;uni-app&lt;/code&gt;: 如何高效开发uni app?"></p><h2 id="优化App启动速度的注意"><a href="#优化App启动速度的注意" class="headerlink" title="优化App启动速度的注意"></a>优化App启动速度的注意</h2><p>工程代码越多，包括背景图和本地字体文件越大，对App的启动速度有影响，应注意控制体积。组件引用的前景图不影响性能。</p><p>App端的 splash 关闭有白屏检测机制，如果首页一直白屏或首页本身就是一个空的中转页面，可能会造成 splash 10秒才关闭。</p><p>App端使用自定义组件模式时启动速度更快，首页为nvue页面时启动速度更快</p><p>App设置为纯nvue项目（<code>manifest</code>里设置<code>app-plus</code>下的<code>renderer:&quot;native&quot;</code>），这种项目的启动速度更快，2秒即可完成启动。因为它整个应用都使用原生渲染，不加载基于webview的那套框架。</p><p><img src="http://cdn.javanx.cn/wp-content/themes/lensnews2.2/images/201909/11/20191018142557.png" alt="&lt;code&gt;uni-app&lt;/code&gt;: 如何高效开发uni app?"></p><h2 id="优化包体积"><a href="#优化包体积" class="headerlink" title="优化包体积"></a>优化包体积</h2><p>1、<code>uni-app</code>发行到小程序时，自带引擎只有几十K，主要是一个定制过的vue.js核心库。如果使用了<code>es6</code>转<code>es5</code>、css对齐的功能，可能会增大代码体积，可以配置这些编译功能是否开启。</p><p>2、<code>uni-app</code>的H5端，自带了<code>vue.js</code>、<code>vue-rooter</code>及部分<code>es6 polyfill</code>库，这部分的体积gzip后只有92k，和web开发使用vue基本一致。而内置组件ui库（如picker、switch等）、小程序的对齐js api等，相当于一个完善的大型ui库。但大多数应用不会用到所有内置组件和API。由此<code>uni-app</code>提供了摇树优化机制，未摇树优化前的<code>uni-app</code>整体包体积约500k，服务器部署gzip后162k。开启摇树优化需在<code>manifest</code>配置。</p><p>3、<code>uni-app</code>的App端，因为自带了一个独立v8引擎和小程序框架，所以比<code>HTML5Plus</code>或<code>mui</code>等普通<code>hybrid</code>的App引擎体积要大。Android基础引擎约15M。App还提供了扩展模块，比如地图、蓝牙等，打包时如不需要这些模块，可以裁剪掉，以缩小发行包体积。在 <code>manifest.json-App</code>模块权限 里可以选择。</p><p>4、App端支持如果选择纯nvue项目（<code>manifest</code>里设置<code>app-plus</code>下的<code>renderer:&quot;native&quot;</code>），包体积可以进一步减少2M左右。</p><p>5、<code>uni-app</code>的App端默认包含arm32和x86两个cpu的支持so库。这会增大包体积。如果你在意体积控制，可以在manifest里去掉x86 cpu的支持（manifest可视化界面-App其他设置里选择cpu），这可以减少包体积到9M。但代价是不支持intel的cpu了。一般手机都是arm的，仅个别少见的Android pad使用x86 cpu。另外as的模拟器里如果选择x86时也无法运行这种apk。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><a href="http://www.javanx.cn/tag/性能优化/" target="_blank" rel="noopener">性能优化</a>可以总结以下几点：</p><p>1、减少页面级渲染<br>2、能用CSS解决的，不要用JS<br>3、减少M级图片，在保证分辨率的同时，尽量压缩图片<br>4、减少包的体积，去掉不必要的图片，字体文件备份文件等</p><p>同时，跟小伙们们说再见了，本专栏完结，同时回顾一下本专栏内容。本专栏主要通过一个简单的“天气”项目，让大家快速上手uni-app，从项目搭建、接口调用、原生交互、组件封装使用等，基本完成了一整套开发。</p><p>再次谢谢，支持我的小伙伴，期待下一次专栏能给大家带来更好更优质的内容。谢谢大家。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue的计算属性如何实现缓存</title>
      <link href="/2020/06/19/vue-de-ji-suan-shu-xing-ru-he-shi-xian-huan-cun/"/>
      <url>/2020/06/19/vue-de-ji-suan-shu-xing-ru-he-shi-xian-huan-cun/</url>
      
        <content type="html"><![CDATA[<blockquote><p>原文来自公众号：前端从进阶到入院</p></blockquote><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>很多人提起 Vue 中的 computed，第一反应就是计算属性会缓存，那么它到底是怎么缓存的呢？缓存的到底是什么，什么时候缓存会失效，相信还是有很多人对此很模糊。</p><p>本文以 Vue 2.6.11 版本为基础，就深入原理，带你来看看所谓的缓存到底是什么样的。</p><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>本文假定你对 Vue 响应式原理已经有了基础的了解，如果对于 <code>Watcher</code>、<code>Dep</code>和什么是 <code>渲染watcher</code> 等概念还不是很熟悉的话，可以先找一些基础的响应式原理的文章或者教程看一下。视频教程的话推荐黄轶老师的，如果想要看简化实现，也可以先看我写的文章：</p><p><strong>手把手带你实现一个最精简的响应式系统来学习Vue的data、computed、watch源码</strong>[1]</p><p>注意，这篇文章里我也写了 computed 的原理，但是这篇文章里的 computed 是基于 Vue 2.5 版本的，和当前 2.6 版本的变化还是非常大的，可以仅做参考。</p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>按照我的文章惯例，还是以一个最简的示例来演示。</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span>  <span class="token operator">&lt;</span>span @click<span class="token operator">=</span><span class="token string">"change"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>sum<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"./vue2.6.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span>  <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>这个例子很简单，刚开始页面上显示数字 <code>2</code>，点击数字后变成 <code>3</code>。</p><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><h3 id="回顾-watcher-的流程"><a href="#回顾-watcher-的流程" class="headerlink" title="回顾 watcher 的流程"></a>回顾 watcher 的流程</h3><p>进入正题，Vue 初次运行时会对 computed 属性做一些初始化处理，首先我们回顾一下 watcher 的概念，它的核心概念是 <code>get</code> 求值，和 <code>update</code> 更新。</p><ol><li>在求值的时候，它会先把<strong>自身</strong>也就是 watcher 本身赋值给 <code>Dep.target</code> 这个全局变量。</li><li>然后求值的过程中，会读取到响应式属性，那么响应式属性的 dep 就会收集到这个 watcher 作为依赖。</li><li>下次响应式属性更新了，就会从 dep 中找出它收集到的 watcher，触发 <code>watcher.update()</code> 去更新。</li></ol><p>所以最关键的就在于，这个 <code>get</code> 到底用来做什么，这个 <code>update</code> 会触发什么样的更新。</p><p>在基本的响应式更新视图的流程中，以上概念的 <code>get</code> 求值就是指 Vue 的组件重新渲染的函数，而 <code>update</code> 的时候，其实就是重新调用组件的渲染函数去更新视图。</p><p>而 Vue 中很巧妙的一点，就是这套流程也同样适用于 computed 的更新。</p><h3 id="初始化-computed"><a href="#初始化-computed" class="headerlink" title="初始化 computed"></a>初始化 computed</h3><p>这里先提前剧透一下，Vue 会对 options 中的每个 computed 属性也用 watcher 去包装起来，它的 <code>get</code> 函数显然就是要执行用户定义的求值函数，而 <code>update</code> 则是一个比较复杂的流程，接下来我会详细讲解。</p><p>首先在组件初始化的时候，会进入到初始化 computed 的函数</p><pre><code>if (opts.computed) { initComputed(vm, opts.computed); }</code></pre><p>进入 <code>initComputed</code> 看看</p><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> watchers <span class="token operator">=</span> vm<span class="token punctuation">.</span>_computedWatchers <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 依次为每个 computed 属性定义</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> userDef <span class="token operator">=</span> computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span>  watchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>      vm<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 实例</span>      getter<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 用户传入的求值函数 sum</span>      noop<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 回调函数 可以先忽视</span>      <span class="token punctuation">{</span> lazy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// 声明 lazy 属性 标记 computed watcher</span>  <span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// 用户在调用 this.sum 的时候，会发生的事情</span>  <span class="token function">defineComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> userDef<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>首先定义了一个空的对象，用来存放所有计算属性相关的 watcher，后文我们会把它叫做 <code>计算watcher</code>。</p><p>然后循环为每个 computed 属性生成了一个 <code>计算watcher</code>。</p><p>它的形态保留关键属性简化后是这样的：</p><pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>    deps<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    dirty<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    getter<span class="token punctuation">:</span> ƒ <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    lazy<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    value<span class="token punctuation">:</span> undefined<span class="token punctuation">}</span></code></pre><p>可以看到它的 <code>value</code> 刚开始是 undefined，<code>lazy</code> 是 true，说明它的值是惰性计算的，只有到真正在模板里去读取它的值后才会计算。</p><p>这个 <code>dirty</code> 属性其实是缓存的关键，先记住它。</p><p>接下来看看比较关键的 <code>defineComputed</code>，它决定了用户在读取 <code>this.sum</code> 这个计算属性的值后会发生什么，继续简化，排除掉一些不影响流程的逻辑。</p><pre class=" language-js"><code class="language-js">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>     <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 从刚刚说过的组件实例上拿到 computed watcher</span>        <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// ✨ 注意！这里只有dirty了才会重新求值</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>dirty<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 这里会求值 调用 get</span>            watcher<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">}</span>          <span class="token comment" spellcheck="true">// ✨ 这里也是个关键 等会细讲</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>            watcher<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">}</span>          <span class="token comment" spellcheck="true">// 最后返回计算出来的值</span>          <span class="token keyword">return</span> watcher<span class="token punctuation">.</span>value        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这个函数需要仔细看看，它做了好几件事，我们以初始化的流程来讲解它：</p><p>首先 <code>dirty</code> 这个概念代表脏数据，说明这个数据需要重新调用用户传入的 <code>sum</code> 函数来求值了。我们暂且不管更新时候的逻辑，第一次在模板中读取到  <code></code> 的时候它一定是 true，所以初始化就会经历一次求值。</p><pre class=" language-js"><code class="language-js">evaluate <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 调用 get 函数求值</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// 把 dirty 标记为 false</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span></code></pre><p>这个函数其实很清晰，它先求值，然后把 <code>dirty</code> 置为 false。</p><p>再回头看看我们刚刚那段 <code>Object.defineProperty</code> 的逻辑，</p><p>下次没有特殊情况再读取到 <code>sum</code> 的时候，发现 <code>dirty</code>是false了，是不是直接就返回 <code>watcher.value</code> 这个值就可以了，这其实就是<strong>计算属性缓存</strong>的概念。</p><h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><p>初始化的流程讲完了，相信大家也对 <code>dirty</code> 和 <code>缓存</code> 有了个大概的概念（如果没有，再仔细回头看一看）。</p><p>接下来就讲更新的流程，细化到本文的例子中，也就是 <code>count</code> 的更新到底是怎么触发 <code>sum</code> 在页面上的变更。</p><p>首先回到刚刚提到的 <code>evalute</code> 函数里，也就是读取 <code>sum</code> 时发现是脏数据的时候做的求值操作。</p><pre class=" language-js"><code class="language-js">evaluate <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 调用 get 函数求值</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// 把 dirty 标记为 false</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">}</span></code></pre><h4 id="Dep-target-变更为-渲染watcher"><a href="#Dep-target-变更为-渲染watcher" class="headerlink" title="Dep.target 变更为 渲染watcher"></a>Dep.target 变更为 渲染watcher</h4><p>这里进入 <code>this.get()</code>，首先要明确一点，在模板中读取 <code></code> 变量的时候，全局的 <code>Dep.target</code> 应该是 <code>渲染watcher</code>，这里不理解的话可以到我最开始提到的文章里去理解下。</p><p>全局的 <code>Dep.target</code> 状态是用一个栈 <code>targetStack</code> 来保存，便于前进和回退 <code>Dep.target</code>，至于什么时候会回退，接下来的函数里就可以看到。</p><pre class=" language-js"><code class="language-js">此时的 Dep<span class="token punctuation">.</span>target 是 渲染watcher，targetStack 是 <span class="token punctuation">[</span> 渲染watcher <span class="token punctuation">]</span> 。<span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> value  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm  <span class="token keyword">try</span> <span class="token punctuation">{</span>    value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>    <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> value<span class="token punctuation">}</span></code></pre><p>首先刚进去就 <code>pushTarget</code>，也就是把 <code>计算watcher</code> 自身置为 <code>Dep.target</code>，等待收集依赖。</p><p>执行完 <code>pushTarget(this)</code> 后，</p><h4 id="Dep-target-变更为-计算watcher"><a href="#Dep-target-变更为-计算watcher" class="headerlink" title="Dep.target 变更为 计算watcher"></a>Dep.target 变更为 计算watcher</h4><pre><code>此时的 Dep.target 是 计算watcher，targetStack 是 [ 渲染watcher，计算watcher ] 。</code></pre><p><code>getter</code> 函数，上一章的 watcher 形态里已经说明了，其实就是用户传入的 <code>sum</code> 函数。</p><pre class=" language-js"><code class="language-js"><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></code></pre><p>这里在执行的时候，读取到了 <code>this.count</code>，注意它是一个响应式的属性，所以冥冥之中它们开始建立了千丝万缕的联系……</p><p>这里会触发 <code>count</code> 的 <code>get</code> 劫持，简化一下</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在闭包中，会保留对于 count 这个 key 所定义的 dep</span><span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 闭包中也会保留上一次 set 函数所设置的 val</span><span class="token keyword">let</span> valObject<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>  <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span> reactiveGetter <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> value <span class="token operator">=</span> val    <span class="token comment" spellcheck="true">// Dep.target 此时就是计算watcher</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 收集依赖</span>      dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> value  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>那么可以看出，<code>count</code> 会收集 <code>计算watcher</code> 作为依赖，具体怎么收集呢</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// dep.depend()</span>depend <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Dep<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>其实这里是调用 <code>Dep.target.addDep(this)</code> 去收集，又绕回到 <code>计算watcher</code> 的 <code>addDep</code> 函数上去了，这其实主要是 Vue 内部做了一些去重的优化。</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// watcher 的 addDep函数</span>addDep <span class="token punctuation">(</span>dep<span class="token punctuation">:</span> Dep<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 这里做了一系列的去重操作 简化掉 </span>  <span class="token comment" spellcheck="true">// 这里会把 count 的 dep 也存在自身的 deps 上</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// 又带着 watcher 自身作为参数</span>  <span class="token comment" spellcheck="true">// 回到 dep 的 addSub 函数了</span>  dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>又回到 <code>dep</code> 上去了。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>  subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  addSub <span class="token punctuation">(</span>sub<span class="token punctuation">:</span> Watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>这样就保存了 <code>计算watcher</code> 作为 <code>count</code> 的 dep 里的依赖了。</p><p>经历了这样的一个收集的流程后，此时的一些状态：</p><p><code>sum 的计算watcher</code>：</p><pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>    deps<span class="token punctuation">:</span> <span class="token punctuation">[</span> count的dep <span class="token punctuation">]</span><span class="token punctuation">,</span>    dirty<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 求值完了 所以是false</span>    value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 1 + 1 = 2</span>    getter<span class="token punctuation">:</span> ƒ <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    lazy<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span></code></pre><p><code>count的dep</code>:</p><pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>    subs<span class="token punctuation">:</span> <span class="token punctuation">[</span> sum的计算watcher <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><p>可以看出，计算属性的 watcher 和它所依赖的响应式值的 dep，它们之间互相保留了彼此，相依为命。</p><p>此时求值结束，回到 <code>计算watcher</code> 的 <code>getter</code> 函数：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> value  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm  <span class="token keyword">try</span> <span class="token punctuation">{</span>    value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 此时执行到这里了</span>    <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> value<span class="token punctuation">}</span></code></pre><p>执行到了 <code>popTarget</code>，<code>计算watcher</code> 出栈。</p><h4 id="Dep-target-变更为-渲染watcher-1"><a href="#Dep-target-变更为-渲染watcher-1" class="headerlink" title="Dep.target 变更为 渲染watcher"></a>Dep.target 变更为 渲染watcher</h4><pre><code>此时的 Dep.target 是 渲染watcher，targetStack 是 [ 渲染watcher ] 。</code></pre><p>然后函数执行完毕，返回了 <code>2</code> 这个 value，此时对于 <code>sum</code> 属性的 <code>get</code> 访问还没结束。</p><pre class=" language-js"><code class="language-js">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>     <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// 此时函数执行到了这里</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>            watcher<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">}</span>          <span class="token keyword">return</span> watcher<span class="token punctuation">.</span>value        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>此时的 <code>Dep.target</code> 当然是有值的，就是 <code>渲染watcher</code>，所以进入了 <code>watcher.depend()</code> 的逻辑，这一步<strong>相当关键</strong>。</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// watcher.depend</span>depend <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>还记得刚刚的 <code>计算watcher</code> 的形态吗？它的 <code>deps</code> 里保存了 <code>count</code> 的 dep。</p><p>也就是说，又会调用 <code>count</code> 上的 <code>dep.depend()</code></p><pre class=" language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>  subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  depend <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>      Dep<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>这次的 <code>Dep.target</code> 已经是 <code>渲染watcher</code> 了，所以这个 <code>count</code> 的 dep 又会把 <code>渲染watcher</code> 存放进自身的 <code>subs</code> 中。</p><p><code>count的dep</code>:</p><pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>    subs<span class="token punctuation">:</span> <span class="token punctuation">[</span> sum的计算watcher，渲染watcher <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><p>那么来到了此题的重点，这时候 <code>count</code> 更新了，是如何去触发视图更新的呢？</p><p>再回到 <code>count</code> 的响应式劫持逻辑里去：</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在闭包中，会保留对于 count 这个 key 所定义的 dep</span><span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 闭包中也会保留上一次 set 函数所设置的 val</span><span class="token keyword">let</span> valObject<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>  <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span> reactiveSetter <span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>      val <span class="token operator">=</span> newVal      <span class="token comment" spellcheck="true">// 触发 count 的 dep 的 notify</span>      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>好，这里触发了我们刚刚精心准备的 <code>count</code> 的 dep 的 <code>notify</code> 函数，感觉离成功越来越近了。</p><pre class=" language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>  subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  notify <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> subs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      subs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>这里的逻辑就很简单了，把 <code>subs</code> 里保存的 watcher 依次去调用它们的 <code>update</code> 方法，也就是</p><ol><li>调用 <code>计算watcher</code> 的 update</li><li>调用 <code>渲染watcher</code> 的 update</li></ol><p>拆解来看。</p><h4 id="计算watcher-的-update"><a href="#计算watcher-的-update" class="headerlink" title="计算watcher 的 update"></a>计算watcher 的 update</h4><pre class=" language-js"><code class="language-js">update <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>wtf，就这么一句话…… 没错，就仅仅是把 <code>计算watcher</code> 的 <code>dirty</code> 属性置为 true，静静的等待下次读取即可。</p><h4 id="渲染watcher-的-update"><a href="#渲染watcher-的-update" class="headerlink" title="渲染watcher 的 update"></a>渲染watcher 的 update</h4><p>这里其实就是调用 <code>vm._update(vm._render())</code> 这个函数，重新根据 <code>render</code> 函数生成的 <code>vnode</code> 去渲染视图了。</p><p>而在 <code>render</code> 的过程中，一定会访问到 <code>sum</code> 这个值，那么又回回到 <code>sum</code> 定义的 <code>get</code> 上：</p><pre class=" language-js"><code class="language-js">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>     <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// ✨上一步中 dirty 已经置为 true, 所以会重新求值</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>dirty<span class="token punctuation">)</span> <span class="token punctuation">{</span>            watcher<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">}</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>            watcher<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">}</span>          <span class="token comment" spellcheck="true">// 最后返回计算出来的值</span>          <span class="token keyword">return</span> watcher<span class="token punctuation">.</span>value        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>由于上一步中的响应式属性更新，触发了 <code>计算 watcher</code> 的 <code>dirty</code> 更新为 true。所以又会重新调用用户传入的 <code>sum</code> 函数计算出最新的值，页面上自然也就显示出了最新的值。</p><p>至此为止，整个计算属性更新的流程就结束了。</p><h2 id="缓存生效的情况"><a href="#缓存生效的情况" class="headerlink" title="缓存生效的情况"></a>缓存生效的情况</h2><p>根据上面的总结，只有计算属性依赖的响应式值发生更新的时候，才会把 <code>dirty</code> 重置为 true，这样下次读取的时候才会发生真正的计算。</p><p>这样的话，假设 <code>sum</code> 函数是一个用户定义的一个比较耗费时间的操作，优化就比较明显了。</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span>  <span class="token operator">&lt;</span>span @click<span class="token operator">=</span><span class="token string">"change"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>sum<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>  <span class="token operator">&lt;</span>span @click<span class="token operator">=</span><span class="token string">"changeOther"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>other<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"./vue2.6.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span>  <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        other<span class="token punctuation">:</span> <span class="token string">'Hello'</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">changeOther</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>other <span class="token operator">=</span> <span class="token string">'ssh'</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 非常耗时的计算属性</span>      <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">100000</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            i<span class="token operator">--</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>在这个例子中，<code>other</code> 的值和计算属性没有任何关系，如果 <code>other</code> 的值触发更新的话，就会重新渲染视图，那么会读取到 <code>sum</code>，如果计算属性不做缓存的话，每次都要发生一次很耗费性能的没有必要的计算。</p><p>所以，只有在 <code>count</code> 发生变化的时候，<code>sum</code> 才会重新计算，这是一个很巧妙的优化。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>2.6 版本计算属性更新的路径是这样的：</p><ol><li>响应式的值 <code>count</code> 更新</li><li>同时通知 <code>computed watcher</code> 和 <code>渲染 watcher</code> 更新</li><li><code>omputed watcher</code> 把 dirty 设置为 true</li><li>视图渲染读取到 computed 的值，由于 dirty 所以 <code>computed watcher</code> 重新求值。</li></ol><p>通过本篇文章，相信你可以完全理解计算属性的缓存到底是什么概念，在什么样的情况下才会生效了吧？</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p>[1]手把手带你实现一个最精简的响应式系统来学习Vue的data、computed、watch源码: <em><a href="https://juejin.im/post/5db6433b51882564912fc30f" target="_blank" rel="noopener">https://juejin.im/post/5db6433b51882564912fc30f</a></em></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>package-lock.json 冲突解决</title>
      <link href="/2020/06/16/package-lock-json-chong-tu-jie-jue/"/>
      <url>/2020/06/16/package-lock-json-chong-tu-jie-jue/</url>
      
        <content type="html"><![CDATA[<blockquote><p>建议读文章<a href="https://blog.csdn.net/weixin_43820866/article/details/105232066" target="_blank" rel="noopener">npm的package.json和package-lock.json更新策略</a></p></blockquote><h2 id="漏洞出现原因"><a href="#漏洞出现原因" class="headerlink" title="漏洞出现原因"></a>漏洞出现原因</h2><p>github上的前端项目通常会出现这种依赖警告</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200616212136.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200616212603.png" alt=""></p><p>这个是因为在开发过程中使用的是cnpm，cnpm是不会修改package-lock.json里面的依赖</p><p>cnpm install不受package-lock.json影响，只会根据package.json进行下载</p><p>cnpm i xxx@xxx不会跟新到package-lock.json中去而npm会</p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>第一种办法就是一个包一个包的的npm install去更新，这样package-lock.json的依赖也会更新</p><p>第二种办法就是npm install prune ddp，这样就可以把package.json的包版本跟package-lock.json的依赖同步，然后如果github上还是出现高危漏洞警告就可以一个个npm install去更细包了</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Service Worker</title>
      <link href="/2020/06/12/service-worker/"/>
      <url>/2020/06/12/service-worker/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文出自公众号：前端瓶子君</p><p>原文地址<a href="https://mp.weixin.qq.com/s/8mjrSeQfG2m5Kpkb13EPAg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/8mjrSeQfG2m5Kpkb13EPAg</a></p></blockquote><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文首先会简单介绍下前端的常见缓存方式，再引入serviceworker的概念，针对其原理和如何运用进行介绍。然后基于google推出的第三方库workbox，在产品中进行运用实践，并对其原理进行简要剖析。</p><h2 id="前端缓存简介"><a href="#前端缓存简介" class="headerlink" title="前端缓存简介"></a>前端缓存简介</h2><p>先简单介绍一下现有的前端缓存技术方案，主要分为http缓存和浏览器缓存。</p><h3 id="http缓存"><a href="#http缓存" class="headerlink" title="http缓存"></a>http缓存</h3><p>http缓存都是第二次请求时开始的，这也是个老生常谈的话题了。无非也是那几个http头的问题：</p><h4 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h4><p>HTTP1.0的内容，服务器使用Expires头来告诉Web客户端它可以使用当前副本，直到指定的时间为止。</p><h4 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h4><p>HTTP1.1引入了Cathe-Control，它使用max-age指定资源被缓存多久，主要是解决了Expires一个重大的缺陷，就是它设置的是一个固定的时间点，客户端时间和服务端时间可能有误差。</p><p>所以一般会把两个头都带上，这种缓存称为<strong>强缓存</strong>，表现形式为：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175720" alt="img"></p><h4 id="Last-Modified-If-Modified-Since"><a href="#Last-Modified-If-Modified-Since" class="headerlink" title="Last-Modified / If-Modified-Since"></a>Last-Modified / If-Modified-Since</h4><p>Last-Modified是服务器告诉浏览器该资源的最后修改时间，If-Modified-Since是请求头带上的，上次服务器给自己的该资源的最后修改时间。然后服务器拿去对比。</p><p>若资源的最后修改时间大于If-Modified-Since，说明资源又被改动过，则响应整片资源内容，返回状态码200；</p><p>若资源的最后修改时间小于或等于If-Modified-Since，说明资源无新修改，则响应<strong>HTTP 304</strong>，告知浏览器继续使用当前版本。</p><h4 id="Etag-If-None-Match"><a href="#Etag-If-None-Match" class="headerlink" title="Etag / If-None-Match"></a>Etag / If-None-Match</h4><p>前面提到由文件的修改时间来判断文件是否改动，还是会带来一定的误差，比如注释等无关紧要的修改等。所以推出了新的方式。</p><p>Etag是由服务端特定算法生成的该文件的唯一标识，而请求头把返回的Etag值通过If-None-Match再带给服务端，服务端通过比对从而决定是否响应新内容。这也是304缓存。</p><h3 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h3><h4 id="storage"><a href="#storage" class="headerlink" title="storage"></a>storage</h4><p>简单的缓存方式有cookie，localStorage和sessionStorage。这里就不详细介绍他们的区别了，这里说下通过localStorage来缓存静态资源的优化方案。</p><p>localStorage通常有5MB的存储空间，我们以[微信文章页](<a href="https://mp.weixin.qq.com/s?__biz=MzAwNjMxMTA5Mw==&amp;mid=2651340686&amp;idx=1&amp;sn=3714a2d0941667bed71228c66351ee76&amp;chksm=80f3c254b7844b42f38f61de40a50076d69a1fe752c46348e4121525d12144f0bedbb90c79c6&amp;mpshare=1&amp;scene=21&amp;srcid=0906lJRVVg3vsE0wP2BnDlLu&amp;key=ff3a3f386f4471abb7bae740ce6af96999ee908a3e121c460d8a5152d30f4a98db19585834e9746bf411d11071c558231692934f2c20adf0a393c35d83836ee543b76a7f95ffdc8192edbfaac941f906&amp;ascene=0&amp;uin=MjUwMTIyNjY4Mg==&amp;devicetype=iMac" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzAwNjMxMTA5Mw==&amp;mid=2651340686&amp;idx=1&amp;sn=3714a2d0941667bed71228c66351ee76&amp;chksm=80f3c254b7844b42f38f61de40a50076d69a1fe752c46348e4121525d12144f0bedbb90c79c6&amp;mpshare=1&amp;scene=21&amp;srcid=0906lJRVVg3vsE0wP2BnDlLu&amp;key=ff3a3f386f4471abb7bae740ce6af96999ee908a3e121c460d8a5152d30f4a98db19585834e9746bf411d11071c558231692934f2c20adf0a393c35d83836ee543b76a7f95ffdc8192edbfaac941f906&amp;ascene=0&amp;uin=MjUwMTIyNjY4Mg==&amp;devicetype=iMac</a> MacBookPro13,2 OSX OSX 10.12.1 build(16B2657)&amp;version=12020810&amp;nettype=WIFI&amp;lang=zh_CN&amp;fontScale=100&amp;pass_ticket=b33mKzDsMeDiiLYT97yWzaAceoFf/ly7szwZmE/62 tvutX3nrerhLuye wpBGCb#wechat_redirect)为例。</p><p>查看请求发现，基本没有js和css的请求，因为它把全部的不需要改动的资源都放到了localStorage中：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175729" alt="img"></p><p>所以微信的文章页加载非常的快。</p><h4 id="前端数据库"><a href="#前端数据库" class="headerlink" title="前端数据库"></a>前端数据库</h4><p>前端数据库有WebSql和IndexDB，其中WebSql被规范废弃，他们都有大约50MB的最大容量，可以理解为localStorage的加强版。</p><h4 id="应用缓存"><a href="#应用缓存" class="headerlink" title="应用缓存"></a>应用缓存</h4><p>应用缓存主要是通过manifest文件来注册被缓存的静态资源，已经被废弃，因为他的设计有些不合理的地方，他在缓存静态文件的同时，也会默认缓存html文件。这导致页面的更新只能通过manifest文件中的版本号来决定。所以，应用缓存只适合那种常年不变化的静态网站。如此的不方便，也是被废弃的重要原因。</p><p>PWA也运用了该文件，不同于manifest简单的将文件通过是否缓存进行分类，PWA用manifest构建了自己的APP骨架，<strong>并运用Servie Worker来控制缓存</strong>，这也是今天的主角。</p><h2 id="Service-Worker"><a href="#Service-Worker" class="headerlink" title="Service Worker"></a>Service Worker</h2><p>Service Worker本质上也是浏览器缓存资源用的，只不过他不仅仅是cache，也是通过worker的方式来进一步优化。</p><p>他基于h5的web worker，所以绝对不会阻碍当前js线程的执行，sw最重要的工作原理就是</p><p>1、后台线程：独立于当前网页线程；</p><p>2、网络代理：在网页发起请求时代理，来缓存文件；</p><h3 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175735" alt="img"></p><p>可以看到，基本上新版浏览器还是兼容滴。之前是只有chrome和firefox支持，现在微软和苹果也相继支持了。</p><h3 id="成熟程度"><a href="#成熟程度" class="headerlink" title="成熟程度"></a>成熟程度</h3><p>判断一个技术是否值得尝试，肯定要考虑下它的成熟程度，否则过一段时间又和应用缓存一样被规范抛弃就尴尬了。</p><p>所以这里我列举了几个使用Service Worker的页面：</p><p>淘宝</p><p>网易新闻</p><p>考拉</p><p>所以说还是可以尝试下的。</p><h3 id="调试方法"><a href="#调试方法" class="headerlink" title="调试方法"></a>调试方法</h3><p>一个网站是否启用Service Worker，可以通过开发者工具中的Application来查看：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175754" alt="img"></p><p>被Service Worker缓存的文件，可以在Network中看到Size项为 from ServiceWorker：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175800" alt="img"></p><p>也可以在Application的Cache Storage中查看缓存的具体内容：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175805" alt="img"></p><p>如果是具体的断点调试，需要使用对应的线程，不再是main线程了，这也是webworker的通用调试方法：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175811" alt="img"></p><h3 id="使用条件"><a href="#使用条件" class="headerlink" title="使用条件"></a>使用条件</h3><p>sw 是基于 HTTPS 的，因为service worker中涉及到请求拦截，所以必须使用HTTPS协议来保障安全。如果是本地调试的话，localhost是可以的。</p><p>而我们刚好全站强制https化，所以正好可以使用。</p><h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p>大概可以用如下图片来解释：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175816" alt="img"></p><h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><p>要使用Service worker，首先需要注册一个sw，通知浏览器为该页面分配一块内存，然后sw就会进入安装阶段。</p><p>一个简单的注册方式：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>        navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'./sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>当然也可以考虑全面点，参考网易新闻的注册方式：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">"serviceWorker"</span> <span class="token keyword">in</span> navigator <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"load"</span><span class="token punctuation">,</span>    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> e <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/\/news\/[a-z]{1,}\//</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"article-sw.js?v=08494f887a520e6455fa"</span><span class="token punctuation">;</span>        navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>            n<span class="token punctuation">.</span>onupdatefound <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">var</span> e <span class="token operator">=</span> n<span class="token punctuation">.</span>installing<span class="token punctuation">;</span>                e<span class="token punctuation">.</span>onstatechange <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">switch</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">case</span> <span class="token string">"installed"</span><span class="token punctuation">:</span>                            navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>controller <span class="token operator">?</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"New or updated content is available."</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Content is now available offline!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">break</span><span class="token punctuation">;</span>                        <span class="token keyword">case</span> <span class="token string">"redundant"</span><span class="token punctuation">:</span>                            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"The installing service worker became redundant."</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>        <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Error during service worker registration:"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>前面提到过，由于sw会监听和代理所有的请求，所以<strong>sw的作用域</strong>就显得额外的重要了，比如说我们只想监听我们专题页的所有请求，就在注册时指定路径：</p><pre><code>navigator.serviceWorker.register(&#39;/topics/sw.js&#39;);</code></pre><p>这样就只会对topics/下面的路径进行优化。</p><h4 id="installing"><a href="#installing" class="headerlink" title="installing"></a>installing</h4><p>我们注册后，浏览器就会开始安装sw，可以通过事件监听：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//service worker安装成功后开始缓存所需的资源</span><span class="token keyword">var</span> CACHE_PREFIX <span class="token operator">=</span> <span class="token string">'cms-sw-cache'</span><span class="token punctuation">;</span><span class="token keyword">var</span> CACHE_VERSION <span class="token operator">=</span> <span class="token string">'0.0.20'</span><span class="token punctuation">;</span><span class="token keyword">var</span> CACHE_NAME <span class="token operator">=</span> CACHE_PREFIX<span class="token operator">+</span><span class="token string">'-'</span><span class="token operator">+</span>CACHE_VERSION<span class="token punctuation">;</span><span class="token keyword">var</span> allAssets <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'./main.css'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//调试时跳过等待过程</span>    self<span class="token punctuation">.</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Perform install steps</span>    <span class="token comment" spellcheck="true">//首先 event.waitUntil 你可以理解为 new Promise，</span>    <span class="token comment" spellcheck="true">//它接受的实际参数只能是一个 promise，因为,caches 和 cache.addAll 返回的都是 Promise，</span>    <span class="token comment" spellcheck="true">//这里就是一个串行的异步加载，当所有加载都成功时，那么 SW 就可以下一步。</span>    <span class="token comment" spellcheck="true">//另外，event.waitUntil 还有另外一个重要好处，它可以用来延长一个事件作用的时间，</span>    <span class="token comment" spellcheck="true">//这里特别针对于我们 SW 来说，比如我们使用 caches.open 是用来打开指定的缓存，但开启的时候，</span>    <span class="token comment" spellcheck="true">//并不是一下就能调用成功，也有可能有一定延迟，由于系统会随时睡眠 SW，所以，为了防止执行中断，</span>    <span class="token comment" spellcheck="true">//就需要使用 event.waitUntil 进行捕获。另外，event.waitUntil 会监听所有的异步 promise</span>    <span class="token comment" spellcheck="true">//如果其中一个 promise 是 reject 状态，那么该次 event 是失败的。这就导致，我们的 SW 开启失败。</span>    event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>        caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>CACHE_NAME<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[SW]: Opened cache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>allAssets<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>安装时，sw就开始缓存文件了，会检查所有文件的缓存状态，如果都已经缓存了，则安装成功，进入下一阶段。</p><h4 id="activated"><a href="#activated" class="headerlink" title="activated"></a>activated</h4><p>如果是第一次加载sw，在安装后，会直接进入activated阶段，而如果sw进行更新，情况就会显得复杂一些。流程如下：</p><p>首先老的sw为A，新的sw版本为B。B进入install阶段，而A还处于工作状态，所以B进入waiting阶段。只有等到A被terminated后，B才能正常替换A的工作。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175841" alt="img"></p><p>这个terminated的时机有如下几种方式：</p><p>1、关闭浏览器一段时间；</p><p>2、手动清除serviceworker；</p><p>3、在sw安装时直接跳过waiting阶段</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//service worker安装成功后开始缓存所需的资源</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//跳过等待过程</span>    self<span class="token punctuation">.</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>然后就进入了activated阶段，激活sw工作。</p><p>activated阶段可以做很多有意义的事情，比如更新存储在cache中的key和value：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> CACHE_PREFIX <span class="token operator">=</span> <span class="token string">'cms-sw-cache'</span><span class="token punctuation">;</span><span class="token keyword">var</span> CACHE_VERSION <span class="token operator">=</span> <span class="token string">'0.0.20'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * 找出对应的其他key并进行删除操作 * @returns {*} */</span><span class="token keyword">function</span> <span class="token function">deleteOldCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> all <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>CACHE_PREFIX<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>CACHE_VERSION<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[SW]: Delete cache:'</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>all<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//sw激活阶段,说明上一sw已失效</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>        <span class="token comment" spellcheck="true">// 遍历 caches 里所有缓存的 keys 值</span>        caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>deleteOldCaches<span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="idle"><a href="#idle" class="headerlink" title="idle"></a>idle</h4><p>这个空闲状态一般是不可见的，这种一般说明sw的事情都处理完毕了，然后处于闲置状态了。</p><p>浏览器会周期性的轮询，去释放处于idle的sw占用的资源。</p><h4 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h4><p>该阶段是sw最为关键的一个阶段，用于拦截代理所有指定的请求，并进行对应的操作。</p><p>所有的缓存部分，都是在该阶段，这里举一个简单的例子：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//监听浏览器的所有fetch请求，对已经缓存的资源使用本地缓存回复</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>        caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//该fetch请求已经缓存</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">return</span> response<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>生命周期大概讲清楚了，我们就以一个具体的例子来说明下原生的serviceworker是如何在生产环境中使用的吧。</p><h3 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h3><p>我们可以以网易新闻的wap页为例,其针对不怎么变化的静态资源开启了sw缓存，具体的sw.js逻辑和解读如下：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//需要缓存的资源列表</span><span class="token keyword">var</span> precacheConfig <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/bg_img_sm_minfy.png"</span><span class="token punctuation">,</span>        <span class="token string">"c4f55f5a9784ed2093009dadf1e954f9"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/change.png"</span><span class="token punctuation">,</span>        <span class="token string">"9af1b102ef784b8ff08567ba25f31d95"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/icon-download.png"</span><span class="token punctuation">,</span>        <span class="token string">"1c02c724381d77a1a19ca18925e9b30c"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/icon-login-dark.png"</span><span class="token punctuation">,</span>        <span class="token string">"b59ba5abe97ff29855dfa4bd3a7a9f35"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/icon-refresh.png"</span><span class="token punctuation">,</span>        <span class="token string">"a5b1084e41939885969a13f8dbc88abd"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/icon-video-play.png"</span><span class="token punctuation">,</span>        <span class="token string">"065ff496d7d36345196d254aff027240"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/icon.ico"</span><span class="token punctuation">,</span>        <span class="token string">"a14e5365cc2b27ec57e1ab7866c6a228"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/iconfont_1.eot"</span><span class="token punctuation">,</span>        <span class="token string">"e4d2788fef09eb0630d66cc7e6b1ab79"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/iconfont_1.svg"</span><span class="token punctuation">,</span>        <span class="token string">"d9e57c341608fddd7c140570167bdabb"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/iconfont_1.ttf"</span><span class="token punctuation">,</span>        <span class="token string">"f422407038a3180bb3ce941a4a52bfa2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/iconfont_1.woff"</span><span class="token punctuation">,</span>        <span class="token string">"ead2bef59378b00425779c4ca558d9bd"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/index.5cdf03e8.js"</span><span class="token punctuation">,</span>        <span class="token string">"6262ac947d12a7b0baf32be79e273083"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/index.bc729f8a.css"</span><span class="token punctuation">,</span>        <span class="token string">"58e54a2c735f72a24715af7dab757739"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/logo-app-bohe.png"</span><span class="token punctuation">,</span>        <span class="token string">"ac5116d8f5fcb3e7c49e962c54ff9766"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/logo-app-mail.png"</span><span class="token punctuation">,</span>        <span class="token string">"a12bbfaeee7fbf025d5ee85634fca1eb"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/logo-app-manhua.png"</span><span class="token punctuation">,</span>        <span class="token string">"b8905b119cf19a43caa2d8a0120bdd06"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/logo-app-open.png"</span><span class="token punctuation">,</span>        <span class="token string">"b7cc76ba7874b2132f407049d3e4e6e6"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/logo-app-read.png"</span><span class="token punctuation">,</span>        <span class="token string">"e6e9c8bc72f857960822df13141cbbfd"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/logo-site.png"</span><span class="token punctuation">,</span>        <span class="token string">"2b0d728b46518870a7e2fe424e9c0085"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/version_no_pic.png"</span><span class="token punctuation">,</span>        <span class="token string">"aef80885188e9d763282735e53b25c0e"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/version_pc.png"</span><span class="token punctuation">,</span>        <span class="token string">"42f3cc914eab7be4258fac3a4889d41d"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"https://static.ws.126.net/163/wap/f2e/milk_index/version_standard.png"</span><span class="token punctuation">,</span>        <span class="token string">"573408fa002e58c347041e9f41a5cd0d"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> cacheName <span class="token operator">=</span> <span class="token string">'sw-precache-v3-new-wap-index-'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>registration <span class="token operator">?</span> self<span class="token punctuation">.</span>registration<span class="token punctuation">.</span>scope <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> ignoreUrlParametersMatching <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">/</span><span class="token operator">^</span>utm_<span class="token operator">/</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> addDirectoryIndex <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>originalUrl<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>originalUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        url<span class="token punctuation">.</span>pathname <span class="token operator">+</span><span class="token operator">=</span> index<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> url<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> cleanResponse <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>originalResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// If this is not a redirected response, then we don't have to do anything.</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>originalResponse<span class="token punctuation">.</span>redirected<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>originalResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// Firefox 50 and below doesn't support the Response.body stream, so we may</span>    <span class="token comment" spellcheck="true">// need to read the entire body to memory as a Blob.</span>    <span class="token keyword">var</span> bodyPromise <span class="token operator">=</span> <span class="token string">'body'</span> <span class="token keyword">in</span> originalResponse <span class="token operator">?</span>        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>originalResponse<span class="token punctuation">.</span>body<span class="token punctuation">)</span> <span class="token punctuation">:</span>        originalResponse<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> bodyPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// new Response() is happy when passed either a stream or a Blob.</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span>            headers<span class="token punctuation">:</span> originalResponse<span class="token punctuation">.</span>headers<span class="token punctuation">,</span>            status<span class="token punctuation">:</span> originalResponse<span class="token punctuation">.</span>status<span class="token punctuation">,</span>            statusText<span class="token punctuation">:</span> originalResponse<span class="token punctuation">.</span>statusText        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> createCacheKey <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>originalUrl<span class="token punctuation">,</span> paramName<span class="token punctuation">,</span> paramValue<span class="token punctuation">,</span>                              dontCacheBustUrlsMatching<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// Create a new URL object to avoid modifying originalUrl.</span>    <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>originalUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// If dontCacheBustUrlsMatching is not set, or if we don't have a match,</span>    <span class="token comment" spellcheck="true">// then add in the extra cache-busting URL parameter.</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dontCacheBustUrlsMatching <span class="token operator">||</span>        <span class="token operator">!</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>dontCacheBustUrlsMatching<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        url<span class="token punctuation">.</span>search <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>search <span class="token operator">?</span> <span class="token string">'&amp;'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span>            <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>paramName<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>paramValue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> url<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> isPathWhitelisted <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>whitelist<span class="token punctuation">,</span> absoluteUrlString<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// If the whitelist is empty, then consider all URLs to be whitelisted.</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>whitelist<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// Otherwise compare each path regex to the path of the URL passed in.</span>    <span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>absoluteUrlString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>    <span class="token keyword">return</span> whitelist<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>whitelistedPathRegex<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>whitelistedPathRegex<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> stripIgnoredUrlParameters <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>originalUrl<span class="token punctuation">,</span>                                         ignoreUrlParametersMatching<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>originalUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Remove the hash; see https://github.com/GoogleChrome/sw-precache/issues/290</span>    url<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    url<span class="token punctuation">.</span>search <span class="token operator">=</span> url<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// Exclude initial '?'</span>        <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// Split into an array of 'key=value' strings</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> kv<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Split each 'key=value' string into a [key, value] array</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> ignoreUrlParametersMatching<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>ignoredRegex<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token operator">!</span>ignoredRegex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>kv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Return true iff the key doesn't match any of the regexes.</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> kv<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Join each [key, value] array into a 'key=value' string</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Join the array of 'key=value' strings into a string with '&amp;' in between each</span>    <span class="token keyword">return</span> url<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> hashParamName <span class="token operator">=</span> <span class="token string">'_sw-precache'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//定义需要缓存的url列表</span><span class="token keyword">var</span> urlsToCacheKeys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>    precacheConfig<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> relativeUrl <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> hash <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> absoluteUrl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>relativeUrl<span class="token punctuation">,</span> self<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> cacheKey <span class="token operator">=</span> <span class="token function">createCacheKey</span><span class="token punctuation">(</span>absoluteUrl<span class="token punctuation">,</span> hashParamName<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>absoluteUrl<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cacheKey<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//把cache中的url提取出来,进行去重操作</span><span class="token keyword">function</span> <span class="token function">setOfCachedUrls</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>requests<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//提取url</span>        <span class="token keyword">return</span> requests<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//去重</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//sw安装阶段</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>        <span class="token comment" spellcheck="true">//首先尝试取出存在客户端cache中的数据</span>        caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">setOfCachedUrls</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cachedUrls<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>                    Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>urlsToCacheKeys<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">//如果需要缓存的url不在当前cache中,则添加到cache</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cachedUrls<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token comment" spellcheck="true">//设置same-origin是为了兼容旧版本safari中其默认值不为same-origin,</span>                            <span class="token comment" spellcheck="true">//只有当URL与响应脚本同源才发送 cookies、 HTTP Basic authentication 等验证信息</span>                            <span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> <span class="token punctuation">{</span>credentials<span class="token punctuation">:</span> <span class="token string">'same-origin'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                <span class="token comment" spellcheck="true">//通过fetch api请求资源</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Request for '</span> <span class="token operator">+</span> cacheKey <span class="token operator">+</span> <span class="token string">' returned a '</span> <span class="token operator">+</span>                                        <span class="token string">'response with status '</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">}</span>                                <span class="token keyword">return</span> <span class="token function">cleanResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>responseToCache<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                    <span class="token comment" spellcheck="true">//并设置到当前cache中</span>                                    <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> responseToCache<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//强制跳过等待阶段,进入激活阶段</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//清除cache中原来老的一批相同key的数据</span>    <span class="token keyword">var</span> setOfExpectedUrls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>urlsToCacheKeys<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>        caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>existingRequests<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>                    existingRequests<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>existingRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>setOfExpectedUrls<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>existingRequest<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token comment" spellcheck="true">//cache中删除指定对象</span>                            <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>existingRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//self相当于webworker线程的当前作用域</span>            <span class="token comment" spellcheck="true">//当一个 service worker 被初始注册时，页面在下次加载之前不会使用它。claim() 方法会立即控制这些页面</span>            <span class="token comment" spellcheck="true">//从而更新客户端上的serviceworker</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 标识位,用来判断是否需要缓存</span>        <span class="token keyword">var</span> shouldRespond<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 对url进行一些处理,移除一些不必要的参数</span>        <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">stripIgnoredUrlParameters</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> ignoreUrlParametersMatching<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 如果该url不是我们想要缓存的url,置为false</span>        shouldRespond <span class="token operator">=</span> urlsToCacheKeys<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 如果shouldRespond未false,再次验证</span>        <span class="token keyword">var</span> directoryIndex <span class="token operator">=</span> <span class="token string">'index.html'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>shouldRespond <span class="token operator">&amp;&amp;</span> directoryIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>            url <span class="token operator">=</span> <span class="token function">addDirectoryIndex</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> directoryIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>            shouldRespond <span class="token operator">=</span> urlsToCacheKeys<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 再次验证,判断其是否是一个navigation类型的请求</span>        <span class="token keyword">var</span> navigateFallback <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>shouldRespond <span class="token operator">&amp;&amp;</span>            navigateFallback <span class="token operator">&amp;&amp;</span>            <span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'navigate'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>            <span class="token function">isPathWhitelisted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>navigateFallback<span class="token punctuation">,</span> self<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            shouldRespond <span class="token operator">=</span> urlsToCacheKeys<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 如果标识位为true</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldRespond<span class="token punctuation">)</span> <span class="token punctuation">{</span>            event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>                caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">//去缓存cache中找对应的url的值</span>                    <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>urlsToCacheKeys<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">//如果找到了,就返回value</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token keyword">return</span> response<span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'The cached response that was expected is missing.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// 如果没找到则请求该资源</span>                    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Couldn\'t serve response for "%s" from cache: %O'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这里的策略大概就是优先在cache中寻找资源，如果找不到再请求资源。可以看出，为了实现一个较为简单的缓存，还是比较复杂和繁琐的，所以很多工具就应运而生了。</p><h2 id="Workbox"><a href="#Workbox" class="headerlink" title="Workbox"></a>Workbox</h2><p>由于直接写原生的sw.js，比较繁琐和复杂，所以一些工具就出现了，而workbox是其中的佼佼者，由google团队推出。</p><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>在 Workbox 之前，GoogleChrome 团队较早时间推出过 sw-precache 和 sw-toolbox 库，但是在 GoogleChrome 工程师们看来，workbox 才是真正能方便统一的处理离线能力的更完美的方案，所以停止了对 sw-precache 和 sw-toolbox 的维护。</p><h3 id="使用者"><a href="#使用者" class="headerlink" title="使用者"></a>使用者</h3><p>有很多团队也是启用该工具来实现serviceworker的缓存，比如说：</p><p>淘宝首页</p><p>网易新闻wap文章页</p><p>百度的Lavas</p><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><p>首先，需要在项目的sw.js文件中，引入workbox的官方js，这里用了我们自己的静态资源：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">importScripts</span><span class="token punctuation">(</span>    <span class="token string">"https://edu-cms.nosdn.127.net/topics/js/workbox_9cc4c3d662a4266fe6691d0d5d83f4dc.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>其中importScripts是webworker中加载js的方式。</p><p>引入workbox后，全局会挂载一个workbox对象</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>workbox<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'workbox加载成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'workbox加载失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>然后需要在使用其他的api前，提前使用配置</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//关闭控制台中的输出</span>workbox<span class="token punctuation">.</span><span class="token function">setConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>也可以统一指定存储时cache的名称：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//设置缓存cachestorage的名称</span>workbox<span class="token punctuation">.</span>core<span class="token punctuation">.</span><span class="token function">setCacheNameDetails</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    prefix<span class="token punctuation">:</span><span class="token string">'edu-cms'</span><span class="token punctuation">,</span>    suffix<span class="token punctuation">:</span><span class="token string">'v1'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="precache"><a href="#precache" class="headerlink" title="precache"></a>precache</h3><p>workbox的缓存分为两种，一种的precache，一种的runtimecache。</p><p>precache对应的是在installing阶段进行读取缓存的操作。它让开发人员可以确定缓存文件的时间和长度，以及在不进入网络的情况下将其提供给浏览器，这意味着它可以用于创建Web离线工作的应用。</p><h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><p>首次加载Web应用程序时，workbox会下载指定的资源，并存储具体内容和相关修订的信息在indexedDB中。</p><p>当资源内容和sw.js更新后，workbox会去比对资源，然后将新的资源存入cache，并修改indexedDB中的版本信息。</p><p>我们举一个例子：</p><pre class=" language-javascript"><code class="language-javascript">workbox<span class="token punctuation">.</span>precaching<span class="token punctuation">.</span><span class="token function">precacheAndRoute</span><span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token string">'./main.css'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175858" alt="img"></p><p>indexedDB中会保存其相关信息</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175904" alt="img"></p><p>这个时候我们把main.css的内容改变后，再刷新页面，会发现除非强制刷新，否则workbox还是会读取cache中存在的老的main.css内容。</p><p>即使我们把main.css从服务器上删除，也不会对页面造成影响。</p><p>所以这种方式的缓存都需要配置一个版本号。在修改sw.js时，对应的版本也需要变更。</p><h4 id="使用实践"><a href="#使用实践" class="headerlink" title="使用实践"></a>使用实践</h4><p>当然了，一般我们的一些不经常变的资源，都会使用cdn，所以这里自然就需要支持域外资源了，配置方式如下：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fileList <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>        url<span class="token punctuation">:</span><span class="token string">'https://edu-cms.nosdn.127.net/topics/js/cms_specialWebCommon_js_f26c710bd7cd055a64b67456192ed32a.js'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        url<span class="token punctuation">:</span><span class="token string">'https://static.ws.126.net/163/frontend/share/css/article.207ac19ad70fd0e54d4a.css'</span>    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//precache 适用于支持跨域的cdn和域内静态资源</span>workbox<span class="token punctuation">.</span>precaching<span class="token punctuation">.</span><span class="token function">suppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>workbox<span class="token punctuation">.</span>precaching<span class="token punctuation">.</span><span class="token function">precacheAndRoute</span><span class="token punctuation">(</span>fileList<span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token string">"ignoreUrlParametersMatching"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这里需要对应的资源配置跨域允许头，否则是不能正常加载的。且文件都要以版本文件名的方式，来确保修改后cache和indexDB会得到更新。</p><p>理解了原理和实践后，说明这种方式适合于上线后就不会经常变动的静态资源。</p><h3 id="runtimecache"><a href="#runtimecache" class="headerlink" title="runtimecache"></a>runtimecache</h3><p>运行时缓存是在install之后，activated和fetch阶段做的事情。</p><p>既然在fetch阶段发送，那么runtimecache 往往应对着各种类型的资源，对于不同类型的资源往往也有不同的缓存策略。</p><h4 id="缓存策略"><a href="#缓存策略" class="headerlink" title="缓存策略"></a>缓存策略</h4><p>workbox提供的缓存策划有以下几种，通过不同的配置可以针对自己的业务达到不同的效果：</p><h5 id="staleWhileRevalidate"><a href="#staleWhileRevalidate" class="headerlink" title="staleWhileRevalidate"></a>staleWhileRevalidate</h5><p>这种策略的意思是当请求的路由有对应的 Cache 缓存结果就直接返回，在返回 Cache 缓存结果的同时会在后台发起网络请求拿到请求结果并更新 Cache 缓存，如果本来就没有 Cache 缓存的话，直接就发起网络请求并返回结果，这对用户来说是一种<strong>非常安全</strong>的策略，能保证用户最快速的拿到请求的结果。</p><p>但是也有一定的缺点，就是还是会有网络请求占用了用户的网络带宽。可以像如下的方式使用 State While Revalidate 策略：</p><pre class=" language-javascript"><code class="language-javascript">workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>    <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'https://edu-cms\.nosdn\.127\.net/topics/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span><span class="token function">staleWhileRevalidate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//cache名称</span>        cacheName<span class="token punctuation">:</span> <span class="token string">'lf-sw:static'</span><span class="token punctuation">,</span>        plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>            <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//cache最大数量</span>                maxEntries<span class="token punctuation">:</span> <span class="token number">30</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h5 id="networkFirst"><a href="#networkFirst" class="headerlink" title="networkFirst"></a>networkFirst</h5><p>这种策略就是当请求路由是被匹配的，就采用网络优先的策略，也就是优先尝试拿到网络请求的返回结果，如果拿到网络请求的结果，就将结果返回给客户端并且写入 Cache 缓存。</p><p><strong>如果网络请求失败</strong>，那最后被缓存的 Cache 缓存结果就会被返回到客户端，这种策略一般适用于返回结果不太固定或对实时性有要求的请求，为网络请求失败进行兜底。可以像如下方式使用 Network First 策略：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//自定义要缓存的html列表</span><span class="token keyword">var</span> cacheList <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'/Hexo/public/demo/PWADemo/workbox/index.html'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">//自定义过滤方法</span>    <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 需要缓存的HTML路径列表</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>url<span class="token punctuation">.</span>host <span class="token operator">===</span> <span class="token string">'localhost:63342'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">~</span>cacheList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span><span class="token function">networkFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        cacheName<span class="token punctuation">:</span> <span class="token string">'lf-sw:html'</span><span class="token punctuation">,</span>        plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>            <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                maxEntries<span class="token punctuation">:</span> <span class="token number">10</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h5 id="cacheFirst"><a href="#cacheFirst" class="headerlink" title="cacheFirst"></a>cacheFirst</h5><p>这个策略的意思就是当匹配到请求之后<strong>直接从 Cache 缓存中取得结果，如果 Cache 缓存中没有结果，那就会发起网络请求</strong>，拿到网络请求结果并将结果更新至 Cache 缓存，并将结果返回给客户端。这种策略比较适合结果不怎么变动且对实时性要求不高的请求。可以像如下方式使用 Cache First 策略：</p><pre class=" language-javascript"><code class="language-javascript">workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>    <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'https://edu-image\.nosdn\.127\.net/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span><span class="token function">cacheFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        cacheName<span class="token punctuation">:</span> <span class="token string">'lf-sw:img'</span><span class="token punctuation">,</span>        plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>            <span class="token comment" spellcheck="true">//如果要拿到域外的资源，必须配置</span>            <span class="token comment" spellcheck="true">//因为跨域使用fetch配置了</span>            <span class="token comment" spellcheck="true">//mode: 'no-cors',所以status返回值为0，故而需要兼容</span>            <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>cacheableResponse<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                statuses<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                maxEntries<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>                <span class="token comment" spellcheck="true">//缓存的时间</span>                maxAgeSeconds<span class="token punctuation">:</span> <span class="token number">12</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h5 id="networkOnly"><a href="#networkOnly" class="headerlink" title="networkOnly"></a>networkOnly</h5><p>比较直接的策略，直接强制使用正常的网络请求，并将结果返回给客户端，这种策略比较适合对实时性要求非常高的请求。</p><h5 id="cacheOnly"><a href="#cacheOnly" class="headerlink" title="cacheOnly"></a>cacheOnly</h5><p>这个策略也比较直接，直接使用 Cache 缓存的结果，并将结果返回给客户端，这种策略比较适合一上线就不会变的静态资源请求。</p><h3 id="举个栗子-1"><a href="#举个栗子-1" class="headerlink" title="举个栗子"></a>举个栗子</h3><p>又到了举个栗子的阶段了，这次我们用淘宝好了，看看他们是如何通过workbox来配置serviceworker的：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//首先是异常处理</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>clients<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>clients <span class="token operator">&amp;&amp;</span> clients<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>        clients<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>           type<span class="token punctuation">:</span> <span class="token string">'ERROR'</span><span class="token punctuation">,</span>          msg<span class="token punctuation">:</span> e<span class="token punctuation">.</span>message <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">,</span>          stack<span class="token punctuation">:</span> e<span class="token punctuation">.</span>error <span class="token operator">?</span> e<span class="token punctuation">.</span>error<span class="token punctuation">.</span>stack <span class="token punctuation">:</span> <span class="token keyword">null</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>clients<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>clients <span class="token operator">&amp;&amp;</span> clients<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>        clients<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          type<span class="token punctuation">:</span> <span class="token string">'REJECTION'</span><span class="token punctuation">,</span>          msg<span class="token punctuation">:</span> e<span class="token punctuation">.</span>reason <span class="token operator">?</span> e<span class="token punctuation">.</span>reason<span class="token punctuation">.</span>message <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>          stack<span class="token punctuation">:</span> e<span class="token punctuation">.</span>reason <span class="token operator">?</span> e<span class="token punctuation">.</span>reason<span class="token punctuation">.</span>stack <span class="token punctuation">:</span> <span class="token keyword">null</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//然后引入workbox</span><span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'https://g.alicdn.com/kg/workbox/3.3.0/workbox-sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>workbox<span class="token punctuation">.</span><span class="token function">setConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  debug<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  modulePathPrefix<span class="token punctuation">:</span> <span class="token string">'https://g.alicdn.com/kg/workbox/3.3.0/'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//直接激活跳过等待阶段</span>workbox<span class="token punctuation">.</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>workbox<span class="token punctuation">.</span><span class="token function">clientsClaim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//定义要缓存的html</span><span class="token keyword">var</span> cacheList <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token string">'/'</span><span class="token punctuation">,</span>  <span class="token string">'/tbhome/home-2017'</span><span class="token punctuation">,</span>  <span class="token string">'/tbhome/page/market-list'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//html采用networkFirst策略，支持离线也能大体访问</span>workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>  <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 需要缓存的HTML路径列表</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>url<span class="token punctuation">.</span>host <span class="token operator">===</span> <span class="token string">'www.taobao.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">~</span>cacheList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>      <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span><span class="token function">networkFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    cacheName<span class="token punctuation">:</span> <span class="token string">'tbh:html'</span><span class="token punctuation">,</span>    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        maxEntries<span class="token punctuation">:</span> <span class="token number">10</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//静态资源采用staleWhileRevalidate策略，安全可靠</span>workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>  <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'https://g\.alicdn\.com/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span><span class="token function">staleWhileRevalidate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    cacheName<span class="token punctuation">:</span> <span class="token string">'tbh:static'</span><span class="token punctuation">,</span>    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        maxEntries<span class="token punctuation">:</span> <span class="token number">20</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//图片采用cacheFirst策略，提升速度</span>workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>  <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'https://img\.alicdn\.com/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span><span class="token function">cacheFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    cacheName<span class="token punctuation">:</span> <span class="token string">'tbh:img'</span><span class="token punctuation">,</span>    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>cacheableResponse<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        statuses<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        maxEntries<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>        maxAgeSeconds<span class="token punctuation">:</span> <span class="token number">12</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>  <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'https://gtms01\.alicdn\.com/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span><span class="token function">cacheFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    cacheName<span class="token punctuation">:</span> <span class="token string">'tbh:img'</span><span class="token punctuation">,</span>    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>cacheableResponse<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        statuses<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        maxEntries<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>        maxAgeSeconds<span class="token punctuation">:</span> <span class="token number">12</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>可以看出，使用workbox比起直接手撸来，要快很多，也明确很多。</p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>目前分析serviceworker和workbox的文章不少，但是介绍workbox原理的文章却不多。这里简单介绍下workbox这个工具库的原理。</p><p>首先将几个我们产品用到的模块图奉上：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175914" alt="img"></p><p>简单提几个workbox源码的亮点。</p><h4 id="通过Proxy按需依赖"><a href="#通过Proxy按需依赖" class="headerlink" title="通过Proxy按需依赖"></a>通过Proxy按需依赖</h4><p>熟悉了workbox后会得知，它是有很多个子模块的，各个子模块再通过用到的时候按需importScript到线程中。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200612175919" alt="img"></p><p>做到按需依赖的原理就是通过Proxy对全局对象workbox进行代理：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  <span class="token keyword">get</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//如果workbox对象上不存在指定对象，就依赖注入该对象对应的脚本</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> o <span class="token operator">=</span> e<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> o <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">.</span><span class="token function">loadModule</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`workbox-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>o<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>如果找不到对应模块，则通过importScripts主动加载：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * 加载前端模块 * @param {Strnig} t  */</span><span class="token function">loadModule</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> e <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">try</span> <span class="token punctuation">{</span>    <span class="token function">importScripts</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">throw</span> <span class="token punctuation">(</span>console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Unable to import module '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>t<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">' from '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'.`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="通过freeze冻结对外暴露api"><a href="#通过freeze冻结对外暴露api" class="headerlink" title="通过freeze冻结对外暴露api"></a>通过freeze冻结对外暴露api</h4><p>workbox.core模块中提供了几个核心操作模块，如封装了indexedDB操作的DBWrapper、对cacheStorage进行读取的cacheWrapper，以及发送请求的fetchWrapper和日志管理的logger等等。</p><p>为了防止外部对内部模块暴露出去的api进行修改，导致出现不可预估的错误，内部模块可以通过Object.freeze将api进行冻结保护：</p><pre class=" language-javascript"><code class="language-javascript">  <span class="token keyword">var</span> _private <span class="token operator">=</span> <span class="token comment" spellcheck="true">/*#__PURE__*/</span>Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    DBWrapper<span class="token punctuation">:</span> DBWrapper<span class="token punctuation">,</span>    WorkboxError<span class="token punctuation">:</span> WorkboxError<span class="token punctuation">,</span>    assert<span class="token punctuation">:</span> finalAssertExports<span class="token punctuation">,</span>    cacheNames<span class="token punctuation">:</span> cacheNames<span class="token punctuation">,</span>    cacheWrapper<span class="token punctuation">:</span> cacheWrapper<span class="token punctuation">,</span>    fetchWrapper<span class="token punctuation">:</span> fetchWrapper<span class="token punctuation">,</span>    getFriendlyURL<span class="token punctuation">:</span> getFriendlyURL<span class="token punctuation">,</span>    logger<span class="token punctuation">:</span> defaultExport  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过对serviceworker的理解和workbox的应用，可以进一步提升产品的性能和弱网情况下的体验。有兴趣的同学也可以对workbox的源码细细评读，其中还有很多不错的设计模式和编程风格值得学习。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
            <tag> 前端优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSR、SSR、NSR、ESR傻傻分不清楚，一文帮你理清前端渲染方案！</title>
      <link href="/2020/06/10/ssr-nsp/"/>
      <url>/2020/06/10/ssr-nsp/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下文章来源于奶爸码农 ，作者奶爸码农</p><p>原文地址：<a href="https://mp.weixin.qq.com/s/1QPc2EZQs3jjPOK7-K6H7Q" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/1QPc2EZQs3jjPOK7-K6H7Q</a></p></blockquote><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>随着前端系统的越发复杂，前端的性能也受到越来越多的重视。Google也不断在推进新的性能相关指标，从原先的Performance API中的指标逐步演进成用户性能体验相关的指标。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205022" alt="img"></p><p>对于用户而言，First Paint、First Meaningful Paint和TTI这几个指标可以直接影响到用户体验。关于前端性能优化有非常多的最佳实践可以参考，这篇文章会重点介绍前端渲染的方案及其优劣。</p><h2 id="CSR-vs-SSR"><a href="#CSR-vs-SSR" class="headerlink" title="CSR vs SSR"></a>CSR vs SSR</h2><h3 id="CSR：Client-Side-Rendering"><a href="#CSR：Client-Side-Rendering" class="headerlink" title="CSR：Client Side Rendering"></a>CSR：Client Side Rendering</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205013" alt="img">**</p><p>浏览器(Client)渲染顾名思义就是所有的页面渲染、逻辑处理、页面路由、接口请求均是在浏览器中发生。其实，现代主流的前端框架均是这种渲染方式，这种渲染方式的好处在于实现了前后端架构分离，利于前后端职责分离，并且能够首次渲染迅速有效减少白屏时间。同时，CSR可以通过在打包编译阶段进行预渲染或者骨架屏生成，可以进一步提升首次渲染的用户体验。</p><p>但是由于和服务端会有多次交互（获取静态资源、获取数据），同时依赖浏览器进行渲染，在移动设备尤其是低配设备上，首屏时间和完全可交互时间是比较长的。</p><h3 id="SSR：Server-Side-Rendering"><a href="#SSR：Server-Side-Rendering" class="headerlink" title="SSR：Server Side Rendering"></a>SSR：Server Side Rendering</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610204600" alt="img"></p><p>服务端渲染则是在服务端完成页面的渲染，在服务端完成页面模板、数据填充、页面渲染，然后将完整的HTML内容返回给到浏览器。由于所有的渲染工作都在服务端完成，因此网站的首屏时间和TTI都会表现比较好。</p><p>但是，渲染需要在服务端完成，并不能很好进行前后端职责分离，而且白屏时间也会比较长，同时，对于服务端的负载要求也会比较高。</p><h3 id="基于Hydration的SSR和CSR融合"><a href="#基于Hydration的SSR和CSR融合" class="headerlink" title="基于Hydration的SSR和CSR融合"></a>基于Hydration的SSR和CSR融合</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610204642" alt="img"></p><p>SSR和CSR均有各自的优点和缺点，因此，业界提出前后端渲染同构的方案来整合SSR和CSR。</p><p>整个页面的加载和刷新是通过服务端渲染来实现，在渲染生成的HTML中内嵌JavaScript和数据内容。通过这样的实现，可以达到和SSR相同的首屏时间，并且基于Hybration，可以生成前端的虚拟Dom，避免前端触发二次渲染。</p><p>SSR和CSR的页面渲染体验对比：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610204653" alt="img"></p><p>SSR和CSR不同阶段优劣对比：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610204702" alt="img"></p><h3 id="Serverless-SSR"><a href="#Serverless-SSR" class="headerlink" title="Serverless SSR"></a>Serverless SSR</h3><p>前端使用SSR进行渲染同构有一个非常明显的缺点：服务资源消耗和运维。通常情况下，同构SSR会采用Node服务，需要固定的服务器资源，并且服务器的运维对于前端同学也提出了很高的要求。</p><p>随着Serverless技术的出现，这些问题似乎得到了很好的解决。Serverless基于触发器调用云端部署的函数，然后调用后端服务。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610204711" alt="img"></p><p>对于前端同学而言，仅仅只需要实现云端函数的实现，对于服务器的运维管理完全不用关心，同时服务器会实现自动弹性伸缩，有效节省了机器资源。</p><p>当然，Serverless并不是万能的，服务器的冷启动目前依旧还是一个非常大的问题。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610204719" alt="img"></p><p>SSR在性能收益上是完胜CSR，配合Serverless，SSR的开发成本仅仅比CSR有略微的提高，因此，从收益成本来看，Serverless SSR已经有了较大的优势，可能会成为未来的趋势。</p><h2 id="NSR"><a href="#NSR" class="headerlink" title="NSR"></a>NSR</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610204728" alt="img"></p><p>UC浏览器在新闻feed流页面加载中采用了NSR（Native Side Rendering），首先在列表页中加载离线页面模板，通过Ajax预加载页面数据，通过Native渲染生成Html数据并且缓存在客户端。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610204751" alt="img"></p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p><p>NSR本质是分布式SSR，将服务器的渲染工作放在了一个个独立的移动设备中，实现了页面的预加载，同时又不会增加额外的服务器压力。</p><h2 id="ESR"><a href="#ESR" class="headerlink" title="ESR"></a>ESR</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610204800" alt="img"></p><p>ESR - Edge Side Rendering，方案的核心思想是，借助边缘计算的能力，将静态内容与动态内容以流式的方式，先后返回给用户。cdn 节点相比于 server，距离用户更近，有着更短的网络延时。在 cdn 节点上，将可缓存的页面静态部分，先快速返回给用户，同时在 cdn 节点上发起动态部分内容请求，并将动态内容在静态部分的响应流后，继续返回给用户。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610204805" alt="img"></p><p>从上面结果可以看出，在网速越慢的情况下，通过 cdn 流式渲染的最终主要元素出来的时间比原始 SSR 的方式出来得越早。这与实际推论也符合，因为网络越慢，静态资源加载时间越慢，对应的浏览器提前加载静态资源带来的效果也越明显。另外，不管在什么网络情况下，cdn 流式渲染方式的白屏时间要短很多。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>CSR、SSR、NSR、ESR，前端渲染方案如此纷繁复杂，其实每一种渲染方案都有其优势和劣势，一定要结合自身的业务需求，平衡好收益和成本选择适合自己的方案。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为什么你的网页需要 CSP?</title>
      <link href="/2020/06/10/csp/"/>
      <url>/2020/06/10/csp/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下文章来源于code秘密花园 ，作者ConardLi</p><p>原文地址：<a href="https://mp.weixin.qq.com/s/S2NeE_hpOX5cM1Yaxz3YDw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/S2NeE_hpOX5cM1Yaxz3YDw</a></p></blockquote><p>内容安全策略（<code>CSP</code>）是一个 <code>HTTP Header</code>，<code>CSP</code> 通过告诉浏览器一系列规则，严格规定页面中哪些资源允许有哪些来源， 不在指定范围内的统统拒绝。</p><p>使用它是防止跨站点脚本（XSS）漏洞的最佳方法。由于难以使用 <code>CSP</code> 对现有网站进行改造（可通过渐进式的方法），因此 <code>CSP</code> 对于所有新网站都是强制性的，强烈建议对所有现有高风险站点进行 <code>CSP</code> 策略配置。</p><h2 id="为什么要配置"><a href="#为什么要配置" class="headerlink" title="为什么要配置"></a>为什么要配置</h2><p><code>CSP</code> 的主要好处就是可以全面禁止使用不安全的嵌入式 <code>JavaScript</code>。内联 <code>JavaScript</code>（无论是反射的还是存储的），意味着不正确的转义用户输入都可以被 <code>Web</code> 浏览器解释为 <code>JavaScript</code> 代码。通过使用 <code>CSP</code> 禁用嵌入式 <code>JavaScript</code>，你可以有效消除针对你站点的几乎所有 <code>XSS</code> 攻击。</p><p>注意，禁用内联 <code>JavaScript</code> 意味着必须从 <code>src</code> 标记加载所有 <code>JavaScript &lt;script&gt;</code>。直接在标记上使用的事件处理程序（例如 <code>onclick</code> ）将无法正常工作，<code>&lt;script&gt;</code>标记内的 <code>JavaScript</code> 也会通过。此外，使用 <code>&lt;style&gt;</code> 标签或 <code>style</code> 属性的内联样式表也将无法加载。因此为了让 <code>CSP</code> 易于实现，在设计站点时必须非常小心。</p><h2 id="如何配置？"><a href="#如何配置？" class="headerlink" title="如何配置？"></a>如何配置？</h2><p>开启 <code>CSP</code> 很简单, 你只需要配置你的网络服务器返回  <code>Content-Security-Policy</code> 这个 <code>HTTP Header</code> (有时你会看到一些关于<code>X-Content-Security-Policy Header</code> 的提法, 那是旧版本，你无须再如此指定它)。</p><p>除此之外，<code>&lt;meta&gt;</code> 元素也可以被用来配置该策略, 例如</p><pre><code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; img-src https://*; child-src &#39;none&#39;;&quot;&gt;</code></pre><h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><p>无论是 <code>header</code> ，还是在 <code>&lt;meta&gt;</code> 标签中指定，其值的格式都是统一的，由一系列 <code>CSP</code> 指令（<code>directive</code>）组合而成。</p><pre><code>Content-Security-Policy: &lt;policy-directive&gt;; &lt;policy-directive&gt;</code></pre><p>这里 <code>directive</code>，即指令，是 <code>CSP</code> 规范中规定用以详细详述某种资源的来源，比如前面示例中使用的 <code>script-src</code>，指定脚本可以有哪些合法来源，<code>img-src</code> 则指定图片的合法涞源，以下是常用指令：</p><ul><li>base-uri 限制可出现在页面 <code>&lt;base&gt;</code> 标签中的链接。</li><li>child-src 列出可用于 worker 及以 frame 形式嵌入的链接。譬如: child-src <a href="https://youtube.com" target="_blank" rel="noopener">https://youtube.com</a> 表示只能从 Youtube 嵌入视频资源。</li><li>connect-src 可发起连接的地址 (通过 XHR, WebSockets 或 EventSource)。</li><li>font-src 字体来源。譬如，要使用 Google web fonts 则需要添加 font-src <a href="https://themes.googleusercontent.com" target="_blank" rel="noopener">https://themes.googleusercontent.com</a> 规则。</li><li>form-action <code>&lt;form&gt;</code>标签可提交的地址。</li><li>frame-ancestors 当前页面可被哪些来源所嵌入（与 child-src 正好相反）。作用于 <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code>, <code>&lt;embed&gt;</code>及 <code>&lt;applet&gt;</code>。该指令不能通过 <code>&lt;meta&gt;</code>指定且只对非 HTML文档类型的资源生效。</li><li>frame-src 该指令已在 level 2 中废弃但会在 level 3 中恢复使用。未指定的情况下回退到 tochild-src 指令。</li><li>img-src 指定图片来源。</li><li>media-src 限制音视频资源的来源。</li><li>object-src Flash 及其他插件的来源。</li><li>plugin-types 限制页面中可加载的插件类型。</li><li>report-uri 指定一个可接收 CSP 报告的地址，浏览器会在相应指令不通过时发送报告。不能通过 <code>&lt;meta&gt;</code> 标签来指定。</li><li>style-src 限制样式文件的来源。</li><li>upgrade-insecure-requests 指导客户端将页面地址重写，HTTP 转 HTTPS。用于站点中有大量旧地址需要重定向的情形。</li><li>worker-src CSP Level 3 中的指令，规定可用于 worker, shared worker, 或 service worker 中的地址。</li></ul><h2 id="预设值"><a href="#预设值" class="headerlink" title="预设值"></a>预设值</h2><p>除了配置指定的涞源以外，这些指令还可以配置一些预定义的值来完成一些默认配置：</p><ul><li><code>none</code> 不匹配任何东西。</li><li><code>self</code> 匹配当前域，但不包括子域。比如 example.com 可以，api.example.com 则会匹配失败。</li><li><code>unsafe-inline</code> 允许内嵌的脚本及样式。是的，没看错，对于页面中内嵌的内容也是有相应限制规则的。</li><li><code>unsafe-eval</code> 允许通过字符串动态创建的脚本执行，比如 eval，setTimeout 等。</li></ul><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205444" alt="img"></p><p>如果页面中非得用内联的写法，还有种方式。即页面中这些内联的脚本或样式标签，赋值一个加密串，这个加密串由服务器生成，同时这个加密串被添加到页面的响应头里面。</p><pre><code>&lt;script nonce=&quot;EDNnf03nceIOfn39fn3e9h3sdfa&quot;&gt;  // 这里放置内联在 HTML 中的代码&lt;/script&gt; </code></pre><p>页面 HTTP 响应头的 <code>Content-Security-Policy</code>配置中包含相同的加密串：</p><pre><code>Content-Security-Policy: script-src &#39;nonce-EDNnf03nceIOfn39fn3e9h3sdfa&#39;</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205452" alt="img"></p><h2 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h2><h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例 1"></a>示例 1</h3><p>所有内容均来自站点的同一个源 (不包括其子域名)</p><pre><code>Content-Security-Policy: default-src &#39;self&#39;</code></pre><h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例 2"></a>示例 2</h3><p>允许内容来自信任的域名及其子域名 (域名不必须与CSP设置所在的域名相同)</p><pre><code>Content-Security-Policy: default-src &#39;self&#39; *.trusted.com</code></pre><h3 id="示例-3"><a href="#示例-3" class="headerlink" title="示例 3"></a>示例 3</h3><p>允许网页应用的用户在他们自己的内容中包含来自任何源的图片, 但是限制音频或视频需从信任的资源提供者(获得)，所有脚本必须从特定主机服务器获取可信的代码.</p><pre><code>Content-Security-Policy: default-src &#39;self&#39;; img-src *; media-src media1.com media2.com; script-src userscripts.example.com</code></pre><p>在这里，各种内容默认仅允许从文档所在的源获取, 但存在如下例外:</p><ul><li>图片可以从任何地方加载(注意 “*” 通配符)。</li><li>多媒体文件仅允许从 media1.com 和 media2.com 加载(不允许从这些站点的子域名)。</li><li>可运行脚本仅允许来自于userscripts.example.com。</li></ul><h3 id="示例-4"><a href="#示例-4" class="headerlink" title="示例 4"></a>示例 4</h3><p>一个线上银行网站的管理者想要确保网站的所有内容都要通过SSL方式获取，以避免攻击者窃听用户发出的请求。</p><pre><code>Content-Security-Policy: default-src https://onlinebanking.jumbobank.com</code></pre><p>该服务器仅允许通过HTTPS方式并仅从onlinebanking.jumbobank.com域名来访问文档。</p><h3 id="示例-5"><a href="#示例-5" class="headerlink" title="示例 5"></a>示例 5</h3><p>一个在线邮箱的管理者想要允许在邮件里包含HTML，同样图片允许从任何地方加载，但不允许JavaScript或者其他潜在的危险内容(从任意位置加载)。</p><pre><code>Content-Security-Policy: default-src &#39;self&#39; *.mailsite.com; img-src *</code></pre><p>注意这个示例并未指定script-src。在此CSP示例中，站点通过 default-src 指令的对其进行配置，这也同样意味着脚本文件仅允许从原始服务器获取。</p><h2 id="上报你的数据"><a href="#上报你的数据" class="headerlink" title="上报你的数据"></a>上报你的数据</h2><p>当检测到非法资源时，除了控制台看到的报错信息，也可以让浏览器将日志发送到服务器以供后续分析使用。接收报告的地址可在 <code>Content-Security-Policy</code> 响应头中通过 <code>report-uri</code>指令来配置。当然，服务端需要编写相应的服务来接收该数据。</p><p>配置 <code>report-uri</code></p><pre><code>Content-Security-Policy: default-src &#39;self&#39;; ...; report-uri /my_amazing_csp_report_parser;`</code></pre><p>服务端收到请求：</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"csp-report"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"document-uri"</span><span class="token operator">:</span> <span class="token string">"http://example.org/page.html"</span><span class="token punctuation">,</span>    <span class="token property">"referrer"</span><span class="token operator">:</span> <span class="token string">"http://evil.example.com/"</span><span class="token punctuation">,</span>    <span class="token property">"blocked-uri"</span><span class="token operator">:</span> <span class="token string">"http://evil.example.com/evil.js"</span><span class="token punctuation">,</span>    <span class="token property">"violated-directive"</span><span class="token operator">:</span> <span class="token string">"script-src 'self' https://apis.google.com"</span><span class="token punctuation">,</span>    <span class="token property">"original-policy"</span><span class="token operator">:</span> <span class="token string">"script-src 'self' https://apis.google.com; report-uri http://example.org/my_amazing_csp_report_parser"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="Report-Only"><a href="#Report-Only" class="headerlink" title="Report Only"></a>Report Only</h2><p><code>CSP</code> 提供了一种报告模式，该模式下资源不会真的被限制加载，只会对检测到的问题进行上报 ，以 <code>JSON</code> 数据的形式发送到 <code>report-uri</code> 指定的地方。</p><p>通过指定 <code>Content-Security-Policy-Report-Only</code> 而不是 <code>Content-Security-Policy</code>，则开启了报告模式。</p><pre><code>Content-Security-Policy-Report-Only: default-src &#39;self&#39;; ...; report-uri /my_amazing_csp_report_parser;</code></pre><p>当然，你也可以同时指定两种响应头，各自里的规则还会正常执行，不会互相影响。比如：</p><pre><code>Content-Security-Policy: img-src *;Content-Security-Policy-Report-Only: img-src ‘none’; report-uri http://reportcollector.example.com/collector.cgi</code></pre><p>这里图片还是会正常加载，但是 <code>img-src ‘none’</code> 也会检测到并且发送报告。</p><p>报告模式对于测试非常有用。在开启 <code>CSP</code> 之前肯定需要对整站做全面的测试，将发现的问题及时修复后再真正开启，比如上面提到的对内联代码的改造。</p><h2 id="如何检验配置成功了？"><a href="#如何检验配置成功了？" class="headerlink" title="如何检验配置成功了？"></a>如何检验配置成功了？</h2><p><strong>在Network中可以看到配置成功的header：</strong></p><p>下面是 <code>Twitter</code> 的一个配置示例，非常完善：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205458" alt="img"></p><p><strong>在控制台可以看到资源 block 报错：</strong></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205503" alt="img"></p><p><strong>Network中可以看到Block资源上报：</strong></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205507" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微任务和宏任务</title>
      <link href="/2020/06/09/wei-ren-wu-he-hong-ren-wu/"/>
      <url>/2020/06/09/wei-ren-wu-he-hong-ren-wu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于<a href="https://juejin.im/post/59e85eebf265da430d571f89" target="_blank" rel="noopener">https://juejin.im/post/59e85eebf265da430d571f89</a></p></blockquote><h1 id="这一次，彻底弄懂-JavaScript-执行机制"><a href="#这一次，彻底弄懂-JavaScript-执行机制" class="headerlink" title="这一次，彻底弄懂 JavaScript 执行机制"></a>这一次，彻底弄懂 JavaScript 执行机制</h1><p>本文的目的就是要保证你彻底弄懂javascript的执行机制，如果读完本文还不懂，可以揍我。</p><p>不论你是javascript新手还是老鸟，不论是面试求职，还是日常开发工作，我们经常会遇到这样的情况：给定的几行代码，我们需要知道其输出内容和顺序。因为javascript是一门单线程语言，所以我们可以得出结论：</p><ul><li>javascript是按照语句出现的顺序执行的</li></ul><p>看到这里读者要打人了：我难道不知道js是一行一行执行的？还用你说？稍安勿躁，正因为js是一行一行执行的，所以我们以为js都是这样的：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token string">'2'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>复制代码</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205210" alt="img"></p><p>然而实际上js是这样的：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'定时器开始啦'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'马上执行for循环啦'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        i <span class="token operator">==</span> <span class="token number">99</span> <span class="token operator">&amp;&amp;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行then函数啦'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'代码执行结束'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205218" alt="img"></p><p>依照<strong>js是按照语句出现的顺序执行</strong>这个理念，我自信的写下输出结果：</p><pre><code>//&quot;定时器开始啦&quot;//&quot;马上执行for循环啦&quot;//&quot;执行then函数啦&quot;//&quot;代码执行结束&quot;复制代码</code></pre><p>去chrome上验证下，结果完全不对，瞬间懵了，说好的一行一行执行的呢？</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205223" alt="img"></p><p>我们真的要彻底弄明白javascript的执行机制了。</p><h3 id="1-关于javascript"><a href="#1-关于javascript" class="headerlink" title="1.关于javascript"></a>1.关于javascript</h3><p>javascript是一门<strong>单线程</strong>语言，在最新的HTML5中提出了Web-Worker，但javascript是单线程这一核心仍未改变。所以一切javascript版的”多线程”都是用单线程模拟出来的，一切javascript多线程都是纸老虎！</p><h3 id="2-javascript事件循环"><a href="#2-javascript事件循环" class="headerlink" title="2.javascript事件循环"></a>2.javascript事件循环</h3><p>既然js是单线程，那就像只有一个窗口的银行，客户需要排队一个一个办理业务，同理js任务也要一个一个顺序执行。如果一个任务耗时过长，那么后一个任务也必须等着。那么问题来了，假如我们想浏览新闻，但是新闻包含的超清图片加载很慢，难道我们的网页要一直卡着直到图片完全显示出来？因此聪明的程序员将任务分为两类：</p><ul><li>同步任务</li><li>异步任务</li></ul><p>当我们打开网站时，网页的渲染过程就是一大堆同步任务，比如页面骨架和页面元素的渲染。而像加载图片音乐之类占用资源大耗时久的任务，就是异步任务。关于这部分有严格的文字定义，但本文的目的是用最小的学习成本彻底弄懂执行机制，所以我们用导图来说明：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205228" alt="img"></p><p>导图要表达的内容用文字来表述的话：</p><ul><li>同步和异步任务分别进入不同的执行”场所”，同步的进入主线程，异步的进入Event Table并注册函数。</li><li>当指定的事情完成时，Event Table会将这个函数移入Event Queue。</li><li>主线程内的任务执行完毕为空，会去Event Queue读取对应的函数，进入主线程执行。</li><li>上述过程会不断重复，也就是常说的Event Loop(事件循环)。</li></ul><p>我们不禁要问了，那怎么知道主线程执行栈为空啊？js引擎存在monitoring process进程，会持续不断的检查主线程执行栈是否为空，一旦为空，就会去Event Queue那里检查是否有等待被调用的函数。</p><p>说了这么多文字，不如直接一段代码更直白：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    url<span class="token punctuation">:</span>www<span class="token punctuation">.</span>javascript<span class="token punctuation">.</span>com<span class="token punctuation">,</span>    data<span class="token punctuation">:</span>data<span class="token punctuation">,</span>    success<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发送成功!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'代码执行结束'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>上面是一段简易的<code>ajax</code>请求代码：</p><ul><li>ajax进入Event Table，注册回调函数<code>success</code>。</li><li>执行<code>console.log(&#39;代码执行结束&#39;)</code>。</li><li>ajax事件完成，回调函数<code>success</code>进入Event Queue。</li><li>主线程从Event Queue读取回调函数<code>success</code>并执行。</li></ul><p>相信通过上面的文字和代码，你已经对js的执行顺序有了初步了解。接下来我们来研究进阶话题：setTimeout。</p><h3 id="3-又爱又恨的setTimeout"><a href="#3-又爱又恨的setTimeout" class="headerlink" title="3.又爱又恨的setTimeout"></a>3.又爱又恨的setTimeout</h3><p>大名鼎鼎的<code>setTimeout</code>无需再多言，大家对他的第一印象就是异步可以延时执行，我们经常这么实现延时3秒执行：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'延时3秒'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>复制代码</code></pre><p>渐渐的<code>setTimeout</code>用的地方多了，问题也出现了，有时候明明写的延时3秒，实际却5，6秒才执行函数，这又咋回事啊？</p><p>先看一个例子：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行console'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>根据前面我们的结论，<code>setTimeout</code>是异步的，应该先执行<code>console.log</code>这个同步任务，所以我们的结论是：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//执行console</span><span class="token comment" spellcheck="true">//task()复制代码</span></code></pre><p>去验证一下，结果正确！<br>然后我们修改一下前面的代码：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000000</span><span class="token punctuation">)</span></code></pre><p>乍一看其实差不多嘛，但我们把这段代码在chrome执行一下，却发现控制台执行<code>task()</code>需要的时间远远超过3秒，说好的延时三秒，为啥现在需要这么长时间啊？</p><p>这时候我们需要重新理解<code>setTimeout</code>的定义。我们先说上述代码是怎么执行的：</p><ul><li><code>task()</code>进入Event Table并注册,计时开始。</li><li>执行<code>sleep</code>函数，很慢，非常慢，计时仍在继续。</li><li>3秒到了，计时事件<code>timeout</code>完成，<code>task()</code>进入Event Queue，但是<code>sleep</code>也太慢了吧，还没执行完，只好等着。</li><li><code>sleep</code>终于执行完了，<code>task()</code>终于从Event Queue进入了主线程执行。</li></ul><p>上述的流程走完，我们知道<code>setTimeout</code>这个函数，是经过指定时间后，把要执行的任务(本例中为<code>task()</code>)加入到Event Queue中，又因为是单线程任务要一个一个执行，如果前面的任务需要的时间太久，那么只能等着，导致真正的延迟时间远远大于3秒。</p><p>我们还经常遇到<code>setTimeout(fn,0)</code>这样的代码，0秒后执行又是什么意思呢？是不是可以立即执行呢？</p><p>答案是不会的，<code>setTimeout(fn,0)</code>的含义是，指定某个任务在主线程最早可得的空闲时间执行，意思就是不用再等多少秒了，只要主线程执行栈内的同步任务全部执行完成，栈为空就马上执行。举例说明：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//代码1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'先执行这里'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行啦'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>复制代码<span class="token comment" spellcheck="true">//代码2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'先执行这里'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行啦'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>代码1的输出结果是：</p><pre><code>//先执行这里//执行啦</code></pre><p>代码2的输出结果是：</p><pre><code>//先执行这里// ... 3s later// 执行啦</code></pre><p>关于<code>setTimeout</code>要补充的是，即便主线程为空，0毫秒实际上也是达不到的。根据HTML的标准，最低是4毫秒。有兴趣的同学可以自行了解。</p><h3 id="4-又恨又爱的setInterval"><a href="#4-又恨又爱的setInterval" class="headerlink" title="4.又恨又爱的setInterval"></a>4.又恨又爱的setInterval</h3><p>上面说完了<code>setTimeout</code>，当然不能错过它的孪生兄弟<code>setInterval</code>。他俩差不多，只不过后者是循环的执行。对于执行顺序来说，<code>setInterval</code>会每隔指定的时间将注册的函数置入Event Queue，如果前面的任务耗时太久，那么同样需要等待。</p><p>唯一需要注意的一点是，对于<code>setInterval(fn,ms)</code>来说，我们已经知道不是每过<code>ms</code>秒会执行一次<code>fn</code>，而是每过<code>ms</code>秒，会有<code>fn</code>进入Event Queue。一旦<strong><code>setInterval</code>的回调函数<code>fn</code>执行时间超过了延迟时间<code>ms</code>，那么就完全看不出来有时间间隔了</strong>。这句话请读者仔细品味。</p><h3 id="5-Promise与process-nextTick-callback"><a href="#5-Promise与process-nextTick-callback" class="headerlink" title="5.Promise与process.nextTick(callback)"></a>5.Promise与process.nextTick(callback)</h3><p>传统的定时器我们已经研究过了，接着我们探究<code>Promise</code>与<code>process.nextTick(callback)</code>的表现。</p><p><code>Promise</code>的定义和功能本文不再赘述，不了解的读者可以学习一下阮一峰老师的<a href="http://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="noopener">Promise</a>。而<code>process.nextTick(callback)</code>类似node.js版的”setTimeout”，在事件循环的下一次循环中调用 callback 回调函数。</p><p>我们进入正题，除了广义的同步任务和异步任务，我们对任务有更精细的定义：</p><ul><li>macro-task(宏任务)：包括整体代码script，setTimeout，setInterval</li><li>micro-task(微任务)：Promise，process.nextTick</li></ul><p>不同类型的任务会进入对应的Event Queue，比如<code>setTimeout</code>和<code>setInterval</code>会进入相同的Event Queue。</p><p>事件循环的顺序，决定js代码的执行顺序。进入整体代码(宏任务)后，开始第一次循环。接着执行所有的微任务。然后再次从宏任务开始，找到其中一个任务队列执行完毕，再执行所有的微任务。听起来有点绕，我们用文章最开始的一段代码说明：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'then'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'console'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>这段代码作为宏任务，进入主线程。</li><li>先遇到<code>setTimeout</code>，那么将其回调函数注册后分发到宏任务Event Queue。(注册过程与上同，下文不再描述)</li><li>接下来遇到了<code>Promise</code>，<code>new Promise</code>立即执行，<code>then</code>函数分发到微任务Event Queue。</li><li>遇到<code>console.log()</code>，立即执行。</li><li>好啦，整体代码script作为第一个宏任务执行结束，看看有哪些微任务？我们发现了<code>then</code>在微任务Event Queue里面，执行。</li><li>ok，第一轮事件循环结束了，我们开始第二轮循环，当然要从宏任务Event Queue开始。我们发现了宏任务Event Queue中<code>setTimeout</code>对应的回调函数，立即执行。</li><li>结束。</li></ul><p>事件循环，宏任务，微任务的关系如图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205236" alt="img"></p><p>我们来分析一段较复杂的代码，看看你是否真的掌握了js的执行机制：</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'6'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'10'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'11'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>第一轮事件循环流程分析如下：</p><ul><li>整体script作为第一个宏任务进入主线程，遇到<code>console.log</code>，输出1。</li><li>遇到<code>setTimeout</code>，其回调函数被分发到宏任务Event Queue中。我们暂且记为<code>setTimeout1</code>。</li><li>遇到<code>process.nextTick()</code>，其回调函数被分发到微任务Event Queue中。我们记为<code>process1</code>。</li><li>遇到<code>Promise</code>，<code>new Promise</code>直接执行，输出7。<code>then</code>被分发到微任务Event Queue中。我们记为<code>then1</code>。</li><li>又遇到了<code>setTimeout</code>，其回调函数被分发到宏任务Event Queue中，我们记为<code>setTimeout2</code>。</li></ul><table><thead><tr><th align="center">宏任务Event Queue</th><th align="center">微任务Event Queue</th></tr></thead><tbody><tr><td align="center">setTimeout1</td><td align="center">process1</td></tr><tr><td align="center">setTimeout2</td><td align="center">then1</td></tr></tbody></table><ul><li>上表是第一轮事件循环宏任务结束时各Event Queue的情况，此时已经输出了1和7。</li><li>我们发现了<code>process1</code>和<code>then1</code>两个微任务。</li><li>执行<code>process1</code>,输出6。</li><li>执行<code>then1</code>，输出8。</li></ul><p>好了，第一轮事件循环正式结束，这一轮的结果是输出1，7，6，8。那么第二轮时间循环从<code>setTimeout1</code>宏任务开始：</p><ul><li>首先输出2。接下来遇到了<code>process.nextTick()</code>，同样将其分发到微任务Event Queue中，记为<code>process2</code>。<code>new Promise</code>立即执行输出4，<code>then</code>也分发到微任务Event Queue中，记为<code>then2</code>。</li></ul><table><thead><tr><th align="center">宏任务Event Queue</th><th align="center">微任务Event Queue</th></tr></thead><tbody><tr><td align="center">setTimeout2</td><td align="center">process2</td></tr><tr><td align="center"></td><td align="center">then2</td></tr></tbody></table><ul><li>第二轮事件循环宏任务结束，我们发现有<code>process2</code>和<code>then2</code>两个微任务可以执行。</li><li>输出3。</li><li>输出5。</li><li>第二轮事件循环结束，第二轮输出2，4，3，5。</li><li>第三轮事件循环开始，此时只剩setTimeout2了，执行。</li><li>直接输出9。</li><li>将<code>process.nextTick()</code>分发到微任务Event Queue中。记为<code>process3</code>。</li><li>直接执行<code>new Promise</code>，输出11。</li><li>将<code>then</code>分发到微任务Event Queue中，记为<code>then3</code>。</li></ul><table><thead><tr><th align="center">宏任务Event Queue</th><th align="center">微任务Event Queue</th></tr></thead><tbody><tr><td align="center"></td><td align="center">process3</td></tr><tr><td align="center"></td><td align="center">then3</td></tr></tbody></table><ul><li>第三轮事件循环宏任务执行结束，执行两个微任务<code>process3</code>和<code>then3</code>。</li><li>输出10。</li><li>输出12。</li><li>第三轮事件循环结束，第三轮输出9，11，10，12。</li></ul><p>整段代码，共进行了三次事件循环，完整的输出为1，7，6，8，2，4，3，5，9，11，10，12。<br>(请注意，node环境下的事件监听依赖libuv与前端环境不完全相同，输出顺序可能会有误差)</p><h3 id="6-写在最后"><a href="#6-写在最后" class="headerlink" title="6.写在最后"></a>6.写在最后</h3><h4 id="1-js的异步"><a href="#1-js的异步" class="headerlink" title="(1)js的异步"></a>(1)js的异步</h4><p>我们从最开头就说javascript是一门单线程语言，不管是什么新框架新语法糖实现的所谓异步，其实都是用同步的方法去模拟的，牢牢把握住单线程这点非常重要。</p><h4 id="2-事件循环Event-Loop"><a href="#2-事件循环Event-Loop" class="headerlink" title="(2)事件循环Event Loop"></a>(2)事件循环Event Loop</h4><p>事件循环是js实现异步的一种方法，也是js的执行机制。</p><h4 id="3-javascript的执行和运行"><a href="#3-javascript的执行和运行" class="headerlink" title="(3)javascript的执行和运行"></a>(3)javascript的执行和运行</h4><p>执行和运行有很大的区别，javascript在不同的环境下，比如node，浏览器，Ringo等等，执行方式是不同的。而运行大多指javascript解析引擎，是统一的。</p><h4 id="4-setImmediate"><a href="#4-setImmediate" class="headerlink" title="(4)setImmediate"></a>(4)setImmediate</h4><p>微任务和宏任务还有很多种类，比如<code>setImmediate</code>等等，执行都是有共同点的，有兴趣的同学可以自行了解。</p><h4 id="5-最后的最后"><a href="#5-最后的最后" class="headerlink" title="(5)最后的最后"></a>(5)最后的最后</h4><ul><li>javascript是一门单线程语言</li><li>Event Loop是javascript的执行机制</li></ul><p>牢牢把握两个基本点，以认真学习javascript为中心，早日实现成为前端高手的伟大梦想！</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200610205244" alt="img"></p><table><thead><tr><th align="center">宏任务</th><th align="center">微任务</th></tr></thead><tbody><tr><td align="center">I/O</td><td align="center">process.nextTick</td></tr><tr><td align="center">setTimeout</td><td align="center">MutationObserver</td></tr><tr><td align="center">setInterval</td><td align="center">Promise</td></tr><tr><td align="center">setImmediate</td><td align="center">then</td></tr><tr><td align="center">requestAnimationFrame</td><td align="center">catch</td></tr><tr><td align="center"></td><td align="center">finally</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>file转换为blob</title>
      <link href="/2020/06/09/file-zhuan-huan-wei-blob/"/>
      <url>/2020/06/09/file-zhuan-huan-wei-blob/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于<a href="https://segmentfault.com/a/1190000020153597" target="_blank" rel="noopener">https://segmentfault.com/a/1190000020153597</a></p></blockquote><h2 id="javascript实现上传文件流file转base64，base64转blob，blob转url访问地址"><a href="#javascript实现上传文件流file转base64，base64转blob，blob转url访问地址" class="headerlink" title="javascript实现上传文件流file转base64，base64转blob，blob转url访问地址"></a>javascript实现上传文件流file转base64，base64转blob，blob转url访问地址</h2><p>这file转换为blob的话，在uniapp是有一个API可以直接调用<code>uni.chooseImage</code></p><p>而在H5的话需要自己写方法去转换</p><p>具体方法如下：</p><pre class=" language-javascript"><code class="language-javascript">    <span class="token comment" spellcheck="true">/**    * 上传附件转base64    */</span>    <span class="token function">fileByBase64</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// 传入一个参数对象即可得到基于该参数对象的文本内容</span>        reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>        reader<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// target.result 该属性表示目标对象的DataURL</span>            <span class="token comment" spellcheck="true">// console.log(e.target.result)</span>            <span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>     <span class="token comment" spellcheck="true">/**     * base64转Blob     */</span>    <span class="token function">base64ByBlob</span><span class="token punctuation">(</span>base64<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// eslint-disable-next-line one-var</span>        <span class="token keyword">var</span> arr <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            mime <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/:(.*?);/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            bstr <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            n <span class="token operator">=</span> bstr<span class="token punctuation">.</span>length<span class="token punctuation">,</span>            u8arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            u8arr<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> bstr<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// console.log(new Blob([u8arr], { type: mime }))</span>        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>u8arr<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>            type<span class="token punctuation">:</span> mime        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>     <span class="token comment" spellcheck="true">/**     * 使用     */</span>    <span class="token function">selectedFile</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> file <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fileByBase64</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token punctuation">(</span>base64<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">base64ByBlob</span><span class="token punctuation">(</span>base64<span class="token punctuation">,</span> blob <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// console.log(blob, 'blob')</span>                <span class="token keyword">var</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>fileList <span class="token operator">=</span> url                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fileList<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span></code></pre><p>然后只需要在input里面绑定这个事件即可</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectedFile($event)<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 日常总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BFC</title>
      <link href="/2020/06/07/bfc/"/>
      <url>/2020/06/07/bfc/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript设计模式之观察者模式</title>
      <link href="/2020/06/07/javascript-she-ji-mo-shi-zhi-guan-cha-zhe-mo-shi/"/>
      <url>/2020/06/07/javascript-she-ji-mo-shi-zhi-guan-cha-zhe-mo-shi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文引用于<a href="https://srtian96.gitee.io/blog/2018/05/21/JavaScript设计模式之观察者模式/" target="_blank" rel="noopener">https://srtian96.gitee.io/blog/2018/05/21/JavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/</a></p></blockquote><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>准备研究一下MVVM的一些东西，由于MVVM运用了观察者模式的思想，因此翻开了《JavaScript设计模式与开发实践》一书，将观察者模式学习了一遍，顺便有对一些常用的设计模式进行一些了解，但由于平时很多设计模式并没有用过甚至没有接触过，发现一个很有意思的东西，JavaScript还正是厉害，将很多常用的设计模式都封装成了API，比如ES6出来的迭代器和代理。但总的来说还是有很多不能理解的地方，真是前途漫漫，还需努力啊。</p><h3 id="一、什么是观察者模式"><a href="#一、什么是观察者模式" class="headerlink" title="一、什么是观察者模式"></a>一、什么是观察者模式</h3><p>观察者模式又叫做发布—订阅模式，是我们最常用的设计模式之一（这两种模式其实还是有一定区别，但在《JavaScript设计模式与开发实践》一书中有这么说过，但在经历了一些学习后发现这两种还是存在一定的区别的，具体区别可以谷歌~）。它定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知和更新。观察者模式提供了一个订阅模型，其中对象订阅事件并在发生时得到通知，这种模式是事件驱动的编程基石，它有利益于良好的面向对象的设计。</p><p>看了上面的这段描述，可能还是不懂什么是观察者模式。我们还可以来看看生活中的观察者模式：现在房价这么高，你肯定是想要早点买房，但你看好的楼盘还没开盘，因此你就将你的电话留给售楼小姐，一旦楼盘推出就让她打电话给你。主动权在售楼方，而你只需要提供一个联系方式就行了这样你就不用担心楼盘出来你不知道了，也不需要每天都打电话去问楼盘推出了没。</p><p>自己的一些理解：学了Rx.js后对观察者模式有了更为深刻的理解，观察者模式本质上就是将数据的产生于数据的处理逻辑相分离开来，被观察者模式负责数据的产生，观察者则负责处理数据，即产生的数据流与处理数据的逻辑分离开来。（补充）</p><h3 id="二、观察者模式的使用场景"><a href="#二、观察者模式的使用场景" class="headerlink" title="二、观察者模式的使用场景"></a>二、观察者模式的使用场景</h3><h4 id="2-1-DOM事件"><a href="#2-1-DOM事件" class="headerlink" title="2.1 DOM事件"></a>2.1 DOM事件</h4><p>实际上，只要我们曾经在DOM节点上面绑定过事件函数，那我们就使用过观察者模式，应为JS和DOM之间就是实现了一种观察者模式。</p><pre class=" language-javascript"><code class="language-javascript">document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>，<span class="token boolean">false</span> <span class="token punctuation">)</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//模拟用户点击</span></code></pre><p>在上面的代码中，需要监听用户点击 document.body 的动作，但是我们是没办法预知用户将在什么时候点击的。因此我们订阅了 document.body 的 click 事件，当 body 节点被点击时，body 节点便会向订阅者发布 “Hello World” 消息。</p><h4 id="2-2自定义事件"><a href="#2-2自定义事件" class="headerlink" title="2.2自定义事件"></a>2.2自定义事件</h4><p>除了DOM事件外，我们还可以实现一些自定义事件，这种依靠自定义时间完成的观察者模式可以用于任何的JavaScript代码中。</p><p>示例：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token punctuation">{</span>    clientList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    listen<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clientListen<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>clientList<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token punctuation">}</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>clientList<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    trigger<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> key <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>shift<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>        <span class="token keyword">const</span> fns <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clientList<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fns <span class="token operator">||</span> fns<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> fn <span class="token punctuation">;</span>fn <span class="token operator">=</span> fns<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            fn<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    remove <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key <span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> fns <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clientList<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fns<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>            fns <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>fns<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> l <span class="token operator">=</span> fns<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> l<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">;</span> l<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">const</span> _fn <span class="token operator">=</span> fns<span class="token punctuation">[</span>l<span class="token punctuation">]</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span> _fn <span class="token operator">===</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    fns<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> installEvent <span class="token operator">=</span> obj <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>        obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> event<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>然后我们就能增加发布和订阅功能了：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> events <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token function">installEvent</span><span class="token punctuation">(</span>events<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 订阅信息</span>events<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'newMessage'</span><span class="token punctuation">,</span> fn1 <span class="token operator">=</span> say <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'say:'</span> <span class="token operator">+</span> say<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 发布信息</span>events<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'newMessage'</span><span class="token punctuation">,</span> <span class="token string">"Hello world"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//移除订阅</span>events<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'newMessage'</span><span class="token punctuation">,</span> fn1<span class="token punctuation">)</span></code></pre><h3 id="三、观察者模式的不足"><a href="#三、观察者模式的不足" class="headerlink" title="三、观察者模式的不足"></a>三、观察者模式的不足</h3><p>观察者模式的有点非常明显：一是时间上的解耦，而是对象之间的解耦。既可用于异步编程中，也可以用帮助我们完成更松耦合的代码编写。但它仍然有所不足：</p><ul><li>创建订阅者本身要消耗一定的时间和内存</li><li>当订阅一个消息时，也许此消息并没有发生，但这个订阅者会始终存在内存中。</li><li>观察者模式弱化了对象之间的联系，这本是好事情，但如果过度使用，对象与对象之间的联系也会被隐藏的很深，会导致项目的难以跟踪维护和理解。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
            <tag> JavaScript设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript事件委托</title>
      <link href="/2020/06/06/javascript-shi-jian-wei-tuo/"/>
      <url>/2020/06/06/javascript-shi-jian-wei-tuo/</url>
      
        <content type="html"><![CDATA[<blockquote><p>作者：小进进不将就<br>链接：<a href="https://www.jianshu.com/p/1cfda28abc79" target="_blank" rel="noopener">https://www.jianshu.com/p/1cfda28abc79</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote><h2 id="1、什么是事件委托？"><a href="#1、什么是事件委托？" class="headerlink" title="1、什么是事件委托？"></a><strong>1、什么是事件委托？</strong></h2><p> 事件委托就是利用冒泡的原理，将事件加到 父元素 或 祖先元素上，触发执行效果。</p><p>例：在 document 中绑定 click 事件，当 click 的对象为 按钮 btn 时，弹框显示 按钮 btn的值</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>嘿嘿<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>哈哈<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  window<span class="token punctuation">.</span>onload<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> btn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"btn"</span><span class="token punctuation">)</span>    document<span class="token punctuation">.</span>onclick<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// console.log(e.target)</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token operator">===</span>btn<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span>btn<span class="token punctuation">.</span>value<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200606191737" alt=""></p><h2 id="2、事件委托的优点"><a href="#2、事件委托的优点" class="headerlink" title="2、事件委托的优点"></a><strong>2、事件委托的优点</strong></h2><p> （1）可以提高 <code>JS</code> 性能</p><p> 例：在 <code>ul</code> 上创建 100 个 <code>li</code>，点击每个 <code>li</code> 都要弹框显示该 <code>li</code> 的 <code>value</code></p><p>传统写法：在每个 <code>li</code> 上都绑定 <code>onclick</code> 事件，并触发 <code>alert</code> 事件</p><p>事件委托：在 <code>document</code> 上绑定 <code>onclick</code> 事件，当触发 <code>onclick</code> 事件后，判断是不是 <code>&lt;li&gt;</code> 标签，如果是，则 <code>alert</code> 一下<code>&lt;li&gt;</code>标签的值。</p><p>（2）可以动态添加 <code>DOM</code> 元素，不需要因为元素的变动而修改事件绑定。</p><h2 id="3、事件委托需要注意的地方"><a href="#3、事件委托需要注意的地方" class="headerlink" title="3、事件委托需要注意的地方"></a><strong>3、事件委托需要注意的地方</strong></h2><p> 事件委托绑定的元素，最好是被监听元素的父元素，如 <code>&lt;li&gt;</code> 上面的 <code>&lt;ul&gt;</code>，<code>&lt;tr&gt;</code>上面的 <code>&lt;table&gt;</code> 等。</p><p>因为 事件冒泡 的过程也要耗时，越接近顶层，事件的「事件传播链」就越长，也就越耗时。</p><h2 id="4、事件冒泡-和-事件捕获"><a href="#4、事件冒泡-和-事件捕获" class="headerlink" title="4、事件冒泡 和 事件捕获"></a><strong>4、事件冒泡 和 事件捕获</strong></h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200606191746" alt=""></p><p>如图，事件冒泡是从子元素向父元素传递事件，一层一层，<strong>事件委托就是利用了冒泡原理</strong>；事件捕获是从 DOM 最高层对象一层一层往子元素传播。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6规范大全</title>
      <link href="/2020/06/06/es6-gui-fan-da-quan/"/>
      <url>/2020/06/06/es6-gui-fan-da-quan/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于<a href="https://blog.csdn.net/chenjuan1993/article/details/80952918" target="_blank" rel="noopener">https://blog.csdn.net/chenjuan1993/article/details/80952918</a></p></blockquote><p>文章开篇我要放一下最敬佩的大神阮叔的ES6入门书籍《ECMAScript 6入门》</p><p>  链接地址：<a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener">http://es6.ruanyifeng.com/</a></p><p> ES6（ECMAScript2015）的出现，无疑给前端开发人员带来了新的惊喜，它包含了很多很棒的新特性，可以更加方便的实现很多复杂的操作，提高开发人员的效率。</p><p>本文主要针对ES6做一个简要介绍。下面让我们一同来了解当今最流行的编程语言JavaScript的最新版本的特性。</p><h4 id="let，const"><a href="#let，const" class="headerlink" title="let，const"></a><strong>let，const</strong></h4><p><strong>let 定义的变量不会被变量提升，const 定义的常量不能被修改，let 和 const 都是块级作用域</strong></p><p>ES6前，js 是没有块级作用域 {} 的概念的。（有函数作用域、全局作用域、eval作用域）</p><p>ES6后，let 和 const 的出现，js 也有了块级作用域的概念，前端的知识是日新月异的~</p><p>变量提升：在ES6以前，var关键字声明变量。无论声明在何处，都会被视为声明在函数的最顶部；不在函数内即在全局作用域的最顶部。这样就会引起一些误解。例如：</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// undefined</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span># 上面的代码相当于<span class="token keyword">var</span> a<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span># 而 <span class="token keyword">let</span> 就不会被变量提升console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// a is not defined</span><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span></code></pre><p>const 定义的常量不能被修改</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">"bai"</span><span class="token punctuation">;</span>name <span class="token operator">=</span> <span class="token string">"ming"</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ming</span><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"bai"</span><span class="token punctuation">;</span>name <span class="token operator">=</span> <span class="token string">"ming"</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Assignment to constant variable.</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="import、export"><a href="#import、export" class="headerlink" title="import、export"></a>import、export</h4><p><strong>import导入模块、export导出模块</strong></p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 全部导入</span><span class="token keyword">import</span> people <span class="token keyword">from</span> <span class="token string">'./example'</span><span class="token comment" spellcheck="true">// 将整个模块当作单一对象进行导入，该模块的所有导出都会作为对象的属性存在</span><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> example <span class="token keyword">from</span> <span class="token string">"./example.js"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>example<span class="token punctuation">.</span>name<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>example<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 导入部分，引入非 default 时，使用花括号</span><span class="token keyword">import</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> age<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./example'</span><span class="token comment" spellcheck="true">// 导出默认, 有且只有一个默认</span><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token comment" spellcheck="true">// 部分导出</span><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">App</span> extend Component <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="class、extends、super"><a href="#class、extends、super" class="headerlink" title="class、extends、super"></a>class、extends、super</h4><p>ES5中最令人头疼的的几个部分：原型、构造函数，继承，有了ES6我们不再烦恼！</p><p>ES6引入了Class（类）这个概念。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'animal'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">says</span><span class="token punctuation">(</span>say<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' says '</span> <span class="token operator">+</span> say<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> animal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>animal<span class="token punctuation">.</span><span class="token function">says</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//animal says hello</span><span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'cat'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cat<span class="token punctuation">.</span><span class="token function">says</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//cat says hello</span></code></pre><p>上面代码首先用class定义了一个“类”，可以看到里面有一个constructor方法，这就是构造方法，而this关键字则代表实例对象。简单地说，constructor内定义的方法和属性是实例对象自己的，而constructor外定义的方法和属性则是所有实力对象可以共享的。</p><p>Class之间可以通过extends关键字实现继承，这比ES5的通过修改原型链实现继承，要清晰和方便很多。上面定义了一个Cat类，该类通过extends关键字，继承了Animal类的所有属性和方法。</p><p>super关键字，它指代父类的实例（即父类的this对象）。子类必须在constructor方法中调用super方法，否则新建实例时会报错。这是因为子类没有自己的this对象，而是继承父类的this对象，然后对其进行加工。如果不调用super方法，子类就得不到this对象。</p><p>ES6的继承机制，实质是先创造父类的实例对象this（所以必须先调用super方法），然后再用子类的构造函数修改this。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ES5</span><span class="token keyword">var</span> Shape <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">,</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>Shape<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>move <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> Rectangle <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">id</span><span class="token punctuation">(</span>ix<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Shape<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>Rectangle<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Shape<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>Rectangle<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Rectangle<span class="token punctuation">;</span><span class="token keyword">var</span> Circle <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> radius<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Shape<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>radius <span class="token operator">=</span> radius<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>Circle<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Shape<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>Circle<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Circle<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ES6</span><span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">move</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> radius<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>radius <span class="token operator">=</span> radius<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="arrow-functions-（箭头函数）"><a href="#arrow-functions-（箭头函数）" class="headerlink" title="arrow functions （箭头函数）"></a>arrow functions （箭头函数）</h4><p>函数的快捷写法。不需要 function 关键字来创建函数，省略 return 关键字，继承当前上下文的 this 关键字</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ES5</span><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> newArr1 <span class="token operator">=</span> arr1<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ES6</span><span class="token keyword">let</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> newArr2 <span class="token operator">=</span> arr2<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>箭头函数小细节：当你的函数有且仅有一个参数的时候，是可以省略掉括号的；当你函数中有且仅有一个表达式的时候可以省略{}</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> newArr2 <span class="token operator">=</span> arr2<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">></span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>JavaScript语言的this对象一直是一个令人头痛的问题，运行上面的代码会报错，这是因为setTimeout中的this指向的是全局对象。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'animal'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">says</span><span class="token punctuation">(</span>say<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' says '</span> <span class="token operator">+</span> say<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">var</span> animal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>animal<span class="token punctuation">.</span><span class="token function">says</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//undefined says hi</span></code></pre><h3 id="arrow-functions-（箭头函数）-1"><a href="#arrow-functions-（箭头函数）-1" class="headerlink" title="arrow functions （箭头函数）"></a>arrow functions （箭头函数）</h3><p>函数的快捷写法。不需要 function 关键字来创建函数，省略 return 关键字，继承当前上下文的 this 关键字</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ES5</span><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> newArr1 <span class="token operator">=</span> arr1<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ES6</span><span class="token keyword">let</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> newArr2 <span class="token operator">=</span> arr2<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>箭头函数小细节：当你的函数有且仅有一个参数的时候，是可以省略掉括号的；当你函数中有且仅有一个表达式的时候可以省略{}</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> newArr2 <span class="token operator">=</span> arr2<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">></span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>JavaScript语言的this对象一直是一个令人头痛的问题，运行上面的代码会报错，这是因为setTimeout中的this指向的是全局对象。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'animal'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">says</span><span class="token punctuation">(</span>say<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' says '</span> <span class="token operator">+</span> say<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">var</span> animal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>animal<span class="token punctuation">.</span><span class="token function">says</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//undefined says hi</span></code></pre><p>解决办法：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 传统方法1: 将this传给self,再用self来指代this</span><span class="token function">says</span><span class="token punctuation">(</span>say<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' says '</span> <span class="token operator">+</span> say<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 传统方法2: 用bind(this),即</span><span class="token function">says</span><span class="token punctuation">(</span>say<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' says '</span> <span class="token operator">+</span> say<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ES6: 箭头函数</span><span class="token comment" spellcheck="true">// 当我们使用箭头函数时，函数体内的this对象，就是定义时所在的对象</span><span class="token function">says</span><span class="token punctuation">(</span>say<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' says '</span> <span class="token operator">+</span> say<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="template-string-（模板字符串）"><a href="#template-string-（模板字符串）" class="headerlink" title="template string （模板字符串）"></a>template string （模板字符串）</h4><p>解决了 ES5 在字符串功能上的痛点。</p><p>第一个用途：字符串拼接。将表达式嵌入字符串中进行拼接，用 单引号和`${}来界定。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// es5</span><span class="token keyword">var</span> name1 <span class="token operator">=</span> <span class="token string">"bai"</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span> <span class="token operator">+</span> name1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// es6</span><span class="token keyword">const</span> name2 <span class="token operator">=</span> <span class="token string">"ming"</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`hello</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>第二个用途：在ES5时我们通过反斜杠来做多行字符串拼接。ES6反引号 `` 直接搞定。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// es5</span><span class="token keyword">var</span> msg <span class="token operator">=</span> <span class="token string">"Hi \man!"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// es6</span><span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token template-string"><span class="token string">`&lt;div>&lt;span>hello world&lt;/span>&lt;/div>`</span></span><span class="token punctuation">;</span></code></pre><p>另外：<code>includes</code> <code>repeat</code></p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// includes：判断是否包含然后直接返回布尔值</span><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'hahah'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// false</span><span class="token comment" spellcheck="true">// repeat: 获取字符串重复n次</span><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">'he'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'hehehe'</span></code></pre><h4 id="destructuring-（解构）"><a href="#destructuring-（解构）" class="headerlink" title="destructuring （解构）"></a>destructuring （解构）</h4><p>简化数组和对象中信息的提取。</p><p>ES6前，我们一个一个获取对象信息；</p><p>ES6后，解构能让我们从对象或者数组里取出数据存为变量</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ES5</span><span class="token keyword">var</span> people1 <span class="token operator">=</span> <span class="token punctuation">{</span>    name<span class="token punctuation">:</span> <span class="token string">'bai'</span><span class="token punctuation">,</span>    age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>    color<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> myName <span class="token operator">=</span> people1<span class="token punctuation">.</span>name<span class="token punctuation">;</span><span class="token keyword">var</span> myAge <span class="token operator">=</span> people1<span class="token punctuation">.</span>age<span class="token punctuation">;</span><span class="token keyword">var</span> myColor <span class="token operator">=</span> people1<span class="token punctuation">.</span>color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myName <span class="token operator">+</span> <span class="token string">'----'</span> <span class="token operator">+</span> myAge <span class="token operator">+</span> <span class="token string">'----'</span> <span class="token operator">+</span> myColor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ES6</span><span class="token keyword">let</span> people2 <span class="token operator">=</span> <span class="token punctuation">{</span>    name<span class="token punctuation">:</span> <span class="token string">'ming'</span><span class="token punctuation">,</span>    age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>    color<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token keyword">let</span> <span class="token punctuation">{</span>    name<span class="token punctuation">,</span>    age<span class="token punctuation">}</span> <span class="token operator">=</span> people2<span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">[</span>first<span class="token punctuation">,</span> second<span class="token punctuation">]</span> <span class="token operator">=</span> people2<span class="token punctuation">.</span>color<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">----</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">----</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>first<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="default-函数默认参数"><a href="#default-函数默认参数" class="headerlink" title="default 函数默认参数"></a>default 函数默认参数</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ES5 给函数定义参数默认值</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token punctuation">{</span>    num <span class="token operator">=</span> num <span class="token operator">||</span> <span class="token number">200</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> num<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ES6</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>num <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> num<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="rest-arguments-（rest参数）"><a href="#rest-arguments-（rest参数）" class="headerlink" title="rest arguments （rest参数）"></a>rest arguments （rest参数）</h3><p>解决了 es5 复杂的 <code>arguments</code> 问题</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span> <span class="token operator">*</span> rest<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 9</span></code></pre><h3 id="Spread-Operator-（展开运算符）"><a href="#Spread-Operator-（展开运算符）" class="headerlink" title="Spread Operator （展开运算符）"></a>Spread Operator （展开运算符）</h3><p>第一个用途：组装数组</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> color <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> colorful <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>color<span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>colorful<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ["red", "yellow", "green", "blue"]</span></code></pre><p>第二个用途：获取数组除了某几项的其他项</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">[</span>first<span class="token punctuation">,</span> second<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">]</span> <span class="token operator">=</span> num<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [5, 7, 9]</span></code></pre><h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>对象初始化简写</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ES5</span><span class="token keyword">function</span> <span class="token function">people</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        name<span class="token punctuation">:</span> name<span class="token punctuation">,</span>        age<span class="token punctuation">:</span> age    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ES6</span><span class="token keyword">function</span> <span class="token function">people</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        name<span class="token punctuation">,</span>        age    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>对象字面量简写（省略冒号与 function 关键字）</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ES5</span><span class="token keyword">var</span> people1 <span class="token operator">=</span> <span class="token punctuation">{</span>    name<span class="token punctuation">:</span> <span class="token string">'bai'</span><span class="token punctuation">,</span>    getName<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ES6</span><span class="token keyword">let</span> people2 <span class="token operator">=</span> <span class="token punctuation">{</span>    name<span class="token punctuation">:</span> <span class="token string">'bai'</span><span class="token punctuation">,</span>    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>另外：<code>Object.assign()</code></p><p>ES6 对象提供了Object.assign()这个方法来实现浅复制。Object.assign()可以把任意多个源对象自身可枚举的属性拷贝给目标对象，然后返回目标对象。第一参数即为目标对象。在实际项目中，我们为了不改变源对象。一般会把目标对象传为{}</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> objA<span class="token punctuation">,</span> objB<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 给对象添加属性</span><span class="token keyword">this</span><span class="token punctuation">.</span>seller <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>seller<span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span></code></pre><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p><strong>用同步的方式去写异步代码</strong></p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 发起异步请求</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/todos'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>        data    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>        err    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="Generators"><a href="#Generators" class="headerlink" title="Generators"></a>Generators</h3><p>生成器（ generator）是能返回一个迭代器的函数。</p><p>生成器函数也是一种函数，最直观的表现就是比普通的function多了个星号<code>*</code>，在其函数体内可以使用<code>yield</code>关键字,有意思的是函数会在每个<code>yield</code>后暂停。</p><p>这里生活中有一个比较形象的例子。咱们到银行办理业务时候都得向大厅的机器取一张排队号。你拿到你的排队号，机器并不会自动为你再出下一张票。也就是说取票机“暂停”住了，直到下一个人再次唤起才会继续吐票。</p><p>迭代器：当你调用一个generator时，它将返回一个迭代器对象。这个迭代器对象拥有一个叫做next的方法来帮助你重启generator函数并得到下一个值。next方法不仅返回值，它返回的对象具有两个属性：done和value。value是你获得的值，done用来表明你的generator是否已经停止提供值。继续用刚刚取票的例子，每张排队号就是这里的value，打印票的纸是否用完就这是这里的done。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 生成器</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">createIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 生成器能像正规函数那样被调用，但会返回一个迭代器</span><span class="token keyword">let</span> iterator <span class="token operator">=</span> <span class="token function">createIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 3</span></code></pre><p>迭代器对异步编程作用很大，异步调用对于我们来说是很困难的事，我们的函数并不会等待异步调用完再执行，你可能会想到用回调函数，（当然还有其他方案比如Promise比如Async/await）。</p><p>生成器可以让我们的代码进行等待。就不用嵌套的回调函数。使用generator可以确保当异步调用在我们的generator函数运行一下行代码之前完成时暂停函数的执行。</p><p>那么问题来了，咱们也不能手动一直调用next()方法，你需要一个能够调用生成器并启动迭代器的方法。就像这样子的：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span>taskDef<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// taskDef 即一个生成器函数</span>    <span class="token comment" spellcheck="true">// 创建迭代器，让它在别处可用</span>    <span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token function">taskDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 启动任务</span>    <span class="token keyword">let</span> result <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 递归使用函数来保持对 next() 的调用</span>    <span class="token keyword">function</span> <span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 如果还有更多要做的</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>            result <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 开始处理过程</span>    <span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上就是 ES6 最常用的一些语法，可以说这20%的语法，在ES6的日常使用中占了80%</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> ES6语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitbook插件</title>
      <link href="/2020/05/31/gitbook-cha-jian/"/>
      <url>/2020/05/31/gitbook-cha-jian/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>作　　者</strong>：<strong><a href="https://www.cnblogs.com/mingyue5826" target="_blank" rel="noopener">明月</a></strong><br><strong>出　　处</strong>：<a href="https://www.cnblogs.com/mingyue5826" target="_blank" rel="noopener">https://www.cnblogs.com/mingyue5826</a></p><p><strong>本文出处</strong>：<a href="https://www.cnblogs.com/mingyue5826/p/10307051.html" target="_blank" rel="noopener">https://www.cnblogs.com/mingyue5826/p/10307051.html</a></p></blockquote><p>因为这个是他的个人网站，有单独的样式copy下来会乱，这里只做转载地址</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> gitbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES5原型链实现类与继承</title>
      <link href="/2020/05/29/es5-yuan-xing-lian-shi-xian-lei-yu-ji-cheng/"/>
      <url>/2020/05/29/es5-yuan-xing-lian-shi-xian-lei-yu-ji-cheng/</url>
      
        <content type="html"><![CDATA[<blockquote><p>作者：东方既白233<br>链接：<a href="https://www.imooc.com/article/254600" target="_blank" rel="noopener">https://www.imooc.com/article/254600</a><br>来源：慕课网<br>本文原创发布于慕课网 ，转载请注明出处，谢谢合作</p></blockquote><h2 id="1-借助构造函数实现继承"><a href="#1-借助构造函数实现继承" class="headerlink" title="1.借助构造函数实现继承"></a>1.借助构造函数实现继承</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/*** 借助构造函数实现继承*/</span><span class="token keyword">function</span> Parent1 <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'parent1'</span><span class="token punctuation">;</span><span class="token punctuation">}</span>Parent1<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>say <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//Parent1 原型链上的方法并没有被 Child1 所继承</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> Child1 <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>Parent1<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//apply；改变函数运行的上下文（将父级的构造函数this指向子构造函数的实例上）</span><span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'child1'</span><span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Child1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Child1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Uncaught TypeError: (intermediate value).say is not a function</span><span class="token comment" spellcheck="true">//缺点就是父类原型链上的方法没有被child1继承了，因为只是调用了父类的构造函数，将属性赋值给子类的实例</span></code></pre><h2 id="2-借助原型链实现继承"><a href="#2-借助原型链实现继承" class="headerlink" title="2.借助原型链实现继承"></a>2.借助原型链实现继承</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/*** 借助原型链实现继承*/</span><span class="token keyword">function</span> <span class="token function">Parent2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'parent2'</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>play <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Child2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'child2'</span><span class="token punctuation">;</span><span class="token punctuation">}</span>Child2<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//new Child2().__proto__===Child2.prototype</span><span class="token keyword">var</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>play<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>play<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//(3) [1, 2, 3] (3) [1, 2, 3]</span>s1<span class="token punctuation">.</span>play<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>play<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>play<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//(4) [1, 2, 3, 4] (4) [1, 2, 3, 4]</span><span class="token comment" spellcheck="true">//缺点，虽然父类的实例成为了子类的原型对象，子类实例都能使用到父类的方法跟数据，但是每次实例化子类，都共用同一个父类实例</span><span class="token comment" spellcheck="true">//改变原型对象会改变父类实例的数据，从而导致两边的原型对象数据都改变</span></code></pre><h2 id="3-组合"><a href="#3-组合" class="headerlink" title="3.组合"></a>3.组合</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Parent3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'parent3'</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>play <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Child3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Parent3<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//在子构造函数中执行父级构造函数</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'child3'</span><span class="token punctuation">;</span><span class="token punctuation">}</span>Child3<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> s4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s3<span class="token punctuation">.</span>play<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span>play<span class="token punctuation">,</span> s4<span class="token punctuation">.</span>play<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//(4) [1, 2, 3, 4] (3) [1, 2, 3]</span><span class="token comment" spellcheck="true">// 缺点：在实例化1个子类的时候，父类的构造函数执行了2次）,同时，子类实例有了父类实例的数据，</span><span class="token comment" spellcheck="true">// 子类的原型对象同时也是父类的示例，也有了一份一样的父类实例数据</span></code></pre><h2 id="4-组合优化一"><a href="#4-组合优化一" class="headerlink" title="4.组合优化一"></a>4.组合优化一</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Parent4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'parent4'</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>play <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Child4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Parent4<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'child4'</span><span class="token punctuation">;</span><span class="token punctuation">}</span>Child4<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Parent4<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//实例化1个子类的时候，父类的构造函数执行了1次</span><span class="token keyword">var</span> s5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> s6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s5<span class="token punctuation">,</span> s6<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Child4 {name: "parent4", play: Array(3), type: "child4"} Child4 {name: "parent4", play: Array(3), type: "child4"}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s5 <span class="token keyword">instanceof</span> <span class="token class-name">Child4</span><span class="token punctuation">,</span> s5 <span class="token keyword">instanceof</span> <span class="token class-name">Parent4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s5<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//缺点：直接把父类的原型对象复制给子类的原型对象，</span><span class="token comment" spellcheck="true">//那么打印出来的s5的constructor是父类的构造函数。是由父类构造的。</span><span class="token comment" spellcheck="true">//直接使用s5 instanceof Parent4或者Child5出来的结果都是是true。</span><span class="token comment" spellcheck="true">//因为无论instanceof的原理是判断实例化对象的_proto_是不是等于构造函数的prototype对象</span><span class="token comment" spellcheck="true">//但是在这里CHild4.prototype跟Parent4.prototype指向的是同一块内存地址，所以肯定都是为true</span></code></pre><h2 id="5-组合优化二"><a href="#5-组合优化二" class="headerlink" title="5.组合优化二"></a>5.组合优化二</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/*** 组合继承的优化2*/</span><span class="token keyword">function</span> <span class="token function">Parent5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'parent5'</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>play <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">Child5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Parent5<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'child5'</span><span class="token punctuation">;</span><span class="token punctuation">}</span>Child5<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Parent5<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>Child5<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Child5<span class="token punctuation">;</span><span class="token keyword">var</span> s7 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s7 <span class="token keyword">instanceof</span> <span class="token class-name">Child5</span><span class="token punctuation">,</span> s7 <span class="token keyword">instanceof</span> <span class="token class-name">Parent5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//true true</span>s7<span class="token punctuation">.</span>constructor<span class="token comment" spellcheck="true">//通过 Object.create()创建一个中间对象{}，这个中间对象原型指向Parent.prototype</span><span class="token comment" spellcheck="true">//再讲这个中间对象{}赋值给子类的prototpye,最后再修改子类的prototype的constructor为CHild5构造函数</span><span class="token comment" spellcheck="true">//这种写法，设置s7的构造函数是Child而不是parent，虽然s7 instanceof child跟parent都未true</span><span class="token comment" spellcheck="true">//但是s7.constructor=Child5了，而不是parent5</span><span class="token comment" spellcheck="true">//证明s7是从child实例化的。</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript原型链</title>
      <link href="/2020/05/28/javascript-yuan-xing-lian/"/>
      <url>/2020/05/28/javascript-yuan-xing-lian/</url>
      
        <content type="html"><![CDATA[<blockquote><p>作者：前小白<br>链接：<a href="https://www.jianshu.com/p/08c07a953fa0" target="_blank" rel="noopener">https://www.jianshu.com/p/08c07a953fa0</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote><blockquote><p>原型链是前端面试里一个经久不衰的问题了，自己也查阅了很多的资料，像红宝书、JavaScript忍者秘籍上都有对这一方面的描述和概括，今天就像自己归纳一下这个问题：</p></blockquote><p><strong>首先，我们先来看一张图：</strong></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707182552" alt=""></p><p>这个绕来绕去的线是不是很恶心呢？那就先别管这些了，等整个逻辑我们梳理完就自然而然的会明白了~</p><h2 id="详解原型链"><a href="#详解原型链" class="headerlink" title="详解原型链"></a>详解原型链</h2><h3 id="一、-什么是原型链？"><a href="#一、-什么是原型链？" class="headerlink" title="一、 什么是原型链？"></a>一、 什么是原型链？</h3><blockquote><p>​    每个对象都可以有一个原型_proto_，这个原型还可以有它自己的原型，以此类推，形成一个原型链。查找特定属性的时候，我们先去这个对象里去找，如果没有的话就去它的原型对象里面去，如果还是没有的话再去向原型对象的原型对象里去寻找…… 这个操作被委托在整个原型链上，这个就是我们说的原型链了。</p></blockquote><h3 id="二、原型指针"><a href="#二、原型指针" class="headerlink" title="二、原型指针"></a>二、原型指针</h3><p>  我们知道了原型的概念，接下来我们就照着上面的图来具体分析一下原型的指针；中间最上面蓝色模块标注的构造函数Foo, 里面有两个属性： <em>proto</em> 和 prototype, 这两个很容易使人混淆，先说说prototype:</p><p><code>prototype:</code></p><p>  prototype属性，它是<strong>函数所独有的</strong>，它是从<strong>一个函数指向一个对象</strong>。它的含义是<strong>函数的原型对象</strong>，也就是这个函数（其实所有函数都可以作为构造函数）所创建的实例的原型对象; 这个属性是一个指针，指向一个对象，这个对象的用途就是包含所有实例共享的属性和方法（我们把这个对象叫做原型对象）;</p><p><code>__proto__:</code></p><p>  <code>__proto__</code>是原型链查询中实际用到的，它总是指向 prototype，换句话说就是指向构造函数的原型对象，它是<strong>对象独有的。</strong>注意，为什么Foo构造也有这个属性呢，因为再js的宇宙里万物皆对象，包括函数；</p><p>根据以上的概括我们能知道Foo构造函数<code>__proto__</code>指向的是他的构造函数的原型对象，它的构造函数是Function, 也就是说Foo的<em>proto_指向Function.prototype, 我们再看到左边绿色的a和b函数的<code>__proto__</code>指像的是Foo.prototype,因为他们是通过 new Foo实例化出来的，它们的构造函数就是Foo(), 即a._proto</em> = Foo.prototype； 接着我们来看看最右边紫色的模块Function.prororype, 它的_proto_指针指向的是Object.prototype,Object._proto_又为null.。于是我们就可以得出：在原型链中的指向是，函数 → 构造行数 → Function.prototype → Object.protype → null ;</p><p><code>constructor：</code></p><p>  我们看到途中最中间灰色模块有一个constructor属性，这个又是做什么用的呢？</p><blockquote><p>每个函数都有一个原型对象，该原型对象有一个constructor属性，指向创建对象的函数本身。</p></blockquote><p>  此外，我们还可以使用constructor属性，所有的实例对象都可以访问constructor属性，constructor属性是创建实例对象的函数的引用。我们可以使用constructor属性验证实例的原型类型（与操作符instanceof非常类似）。</p><p>  由于constructor属性仅仅是原始构造函数的引用，因此我们可以使用该属性创建新的对象，如：</p><p><img src="https:////upload-images.jianshu.io/upload_images/15932532-8c96be3aa1f32228.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/403/format/webp" alt="img"></p><p>  通过第一个对象实例化对象的constuctor方法创建第2个实例化对象，说明创建的新对象ninja2 是Ninja的实例，由于ninja和ninja2不是同一个对象可以得出它们是两个截然不同的实例；</p><p><strong>结论：</strong></p><p>​    1、<strong>proto</strong> 是原型链查询中实际用到的，它总是指向 prototype；</p><p>​    2、prototype 是函数所独有的<strong>，</strong>在定义构造函数时自动创建，它总是被 <strong>proto</strong> 所指。</p><p>所有对象都有<strong>proto</strong>属性，函数这个特殊对象除了具有<strong>proto</strong>属性，还有特有的原型属性prototype。prototype对象默认有两个属性，constructor属性和<strong>proto</strong>属性。prototype属性可以给函数和对象添加可共享（继承）的方法、属性，而<strong>proto</strong>是查找某函数或对象的原型链方式。constructor，这个属性包含了一个指针，指回原构造函数。</p><h2 id="图解原型链"><a href="#图解原型链" class="headerlink" title="图解原型链"></a>图解原型链</h2><blockquote><p>作者：前小白<br>链接：<a href="https://www.jianshu.com/p/9085998d8158" target="_blank" rel="noopener">https://www.jianshu.com/p/9085998d8158</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200528180124" alt="img"></p><p>所谓原型链，指的就是图中的<strong>proto</strong>这一条指针链！</p><p>原型链的顶层就是Object.prototype，而这个对象的是没有原型对象的。</p><p>可在chrome的控制台里面输入：</p><p>Object.<strong>proto</strong></p><p>输出是:</p><p>functionEmpty(){}</p><p>原型链，如此而已。</p><p>对于新人来说，JavaScript的原型是一个很让人头疼的事情，一来prototype容易与<strong>proto</strong>混淆，二来它们之间的各种指向实在有些复杂，其实市面上已经有非常多的文章在尝试说清楚，有一张所谓很经典的图，上面画了各种线条，一会连接这个一会连接那个，说实话我自己看得就非常头晕，更谈不上完全理解了。所以我自己也想尝试一下，看看能不能把原型中的重要知识点拆分出来，用最简单的图表形式说清楚。</p><p>我们知道原型是一个对象，其他对象可以通过它实现属性继承。但是尼玛除了prototype，又有一个<strong>proto</strong>是用来干嘛的？长那么像，让人怎么区分呢？它们都指向谁，那么混乱怎么记啊？原型链又是什么鬼？相信不少初学者甚至有一定经验的老鸟都不一定能完全说清楚，下面用三张简单的图，配合一些示例代码来理解一下。</p><h3 id="prototype和proto的区别"><a href="#prototype和proto的区别" class="headerlink" title="prototype和proto的区别"></a>prototype和<strong>proto</strong>的区别</h3><p><img src="https://images2015.cnblogs.com/blog/787416/201603/787416-20160323103557261-114570044.png" alt="img"></p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//undefined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//Object {}</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//b {}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//function() {}</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200708103739" alt=""></p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/*1、字面量方式*/</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//Object {}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> a<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//true</span><span class="token comment" spellcheck="true">/*2、构造器方式*/</span><span class="token keyword">var</span> A <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//A {}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> a<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//true</span><span class="token comment" spellcheck="true">/*3、Object.create()方式*/</span><span class="token keyword">var</span> a1 <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token keyword">var</span> a2 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a2<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Object {a: 1}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> a<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//false（此处即为图1中的例外情况）</span></code></pre><p><img src="https://images2015.cnblogs.com/blog/787416/201603/787416-20160322110905589-2039017350.png" alt="什么是原型链？"></p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> A <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//A {}（即构造器function A 的原型对象）</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Object {}（即构造器function Object 的原型对象）</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//null</span></code></pre><h3 id="额外知识"><a href="#额外知识" class="headerlink" title="额外知识"></a>额外知识</h3><p>我在写一篇图解prototype和<strong>proto</strong>的区别时，搜资料搜到了一个有意思的现象，下面这两个运算返回的结果是一样的：</p><p>Function instanceof Object;//true</p><p>Object instanceof Function;//true</p><p>这个是怎么一回事呢？要从运算符instanceof说起。</p><h2 id="简述原型链"><a href="#简述原型链" class="headerlink" title="简述原型链"></a>简述原型链</h2><blockquote><p>作者：柚子硕<br>链接：<a href="https://www.jianshu.com/p/f8c7c55025fc" target="_blank" rel="noopener">https://www.jianshu.com/p/f8c7c55025fc</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote><p>基础：<br> <code>只有构造函数有原型属性 - prototype，它是一个对象</code><br> <code>原型对象中有个constructor属性，constructor指向构造函数本身，也只有原型对象具有constructor属性</code><br> <code>所有的对象都有 __protp__属性，它也是个对象</code></p><h6 id="1-构造函数"><a href="#1-构造函数" class="headerlink" title="1.构造函数"></a>1.构造函数</h6><pre class=" language-js"><code class="language-js"> <span class="token comment" spellcheck="true">// 构造函数</span>    <span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 多个对象，会存储多个sayHi方法</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>sayHi <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'大家好，我是'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>     <span class="token keyword">var</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'lilei'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'hmm'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    s1<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    s2<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>sayHi <span class="token operator">===</span> s2<span class="token punctuation">.</span>sayHi<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// false 两个独立的sayHi方法</span></code></pre><p>我们可以通过构造函数批量创建具有相同属性的对象，但当构造函数内有静态方法的时候，每创建一个实例都会为静态方法在内存中开辟一块空间，而这些方法都是一样的，浪费内存。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200708172032" alt=""></p><p>解决方案是将静态方法放在构造函数的原型prototype上，构造函数的原型不会被实例拷贝，所有的实例对象都可以访问构造函数的原型，这样节省了内存空间。</p><pre class=" language-js"><code class="language-js">    <span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>    <span class="token punctuation">}</span>     Student<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>sayHi <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'大家好，我是'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 通过Student构造函数，创建的对象，可以访问Student.prototype中的成员</span>    <span class="token keyword">var</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'lilei'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'hmm'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    s1<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    s2<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>sayHi <span class="token operator">===</span> s2<span class="token punctuation">.</span>sayHi<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// true</span></code></pre><h6 id="2-原型链"><a href="#2-原型链" class="headerlink" title="2.原型链"></a>2.原型链</h6><p>把构造函数、构造函数的原型、构造函数的实例之前的关系成为原型链</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200708172052" alt=""></p><p>image.png</p><h6 id="3-查找规则"><a href="#3-查找规则" class="headerlink" title="3.查找规则"></a>3.查找规则</h6><p>实例对象访问一个方法或者属性的步骤<br> 1.在本身对象内查找<br> 2.通过<code>__proto__</code>访问构造函数的原型prototype内查找<br> 3.通过构造函数的原型prototype内的<code>__proto__</code>访问Object构造函数的原型prototype查找，结果是 null</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200708172104" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AST抽象语法树</title>
      <link href="/2020/05/28/ast-chou-xiang-yu-fa-shu/"/>
      <url>/2020/05/28/ast-chou-xiang-yu-fa-shu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于<a href="https://segmentfault.com/a/1190000016231512?utm_source=tag-newest" target="_blank" rel="noopener">https://segmentfault.com/a/1190000016231512?utm_source=tag-newest</a></p><p>github地址为<a href="https://github.com/wanthering/exportific" target="_blank" rel="noopener">https://github.com/wanthering/exportific</a></p></blockquote><blockquote><p>抽象语法树（AST），是一个非常基础而重要的知识点，但国内的文档却几乎一片空白。</p><p>本文将带大家从底层了解AST,并且通过发布一个小型前端工具，来带大家了解AST的强大功能</p></blockquote><blockquote><p>介绍两个查看AST的工具网站</p><p><a href="https://esprima.org/demo/parse.html#" target="_blank" rel="noopener">https://esprima.org/demo/parse.html#</a></p><p><a href="https://astexplorer.net/" target="_blank" rel="noopener">https://astexplorer.net/</a></p></blockquote><p>Javascript就像一台精妙运作的机器，我们可以用它来完成一切天马行空的构思。</p><p>我们对javascript生态了如指掌，却常忽视javascript本身。这台机器，究竟是哪些零部件在支持着它运行？</p><p>AST在日常业务中也许很难涉及到，但当你不止于想做一个工程师，而想做工程师的工程师，写出vue、react之类的大型框架，或类似webpack、vue-cli前端自动化的工具，或者有批量修改源码的工程需求，那你必须懂得AST。AST的能力十分强大，且能帮你真正吃透javascript的语言精髓。</p><p>事实上，在javascript世界中，你可以认为抽象语法树(AST)是最底层。 再往下，就是关于转换和编译的“黑魔法”领域了。</p><h2 id="人生第一次拆解Javascript"><a href="#人生第一次拆解Javascript" class="headerlink" title="人生第一次拆解Javascript"></a>人生第一次拆解Javascript</h2><p>小时候，当我们拿到一个螺丝刀和一台机器，人生中最令人怀念的梦幻时刻便开始了：</p><p>我们把机器，拆成一个一个小零件，一个个齿轮与螺钉，用巧妙的机械原理衔接在一起…</p><p>当我们把它重新照不同的方式组装起来，这时，机器重新又跑动了起来——世界在你眼中如获新生。</p><p>通过抽象语法树解析，我们可以像童年时拆解玩具一样，透视Javascript这台机器的运转，并且重新按着你的意愿来组装。</p><p><strong>现在，我们拆解一个简单的add函数</strong></p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">}</span></code></pre><p>首先，我们拿到的这个语法块，是一个FunctionDeclaration(函数定义)对象。</p><p>用力拆开，它成了三块：</p><ul><li>一个id，就是它的名字，即add</li><li>两个params，就是它的参数，即[a, b]</li><li>一块body，也就是大括号内的一堆东西</li></ul><p>add没办法继续拆下去了，它是一个最基础Identifier（标志）对象，用来作为函数的唯一标志，就像人的姓名一样。</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>    name<span class="token operator">:</span> 'add'    type<span class="token operator">:</span> 'identifier'    ...<span class="token punctuation">}</span></code></pre><p>params继续拆下去，其实是两个Identifier组成的数组。之后也没办法拆下去了。</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">[</span>    <span class="token punctuation">{</span>        name<span class="token operator">:</span> 'a'        type<span class="token operator">:</span> 'identifier'        ...    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        name<span class="token operator">:</span> 'b'        type<span class="token operator">:</span> 'identifier'        ...    <span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><p>接下来，我们继续拆开body<br>我们发现，body其实是一个BlockStatement（块状域）对象，用来表示是<code>{return a + b}</code></p><p>打开Blockstatement，里面藏着一个ReturnStatement（Return域）对象，用来表示<code>return a + b</code></p><p>继续打开ReturnStatement,里面是一个BinaryExpression(二项式)对象，用来表示<code>a + b</code></p><p>继续打开BinaryExpression，它成了三部分，<code>left</code>，<code>operator</code>，<code>right</code></p><ul><li><code>operator</code> 即<code>+</code></li><li><code>left</code> 里面装的，是Identifier对象 <code>a</code></li><li><code>right</code> 里面装的，是Identifer对象 <code>b</code></li></ul><p>就这样，我们把一个简单的add函数拆解完毕，用图表示就是</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200528171927" alt=""></p><p>看！抽象语法树(Abstract Syntax Tree)，的确是一种标准的树结构。</p><p>那么，上面我们提到的Identifier、Blockstatement、ReturnStatement、BinaryExpression， 这一个个小部件的说明书去哪查？</p><p><strong>请查看 <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Parser_API#Node_objects" target="_blank" rel="noopener">AST对象文档</a></strong></p><h3 id="送给你的AST螺丝刀：recast"><a href="#送给你的AST螺丝刀：recast" class="headerlink" title="送给你的AST螺丝刀：recast"></a>送给你的AST螺丝刀：recast</h3><p>输入命令：</p><pre><code>npm i recast -S</code></pre><p>你即可获得一把操纵语法树的螺丝刀</p><p>接下来，你可以在任意js文件下操纵这把螺丝刀，我们新建一个parse.js示意：</p><p><strong>parse.js</strong></p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 给你一把"螺丝刀"——recast</span><span class="token keyword">const</span> recast <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"recast"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 你的"机器"——一段代码</span><span class="token comment" spellcheck="true">// 我们使用了很奇怪格式的代码，想测试是否能维持代码结构</span><span class="token keyword">const</span> code <span class="token operator">=</span>  <span class="token template-string"><span class="token string">`  function add(a, b) {    return a +      // 有什么奇怪的东西混进来了      b  }  `</span></span><span class="token comment" spellcheck="true">// 用螺丝刀解析机器</span><span class="token keyword">const</span> ast <span class="token operator">=</span> recast<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ast可以处理很巨大的代码文件</span><span class="token comment" spellcheck="true">// 但我们现在只需要代码块的第一个body，即add函数</span><span class="token keyword">const</span> add  <span class="token operator">=</span> ast<span class="token punctuation">.</span>program<span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span></code></pre><p>输入<code>node parse.js</code>你可以查看到add函数的结构，与之前所述一致，通过<a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Parser_API#Node_objects" target="_blank" rel="noopener">AST对象文档</a>可查到它的具体属性：</p><pre class=" language-javascript"><code class="language-javascript">FunctionDeclaration<span class="token punctuation">{</span>    type<span class="token punctuation">:</span> <span class="token string">'FunctionDeclaration'</span><span class="token punctuation">,</span>    id<span class="token punctuation">:</span> <span class="token operator">...</span>    params<span class="token punctuation">:</span> <span class="token operator">...</span>    body<span class="token punctuation">:</span> <span class="token operator">...</span><span class="token punctuation">}</span></code></pre><p>你也可以继续使用console.log透视它的更内层，如：</p><pre><code>console.log(add.params[0])console.log(add.body.body[0].argument.left)</code></pre><h2 id="recast-types-builders-制作模具"><a href="#recast-types-builders-制作模具" class="headerlink" title="recast.types.builders 制作模具"></a>recast.types.builders 制作模具</h2><p>一个机器，你只会拆开重装，不算本事。</p><p>拆开了，还能改装，才算上得了台面。</p><p>recast.types.builders里面提供了不少“模具”，让你可以轻松地拼接成新的机器。</p><p>最简单的例子，我们想把之前的<code>function add(a, b){...}</code>声明，改成匿名函数式声明<code>const add = function(a ,b){...}</code></p><p>如何改装？</p><p>第一步，我们创建一个VariableDeclaration变量声明对象，声明头为const， 内容为一个即将创建的VariableDeclarator对象。</p><p>第二步，创建一个VariableDeclarator，放置add.id在左边， 右边是将创建的FunctionDeclaration对象</p><p>第三步，我们创建一个FunctionDeclaration，如前所述的三个组件，id params body中，因为是匿名函数id设为空，params使用add.params，body使用add.body。</p><p>这样，就创建好了<code>const add = function(){}</code>的AST对象。</p><p>在之前的parse.js代码之后，加入以下代码</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 引入变量声明，变量符号，函数声明三种“模具”</span><span class="token keyword">const</span> <span class="token punctuation">{</span>variableDeclaration<span class="token punctuation">,</span> variableDeclarator<span class="token punctuation">,</span> functionExpression<span class="token punctuation">}</span> <span class="token operator">=</span> recast<span class="token punctuation">.</span>types<span class="token punctuation">.</span>builders<span class="token comment" spellcheck="true">// 将准备好的组件置入模具，并组装回原来的ast对象。</span>ast<span class="token punctuation">.</span>program<span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">variableDeclaration</span><span class="token punctuation">(</span><span class="token string">"const"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>  <span class="token function">variableDeclarator</span><span class="token punctuation">(</span>add<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token function">functionExpression</span><span class="token punctuation">(</span>    <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// Anonymize the function expression.</span>    add<span class="token punctuation">.</span>params<span class="token punctuation">,</span>    add<span class="token punctuation">.</span>body  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//将AST对象重新转回可以阅读的代码</span><span class="token keyword">const</span> output <span class="token operator">=</span> recast<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span></code></pre><p>可以看到，我们打印出了</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> a <span class="token operator">+</span>    <span class="token comment" spellcheck="true">// 有什么奇怪的东西混进来了</span>    b<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>最后一行</p><pre><code>const output = recast.print(ast).code;</code></pre><p>其实是recast.parse的逆向过程，具体公式为</p><pre><code>recast.print(recast.parse(source)).code === source</code></pre><p>打印出来还保留着“原装”的函数内容，连注释都没有变。</p><p>我们其实也可以打印出美化格式的代码段：</p><pre><code>const output = recast.prettyPrint(ast, { tabWidth: 2 }).code</code></pre><p>输出为</p><pre><code>const add = function(a, b) {  return a + b;};</code></pre><blockquote><p>现在，你是不是已经产生了“我可以通过AST树生成任何js代码”的幻觉？</p><p>我郑重告诉你，这不是幻觉。</p></blockquote><h2 id="实战进阶：命令行修改js文件"><a href="#实战进阶：命令行修改js文件" class="headerlink" title="实战进阶：命令行修改js文件"></a>实战进阶：命令行修改js文件</h2><p>除了parse/print/builder以外，Recast的三项主要功能：</p><ul><li>run: 通过命令行读取js文件，并转化成ast以供处理。</li><li>tnt： 通过assert()和check()，可以验证ast对象的类型。</li><li>visit: 遍历ast树，获取有效的AST对象并进行更改。</li></ul><p>我们通过一个系列小务来学习全部的recast工具库：</p><p>创建一个用来示例文件，假设是demo.js</p><p><strong>demo.js</strong></p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">commonDivision</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>b <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">></span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>      a <span class="token operator">=</span> <span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      b <span class="token operator">=</span> <span class="token function">sub</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> a<span class="token punctuation">}</span></code></pre><h3 id="recast-run-——-命令行文件读取"><a href="#recast-run-——-命令行文件读取" class="headerlink" title="recast.run —— 命令行文件读取"></a>recast.run —— 命令行文件读取</h3><p>新建一个名为<code>read.js</code>的文件，写入<br><strong>read.js</strong></p><pre class=" language-javascript"><code class="language-javascript">recast<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> printSource<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">printSource</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>命令行输入</p><pre><code>node read demo.js</code></pre><p>我们查以看到js文件内容打印在了控制台上。</p><p>我们可以知道，<code>node read</code>可以读取<code>demo.js</code>文件，并将demo.js内容转化为ast对象。</p><p>同时它还提供了一个<code>printSource</code>函数，随时可以将ast的内容转换回源码，以方便调试。</p><h3 id="recast-visit-——-AST节点遍历"><a href="#recast-visit-——-AST节点遍历" class="headerlink" title="recast.visit —— AST节点遍历"></a>recast.visit —— AST节点遍历</h3><p><strong>read.js</strong></p><pre class=" language-javascript"><code class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node<span class="token keyword">const</span> recast  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'recast'</span><span class="token punctuation">)</span>recast<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> printSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>  recast<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>      visitExpressionStatement<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">{</span>node<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">false</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>recast.visit将AST对象内的节点进行逐个遍历。</p><p><strong>注意</strong></p><ul><li>你想操作函数声明，就使用visitFunctionDelaration遍历，想操作赋值表达式，就使用visitExpressionStatement。 只要在 <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Parser_API#Node_objects" target="_blank" rel="noopener">AST对象文档</a>中定义的对象，在前面加visit，即可遍历。</li><li>通过node可以取到AST对象</li><li>每个遍历函数后必须加上return false，或者选择以下写法，否则报错：</li></ul><pre class=" language-javascript"><code class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node<span class="token keyword">const</span> recast  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'recast'</span><span class="token punctuation">)</span>recast<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> printSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>  recast<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>      visitExpressionStatement<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node        <span class="token function">printSource</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>调试时，如果你想输出AST对象，可以<code>console.log(node)</code></p><p>如果你想输出AST对象对应的源码，可以<code>printSource(node)</code></p><p>命令行输入<code>node read demo.js</code>进行测试。</p><blockquote><p><code>#!/usr/bin/env node</code> 在所有使用<code>recast.run()</code>的文件顶部都需要加入这一行，它的意义我们最后再讨论。</p></blockquote><h3 id="TNT-——-判断AST对象类型"><a href="#TNT-——-判断AST对象类型" class="headerlink" title="TNT —— 判断AST对象类型"></a>TNT —— 判断AST对象类型</h3><p>TNT，即recast.types.namedTypes，就像它的名字一样火爆，它用来判断AST对象是否为指定的类型。</p><p>TNT.Node.assert()，就像在机器里埋好的炸药，当机器不能完好运转时（类型不匹配），就炸毁机器(报错退出)</p><p>TNT.Node.check()，则可以判断类型是否一致，并输出False和True</p><p>上述Node可以替换成任意AST对象，例如TNT.ExpressionStatement.check(),TNT.FunctionDeclaration.assert()</p><p><strong>read.js</strong></p><pre class=" language-javascript"><code class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node<span class="token keyword">const</span> recast <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"recast"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> TNT <span class="token operator">=</span> recast<span class="token punctuation">.</span>types<span class="token punctuation">.</span>namedTypesrecast<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> printSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>  recast<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>      visitExpressionStatement<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>value        <span class="token comment" spellcheck="true">// 判断是否为ExpressionStatement，正确则输出一行字。</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>TNT<span class="token punctuation">.</span>ExpressionStatement<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是一个ExpressionStatement'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>read.js</strong></p><pre class=" language-javascript"><code class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node<span class="token keyword">const</span> recast <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"recast"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> TNT <span class="token operator">=</span> recast<span class="token punctuation">.</span>types<span class="token punctuation">.</span>namedTypesrecast<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> printSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>  recast<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>      visitExpressionStatement<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node        <span class="token comment" spellcheck="true">// 判断是否为ExpressionStatement，正确不输出，错误则全局报错</span>        TNT<span class="token punctuation">.</span>ExpressionStatement<span class="token punctuation">.</span><span class="token function">assert</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>命令行输入<code>node read demo.js</code>进行测试。</p><h3 id="实战：用AST修改源码，导出全部方法"><a href="#实战：用AST修改源码，导出全部方法" class="headerlink" title="实战：用AST修改源码，导出全部方法"></a>实战：用AST修改源码，导出全部方法</h3><p>exportific.js</p><p>现在，我们想让这个文件中的函数改写成能够全部导出的形式，例如</p><pre><code>function add (a, b) {    return a + b}</code></pre><p>想改变为</p><pre><code>exports.add = (a, b) =&gt; {  return a + b}</code></pre><p>除了使用fs.read读取文件、正则匹配替换文本、fs.write写入文件这种笨拙的方式外，我们可以<strong>用AST优雅地解决问题</strong>。</p><p>查询<a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Parser_API#Node_objects" target="_blank" rel="noopener">AST对象文档</a></p><h4 id="首先，我们先用builders凭空实现一个键头函数"><a href="#首先，我们先用builders凭空实现一个键头函数" class="headerlink" title="首先，我们先用builders凭空实现一个键头函数"></a>首先，我们先用builders凭空实现一个键头函数</h4><p><strong>exportific.js</strong></p><pre class=" language-javascript"><code class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node<span class="token keyword">const</span> recast <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"recast"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">{</span>  identifier<span class="token punctuation">:</span>id<span class="token punctuation">,</span>  expressionStatement<span class="token punctuation">,</span>  memberExpression<span class="token punctuation">,</span>  assignmentExpression<span class="token punctuation">,</span>  arrowFunctionExpression<span class="token punctuation">,</span>  blockStatement<span class="token punctuation">}</span> <span class="token operator">=</span> recast<span class="token punctuation">.</span>types<span class="token punctuation">.</span>buildersrecast<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> printSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 一个块级域 {}</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\n\nstep1:'</span><span class="token punctuation">)</span>  <span class="token function">printSource</span><span class="token punctuation">(</span><span class="token function">blockStatement</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// 一个键头函数 ()=>{}</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\n\nstep2:'</span><span class="token punctuation">)</span>  <span class="token function">printSource</span><span class="token punctuation">(</span><span class="token function">arrowFunctionExpression</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">blockStatement</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// add赋值为键头函数  add = ()=>{}</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\n\nstep3:'</span><span class="token punctuation">)</span>  <span class="token function">printSource</span><span class="token punctuation">(</span><span class="token function">assignmentExpression</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">,</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">arrowFunctionExpression</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">blockStatement</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// exports.add赋值为键头函数  exports.add = ()=>{}</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\n\nstep4:'</span><span class="token punctuation">)</span>  <span class="token function">printSource</span><span class="token punctuation">(</span><span class="token function">expressionStatement</span><span class="token punctuation">(</span><span class="token function">assignmentExpression</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">,</span><span class="token function">memberExpression</span><span class="token punctuation">(</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">'exports'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">arrowFunctionExpression</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">blockStatement</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>上面写了我们一步一步推断出<code>exports.add = ()=&gt;{}</code>的过程，从而得到具体的AST结构体。</p><p>使用<code>node exportific demo.js</code>运行可查看结果。</p><p>接下来，只需要在获得的最终的表达式中，把id(‘add’)替换成遍历得到的函数名，把参数替换成遍历得到的函数参数，把blockStatement([])替换为遍历得到的函数块级作用域，就成功地改写了所有函数！</p><p>另外，我们需要注意，在commonDivision函数内，引用了sub函数，应改写成exports.sub</p><p><strong>exportific.js</strong></p><pre class=" language-javascript"><code class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node<span class="token keyword">const</span> recast <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"recast"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">{</span>  identifier<span class="token punctuation">:</span> id<span class="token punctuation">,</span>  expressionStatement<span class="token punctuation">,</span>  memberExpression<span class="token punctuation">,</span>  assignmentExpression<span class="token punctuation">,</span>  arrowFunctionExpression<span class="token punctuation">}</span> <span class="token operator">=</span> recast<span class="token punctuation">.</span>types<span class="token punctuation">.</span>buildersrecast<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>ast<span class="token punctuation">,</span> printSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 用来保存遍历到的全部函数名</span>  <span class="token keyword">let</span> funcIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  recast<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 遍历所有的函数定义</span>    <span class="token function">visitFunctionDeclaration</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//获取遍历到的函数名、参数、块级域</span>      <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node      <span class="token keyword">const</span> funcName <span class="token operator">=</span> node<span class="token punctuation">.</span>id      <span class="token keyword">const</span> params <span class="token operator">=</span> node<span class="token punctuation">.</span>params      <span class="token keyword">const</span> body <span class="token operator">=</span> node<span class="token punctuation">.</span>body      <span class="token comment" spellcheck="true">// 保存函数名</span>      funcIds<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>funcName<span class="token punctuation">.</span>name<span class="token punctuation">)</span>      <span class="token comment" spellcheck="true">// 这是上一步推导出来的ast结构体</span>      <span class="token keyword">const</span> rep <span class="token operator">=</span> <span class="token function">expressionStatement</span><span class="token punctuation">(</span><span class="token function">assignmentExpression</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">,</span> <span class="token function">memberExpression</span><span class="token punctuation">(</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">'exports'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> funcName<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">arrowFunctionExpression</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment" spellcheck="true">// 将原来函数的ast结构体，替换成推导ast结构体</span>      path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>rep<span class="token punctuation">)</span>      <span class="token comment" spellcheck="true">// 停止遍历</span>      <span class="token keyword">return</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  recast<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 遍历所有的函数调用</span>    <span class="token function">visitCallExpression</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 如果函数调用出现在函数定义中，则修改ast结构</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>funcIds<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        node<span class="token punctuation">.</span>callee <span class="token operator">=</span> <span class="token function">memberExpression</span><span class="token punctuation">(</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">'exports'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> node<span class="token punctuation">.</span>callee<span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token comment" spellcheck="true">// 停止遍历</span>      <span class="token keyword">return</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// 打印修改后的ast源码</span>  <span class="token function">printSource</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="一步到位，发一个最简单的exportific前端工具"><a href="#一步到位，发一个最简单的exportific前端工具" class="headerlink" title="一步到位，发一个最简单的exportific前端工具"></a>一步到位，发一个最简单的exportific前端工具</h3><p>上面讲了那么多，仍然只体现在理论阶段。</p><p>但通过简单的改写，就能通过recast制作成一个名为exportific的源码编辑工具。</p><p>以下代码添加作了两个小改动</p><ol><li>添加说明书–help，以及添加了–rewrite模式，可以直接覆盖文件或默认为导出*.export.js文件。</li><li>将之前代码最后的 printSource(ast)替换成 writeASTFile(ast,filename,rewriteMode)</li></ol><p><strong>exportific.js</strong></p><pre class=" language-javascript"><code class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node<span class="token keyword">const</span> recast <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"recast"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">{</span>  identifier<span class="token punctuation">:</span> id<span class="token punctuation">,</span>  expressionStatement<span class="token punctuation">,</span>  memberExpression<span class="token punctuation">,</span>  assignmentExpression<span class="token punctuation">,</span>  arrowFunctionExpression<span class="token punctuation">}</span> <span class="token operator">=</span> recast<span class="token punctuation">.</span>types<span class="token punctuation">.</span>builders<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 截取参数</span><span class="token keyword">const</span> options <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//如果没有参数，或提供了-h 或--help选项，则打印帮助</span><span class="token keyword">if</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>length<span class="token operator">===</span><span class="token number">0</span> <span class="token operator">||</span> options<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'-h'</span><span class="token punctuation">)</span> <span class="token operator">||</span> options<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'--help'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`    采用commonjs规则，将.js文件内所有函数修改为导出形式。    选项： -r  或 --rewrite 可直接覆盖原有文件    `</span></span><span class="token punctuation">)</span>  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 只要有-r 或--rewrite参数，则rewriteMode为true</span><span class="token keyword">let</span> rewriteMode <span class="token operator">=</span> options<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'-r'</span><span class="token punctuation">)</span> <span class="token operator">||</span> options<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'--rewrite'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 获取文件名</span><span class="token keyword">const</span> clearFileArg <span class="token operator">=</span> options<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">'-r'</span><span class="token punctuation">,</span><span class="token string">'--rewrite'</span><span class="token punctuation">,</span><span class="token string">'-h'</span><span class="token punctuation">,</span><span class="token string">'--help'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 只处理一个文件</span><span class="token keyword">let</span> filename <span class="token operator">=</span> clearFileArg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">const</span> writeASTFile <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> rewriteMode<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> newCode <span class="token operator">=</span> recast<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">.</span>code  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rewriteMode<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 非覆盖模式下，将新文件写入*.export.js下</span>    filename <span class="token operator">=</span> filename<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'export'</span><span class="token punctuation">,</span><span class="token string">'js'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 将新代码写入文件</span>  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span>newCode<span class="token punctuation">)</span><span class="token punctuation">}</span>recast<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>ast<span class="token punctuation">,</span> printSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> funcIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  recast<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token function">visitFunctionDeclaration</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//获取遍历到的函数名、参数、块级域</span>      <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node      <span class="token keyword">const</span> funcName <span class="token operator">=</span> node<span class="token punctuation">.</span>id      <span class="token keyword">const</span> params <span class="token operator">=</span> node<span class="token punctuation">.</span>params      <span class="token keyword">const</span> body <span class="token operator">=</span> node<span class="token punctuation">.</span>body      funcIds<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>funcName<span class="token punctuation">.</span>name<span class="token punctuation">)</span>      <span class="token keyword">const</span> rep <span class="token operator">=</span> <span class="token function">expressionStatement</span><span class="token punctuation">(</span><span class="token function">assignmentExpression</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">,</span> <span class="token function">memberExpression</span><span class="token punctuation">(</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">'exports'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> funcName<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">arrowFunctionExpression</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>rep<span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  recast<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token function">visitCallExpression</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">const</span> node <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>funcIds<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        node<span class="token punctuation">.</span>callee <span class="token operator">=</span> <span class="token function">memberExpression</span><span class="token punctuation">(</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">'exports'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> node<span class="token punctuation">.</span>callee<span class="token punctuation">)</span>      <span class="token punctuation">}</span>      <span class="token keyword">return</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token function">writeASTFile</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span>filename<span class="token punctuation">,</span>rewriteMode<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>现在尝试一下</p><pre><code>node exportific demo.js</code></pre><p>已经可以在当前目录下找到源码变更后的<code>demo.export.js</code>文件了。</p><h3 id="npm发包"><a href="#npm发包" class="headerlink" title="npm发包"></a>npm发包</h3><p>编辑一下package.json文件</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"exportific"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"改写源码中的函数为可exports.XXX形式"</span><span class="token punctuation">,</span>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"exportific.js"</span><span class="token punctuation">,</span>  <span class="token property">"bin"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"exportific"</span><span class="token operator">:</span> <span class="token string">"./exportific.js"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"wanthering"</span><span class="token punctuation">,</span>  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"recast"</span><span class="token operator">:</span> <span class="token string">"^0.15.3"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>注意bin选项，它的意思是将全局命令<code>exportific</code>指向当前目录下的<code>exportific.js</code></p><p>这时，输入<code>npm link</code> 就在本地生成了一个<code>exportific</code>命令。</p><p>之后，只要哪个js文件想导出来使用，就<code>exportific XXX.js</code>一下。</p><p>这是在本地的玩法，想和大家一起分享这个前端小工具，只需要发布npm包就行了。</p><p>同时，一定要注意exportific.js文件头有</p><pre><code>#!/usr/bin/env node</code></pre><p>否则在使用时将报错。</p><h4 id="接下来，正式发布npm包！"><a href="#接下来，正式发布npm包！" class="headerlink" title="接下来，正式发布npm包！"></a>接下来，正式发布npm包！</h4><p>如果你已经有了npm 帐号，请使用<code>npm login</code>登录</p><p>如果你还没有npm帐号 <a href="https://www.npmjs.com/signup" target="_blank" rel="noopener">https://www.npmjs.com/signup</a> 非常简单就可以注册npm</p><p>然后，输入<br><code>npm publish</code></p><p>没有任何繁琐步骤，丝毫审核都没有，你就发布了一个实用的前端小工具exportific 。任何人都可以通过</p><pre><code>npm i exportific -g</code></pre><p>全局安装这一个插件。</p><p>提示：==在试验教程时，请不要和我的包重名，修改一下发包名称。==</p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>我们对javascript再熟悉不过，但透过AST的视角，最普通的js语句，却焕发出精心动魄的美感。你可以通过它批量构建任何javascript代码！</p><p>童年时，这个世界充满了新奇的玩具，再普通的东西在你眼中都如同至宝。如今，计算机语言就是你手中的大玩具，一段段AST对象的拆分组装，构建出我们所生活的网络世界。</p><p>所以不得不说软件工程师是一个幸福的工作，你心中住的仍然是那个午后的少年，永远有无数新奇等你发现，永远有无数梦想等你构建。</p><p>github地址：<a href="https://github.com/wanthering/exportific" target="_blank" rel="noopener">https://github.com/wanthering…</a></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200528171950" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> webpack </tag>
            
            <tag> AST </tag>
            
            <tag> JavaScript </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>proxyTable</title>
      <link href="/2020/05/28/proxytable/"/>
      <url>/2020/05/28/proxytable/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于<a href="https://www.jianshu.com/p/a2e3147c2af2" target="_blank" rel="noopener">https://www.jianshu.com/p/a2e3147c2af2</a></p></blockquote><p>我们在使用 <code>vue-cli</code> 工具生成 <code>vue</code> 项目时</p><pre class=" language-kotlin"><code class="language-kotlin">vue <span class="token keyword">init</span> webpack my<span class="token operator">-</span>project<span class="token operator">-</span>vue</code></pre><p>在生成的项目结构里,会有一个 <code>index.js</code> 文件.</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200528142725.png" alt=""></p><p>在这个 <code>index.js</code> 文件里,会有一个 <code>proxyTable</code> 的空节点.</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200528142736" alt=""></p><p>理解这个节点的作用需要有两个前置知识</p><ul><li>前端跨域</li><li>利用代理服务器进行跨域.</li></ul><p>关于这个问题,我在上一篇[<a href="https://www.jianshu.com/p/3079a07dd37b" target="_blank" rel="noopener">CORS &amp; JSONP 学习笔记一</a>]文章中已经有了大致的说明.</p><p>如果忘记了,可以回头去看看复习一下.</p><hr><h3 id="proxyTable"><a href="#proxyTable" class="headerlink" title="proxyTable"></a>proxyTable</h3><p><code>proxyTable</code> 是 <code>vue-cli</code> 脚手架在开发模式下,为我们提供的一个跨域的代理中转服务器服务.基于 (<code>http-proxy-middleware</code>插件).</p><p>为什么要有 <code>proxyTable</code>?</p><p>有时候在开发期间,我们请求的后台<code>接口(a.b.c/data.json)</code>不和<code>vue(localhost:8080)</code>在同一个域名,后台也并未提供<code>cors</code>跨域服务.</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200528142751" alt="img"></p><p>正常情况下,我们无法通过<code>ajax</code>向后台请求到数据.因为跨域了.浏览器的同源策略,截获了这次数据的返回,没有给vue.</p><p>解决办法有两个:</p><ul><li>服务器开启 <code>cors</code> (最简单,也是最方便的)</li><li>用代理服务器中转一下(vue请求的还是自己的后台,让后台去请求真是数据的后台,然后再将数据返回给vue)</li></ul><hr><h3 id="访问一个不支持跨域的后台服务数据接口"><a href="#访问一个不支持跨域的后台服务数据接口" class="headerlink" title="访问一个不支持跨域的后台服务数据接口"></a>访问一个不支持跨域的后台服务数据接口</h3><p>这里,用node.js写一个非常简单http服务..端口号是54321.</p><p>这个服务就是返回一个<code>json</code>数据.</p><p><strong>但并没有开启跨域功能.</strong></p><pre class=" language-tsx"><code class="language-tsx">const http = require('http')const fs = require('fs')http.createServer((request, response) => {   console.log(request.url)   // 对于所有请求,都返回这个json数据.  fs.readFile('./json.data.json', 'utf-8', (err, data) => {     response.end(data)  })}).listen(54321, () => {   console.log(`server is running at 54321`)})</code></pre><p>测试一下:</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200528142801" alt=""></p><p>然后使用 <code>vue-cli</code> 创建一个 <code>vue</code> 项目</p><p>并在 <code>App.vue</code> 里键入以下代码</p><pre class=" language-jsx"><code class="language-jsx"><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:54321/json.data.json'</span><span class="token punctuation">)</span>          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>users <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>todoList            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span>todoList<span class="token punctuation">)</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span>          <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  </code></pre><p>不出意外,肯定会提示跨域了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200528183538" alt=""></p><p>假设现在这个后台是别人写的,或者是一个压根你就不认识的人或公司写的.你无法让他们去后台追加 <code>cors</code> 来进行跨域支持.</p><p>那就只剩下另外一个办法了.</p><p><strong>配置 <code>proxyTable</code></strong></p><h3 id="配置-proxyTable-来进行跨域"><a href="#配置-proxyTable-来进行跨域" class="headerlink" title="配置 proxyTable 来进行跨域"></a>配置 proxyTable 来进行跨域</h3><p><code>proxyTable</code> 跨域的基本原理是:</p><blockquote><p>在开发模式下,<code>webpack</code> 会为我们提供一个<code>http</code>代理服务器.<br> 我们请求接口的时候,实际上是请求的<code>webpack</code>提供的这个<code>http</code>代理服务器.<br> 在由这个代理服务器请求真是的数据服务器.<br> 最后数据经由<code>webpack</code>代理服务器,最后转交给我们的<code>vue</code>程序.</p></blockquote><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200528142811" alt=""></p><p>为什么加个代理服务器就可以了?</p><p><strong>因为代理服务器不是浏览器,它没有同源策略的限制.</strong></p><p>在了解到了基本原理之后,就可以看看 <code>proxyTable</code> 这个节点的一些配置属性了.</p><pre class=" language-csharp"><code class="language-csharp">proxyTable<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 这里配置 '/api' 就等价于 target , 你在链接里访问 /api === http://localhost:54321</span>      <span class="token string">'/api'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>        target<span class="token punctuation">:</span> <span class="token string">'http://localhost:54321/'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 真是服务器的接口地址 // http://localhost:54321/json.data.json,</span>        secure<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 如果是 https ,需要开启这个选项</span>        changeOrigin<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 是否是跨域请求?肯定是啊,不跨域就没有必要配置这个proxyTable了.</span>        pathRewirte<span class="token punctuation">:</span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// 这里是追加链接,比如真是接口里包含了 /api,就需要这样配置.</span>          <span class="token string">'/^api'</span><span class="token punctuation">:</span> <span class="token string">'api/'</span><span class="token punctuation">,</span>           <span class="token comment" spellcheck="true">// 等价于 </span>          <span class="token comment" spellcheck="true">// step 1  /api = http://localhost:54321/</span>          <span class="token comment" spellcheck="true">// step 2 /^api = /api + api == http://localhost:54321/api</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>     <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>关于 <code>pathRewrite</code> 节点说明:</p><blockquote><p>首先，在ProxyTable模块中设置了‘/api’，target中设置服务器地址，也就是接口的开头那段地址，例如<code>http://localhost:54321/</code>，然后我们在调用接口的时候，就可以全局使用<code>/api</code>，这时候<code>/api</code>的作用就相当于<code>http://localhost:54321/</code>，比如接口的地址是<code>http://localhost:54321/api/json.data</code>，我们就可以使用<code>/api/json.data</code></p></blockquote><blockquote><p>那<code>pathRewrite</code>是用来干嘛的呢，这里的作用，相当于是替代<code>/api</code>，如果接口中是没有<code>api</code>的，那就直接置空，如果接口中有<code>api</code>，那就得写成{<code>^/api</code>:<code>/api</code>}，可以理解为一个重定向或者重新赋值的功能。</p></blockquote><p>总结:</p><ul><li><code>proxyTable</code> 就是<code>webpack</code>在开发环境给我们提供的一个代理服务器,(使用的是 http-proxy-middleware)</li><li>目的是为了在服务器不方便开启跨域功能的时候,我们也能方便的在开发阶段发送ajax跨域请求.</li><li>当了真实发布环境,这个玩意就不起作用了.除非自己配置一个代理服务器,或者让后台开启 <code>cors</code></li></ul><p>[<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgitee.com%2FcodeResp%2Fvue-proxyTable.git" target="_blank" rel="noopener">码云code</a>]</p><blockquote><p>作者：人话博客<br>链接：<a href="https://www.jianshu.com/p/a2e3147c2af2" target="_blank" rel="noopener">https://www.jianshu.com/p/a2e3147c2af2</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> webpack </tag>
            
            <tag> 转载 </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue的computed与watch的理解</title>
      <link href="/2020/05/27/vue-de-computed-yu-watch-de-li-jie/"/>
      <url>/2020/05/27/vue-de-computed-yu-watch-de-li-jie/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于<a href="https://www.cnblogs.com/wasbg/p/11416477.html" target="_blank" rel="noopener">https://www.cnblogs.com/wasbg/p/11416477.html</a></p></blockquote><h2 id="对vue中的computed属性，watch监听，计算属性理解"><a href="#对vue中的computed属性，watch监听，计算属性理解" class="headerlink" title="对vue中的computed属性，watch监听，计算属性理解"></a>对vue中的computed属性，watch监听，计算属性理解</h2><p>自己的理解：</p><ul><li>computed用来监控自己定义的变量，该变量不在data里面声明，直接在computed里面定义，然后就可以在页面上进行双向数据绑定展示出结果或者用作其他处理；</li><li>computed比较适合对多个变量或者对象进行处理后返回一个结果值，也就是数多个变量中的某一个值发生了变化则我们监控的这个值也就会发生变化，举例：购物车里面的商品列表和总金额之间的关系，只要商品列表里面的商品数量发生变化，或减少或增多或删除商品，总金额都应该发生变化。这里的这个总金额使用computed属性来进行计算是最好的选择</li></ul><p>与watch之间的区别：</p><p>　　刚开始总是傻傻分不清到底在什么时候使用watch，什么时候使用computed。这里大致说一下自己的理解：</p><ul><li>watch主要用于监控vue实例的变化，它监控的变量当然必须在data里面声明才可以，它可以监控一个变量，也可以是一个对象，但是我们不能类似这样监控，比如：</li></ul><pre class=" language-js"><code class="language-js">watch<span class="token punctuation">:</span><span class="token punctuation">{</span>  goodsList<span class="token punctuation">.</span><span class="token function">price</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> Val<span class="token punctuation">)</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newval<span class="token punctuation">,</span> val<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>这样会报错。只能监控整个对象或单个变量，如下所示：</p><pre class=" language-vue"><code class="language-vue">data(){　　return {　　　　example0:"",　　　　example1:"",　　　　example2:{ 　　　  inner0:1, 　　　　　　　　　        innner1:2 　　　　　　　　　      }　　}},watch:{　example0(newVal,oldVal){           ……   },}</code></pre><ul><li>watch一般用于监控路由、input输入框的值特殊处理等等，它比较适合的场景是一个数据影响多个数据　</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 我们当要监听一个对象数据变化的时候我们就用到computed，如下所示</span>commuted<span class="token punctuation">:</span><span class="token punctuation">{</span>  custom <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>example2<span class="token punctuation">.</span>inner0  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>  custom <span class="token punctuation">(</span>newval<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newval<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 第二种方法 监听对象的某个属性</span><span class="token string">'example2.inner0'</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>newval<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newval<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>以下内容是摘自<a href="https://www.w3cplus.com/vue/vue-computed-intro.html" target="_blank" rel="noopener">https://www.w3cplus.com/vue/vue-computed-intro.html</a> © w3cplus.com：</p><p><strong>计算属性</strong>可用于快速计算视图（<strong>View</strong>）中显示的属性。这些计算将被缓存，并且只在需要时更新。</p><p>在Vue中有多种方法为视图设置值：</p><ul><li>使用指令直接将数据值绑定到视图</li><li>使用简单的表达式对内容进行简单的转换</li><li>使用过滤器对内容进行简单的转换</li></ul><p>除此之外，我们还可以使用计算属性根据数据模型中的值或一组值来计算显示值。</p><h2 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h2><p>计算属性允许我们对指定的视图，复杂的值计算。这些值将绑定到依赖项值，只在需要时更新。</p><p>例如，我们可以在数据模型中有一个results数组：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200527172117.png" alt=""></p><p>假设我们想要查看所有主题的总数。我们不能使用filters或expressions来完成这个任务。</p><ul><li>filters：用于简单的数据格式，在应用程序的多个位置都需要它</li><li>expressions：不允许使用流操作或其他复杂的逻辑。他们应该保持简单</li></ul><p>这个时候，计算属性就可以派上用场。我们可以向模型中添加一个计算值，如下：</p><p><img src="https://images2018.cnblogs.com/blog/756683/201803/756683-20180302141805420-374118123.png" alt=""></p><p>效果如下：</p><p><img src="https://images2018.cnblogs.com/blog/756683/201803/756683-20180302141929655-867871426.png" alt=""></p><p><strong>计算属性 vs 方法</strong></p><p>我们可以使用Vue中的method计算出学科的总分，最终得到的总数结果是相同的。</p><p>在上例的基础上，我们把computed区块中的<code>totalMarks</code>函数整体移到<code>methods</code>中。同时在模板中将 <code></code>替换成<code></code>。 你最终看到的结果是一样的，如下所示：</p><p><img src="https://images2018.cnblogs.com/blog/756683/201803/756683-20180302142229964-730914120.png" alt="img"></p><p>虽然这两种方式输出的结果是相同的，但是性能将遭受毁灭性的打击。使用这种方法<code>totalMarks()</code>方法在每次页面渲染时都被执行一次（例如，使用每一个change）。</p><p>如果我们有一个计算属性，那么Vue会记住计算的属性所依赖的值（在我们这个示例中，那就是results）。通过这样做，Vue只有在依赖变化时才可以计算值。否则，将返回以前缓存的值。这也意味着<strong>只要results还没有发生改变，多次访问<code>totalMark</code>计算属性会立即返回之前的计算结果，而不必再次执行函数。</strong></p><p>上面两个示例也说明，在Vue中<strong>计算属性是基于它们的依赖进行缓存的，而方法是不会基于它们的依赖进行缓存的。从而使用计算属性要比方法性能更好。</strong></p><p>这也同样意味着下面的计算属性将不再更新，因为Date.now()不是响应式依赖：</p><p><img src="https://images2018.cnblogs.com/blog/756683/201803/756683-20180302142445599-432706336.png" alt="img"></p><p>相比之下，每当触发重新渲染时，方法的调用方式将总是再次执行函数。因此，函数必须是一个纯函数。它不能有副作用。输出只能依赖于传递给函数的值。</p><p>那么我们为什么需要缓存？假设我们有一个性能开销比较大的的计算属性A，它需要遍历一个极大的数组和做大量的计算。然后我们可能有其他的计算属性依赖于 A 。如果没有缓存，我们将不可避免的多次执行 A 的 getter！如果你不希望有缓存，请用方法来替代。</p><p><strong>计算属性的setter</strong></p><p>计算属性默认只有getter，不过在需要时你也可以提供一个setter</p><p><img src="https://images2018.cnblogs.com/blog/756683/201803/756683-20180302142839908-779400171.png" alt="img"></p><p>效果如下：</p><p><img src="https://images2018.cnblogs.com/blog/756683/201803/756683-20180302142858469-1873818746.png" alt="img"></p><p>你在输入框中输入一个fullName，然后点击set按钮，可以看到对应的效果。你现在再运行app.fullName=”Airen liao”时，计算属性的setter会被调用，app.firstName和app.lastName也相应地会被更新。如下图所示：</p><p><img src="https://images2018.cnblogs.com/blog/756683/201803/756683-20180302143042946-1650123244.gif" alt="img"></p><p><strong>观察者：</strong></p><p>虽然计算属性在大多数情况下更合适，但有时候也需要一个自定义的watcher。这是为什么Vue通过watch选项提供一个更通用的方法，来响应数据的变化。当你想要在数据变化响应时，执行异步操作或开销较大的操作，这是很有用的。</p><p>Vue确实提供了一种更通用的方式来观察和响应Vue实例上的数据变动：watch属性。当你有一些数据需要随着其它数据变动而变动时，你很容易滥用watch。然而，通常更好的想法是使用计算属性而不是命令式的watch回调。比如下面的示例：</p><p><img src="https://images2018.cnblogs.com/blog/756683/201803/756683-20180302143246492-509225082.png" alt="img"></p><p>上面代码是命令式的和重复的。将它与计算属性的版本进行比较：</p><p><img src="https://images2018.cnblogs.com/blog/756683/201803/756683-20180302143312343-1120005319.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue跨域</title>
      <link href="/2020/05/27/vue-kua-yu/"/>
      <url>/2020/05/27/vue-kua-yu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于<a href="https://www.cnblogs.com/wasbg/p/10973880.html" target="_blank" rel="noopener">https://www.cnblogs.com/wasbg/p/10973880.html</a></p></blockquote><h2 id="什么是跨域"><a href="#什么是跨域" class="headerlink" title="什么是跨域"></a>什么是跨域</h2><p>  跨域指浏览器不允许当前页面的所在的源去请求另一个源的数据。源指协议，端口，域名。只要这个3个中有一个不同就是跨域。 这里列举一个经典的列子：</p><pre class=" language-javascript"><code class="language-javascript">#协议跨域http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>a<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com访问https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>a<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com；#端口跨域http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>a<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token punctuation">:</span><span class="token number">8080</span>访问http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>a<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token punctuation">:</span><span class="token number">80</span>；#域名跨域http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>a<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com访问http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>b<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com；</code></pre><p>  现在很多公司都是采用前后分离的方式开发。那么出现经常和会跨域打交道。我这里整理日常开发中解决跨域的几种方案。我们前端使用的Vue，后端使用的NodeJs。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="proxyTable"><a href="#proxyTable" class="headerlink" title="proxyTable"></a>proxyTable</h3><p>  在vue脚手架的2.*版本中，这里vue脚手架生成的标准项目为准。一般在项目config目录下面有个index文件。里面格式如下：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    dev<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// Paths</span>        assetsSubDirectory<span class="token punctuation">:</span> <span class="token string">'static'</span><span class="token punctuation">,</span>        assetsPublicPath<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>        proxyTable<span class="token punctuation">:</span> <span class="token punctuation">{</span>            <span class="token string">'/api'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>                target<span class="token punctuation">:</span> <span class="token string">'http://localhost:7001'</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//后端接口地址</span>                changeOrigin<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//是否允许跨越</span>                pathRewrite<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    <span class="token string">'^/api'</span><span class="token punctuation">:</span> <span class="token string">'/api'</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//重写,</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        host<span class="token punctuation">:</span> <span class="token string">'192.168.0.104'</span><span class="token punctuation">,</span>        port<span class="token punctuation">:</span> <span class="token number">8081</span><span class="token punctuation">,</span>        autoOpenBrowser<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        errorOverlay<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        notifyOnErrors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        poll<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        useEslint<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        showEslintErrorsInOverlay<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        devtool<span class="token punctuation">:</span> <span class="token string">'eval-source-map'</span><span class="token punctuation">,</span>        cacheBusting<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        cssSourceMap<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span></code></pre><p>  上面配置中，我们根据实际情况只需要修改proxyTable对于配置即可。假设我后端请求地址是<a href="http://localhost:7001" target="_blank" rel="noopener">http://localhost:7001</a> ，所有api的接口url都以/api开头。所以首先需要匹配所有以/api开头的.然后修改target的地址为<a href="http://localhost:7001" target="_blank" rel="noopener">http://localhost:7001</a> 。最后修改pathRewrite地址。将前缀 ‘^api’ 转为 ‘/api’。如果本身的接口地址就有 ‘/api’ 这种通用前缀，就可以把 pathRewrite 删掉。注意这个方式只能在开发环境中使用。</p><h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><p>  CORS即跨源资源共享，它定义了一种浏览器和服务器交互的方式来确定是否允许跨域请求。它是一个妥协，有更大的灵活性，但比起简单地允许所有这些的要求来说更加安全。但是CORS也具有一定的风险性，比如请求中只能说明来自于一个特定的域但不能验证是否可信，而且也容易被第三方入侵。 这里一般需要后端配合,开启CORS。一般各种语言都有类似的包。比如Node.JS的<a href="https://www.npmjs.com/package/koa2-cors" target="_blank" rel="noopener">koa2-cors</a>，Django的<a href="https://github.com/adamchainz/django-cors-headers" target="_blank" rel="noopener">CORSheaders</a></p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//npm install --save koa2-cors</span><span class="token keyword">var</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa2-cors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//开启</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这个方式解决的跨越问题支持开发和生产环境。但是有一定的安全性问题。</p><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><p>  当我们明白跨越的含义之后。只要解决了’源’的问题。那么跨越也就不存在了。这里我们便会想到proxy，同时也会想到Nginx。<br><img src="http://img.shepherd618.cn/vue_po.png" alt="enter image description here"><br>我们只需要在部署静态资源配置下面加上红框里面的配置就可以了。同时这个方法支持开发环境和生产环境。</p><h3 id="后端程序代理"><a href="#后端程序代理" class="headerlink" title="后端程序代理"></a>后端程序代理</h3><p>  当然上面2个方法都需要后端的配合和需要修改服务器配置。所有还有一种方法不需要他们配合 ，我们自己就可以做到。就是我们自己启一个后端程序做代理。然后把所有的请求转发到服务器。这里要用到node的一个包<a href="https://www.npmjs.com/package/http-proxy-middleware" target="_blank" rel="noopener">http-proxy-middleware</a>。关键代码(express)如下<br><img src="http://img.shepherd618.cn/nodo_py.png" alt="enter image description here"></p><p>  </p><p>用Vue-cli脚手架搭建了个demo,前后分离就有跨域问题的出现。</p><p>vue-clie搭建demo步骤（传送门）：<a href="https://www.cnblogs.com/wangenbo/p/8487764.html" target="_blank" rel="noopener">https://www.cnblogs.com/wangenbo/p/8487764.html</a></p><p>我自己在网上找了2个接口做测试：</p><p>CSDN：<a href="https://www.csdn.net/api/articles?type=more&amp;category=home&amp;shown_offset=1524276761019196&amp;first_view=false" target="_blank" rel="noopener">https://www.csdn.net/api/articles?type=more&amp;category=home&amp;shown_offset=1524276761019196&amp;first_view=false</a></p><p>掘金：<a href="https://suggest-follow-api-ms.juejin.im/v1/getByTag?tag=%E5%89%8D%E7%AB%AF&amp;src=web&amp;t=1" target="_blank" rel="noopener">https://suggest-follow-api-ms.juejin.im/v1/getByTag?tag=%E5%89%8D%E7%AB%AF&amp;src=web&amp;t=1</a></p><p>安装模块axios进行ajax请求，直接请求，肯定显示跨域，无法请求。</p><p> ===============  以下为npm run dev 跨域的解决方法  ===============</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707144338.png" alt=""></p><p>脚手架Vue-cli已经帮我们留好了接口</p><p>参考这篇文章才知道：<a href="https://blog.csdn.net/qq_31201781/article/details/78778193" target="_blank" rel="noopener">https://blog.csdn.net/qq_31201781/article/details/78778193</a></p><p>在config目录下的index.js文件，有个参数：</p><p>proxyTable:{}</p><p>所以，我把参数添加成：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707144346.png" alt=""></p><p>原来接口：</p><p>CSDN：<a href="https://www.csdn.net/api/articles?type=more&amp;category=home&amp;shown_offset=1524276761019196&amp;first_view=false" target="_blank" rel="noopener">https://www.csdn.net/api/articles?type=more&amp;category=home&amp;shown_offset=1524276761019196&amp;first_view=false</a></p><p>掘金：<a href="https://suggest-follow-api-ms.juejin.im/v1/getByTag?tag=%E5%89%8D%E7%AB%AF&amp;src=web&amp;t=1" target="_blank" rel="noopener">https://suggest-follow-api-ms.juejin.im/v1/getByTag?tag=%E5%89%8D%E7%AB%AF&amp;src=web&amp;t=1</a></p><p>请求链接就变成这样了：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707144353.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707144359.png" alt=""></p><p>最后，把数据打印出来，就可以了。。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707144406.png" alt=""></p><p>===============  以上为npm run dev 跨域的解决方法  ===============</p><p>===============  以下为npm run build 跨域的解决方法  ===============</p><p>我们要打包上线：就用npm run build会打包成dist文件</p><p>但发到线上，就得用nginx解决跨域。</p><p>首先，下载nginx</p><p><a href="https://blog.csdn.net/biaoge0310/article/details/78900538" target="_blank" rel="noopener">https://blog.csdn.net/biaoge0310/article/details/78900538</a></p><p>入门命令：</p><p>　 在ngix文件目录下执行以下命令</p><p>　　start nginx　　开启ngix</p><p>　　nginx -s quit　 退出　</p><p>　　nginx -s reload 重启</p><p>​    nginx -t 检查配置文件是否成功 </p><p>然后：进入nginx/conf目录下的，找到nginx.conf文件</p><p>添加如下配置：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200707144412.png" alt=""></p><p>启动ngix服务器： start nginx</p><p>输入网址：<a href="http://localhost:8099" target="_blank" rel="noopener">http://localhost:8099</a></p><p>完美！！！！打包后也解决了。。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue生命周期详解</title>
      <link href="/2020/05/27/vue-sheng-ming-zhou-qi-xiang-jie/"/>
      <url>/2020/05/27/vue-sheng-ming-zhou-qi-xiang-jie/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文章大部分引用于<a href="https://www.cnblogs.com/chenyablog/p/9095677.html" target="_blank" rel="noopener">https://www.cnblogs.com/chenyablog/p/9095677.html</a></p></blockquote><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200527165603.png"/><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200527165715.png"/><p><strong>注意：</strong></p><ol><li><strong>created阶段的ajax请求与mounted请求的区别：前者页面视图未出现，如果请求信息过多，页面会长时间处于白屏状态</strong></li><li><strong>mounted 不会承诺所有的子组件也都一起被挂载。如果你希望等到整个视图都渲染</strong></li></ol><p><strong>父子组件的生命周期：</strong></p><p><strong>子组件的所有生命周期都会在父组件的beforemounted之前加载完毕</strong></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue中的history和hash区别</title>
      <link href="/2020/05/27/vue-zhong-de-history-he-hash-qu-bie/"/>
      <url>/2020/05/27/vue-zhong-de-history-he-hash-qu-bie/</url>
      
        <content type="html"><![CDATA[<h2 id="hash和history的区别"><a href="#hash和history的区别" class="headerlink" title="hash和history的区别"></a>hash和history的区别</h2><ol><li><code>hash</code>的话在地址栏会有一个<code>#</code>的符号。特点在于即便<code>hash</code>出现在<code>URL</code>中，但是不会包括在<code>http</code>请求中，对于后端没有影响，改变了<code>hash</code>也不会重新加载页面</li><li><code>history</code>其实就是字面意思的可以记录历史页面，利用了 <code>HTML5 History Interface</code> 中新增的 <code>pushState()</code> 和 <code>replaceState()</code> 方法。(需要特定浏览器支持）这两个方法应用于浏览器的历史记录栈，在当前已有的 <code>back、forward、go</code> 的基础之上，它们提供了对历史记录进行修改的功能。只是当它们执行修改时，虽然改变了当前的 <code>URL</code>，但浏览器不会立即向后端发送请求。</li></ol><p><code>hash</code> 模式和 <code>history</code> 模式都属于浏览器自身的特性，<code>Vue-Router</code> 只是利用了这两个特性（通过调用浏览器提供的接口）来实现前端路由</p><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>一般情景下，<code>hash</code>和<code>histoury</code>都可以，除非你更在意颜值，<code>#</code>符号夹杂在<code>URL</code>里看起来确实有些不太美丽。如果不想要很丑的<code>hash</code>，我们可以用路由的<code>history</code>模式，这种模式充分利用<code>history</code>。<code>pushState API</code>来完成<code>URL</code>跳转而无须重新加载页面。</p><p>调用<code>history.pushState()</code>相比于直接修改<code>hash</code> ，存在以下优势：<br>1：<code>pushState()</code>设置的新<code>URL</code>可以是与当前<code>URL</code>同源的任意<code>URL</code>；而<code>hash</code>只可修改#后面的部分，因此只能设置与当前<code>URL</code>同文档的URL；<br>2：<code>pushState()</code>设置的新<code>URL</code>可以与当前<code>URL</code>一模一样，这样也会把记录添加到栈中；而<code>hash</code>设置的新值必须与原来不一样才会触发动作将记录添加到栈中；<br>3：<code>pushState()</code>通过<code>stateObject</code>参数可以添加任意类型的数据到记录中；而<code>hash</code>只可添加短字符串；<br>4：<code>pushState()</code>可额外设置<code>title</code>属性供后续使用。</p><p>当然<code>history</code>也不是样样都好。<code>SPA</code>虽然在浏览器里游刃有余，单真要通过<code>URL</code>向后端发起<code>HTTP</code>请求时，两者的差异就来了。尤其在用户手动输入<code>URL</code>后回车，或者刷新（重启）浏览器的时候。<br>1：<code>hash</code> 模式下，仅<code>hash</code>符号之前的内容会被包含在请求中，如<a href="http://www.abc.com" target="_blank" rel="noopener">http://www.abc.com</a> ，因此对于后端来说，即使没有做到对路由的全覆盖，也不会返回404错误。<br>2：<code>history</code>模式下，前端的<code>URL</code>必须和实际向后端发起请求的<code>URL</code>一致。如<a href="http://www.abc.com/book/id" target="_blank" rel="noopener">http://www.abc.com/book/id</a> ，如果后端缺少对/book/id 的路由处理，将返回404错误。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue的父子传值</title>
      <link href="/2020/05/26/vue-de-fu-zi-chuan-zhi/"/>
      <url>/2020/05/26/vue-de-fu-zi-chuan-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="父子组件的通信"><a href="#父子组件的通信" class="headerlink" title="父子组件的通信"></a>父子组件的通信</h2><p>在开发中，都是在一个大的组件中请求完数据，然后子组件再使用v-for去遍历数据的值。因为如果每个组件的数据都要去向后台发送请求数据的话，那么对服务器的压力是很大的。</p><p>如果是父组件向子组件传递数据，那么只需要通过<code>props</code>的方式去传递数据。如果是子组件向父组件传递数据的话，那么就需要使用到发送事件<code>($emit Events)</code></p><h3 id="父组件传递值到子组件"><a href="#父组件传递值到子组件" class="headerlink" title="父组件传递值到子组件"></a>父组件传递值到子组件</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token attr-name">:cmovie</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>movie<span class="token punctuation">"</span></span> <span class="token attr-name">:cmessage</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cpn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{cmovie}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{cmessage}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token keyword">const</span> cpn<span class="token operator">=</span><span class="token punctuation">{</span>      template<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`#cpn`</span></span><span class="token punctuation">,</span>      props<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'cmovie'</span><span class="token punctuation">,</span><span class="token string">'cmessage'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>      data<span class="token punctuation">:</span><span class="token punctuation">{</span>          message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>          movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      components<span class="token punctuation">:</span><span class="token punctuation">{</span>        cpn      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h4 id="props可以有类型限制"><a href="#props可以有类型限制" class="headerlink" title="props可以有类型限制"></a>props可以有类型限制</h4><p>props不仅仅可以使用数组的方式的写法，还可以使用对象的方式</p><p>比如：</p><pre class=" language-html"><code class="language-html"> <span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token attr-name">:cmovie</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>movie<span class="token punctuation">"</span></span> <span class="token attr-name">:cmessage</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cpn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{cmovie}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{cmessage}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token keyword">const</span> cpn<span class="token operator">=</span><span class="token punctuation">{</span>      template<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`#cpn`</span></span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">// props:['cmovie','cmessage'],//这里一定不能使用驼峰式命名</span>      props<span class="token punctuation">:</span><span class="token punctuation">{</span>        cmovie<span class="token punctuation">:</span> Array<span class="token punctuation">,</span>        cmessage<span class="token punctuation">:</span> String      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>      data<span class="token punctuation">:</span><span class="token punctuation">{</span>          message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>          movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      components<span class="token punctuation">:</span><span class="token punctuation">{</span>        cpn      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>比如如上代码，cmovie就只能为Array，cmessage就只能是String方法</p><p>props支持的类型限制有：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191220180150.png" style="zoom:67%;" /><h4 id="props设置默认值"><a href="#props设置默认值" class="headerlink" title="props设置默认值"></a>props设置默认值</h4><p>props除了可以设置类型限制之外还可以设置默认值</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--    &lt;cpn :cmovie="movie" :cmessage="message">&lt;/cpn>    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cpn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{cmovie}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{cmessage}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token keyword">const</span> cpn<span class="token operator">=</span><span class="token punctuation">{</span>      template<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`#cpn`</span></span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">// props:['cmovie','cmessage'],//这里一定不能使用驼峰式命名</span>      props<span class="token punctuation">:</span><span class="token punctuation">{</span>        cmovie<span class="token punctuation">:</span> <span class="token punctuation">{</span>          type<span class="token punctuation">:</span>Array<span class="token punctuation">,</span>          <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">//这个数组的话最好是要用一个返回值去写，因为在vue的2.5.17的时候如果不使用返回值就会报错</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        cmessage<span class="token punctuation">:</span> <span class="token punctuation">{</span>          type<span class="token punctuation">:</span>String<span class="token punctuation">,</span>          <span class="token keyword">default</span><span class="token punctuation">:</span><span class="token string">'hello world'</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>      data<span class="token punctuation">:</span><span class="token punctuation">{</span>          message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>          movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      components<span class="token punctuation">:</span><span class="token punctuation">{</span>        cpn      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>这里的返回值必须是一个函数，因为类型是<strong>对象或者是数组</strong>的时候，默认值必须是一个函数，也就是必须如下的写法</p><pre class=" language-js"><code class="language-js"><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>如果不使用函数式的写法的话就会报错，如下代码所示：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--    &lt;cpn :cmovie="movie" :cmessage="message">&lt;/cpn>    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cpn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{cmovie}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{cmessage}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> cpn<span class="token operator">=</span><span class="token punctuation">{</span>    template<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`#cpn`</span></span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// props:['cmovie','cmessage'],//这里一定不能使用驼峰式命名</span>    props<span class="token punctuation">:</span><span class="token punctuation">{</span>      cmovie<span class="token punctuation">:</span> <span class="token punctuation">{</span>        type<span class="token punctuation">:</span>Array<span class="token punctuation">,</span>        <span class="token keyword">default</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">//这里修改了个错误的写法</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      cmessage<span class="token punctuation">:</span> <span class="token punctuation">{</span>        type<span class="token punctuation">:</span>String<span class="token punctuation">,</span>        <span class="token keyword">default</span><span class="token punctuation">:</span><span class="token string">'hello world'</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span><span class="token punctuation">{</span>      message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>      movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span><span class="token punctuation">{</span>      cpn    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191220183449.png" style="zoom:67%;" /><h4 id="props的其他写法"><a href="#props的其他写法" class="headerlink" title="props的其他写法"></a>props的其他写法</h4><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191220183813.png" style="zoom:67%;" /><p>甚至还可以使用自定义对象去创建</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221102053.png" style="zoom:67%;" /><h4 id="props的驼峰标识"><a href="#props的驼峰标识" class="headerlink" title="props的驼峰标识"></a>props的驼峰标识</h4><p>props不能随便使用驼峰标识，因为这个可能会有点会报错，原因如下：</p><p>如下代码是正常的写法：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token attr-name">:cinfo</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{cinfo}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> cpn<span class="token operator">=</span><span class="token punctuation">{</span>    template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>    props<span class="token punctuation">:</span><span class="token punctuation">{</span>      cinfo<span class="token punctuation">:</span><span class="token punctuation">{</span>        type<span class="token punctuation">:</span>Object<span class="token punctuation">,</span>        <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token punctuation">{</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span><span class="token punctuation">{</span>      message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>      info<span class="token punctuation">:</span><span class="token punctuation">{</span>        name<span class="token punctuation">:</span><span class="token string">'LY'</span><span class="token punctuation">,</span>        age<span class="token punctuation">:</span><span class="token number">21</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span><span class="token punctuation">{</span>      cpn    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>如果使用驼峰标识的话会不能正常显示，代码如下：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token attr-name">:cInfo</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{cInfo}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> cpn<span class="token operator">=</span><span class="token punctuation">{</span>    template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>    props<span class="token punctuation">:</span><span class="token punctuation">{</span>      cInfo<span class="token punctuation">:</span><span class="token punctuation">{</span>        type<span class="token punctuation">:</span>Object<span class="token punctuation">,</span>        <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token punctuation">{</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span><span class="token punctuation">{</span>      message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>      info<span class="token punctuation">:</span><span class="token punctuation">{</span>        name<span class="token punctuation">:</span><span class="token string">'LY'</span><span class="token punctuation">,</span>        age<span class="token punctuation">:</span><span class="token number">21</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span><span class="token punctuation">{</span>      cpn    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200526211356.png" alt=""></p><p>这个是因为<code>v-bind</code>是不支持驼峰的，至少是到我写这篇博客的<code>Vue</code>正式发布版本都还没支持，如果要<code>v-bind</code>要使用驼峰的标识的话要对驼峰的部分用<code>-</code>分开，比如如下代码：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token attr-name">:c-info</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{cInfo}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> cpn<span class="token operator">=</span><span class="token punctuation">{</span>    template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>    props<span class="token punctuation">:</span><span class="token punctuation">{</span>      cInfo<span class="token punctuation">:</span><span class="token punctuation">{</span>        type<span class="token punctuation">:</span>Object<span class="token punctuation">,</span>        <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token punctuation">{</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span><span class="token punctuation">{</span>      message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>      info<span class="token punctuation">:</span><span class="token punctuation">{</span>        name<span class="token punctuation">:</span><span class="token string">'LY'</span><span class="token punctuation">,</span>        age<span class="token punctuation">:</span><span class="token number">21</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span><span class="token punctuation">{</span>      cpn    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>如下代码就不会报警告和能正常显示</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221105231.png" style="zoom: 50%;" /><p>如下代码也是同理：(<code>childMyMessage</code>可以拆分为<code>child-My-Message</code>)</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token attr-name">:c-Info</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token attr-name">:child-My-Message</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>message<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{cInfo}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{childMyMessage}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> cpn<span class="token operator">=</span><span class="token punctuation">{</span>    template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>    props<span class="token punctuation">:</span><span class="token punctuation">{</span>      cInfo<span class="token punctuation">:</span><span class="token punctuation">{</span>        type<span class="token punctuation">:</span>Object<span class="token punctuation">,</span>        <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      childMyMessage<span class="token punctuation">:</span><span class="token punctuation">{</span>        type<span class="token punctuation">:</span>String<span class="token punctuation">,</span>        <span class="token keyword">default</span><span class="token punctuation">:</span><span class="token string">''</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span><span class="token punctuation">{</span>      message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>      info<span class="token punctuation">:</span><span class="token punctuation">{</span>        name<span class="token punctuation">:</span><span class="token string">'LY'</span><span class="token punctuation">,</span>        age<span class="token punctuation">:</span><span class="token number">21</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span><span class="token punctuation">{</span>      cpn    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="子组件传递数据到父组件"><a href="#子组件传递数据到父组件" class="headerlink" title="子组件传递数据到父组件"></a>子组件传递数据到父组件</h3><h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><p>子组件传递父组件是需要自定义事件来去传递的</p><p>子组件向父组件传递数据一般是用在类似京东的移动端网页</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221113225.png" style="zoom:67%;" /><p>出现在子组件点击手机数码的时候，要向最大的那个父组件告诉他我点击了<code>catelogy=“手机数码”</code>，然后父组件返回这个数据给子组件显示。</p><h4 id="子组件自定义数据"><a href="#子组件自定义数据" class="headerlink" title="子组件自定义数据"></a>子组件自定义数据</h4><p>如下代码所示，先子组件渲染页面，先能在自己组件中打印出值</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--父组件模板--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--子组件模板--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in categories<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick(item)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token comment" spellcheck="true">// 1.子组件</span>  <span class="token keyword">const</span> cpn <span class="token operator">=</span> <span class="token punctuation">{</span>    template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`#cpn`</span></span><span class="token punctuation">,</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>          <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>          name<span class="token punctuation">:</span> <span class="token string">"热门推荐"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">{</span>            <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            name<span class="token punctuation">:</span> <span class="token string">"手机数码"</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">{</span>            <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>            name<span class="token punctuation">:</span> <span class="token string">"电脑办公"</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">btnclick</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 父组件</span>  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      message<span class="token punctuation">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>      movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>      cpn    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>然后要使用<code>$emit</code>发送一个事件给父组件，然后父组件就可以收到这个事件了</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--父组件模板--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--1. 是不可以直接使用父组件的movie的，要去通过props去间接调用 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token attr-name">@itemclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpnclick<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- &lt;cpn>&lt;/cpn> --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--子组件模板--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in categories<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick(item)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token comment" spellcheck="true">// 1.子组件</span>  <span class="token keyword">const</span> cpn <span class="token operator">=</span> <span class="token punctuation">{</span>    template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`#cpn`</span></span><span class="token punctuation">,</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>          <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>          name<span class="token punctuation">:</span> <span class="token string">"热门推荐"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">{</span>            <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            name<span class="token punctuation">:</span> <span class="token string">"手机数码"</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">{</span>            <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>            name<span class="token punctuation">:</span> <span class="token string">"电脑办公"</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">btnclick</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'itemclick'</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 父组件</span>  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      message<span class="token punctuation">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>      movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>      cpn    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token function">cpnclick</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'cpnclick触发'</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>注：这里事件不能使用驼峰标识，只有在脚手架里面可以使用，而在这个场景中是不可以使用驼峰标识的，因为在脚手架中在<code>template</code>等所有的组件对象都渲染成一个<code>render</code>函数，是可以正常解析的，但是在<code>html</code>文件里面引用的时候解析不了</p><p>子组件向父组件传递数据的流程如下：</p><ol><li>在子组件中，通过<code>$emit</code>来触发事件</li><li>在父组件中，通过<code>v-on</code>监听子组件的事件</li></ol><h2 id="父子组件之间的互相访问"><a href="#父子组件之间的互相访问" class="headerlink" title="父子组件之间的互相访问"></a>父子组件之间的互相访问</h2><h3 id="父组件访问子组件"><a href="#父组件访问子组件" class="headerlink" title="父组件访问子组件"></a>父组件访问子组件</h3><h4 id="children访问子组件的方法"><a href="#children访问子组件的方法" class="headerlink" title="$children访问子组件的方法"></a>$children访问子组件的方法</h4><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>button<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cpn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        我是子组件    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span><span class="token punctuation">{</span>      message<span class="token punctuation">:</span><span class="token string">'hello'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">showmessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span><span class="token punctuation">{</span>      cpn<span class="token punctuation">:</span><span class="token punctuation">{</span>        template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">return</span><span class="token punctuation">{</span>            name<span class="token punctuation">:</span><span class="token string">'我是子组件的name'</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        methods<span class="token punctuation">:</span><span class="token punctuation">{</span>          <span class="token function">showmessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'showmessage'</span><span class="token punctuation">)</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>然后就可以父组件就可以通过下标来获取子组件的方法了</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221145323.png" style="zoom:67%;" /><p>但是这个方式不经常用，因为如果中间插入了其他的组件的话，比如</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mycpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mycpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>button<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>那么下标的值也跟着改变，所以$children的方式是不经常用的，经常用的是下面的这个方法：</p><h4 id="refs"><a href="#refs" class="headerlink" title="$refs"></a>$refs</h4><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>aaa<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bbb<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ccc<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>button<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cpn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        我是子组件    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span><span class="token punctuation">{</span>      message<span class="token punctuation">:</span><span class="token string">'hello'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span><span class="token punctuation">{</span>      cpn<span class="token punctuation">:</span><span class="token punctuation">{</span>        template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">return</span><span class="token punctuation">{</span>            name<span class="token punctuation">:</span><span class="token string">'我是子组件的name'</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        methods<span class="token punctuation">:</span><span class="token punctuation">{</span>          <span class="token function">showmessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'showmessage'</span><span class="token punctuation">)</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>refs是每次都可以获取想要获取的值</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221150705.png" style="zoom:67%;" /><h3 id="子组件访问父组件"><a href="#子组件访问父组件" class="headerlink" title="子组件访问父组件"></a>子组件访问父组件</h3><p>这个子组件访问父组件用的是十分的少的，而且开发中也不建议这样去使用</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cpn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>我是cpn组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ccpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ccpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>ccpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>我是子组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>button<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span><span class="token punctuation">{</span>                        name<span class="token punctuation">:</span><span class="token string">'LY'</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                components<span class="token punctuation">:</span><span class="token punctuation">{</span>                    cpn<span class="token punctuation">:</span><span class="token punctuation">{</span>                        template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>                        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">return</span><span class="token punctuation">{</span>                                name<span class="token punctuation">:</span><span class="token string">"CCpn LY"</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span><span class="token punctuation">,</span>                        methods<span class="token punctuation">:</span><span class="token punctuation">{</span>                            <span class="token comment" spellcheck="true">// btnclick(){</span>                            <span class="token comment" spellcheck="true">//     //访问父组件 $parent</span>                            <span class="token comment" spellcheck="true">//     console.log(this.$parent)</span>                            <span class="token comment" spellcheck="true">// }</span>                        <span class="token punctuation">}</span><span class="token punctuation">,</span>                        components<span class="token punctuation">:</span><span class="token punctuation">{</span>                            ccpn<span class="token punctuation">:</span><span class="token punctuation">{</span>                                template<span class="token punctuation">:</span><span class="token string">'#ccpn'</span><span class="token punctuation">,</span>                                methods<span class="token punctuation">:</span><span class="token punctuation">{</span>                                    <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                        <span class="token comment" spellcheck="true">//访问父组件 $parent</span>                                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">)</span>                                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>name<span class="token punctuation">)</span>                                        <span class="token comment" spellcheck="true">//这个甚至可以直接访问root组件，也就是Vue实例</span>                                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>name<span class="token punctuation">)</span>                                    <span class="token punctuation">}</span>                                <span class="token punctuation">}</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>子访问父组件的<code>$parents</code>的方法十分的简单，但是也用得少，因为这样的耦合度太高</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Develoment和Production打包模式下的区别</title>
      <link href="/2020/05/24/develoment-he-production-da-bao-mo-shi-xia-de-qu-bie/"/>
      <url>/2020/05/24/develoment-he-production-da-bao-mo-shi-xia-de-qu-bie/</url>
      
        <content type="html"><![CDATA[<h2 id="两种模式下的区别"><a href="#两种模式下的区别" class="headerlink" title="两种模式下的区别"></a>两种模式下的区别</h2><h2 id="分离两个模式的配置文件"><a href="#分离两个模式的配置文件" class="headerlink" title="分离两个模式的配置文件"></a>分离两个模式的配置文件</h2><p>首先说明两种模式下的区别</p><p>在Develoment模式下，webpack可以启动dev-Server来启动一个服务器，服务器里面还集成了HMR的特性，并且在这个模式下source-map是非常的全的，可以快速定位到错误点</p><p>下面看看开发环境的配置</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200524143402.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200524143426.png" alt=""></p><p>除此之外还有一系列的配置</p><p>如果是要改成生产环境的话，那么又要把以上的配置删掉改过，这样就显得十分的麻烦</p><p>这个时候可以把开发环境的配置写到一个webpack.dev.js文件里面，然后把生产环境的写到webpack.prod.js里面</p><p>然后再在package.json里面配置两个环境不同的命令</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200524152258.png" alt=""></p><p>这个也就是vue cli之类的原理</p><h2 id="取出共同配置文件"><a href="#取出共同配置文件" class="headerlink" title="取出共同配置文件"></a>取出共同配置文件</h2><p>但是只是分离不够，因为生产环境和开发环境的webpack配置有大量的相同配置代码</p><p>这个时候可以新建一个<code>webpack.common.js</code>文件，把共同的配置项写在里面</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200524162309.png" alt=""></p><p>公共参数已经抽离出来了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200524162556.png" alt=""></p><p>但是这样还是不可以引入公共文件的</p><p>需要下载一个插件才行<code>cnpm install webpack-merge -D</code></p><p>然后再去生产环境和开发环境的配置上引入这个文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200524163848.png" alt=""></p><ul><li>需要引入merge的文件</li><li>需要引入公共配置文件</li><li>然后使用merge把两个结合起来</li></ul><p>有一些脚手架的版本会把这三个webpack的文件放到一个build文件夹下，所以只需要改一下package.json的配置即可</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpack之Tree Shaking</title>
      <link href="/2020/05/23/tree-shaking/"/>
      <url>/2020/05/23/tree-shaking/</url>
      
        <content type="html"><![CDATA[<h2 id="Tree-Shaking是什么"><a href="#Tree-Shaking是什么" class="headerlink" title="Tree Shaking是什么"></a>Tree Shaking是什么</h2><p>在打包的时候会出现如下字段</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200523193510.png" alt=""></p><p>这个的意思是在preset-env设置了<code>useBuiltIns</code>后，就已经达到了按需引入ES6语法的目的了，不用再去写<code>import &quot;@babel/polyfill&quot;;</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200523193859.png" alt=""></p><p>意思是可以把多余的<code>import &quot;@babel/polyfill&quot;;</code>代码去掉</p><p>这里先创建一个方法来演示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200523194619.png" alt="项目结构"></p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* math.js */</span><span class="token keyword">export</span> <span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">const</span> minus <span class="token operator">=</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* index.js */</span><span class="token keyword">import</span> <span class="token punctuation">{</span>add<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./math"</span><span class="token punctuation">;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span></code></pre><p>然后使用webpack进行打包<code>npx webpack</code></p><p>打包出来的结果会发现两个方法都有，虽然只引入了一个方法，但是会把math.js里面的所有代码都进行引入</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200523194821.png" alt=""></p><p>如果要实现按需引入的功能，在webpack2.0以后提供了tree Shaking的功能，可以中文理解为摇树的概念，意味着把没有用的东西都摇掉</p><h2 id="怎么用Tree-Shaking"><a href="#怎么用Tree-Shaking" class="headerlink" title="怎么用Tree Shaking"></a>怎么用Tree Shaking</h2><p><code>Tree Shaking</code>只支持<code>ES module</code>方式的引入</p><p>为什么呢,因为<code>ES module</code>引入的底层是通过静态文件的引入方式，<code>Commonjs</code>是通过动态引入的方式</p><p>现在配置的是<code>development</code>模式，默认是没有这个功能的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200523224829.png" alt=""></p><p>所以要添加一些配置</p><p>首先要在webpack配置中添加<code>usedExports</code>配置，如下图所示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200523225237.png" alt="webpack.config.js"></p><p>在大部分的情况下，这样做已经是足够了的，只配置webpack已经可以做到业务代码按需打包了</p><p>但是有一些特殊情况，比如前面文章的pollyfill，因为pollyfill没有导出任何的内容，内部为了实现补充低版本浏览器不支持promise、map等方法，是在内部去定义了windows.promise之类的变量。但是如果只是如上的配置，用了tree Shaking，会发现怎么没有导出任何的内容，可能就直接把pollyfill忽略掉了。所以为了防止这种情况的出现，要对其做一个特殊的处理</p><p>此时为了防止上述情况的出现，所以要把pollyfill的引入的babel单独写进去，具体如下图所示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200523230732.png" alt=""></p><p>sideEffects里面配置了<code>@babel/polly-fill</code>，那么在tree Shaking的时候就不会对他进行任何作用</p><p>如果不需要任何单独配置的话，那么就把sideEffects的值改为false</p><p>但是一般的话打包需要有个css文件，css文件是必须全部导入进去的</p><p>所以一般都是填上css</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200523231153.png" alt=""></p><p>再重新进行打包，可以看到这么一行解释</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200523231348.png" alt=""></p><p>英文的意思说只使用了add，也就是我只用的这个方法</p><p>但是实际上我没有用到的代码也还在，因为还是在<code>development</code>的模式下，即便是用了<code>tree Shaking</code>也不会把多余的文件去除掉，因为在开发的环境下需要做一些调试，如果直接删了就调试不了了</p><p>当然如果是在<code>production</code>的模式下，是会直接把代码删除掉的</p><p>并且在<code>production</code>模式下，连webpack配置文件的<code>optimization</code>都不用设置，但是<code>package.json</code>里面的<code>&quot;sideEffects&quot;: false,</code>还是要设置的</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>github的精准查询方式</title>
      <link href="/2020/05/23/github-de-jing-zhun-cha-xun-fang-shi/"/>
      <url>/2020/05/23/github-de-jing-zhun-cha-xun-fang-shi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://zhuanlan.zhihu.com/p/55294261" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/55294261</a></p><p>文章作者：<a href="https://www.zhihu.com/people/chainho" target="_blank" rel="noopener">chainho</a></p></blockquote><p>本文首发于微信公众号「<strong>Tomcat那些事儿</strong>」，关注阅读更多精彩内容。</p><p>GitHub的流行， GitHub在开源世界的受欢迎程度自不必多言。再加上今天，GitHub官方又搞了个大新闻：私有仓库也改为免费使用，这在原来可是需要真金白银的买的。可见微软收购后，依然没有改变 GitHub 的定位，甚至还更进一步。</p><p>花开两朵，各表一枝。我们今天想要聊的并不是 GitHub 多么重要，而是要说一下 GitHub 的搜索功能。</p><p>你在 GitHub上搜索代码时，是怎么样操作的呢？是不是也是像我这样，直接在搜索框里输入要检索的内容，然后不断在列表里翻页找自己需要的内容？</p><p><img src="https://pic4.zhimg.com/80/v2-78d6c2fb6bb895887d94dd1fe494262b_720w.jpg" alt="img"></p><p>或者是简单筛选下，在左侧加个语言的过滤项。</p><p><img src="https://pic1.zhimg.com/80/v2-3ede229851830d64aa91857df634e098_720w.jpg" alt="img"></p><p>再或者改变一下列表的排序方式</p><p><img src="https://pic3.zhimg.com/80/v2-bdcda3868e7bb9b5f86daedd218b6ffe_720w.jpg" alt="img"></p><p>这就是「<strong>全部</strong>」了吗？</p><p>一般的系统检索功能，都会有一个「<strong>高级搜索</strong>」的功能。需要在另外的界面里展开，进行二次搜索之类的。 GitHub 有没有类似的呢？</p><p>答案是「肯定的」。做为一个为万千工程师提供服务的网站，不仅要有，而且还要技术范儿。</p><p>如果我们自己开发一个类似的应用，会怎样实现呢？</p><p>带着思路，咱们一起来看看，GitHub 是怎样做的。</p><p>这里我们假设正要学习 Spring Cloud，要找一个 Spring Cloud 的 Demo 参考练手。</p><h2 id="1-明确搜索仓库标题、仓库描述、README"><a href="#1-明确搜索仓库标题、仓库描述、README" class="headerlink" title="1. 明确搜索仓库标题、仓库描述、README"></a><strong>1. 明确搜索仓库标题、仓库描述、README</strong></h2><p>GitHub 提供了便捷的搜索方式，可以限定只搜索仓库的标题、或者描述、README等。</p><p>以Spring Cloud 为例，一般一个仓库，大概是这样的</p><p><img src="https://pic2.zhimg.com/80/v2-53cb71653bc913ebd2530ba5cf2eba75_720w.jpg" alt="img"></p><p>其中，红色箭头指的两个地方，分别是仓库的<strong>名称</strong>和<strong>描述</strong>。咱们可以直接限定关键字只查特定的地方。比如咱们只想查找仓库名称包含 spring cloud 的仓库，可以使用语法</p><h3 id="in-name-关键词"><a href="#in-name-关键词" class="headerlink" title="in:name 关键词"></a><strong>in:name</strong> 关键词</h3><p><img src="https://pic2.zhimg.com/80/v2-1731a269c74bd3b10eb46d2721d28a15_720w.jpg" alt="img"></p><p>如果想查找描述的内容，可以使用这样的方式：</p><h3 id="in-descripton-关键词"><a href="#in-descripton-关键词" class="headerlink" title="in:descripton 关键词"></a><strong>in:descripton</strong> 关键词</h3><p><img src="https://pic3.zhimg.com/80/v2-ec371692fb389afbb8aaae768cea9b96_720w.jpg" alt="img"></p><p>这里就是搜索上面项目描述的内容。</p><p>一般项目，都会有个README文件，如果要查该文件包含特定关键词的话，我想你猜到了</p><h3 id="in-readme-关键词"><a href="#in-readme-关键词" class="headerlink" title="in:readme 关键词"></a><strong>in:readme</strong> 关键词</h3><h2 id="2-明确搜索-star、fork-数大于多少的"><a href="#2-明确搜索-star、fork-数大于多少的" class="headerlink" title="2. 明确搜索 star、fork 数大于多少的"></a><strong>2. 明确搜索 star、fork 数大于多少的</strong></h2><p>一个项目 star 数的多少，一般代表该项目有受欢迎程度。虽然现在也有垃圾项目刷 star ，但毕竟是少数， star 依然是个不错的衡量标准。</p><p>stars: <strong>&gt;</strong> 数字 关键字。</p><p>比如咱们要找 star 数大于 3000 的Spring Cloud 仓库，就可以这样</p><p>stars:&gt;3000 spring cloud</p><p><img src="https://pic4.zhimg.com/80/v2-5c1d941ba4ef5992121d7efb62c07d63_720w.jpg" alt="img"></p><p>如果不加 &gt;= 的话，是要精确找 star 数等于具体数字的，这个一般有点困难。</p><p>如果要找在指定数字区间的话，使用</p><p>stars: 10..20 关键词</p><p>fork 数同理，将上面的 stars 换成 fork，其它语法相同</p><p><img src="https://pic4.zhimg.com/80/v2-4d3132becfc40d1fd14aca5ad9d96ec3_720w.jpg" alt="img"></p><h2 id="3-明确搜索仓库大小的"><a href="#3-明确搜索仓库大小的" class="headerlink" title="3. 明确搜索仓库大小的"></a><strong>3. 明确搜索仓库大小的</strong></h2><p>比如你只想看个简单的 Demo，不想找特别复杂的且占用磁盘空间较多的，可以在搜索的时候直接限定仓库的 size 。</p><p>使用方式：</p><p>size:&gt;=5000 关键词</p><p>这里注意下，这个数字代表K, 5000代表着5M。</p><h2 id="4-明确仓库是否还在更新维护"><a href="#4-明确仓库是否还在更新维护" class="headerlink" title="4. 明确仓库是否还在更新维护"></a><strong>4. 明确仓库是否还在更新维护</strong></h2><p>我们在确认是否要使用一些开源产品，框架的时候，是否继续维护是很重要的一点。如果已经过时没人维护的东西，踩了坑就不好办了。而在 GitHub 上找项目的时候，不再需要每个都点到项目里看看最近 push 的时间，直接在搜索框即可完成。</p><p>元旦刚过，比如咱们要找临近年底依然在勤快更新的项目，就可以直接指定<strong>更新时间</strong>在哪个时间前或后的</p><p>通过这样一条搜索 pushed:&gt;2019-01-03 spring cloud</p><p>咱们就找到了1月3号之后，还在更新的项目。</p><p><img src="https://pic1.zhimg.com/80/v2-9d05132110b0f06d97a6a438c074b218_720w.jpg" alt="img"></p><p>你是想找指定时间之前或之后创建的仓库也是可以的，把 pushed 改成 <strong>created</strong> 就行。</p><h2 id="5-明确搜索仓库的-LICENSE"><a href="#5-明确搜索仓库的-LICENSE" class="headerlink" title="5. 明确搜索仓库的 LICENSE"></a><strong>5. 明确搜索仓库的 LICENSE</strong></h2><p>咱们经常使用开源软件，一定都知道，开源软件也是分不同的「门派」不同的LICENSE。开源不等于一切免费，不同的许可证要求也大不相同。 2018年就出现了 Facebook 修改 React 的许可协议导致各个公司纷纷修改自己的代码，寻找替换的框架。</p><p>例如咱们要找协议是最为宽松的 Apache License 2 的代码，可以这样</p><p>license:apache-2.0 spring cloud</p><p><img src="https://pic1.zhimg.com/80/v2-385ae6364bf1046234f1f550420b71c8_720w.jpg" alt="img"></p><p>其它协议就把apache-2.0替换一下即可，比如换成 <strong>mit</strong> 之类的。</p><h2 id="6-明确搜索仓库的语言"><a href="#6-明确搜索仓库的语言" class="headerlink" title="6. 明确搜索仓库的语言"></a><strong>6. 明确搜索仓库的语言</strong></h2><p>比如咱们就找 Java 的库， 除了像上面在左侧点击选择之外，还可以在搜索中过滤。像这样：</p><p><strong>language</strong>:java 关键词</p><h2 id="7-明确搜索某个人或组织的仓库"><a href="#7-明确搜索某个人或组织的仓库" class="headerlink" title="7.明确搜索某个人或组织的仓库"></a><strong>7.明确搜索某个人或组织的仓库</strong></h2><p>比如咱们想在 GitHub 上找一下某个大神是不是提交了新的功能，就可以指定其名称后搜索，例如咱们看下 Josh Long 有没有提交新的 Spring Cloud 的代码，可以这样使用</p><h3 id="user-joshlong"><a href="#user-joshlong" class="headerlink" title="user:joshlong"></a><strong>user</strong>:joshlong</h3><p><img src="https://pic1.zhimg.com/80/v2-547ce22dd1d37b21bc02302170994d78_720w.jpg" alt="img"></p><p>组合使用一下，把 Java 项目过滤出来，多个查询之间「空格」分隔即可。</p><h3 id="user-joshlong-language-java"><a href="#user-joshlong-language-java" class="headerlink" title="user:joshlong language:java"></a><strong>user:joshlong language:java</strong></h3><p><img src="https://pic2.zhimg.com/80/v2-a29f78d6de93a9aabafc468bc1f66c09_720w.jpg" alt="img"></p><p>找某个组织的代码话，可以这样：</p><h3 id="org-spring-cloud-就可以列出具体org-的仓库。"><a href="#org-spring-cloud-就可以列出具体org-的仓库。" class="headerlink" title="org:spring-cloud 就可以列出具体org 的仓库。"></a><strong>org</strong>:spring-cloud 就可以列出具体org 的仓库。</h3><p><img src="https://pic4.zhimg.com/80/v2-cb36d3e09428e276d3ba0767f95e4baf_720w.jpg" alt="img"></p><p>这个搜索使用起来是不是相当的便捷? 比起直接搜一个关键词不停的翻页点开找效率高多了吧。 有帮助的话别忘了点个「<strong>赞</strong>」支持我。</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 实用技巧 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Babel处理ES6</title>
      <link href="/2020/05/22/babel-chu-li-es6/"/>
      <url>/2020/05/22/babel-chu-li-es6/</url>
      
        <content type="html"><![CDATA[<h2 id="Babel处理ES6"><a href="#Babel处理ES6" class="headerlink" title="Babel处理ES6"></a>Babel处理ES6</h2><p>这里只在index.js里面使用ES6语法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522171116.png" alt="index.js"></p><p>那么打包出来的文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522171023.png" alt=""></p><p>会原封不动的把ES6语法的代码放上去</p><p>在使用新版本的浏览器，比如谷歌浏览器之类的，是可以成功打印出来结果的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522171101.png" alt=""></p><p>因为新版本的浏览器与时俱进的兼容了ES6的语法</p><p>但如果是IE浏览器，或者是其他一些版本比较老的浏览器，可能就是直接报错，因为他们不支持ES6的代码</p><p>如果可以把ES6代码，转换成所有浏览器可识别的ES5</p><p>可在官网文档上找到详细的说明</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522182051.png" alt="babeljs官网"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522182201.png" alt="官网webpack说明文档"></p><p>按照官网的配置即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522182749.png" alt=""></p><p>这一行的意思是如果js的代码在node_modules里面，那就不转换，因为里面的都是第三方的代码，并且第三方的代码早就做好了转换，没必要再去做一遍</p><p>配置好之后再重新打包，可看见代码全都被打包成ES5了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522204012.png" alt=""></p><h2 id="presets的额外配置"><a href="#presets的额外配置" class="headerlink" title="presets的额外配置"></a>presets的额外配置</h2><h3 id="useBuiltIns"><a href="#useBuiltIns" class="headerlink" title="useBuiltIns"></a>useBuiltIns</h3><p>上面这样远远不够，因为map、promise等函数在老版本的浏览器还是不存在的，要对低版本的浏览器把map、promise之类的方法做一个补充，使之可以识别</p><p>要使用到polyfill做一次补充</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522204325.png" alt=""></p><p>然后再index.js所有程序之前引入polyfil</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522204715.png" alt=""></p><p>根据文档配置好之后</p><p>可以看到打包的文件大小增加了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522204811.png" alt="不用polyfill"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522204822.png" alt="用polyfill"></p><p>这多的都是promise、map之类老版本不兼容的浏览器的语法，这个是所有的语法都在里面了</p><p>这个包其实很多都是程序中用不上的，我只用到了promise和map，我也只想要这两个语法的就行</p><p>实现这个目的也很简单，只需在webpack添加一个函数</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522205237.png" alt=""></p><p>如上图所示，把presets里面进行修改即可</p><p>这样就可以根据程序中用到的语法再进行打包即可</p><p>这个时候程序的大小就少了很多了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522205404.png" alt=""></p><h3 id="targets"><a href="#targets" class="headerlink" title="targets"></a>targets</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522210545.png" alt=""></p><p>这个代码的意思就是可以打包在浏览器的什么版本之下</p><p>如果chorm浏览器在67的版本之上本来就对ES6的兼容性很好了，这个时候就没必要再去把polyfill的额外的东西打包进去了</p><h3 id="类库的打包"><a href="#类库的打包" class="headerlink" title="类库的打包"></a>类库的打包</h3><p>如上所示的配置可以应用在大部分情况下</p><p>但是有一些比如UI框架、组件库之类的，如果继续使用如上的方法就会污染全局变量，这个时候要用到的是<code>plugin-transform-runtime</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522211629.png" alt=""></p><p><code>plugin-transform-runtime</code>可以很好的帮助解决<code>polyfill</code>污染全局变量的问题，因为他用的是闭包或者间接的帮助组件去引入内容，不存在全局污染的概念，所以写类库的时候用这个方法无疑是一个更好的方案</p><p>照常按照文档来来写即可，但是要注意里面的corejs必须配置为2，要把false改为2</p><pre><code>      {        &quot;absoluteRuntime&quot;: false,        &quot;corejs&quot;: 2,        &quot;helpers&quot;: true,        &quot;regenerator&quot;: true,        &quot;useESModules&quot;: false,        &quot;version&quot;: &quot;7.0.0-beta.0&quot;      }</code></pre><h3 id="babel单独配置文件"><a href="#babel单独配置文件" class="headerlink" title="babel单独配置文件"></a>babel单独配置文件</h3><p>如上代码，如果全部参数都配置上去的话，options里面的代码就变得特别的多，特别的长</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522212346.png" alt=""></p><p>这个时候可以把这些配置文件单出来</p><p>并且创建一个名为<code>.babelrc</code>的文件</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* `.babelrc` */</span><span class="token punctuation">{</span>    presets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        useBuiltIns<span class="token punctuation">:</span> <span class="token string">"usage"</span><span class="token punctuation">,</span>        targets<span class="token punctuation">:</span> <span class="token punctuation">{</span>            chrome<span class="token punctuation">:</span> <span class="token string">"67"</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><p>然后再把原来的options删除掉</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522213046.png" alt=""></p><p>这样再打包结果还是一样，执行不会有任何的问题</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpack之热更新与HMR</title>
      <link href="/2020/05/22/webpack-zhi-re-geng-xin-yu-hmr/"/>
      <url>/2020/05/22/webpack-zhi-re-geng-xin-yu-hmr/</url>
      
        <content type="html"><![CDATA[<h2 id="热更新"><a href="#热更新" class="headerlink" title="热更新"></a>热更新</h2><p>以上的演示都是需要每次修改都要重新打包，然后再点开html来运行</p><p>实现这个目的，有三种方法</p><h3 id="方法1：修改package-json"><a href="#方法1：修改package-json" class="headerlink" title="方法1：修改package.json"></a>方法1：修改package.json</h3><p>之前写的scripts的bundle都是webpack命令，这里可以修改成为实时观看，只需要在webpack里面添加一个watch参数</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521181713.png" alt=""></p><p>这个意思是监听打包文件的变化，如果变化就重新打包</p><h3 id="方法2：-webpack-dev-server"><a href="#方法2：-webpack-dev-server" class="headerlink" title="方法2： webpack-dev-server"></a>方法2： webpack-dev-server</h3><p>我还是嫌方法1不够好，我还要watch可以自动打包，自动打开浏览器，还可以模拟服务器上的特性，可以借助webpack devS erver来实现</p><p>webpack默认没是有这个东西的，要额外的下载</p><p><code>cnpm install webpack-dev-server -D</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521182336.png" alt="webpack.config.js"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521182406.png" alt="package.json"></p><p>可以看到npm run start启动后，会帮我们启动一个端口</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521182536.png" alt=""></p><p>而且打包文件的改变，并不用F5刷新，可以实时的改变</p><p>此外还可以设置自动打开浏览器</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521182814.png" alt=""></p><p>vue和react的脚手架都是使用了webpack-dev-Server</p><p>为什么脚手架可以设置跨域呢</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521183208.png" alt=""></p><p><code>webpack</code>可以设置<code>proxy</code>来跨域，只要访问了<code>localhost:8000/api</code>，就可以转发到3000端口</p><p>方法2是用的人最多一个方法</p><p>webpack-dev-server打包不会生成dist文件，而是打包存储在内存里面了</p><h3 id="方法3：自己创建服务器"><a href="#方法3：自己创建服务器" class="headerlink" title="方法3：自己创建服务器"></a>方法3：自己创建服务器</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521184126.png" alt=""></p><p>这个也就是自己创建一个服务器，早起webpack-dev-Server不稳定而且功能比较少的时候，脚手架开发者都是自己写一个服务器来实现实时更新的功能的</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* server.js */</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token keyword">const</span> WebpackDevMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-middleware'</span><span class="token punctuation">)</span><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config'</span><span class="token punctuation">)</span><span class="token keyword">const</span> complier <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">WebpackDevMiddleware</span><span class="token punctuation">(</span>complier<span class="token punctuation">,</span><span class="token punctuation">{</span>    publicPath<span class="token punctuation">:</span>config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>publicPath<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server is running'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>方法3耗费的精力十分的大，这个方法不建议</p><h2 id="Hot-Module-Replacement"><a href="#Hot-Module-Replacement" class="headerlink" title="Hot Module Replacement"></a>Hot Module Replacement</h2><h3 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a>案例1</h3><p>编写配置文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522103835.png" alt="index.js"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522103848.png" alt="style.css"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522103912.png" alt="package.json"></p><p>依照如上的配置，使用<code>npm run start</code>命令启动</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522104251.png" alt="结果"></p><p>代码的结果是点击新增按钮，偶数的背景为黄色</p><p>此时我修改一下背景颜色</p><p>原来新增的item就消失了，虽然点击颜色已经发生了改变</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522104615.png" alt=""></p><p>但是原来新增的item却不在了</p><p>此时希望的是改变样式的时候，只改变颜色，而不把页面刷新</p><p>这里就可以借助于HMR的功能来实现这个效果</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522104944.png" alt=""></p><p>hot的作用是启动HMR</p><p>hotOnly的作用是如果HMR出了问题，webpack会刷新页面，这里因为不需要重新刷新页面，所以就是写为true即可</p><p>配置完成后，就可以改变样式不刷新页面了</p><h3 id="案例2"><a href="#案例2" class="headerlink" title="案例2"></a>案例2</h3><p>案例的代码如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522154319.png" alt="打包代码文件结构"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522154308.png" alt="counter.js"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522154400.png" alt="index.js"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522154412.png" alt="number.js"></p><p>进行<code>npm run start</code>后</p><p>一开始就是这样的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522154929.png" alt=""></p><p>但是我修改<code>number.js</code>的<code>innerHTML</code>为2000</p><p>在HMR模式关闭的情况下，每次修改1000的值，页面都会进行一次刷新。</p><p>如果是开启的情况下，修改1000的值是不会实时刷新的，要手动F5刷新</p><p>如果是要实时刷新要额外写一些代码</p><p>在HMR模式开启的情况下编写如下新增的代码</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522162041.png" alt="index.js"></p><p>此时如果修改了innerHTML的值，会出现如下的情况</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522162234.png" alt=""></p><p>每一次修改都会新增一个节点</p><p>这里还要把之前的节点删除掉</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522162418.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522162358.png" alt=""></p><p>这里跟案例1的css文件类比，为什么css文件不需要这么一长串代码来监听HMR是否开启就可以不刷新执行</p><p>因为这么一长串代码在css loader里面已经编写好了，vue之类的也一样的，vue也可可以实时刷新，但是我们在使用脚手架的时候也没看到有这么一长串代码，因为vue loader已经编写好了</p><p>HMR的功能都是官网有详细说明的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522163221.png" alt=""></p><p>在官网中底层原理也有详细的文档说明</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200522163304.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpack之Loader与plugins基础</title>
      <link href="/2020/05/20/webpack-zhi-loader-yu-plugins-ji-chu/"/>
      <url>/2020/05/20/webpack-zhi-loader-yu-plugins-ji-chu/</url>
      
        <content type="html"><![CDATA[<h2 id="Loader的引入"><a href="#Loader的引入" class="headerlink" title="Loader的引入"></a>Loader的引入</h2><p>webpack不只是可以转义浏览器不能识别的js代码，还可以打包图片等文件</p><p>如果直接引入图片的文件是会报错的，如下所示</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./test01'</span><span class="token punctuation">)</span><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./test.png'</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521103656.png" alt=""></p><p>webpack能识别js是因为默认是有转义js的规则，而图片没有，所以这里需要一个loader，也就是规则去告诉webpack怎么去做</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    mode<span class="token punctuation">:</span> <span class="token string">"development"</span><span class="token punctuation">,</span>    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>        main<span class="token punctuation">:</span><span class="token string">'./src/index.js'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>        rules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>            test<span class="token punctuation">:</span> <span class="token regex">/\.jpg$/</span><span class="token punctuation">,</span>            use<span class="token punctuation">:</span> <span class="token punctuation">{</span>loader<span class="token punctuation">:</span> <span class="token string">"file-loader"</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>        filename<span class="token punctuation">:</span> <span class="token string">"bundle.js"</span><span class="token punctuation">,</span>        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521104944.png" alt="image-20200521104944044"></p><p>图中的test是正则匹配字符串，use是指定使用什么loader，这个file-loader是没有指定的</p><p>所以要用npm去下载<code>cnpm install file-loader -D</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521104859.png" alt=""></p><p>如图打包成功</p><p>打包出来会打包出两个文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521105038.png" alt=""></p><p>而这个png就是我刚刚的图片</p><p>具体的说明文档是官网介绍的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521105327.png" alt=""></p><p>由此可知，loader其实可以说是一种打包方案</p><p>这个可以同比于vue</p><pre><code>import Header from &#39;./header.vue&#39;</code></pre><p>这个方法肯定是不识别的，所以肯定是需要用到特定的lodaer去执行</p><p> <img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521110127.png" alt="vue官方文档"></p><h2 id="Loader之图片篇"><a href="#Loader之图片篇" class="headerlink" title="Loader之图片篇"></a>Loader之图片篇</h2><p>在上面的实验中可以看到图片的名字变为了一长串的字符串，然而图片还是那个图片</p><p>如果不想变动图片的名字怎么办，这里可以在配置中进行修改</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521110639.png" alt=""></p><p>这个意思就是打包后的名字，前缀还是跟以前一样，后缀也是跟以前一样</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521110723.png" alt=""></p><p>这个其实是叫<code>placeholders</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521110837.png" alt=""></p><p>如果是想把图片等资源都放在一个image的目录下，那么就可以用到<code>outputPath</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521111041.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521111118.png" alt=""></p><p>打包出来的目录如下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521111130.png" alt=""></p><p> 再打开index.html文件其实还是可以运行的，无论路径是否改变</p><p>因为打包图片会进行三步</p><p>第一步会把图片打包移动到指定的文件夹</p><p>第二步是修改文件名</p><p>第三步是把文件相对于dist的路径返回给打包前的js文件的变量</p><p>打包图片使用的是file-loader，与之相类似的还有个叫做url-loader，url-loader可以执行file-loader的方法，而且还可以额外执行一些事情</p><p>先下载url-loader，<code>cnpm install url-loader -D</code>，然后修改文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521111724.png" alt=""></p><p>然后把原来所有的打包文件都删除，再执行一次打包</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521111829.png" alt=""></p><p>会发现原来的images没有了</p><p> 但是运行html文件还是可以照常的显示图片</p><p>这里看一下源码可以发现</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521112001.png" alt=""></p><p>再看下浏览器的图片地址</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521112036.png" alt=""></p><p>可以看到这个图片并不是地址，而是一个base64的内容</p><p>这样好处是可以省去一次http来请求图片</p><p>但是如果这个图片特别的大，加载js的时间就会变得很长</p><p>最佳的方案其实是如果图片小，那么就以base64的形式去存储，如果图片大就存储图片的路径，如需要实现这个功能的话，只需要在options里面再配置一个参数即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521112529.png" alt=""></p><p>这里我把2048修改成38KB，因为我的图片就是这么大</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521112621.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521112610.png" alt=""></p><p>html文件打开可以正常显示图片</p><p>如果我把limit改成204800</p><p>把limit设置成很大，就意味着要大于204800才能存储图片，否则是存储成base64的形式</p><p>url-loader对比于file-loader可以实现更多的功能</p><h2 id="Loader之样式篇"><a href="#Loader之样式篇" class="headerlink" title="Loader之样式篇"></a>Loader之样式篇</h2><h3 id="css篇"><a href="#css篇" class="headerlink" title="css篇"></a>css篇</h3><p> 这里如果要对图片的大小样式进行修改</p><pre class=" language-css"><code class="language-css"><span class="token comment" spellcheck="true">/* index.css */</span><span class="token selector"><span class="token class">.avatar</span></span><span class="token punctuation">{</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">150</span>px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">150</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* index.js */</span><span class="token keyword">import</span> avatar <span class="token keyword">from</span> <span class="token string">'./test.png'</span><span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>img<span class="token punctuation">.</span>src <span class="token operator">=</span> avatarimg<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'avatar'</span><span class="token punctuation">)</span><span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>root<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span></code></pre><p>这样直接打包的话肯定是不能识别css的，因为还要使用loader，官网文档如下图所示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521113819.png" alt=""></p><p>依照官网文档进行修改</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521114026.png" alt=""></p><p>再进行重新打包可以看到样式生效</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521114011.png" alt=""></p><p>css-loader的作用是把所有的css文件之间，如果是有关联的话，比如<code>@import &#39;./avatar.css&#39;</code>,就全部结合并为一个css文件</p><p>style-loader是在css-loader得到内容后，再把内容件挂载在页面上</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521114529.png" alt=""></p><h3 id="less、scss篇"><a href="#less、scss篇" class="headerlink" title="less、scss篇"></a>less、scss篇</h3><p>把原来的css文件删除修改成为less文件</p><pre class=" language-less"><code class="language-less"><span class="token comment" spellcheck="true">/* index.less */</span><span class="token selector">body</span><span class="token punctuation">{</span>  <span class="token selector">.avatar</span><span class="token punctuation">{</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">150</span>px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">150</span>px<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>再把webpack匹配的表达式进行修改成scss</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521115230.png" alt=""></p><p>再进行打包发现是可以的，但是运行出来的结果发现样式没有改变，而且css的样式还是原本的scss语法，并没有翻译成浏览器可识别的css语法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521115157.png" alt=""></p><p>去官网文档查看如何使用sass-loader</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521115452.png" alt=""></p><p>先进行下载</p><pre class=" language-bash"><code class="language-bash">cnpm <span class="token function">install</span> sass-loader node-sass webpack --save-dev</code></pre><p>然后配置一下sass-loader</p><p>再进行打包查看结果</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521115632.png" alt=""></p><p>发现样式已经发生改变</p><h3 id="实现兼容浏览器前缀"><a href="#实现兼容浏览器前缀" class="headerlink" title="实现兼容浏览器前缀"></a>实现兼容浏览器前缀</h3><p>比如在刚刚的图片样式里面，添加一个偏移的前缀</p><pre class=" language-css"><code class="language-css"><span class="token selector">body</span><span class="token punctuation">{</span>  <span class="token selector"><span class="token class">.avatar</span></span><span class="token punctuation">{</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">150</span>px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">150</span>px<span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span><span class="token number">100</span>px,<span class="token number">100</span>px<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>图片可以发生迁移的</p><p>但是我们一般这么写的时候都会要求一个前缀来兼容浏览器</p><p>比如-webkit-transform，但是这样写会很麻烦，要一个一个加前缀</p><p>这个是有个loader去自动添加厂商前缀的功能：postcss-loader</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521143248.png" alt=""></p><p>依照文档的说法，要创建一个postcss-config.js文件</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* postcss-config.js */</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token string">"browsers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>                <span class="token string">"defaults"</span><span class="token punctuation">,</span>                <span class="token string">"not ie &lt; 11"</span><span class="token punctuation">,</span>                <span class="token string">"last 2 versions"</span><span class="token punctuation">,</span>                <span class="token string">"> 1%"</span><span class="token punctuation">,</span>                <span class="token string">"iOS 7"</span><span class="token punctuation">,</span>                <span class="token string">"last 3 iOS versions"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>然后webpack.config.js里面也要添加postcss.config.js</p><pre class=" language-javascript"><code class="language-javascript">use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span><span class="token string">'sass-loader'</span><span class="token punctuation">,</span><span class="token string">'postcss-loader'</span><span class="token punctuation">]</span></code></pre><p>这个autoprefixer是一个插件</p><p>然后重新打包可以看到会自动帮我们添加了前缀</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521150706.png" alt="Google浏览器"></p><h3 id="css-loader的拓展"><a href="#css-loader的拓展" class="headerlink" title="css-loader的拓展"></a>css-loader的拓展</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521151030.png" alt=""></p><p>在很多脚手架工具里面都可以看到单独配置的这一类代码</p><p>这个实际上是这个问题的</p><p>比如我在<code>index.scss</code>里面使用一条命令<code>@import &#39;./other.scss&#39;</code></p><p>在一个scss里面再去引入其他的scss文件</p><p> 有可能引入的other.scss就不会去走postcss-loader和scss-loader了，而是直接去走css-loader</p><p>上图代码的意思就是如果是引入其他的scss之类的文件，引入之前也要去走两个loader</p><h3 id="css打包的模块化"><a href="#css打包的模块化" class="headerlink" title="css打包的模块化"></a>css打包的模块化</h3><p>这里先创建一个其他的js文件createAvatar.js</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* createAvatar.js */</span><span class="token keyword">import</span> avatar <span class="token keyword">from</span> <span class="token string">"./test.png"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">createAvatar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    img<span class="token punctuation">.</span>src <span class="token operator">=</span> avatar    img<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'avatar'</span><span class="token punctuation">)</span>    <span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>    root<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> createAvatar</code></pre><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* index.js */</span><span class="token keyword">import</span> <span class="token string">'./index.scss'</span><span class="token keyword">import</span> avatar <span class="token keyword">from</span> <span class="token string">"./test.png"</span><span class="token punctuation">;</span><span class="token keyword">import</span> createAvatar <span class="token keyword">from</span> <span class="token string">"./createAvatar"</span><span class="token punctuation">;</span><span class="token function">createAvatar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>img<span class="token punctuation">.</span>src <span class="token operator">=</span> avatarimg<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'avatar'</span><span class="token punctuation">)</span><span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>root<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span></code></pre><p>创建两个一模一样功能的文件，可以看到两个的样式是一样的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521153931.png" alt=""></p><p>偏移量都是一样的，这个说明了在index.scss里面引入的index.scss是全局变量</p><p>可是我们想要实现的是一个css文件，只在他当前引入的文件里面有效，就类似于vue里面定义的css样式，只在当前的vue文件有效</p><p>这个就是css的模块化，需要做到这个功能，需要先在webpack文件中修改</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521154215.png" alt=""></p><p>然后在使用的时候，也需要改一下方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521154350.png" alt=""></p><p>引入使用的时候也是引入style.avatar</p><p>然后重新打包</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521154435.png" alt=""></p><p>可以发现两个样式都是不一样的了</p><p>以上的所有webpack打包，都在webpack有教程</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521160130.png" alt=""></p><h2 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h2><h3 id="HtmlWebpackPlugin"><a href="#HtmlWebpackPlugin" class="headerlink" title="HtmlWebpackPlugin"></a>HtmlWebpackPlugin</h3><p>顾名思义plugins 就是插件的意思，比如我们打包的时候dist目录下是没有index.hml的，要我们去手动的生成，这个时候可以用插件帮我们去做这件事</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521160500.png" alt=""></p><p>以如上的方式去修改webpack文件，即可自动生成html文件</p><p>但是直接创建的话，只会导入js文件之类的，比如如下类型，就不会自动的生成</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521163409.png" alt=""></p><p>我在js里面绑定的是root的这个id，但是这个不会自动生成，我们可以自定义一个模板，然后接下来的打包的html文件都是按照这个模板去生成</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521163529.png" alt=""></p><h3 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" class="headerlink" title="clean-webpack-plugin"></a>clean-webpack-plugin</h3><p>这个插件并不是官方的插件，所以并不能在官网找到</p><p>在下载完成后<code>cnpm install clean-webpack-plugin -D</code></p><pre class=" language-javascript"><code class="language-javascript">plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Cleanwebpackplugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dist'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><p>具体生命周期需要看插件的官方文档</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack基本概念</title>
      <link href="/2020/05/19/webpack-ji-chu/"/>
      <url>/2020/05/19/webpack-ji-chu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本博客为观看慕课网webpack学习视频笔记，本文的部分截图、代码都来自于视频</p></blockquote><h2 id="webpack的引入"><a href="#webpack的引入" class="headerlink" title="webpack的引入"></a>webpack的引入</h2><p>以前如果是要对html文件操作，如果是在一个js代码里面写的话</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200519161625.png" alt="index.js"></p><p>会造成代码十分的臃肿，修改起来十分的不易</p><p>那么对于这种情况，可以创建多个项目文件进行管理</p><p>也就是对于三个DOM操作的文件进行分离</p><p>比如:</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* header.js */</span><span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    header<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'header'</span><span class="token punctuation">;</span>    dom<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/* siderbar.js */</span><span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    siderbar<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'siderbar'</span><span class="token punctuation">;</span>    dom<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>siderbar<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/* content.js */</span><span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    content<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'content'</span><span class="token punctuation">;</span>    dom<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>三份代码都如上所示单独以构造函数的形式去编写，然后在index.js总文件里面调用</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Sidebar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p> 这样的做法是显而易见的方便的，只需要哪一块出了问题就去寻找哪一块的代码，整体的html文件就如下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200519162138.png" alt="index.html"></p><p>但是这样会有新的问题</p><ol><li>新增了多个js文件，以前只需要加载一个js文件，现在要加载四个js文件，加载速度会变慢</li><li>即便是创建了header、sidebar之类的，但是不能明眼看出这个类是来源于哪个文件，文件又在哪里，查询还要倒回去html文件来寻找路径</li><li>很难去查错，加入content.js位置放错了，放在了index.js之下，那么浏览器是自上往下执行的，就不会识别到new Content()</li></ol><p>如过是以如下形式写</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200519162603.png" alt="index.js"></p><p>那么也只是需要引入一个index.js文件即可，也可以解决如上的三个问题</p><p> 当然直接这么打开html文件肯定是报错的，因为浏览器不识别import</p><p>这个方式叫做ES Moudule模块引入方式</p><p>使用webpack只需要</p><pre class=" language-javascript"><code class="language-javascript">npm initnpm install webpack<span class="token operator">-</span>cli <span class="token operator">--</span>save<span class="token operator">-</span>dev    npm install webpack <span class="token operator">--</span>save            npx webpack index<span class="token punctuation">.</span>js                #翻译index<span class="token punctuation">.</span>js</code></pre><p>打包出来后会生成一个dist目录，里面有个main.js</p><p>然后再引入main.js即可</p><p>但是这样直接打开的话是会报错的，因为ES Moudule仅仅是导入的话是不可以的，还需要一个导出</p><p>比如：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* header.js */</span><span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    header<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'header'</span><span class="token punctuation">;</span>    dom<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> Header<span class="token comment" spellcheck="true">/* siderbar.js */</span><span class="token keyword">function</span> <span class="token function">Siderbar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    siderbar<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'siderbar'</span><span class="token punctuation">;</span>    dom<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>siderbar<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> Siderbar<span class="token comment" spellcheck="true">/* content.js */</span><span class="token keyword">function</span> <span class="token function">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    content<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'content'</span><span class="token punctuation">;</span>    dom<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> Content</code></pre><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'./header.js'</span><span class="token keyword">import</span> Sidebar <span class="token keyword">from</span> <span class="token string">'./siderbar.js'</span><span class="token keyword">import</span> Content <span class="token keyword">from</span> <span class="token string">'./content.js'</span><span class="token keyword">new</span> <span class="token class-name">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Sidebar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>然后再执行<code>npx webpack index.js</code></p><p>webpack识别的是ES Moudle模块引入方式，此外还有CommonJS、CMD、AMD等语法，webpack同样是可以识别的，比如</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* header.js */</span><span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    header<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'header'</span><span class="token punctuation">;</span>    dom<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Header<span class="token comment" spellcheck="true">/* siderbar.js */</span><span class="token keyword">function</span> <span class="token function">Siderbar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    siderbar<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'siderbar'</span><span class="token punctuation">;</span>    dom<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>siderbar<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Siderbar<span class="token comment" spellcheck="true">/* content.js */</span><span class="token keyword">function</span> <span class="token function">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    content<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'content'</span><span class="token punctuation">;</span>    dom<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Content</code></pre><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* index.js */</span><span class="token keyword">var</span> Header <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./header'</span><span class="token punctuation">)</span><span class="token keyword">var</span> Sidebar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./siderbar'</span><span class="token punctuation">)</span><span class="token keyword">var</span> Content <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./content'</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Sidebar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>直接输入webpack 的话，使用的是全局变量，所以不建议在全局安装webpack，这样会导致两个依赖的webpack版本和全局的webpack版本混淆</p><p>那么如果是要使用依赖里面的webpack版本的话，那么可以使用命令npx webpack index.js（要打包的总文件）</p><h2 id="webpack配置项"><a href="#webpack配置项" class="headerlink" title="webpack配置项"></a>webpack配置项</h2><h3 id="webpack-config-js配置项"><a href="#webpack-config-js配置项" class="headerlink" title="webpack.config.js配置项"></a>webpack.config.js配置项</h3><p>当我们使用命令<code>npx webpack index.js</code>的时候，会默认打包成一个main.js文件，这个是默认的配置文件帮我们定义好的，这个是开发者为了方便我们，默认写好了很多配置，如果是我们想要自己去定义配置文件的时候，可以去定义一个名为<code>webpack.config.js</code></p><p>比如说之前的命令都是<code>npx webpack index.js</code>，如果是不指定index.js的话就会报错。开发者自己知道打包哪个文件是没问题，但是别人也要拿这份代码打包的话也可能不知道要打包哪个文件，因为webpack不知道默认指定的是打包哪个文件，这个时候可以在配置文件定义</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    entry<span class="token punctuation">:</span> <span class="token string">'./index.js'</span><span class="token punctuation">,</span>    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>        filename<span class="token punctuation">:</span> <span class="token string">"bundle.js"</span><span class="token punctuation">,</span>        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'bundle'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>这里filename可以指定打包出来的名字，path可以指定打包出来的目录，但是这个目录不能写死，因为每个人的路径都不一样，所有可以定义一个path来获取开发者的路径，再把bundle结合</p><p>然后执行命令<code>npx webpack</code>，就可以看到文件打包在<code>bundle</code>文件夹下了</p><p>这里不指定参数，因为webpack自动寻找到了<code>webpack.config.js</code>这个文件，然后按照文件的定义去打包</p><p><code>webpack.config.js</code>是默认识别的配置文件，但是如果要修改这个名字的话，那么命令行也要跟着修改</p><p>假如新的文件的名字为<code>webpackconfig.js</code>，那么新的命令应该是<code>npm webpack --config webpackconfig.js</code></p><h3 id="源文件配置项"><a href="#源文件配置项" class="headerlink" title="源文件配置项"></a>源文件配置项</h3><p>比如说上面的header.js、sidebar.js、content.js、index.js等文件，不是拿来直接引用的，这类的源代码一般是放在src目录里面</p><p>把文件放进去后，再修改一下打包项目即可</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* webpackconfig.js */</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>        filename<span class="token punctuation">:</span> <span class="token string">"bundle.js"</span><span class="token punctuation">,</span>        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="编写script"><a href="#编写script" class="headerlink" title="编写script"></a>编写script</h3><p>当然一般用的命令都是npm，而不是使用npx去使用，所以这里可以编写配置文件的脚本</p><p>编写package.json</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* package.json */</span>  <span class="token operator">...</span><span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token string">"bundle"</span><span class="token punctuation">:</span> <span class="token string">"webpack"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token operator">...</span></code></pre><p>npm run执行的就是scripts里面的命令，里面编写要干什么即可</p><blockquote><p>Q：这里有个问题，如果是全局也安装了webpack，那么npm run的是哪个版本的webpack呢？</p><p>A：实际上在scripts里面执行，会先到工程目录下的node_moudles里面寻找是否安装了webpack</p></blockquote><h3 id="webpack-cli"><a href="#webpack-cli" class="headerlink" title="webpack-cli"></a>webpack-cli</h3><p>这个文件的作用是让我们可以在命令行使用webpack命令，如果不安装这个，就无法使用webpack、npx之类的命令</p><h2 id="webpack打包输出"><a href="#webpack打包输出" class="headerlink" title="webpack打包输出"></a>webpack打包输出</h2><p>在webpack打包后会输出这么一大串字符</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200520140901.png" alt="webpack打包输出值"></p><p>图中Hash就是唯一的哈希值</p><p>version是打包的版本</p><p>Asset是输出的文件</p><p>Chunks是打包出来文件的ID</p><p>Chunk Names这个其实是package.json里面entry默认的字符串main</p><p>全写如下：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>        main<span class="token punctuation">:</span><span class="token string">'./src/index.js'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>        filename<span class="token punctuation">:</span> <span class="token string">"bundle.js"</span><span class="token punctuation">,</span>        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>那下面的警告是什么呢，是指webpack打包没有指定打包的环境或者打包的模式</p><p>可以先看到打包出来的文件是全部代码都压缩成一行的文件</p><p>如果没有填写模式mode的话，默认的就是production，如果填写了mode字段</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    mode<span class="token punctuation">:</span> <span class="token string">"production"</span><span class="token punctuation">,</span>    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>        main<span class="token punctuation">:</span><span class="token string">'./src/index.js'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>        filename<span class="token punctuation">:</span> <span class="token string">"bundle.js"</span><span class="token punctuation">,</span>        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>那么输出的结果就不会带着警告</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200520141810.png" alt=""></p><p>打包出来的文件还是一样的</p><p> production就是压缩文件的意思，此外还有一个development，development的意思就是不压缩文件</p><p>可以看到打包出来的代码已经是排版好的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200520142010.png" alt=""></p><h2 id="Entry-与-Output-的基础配置"><a href="#Entry-与-Output-的基础配置" class="headerlink" title="Entry 与 Output 的基础配置"></a>Entry 与 Output 的基础配置</h2><p>webpack中entry默认的打包文件是index.js，默认的输出文件是main.js</p><p>假如我要打包的文件有两个，那么输出只有一个是肯定会报错的</p><p>这里就可以把输出的文件的名字定义成一个占位符</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521170333.png" alt=""></p><p>可以看到这里是根据输入文件的定义名字来生成</p><p>但是在实际开发中，可能会把生成的index.html放到服务器，把js、css等静态文件放在cdn上</p><p>这个时候需要打包的html文件中可以自动生成一个cdn域名前缀</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521171217.png" alt=""></p><p>然后就会发现可以自动加上域名前缀</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521171238.png" alt=""></p><h2 id="SourceMap"><a href="#SourceMap" class="headerlink" title="SourceMap"></a>SourceMap</h2><p>SourceMap默认是开启的，所以要先关掉</p><p>先在index.js里面写一段错误的代码</p><pre class=" language-javascript"><code class="language-javascript">consele<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521174406.png" alt=""></p><p>这里会告诉我们打包的main.js代码出错了，而不是告诉我们源文件的代码哪里报错</p><p>SourceMap是一个映射关系</p><p>这里我们知道main.js的第96行报错</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521174726.png" alt=""></p><p>实际上是index.js第一行代码出错的</p><p>如果我们要通过报错去知道我们源文件哪里出错的话，需要定义</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521174855.png" alt=""></p><p>再刷新一下就可以发现源代码的错误了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521174936.png" alt=""></p><p>这个配置文件可以在webpack官网文档找到</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521175040.png" alt=""></p><p>当然这样做的话会生成一个<code>main.map.js</code>文件，如果不需要这个文件的话可以使用<code>inline-source-map</code>来定义，然后<code>main.map.js</code>里面的内容就变成<code>main.js</code>里面去了</p><p><code>cheap</code>是只管第几行，不精确到哪一个字符，并且没有<code>module</code>的都是只管业务代码，而不管<code>loader</code>之类的错误</p><p><code>module</code>是管loader的代码的，默认是只管业务代码<code>index.js</code>的错误，如果加上<code>module</code>才算是管理所有的代码错误</p><p>建议使用<code>cheap-module-eval-source-map</code>，打包速度快，而且报错比较全面</p><p>而这里因为我们出来的mode一般都是production，而我们希望如果是在线上报错的话，我们也可以快速定位到源代码的错误点</p><p>这样配置就好了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521180513.png" alt=""></p><p>总而言之</p><p>如果是在开发环境</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521180625.png" alt="开发环境配置"></p><p>如果是在生产环境</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200521180645.png" alt="生产环境配置"></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript面向对象编程</title>
      <link href="/2020/05/18/javascript-mian-xiang-dui-xiang-bian-cheng/"/>
      <url>/2020/05/18/javascript-mian-xiang-dui-xiang-bian-cheng/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本篇以及JavaScript设计模式系列的代码和大概理论都是出自由张容铭所著的《JavaScript设计模式》，本博客只再阅读后加上自己的理解</p></blockquote><h2 id="JavaScript的几种函数式编写方式"><a href="#JavaScript的几种函数式编写方式" class="headerlink" title="JavaScript的几种函数式编写方式"></a>JavaScript的几种函数式编写方式</h2><h3 id="函数亦是变量"><a href="#函数亦是变量" class="headerlink" title="函数亦是变量"></a>函数亦是变量</h3><p>在JavaScript中，函数也是一种变量</p><p>比如如下的定义函数的代码</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">checkName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证名字</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">checkEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证邮箱</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">checkPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证密码</span><span class="token punctuation">}</span><span class="token operator">...</span><span class="token operator">...</span></code></pre><p>如上代码其实等价于</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> checkName <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证名字</span><span class="token punctuation">}</span><span class="token keyword">var</span> checkEmail <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证邮箱</span><span class="token punctuation">}</span><span class="token keyword">var</span> checkPassword <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证密码</span><span class="token punctuation">}</span></code></pre><p>但是如上做法肯定是污染全局变量的，如果别人也定义了这个方法名字就会进行覆盖</p><h3 id="函数收编变量"><a href="#函数收编变量" class="headerlink" title="函数收编变量"></a>函数收编变量</h3><p>这个时候可以用对象来解决</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> CheckObject <span class="token operator">=</span> <span class="token punctuation">{</span>    checkName <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证名字</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    checkEmail <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证邮箱</span>    <span class="token punctuation">}</span>    checkPassword <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证密码</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>但是书中1.3章写的不明确，我认为这样的方法不易于拓展，每一个方法都要往复的写到这个对象里边会麻烦</p><p>如下写法也是一样的</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> CheckObject <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>CheckObject<span class="token punctuation">.</span>checkName <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证名字</span><span class="token punctuation">}</span><span class="token punctuation">,</span>CheckObject<span class="token punctuation">.</span>checkEmail <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证邮箱</span><span class="token punctuation">}</span>CheckObject<span class="token punctuation">.</span>checkPassword <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证密码</span><span class="token punctuation">}</span></code></pre><p>但是这样的话别人想用你的方法就比较难了，因为对象不可以复制一份或者说这个对象在用new关键字创建的时候，新创建对象不可以继承于这些方法</p><p>就比如买了这本书，书就这么一本，但如果买的是一台打印机，那么无论有多少个人要看这本书都可以打印出来</p><p>这里我的个人理解为，这个可以理解为这样的写法两个人看的都是同一本书，如果是一个人要翻页势必会影响另一个人的阅读，在程序说也就是一个人操作这个对象，势必会影响另一个人的对象代码</p><h3 id="真假对象"><a href="#真假对象" class="headerlink" title="真假对象"></a>真假对象</h3><p>对于如上的问题，如果只是想把对象复制一份的话，可以把对象放在一个函数对象中</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> CheckObject <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span><span class="token punctuation">{</span>        checkName <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//验证名字</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        checkEmail <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//验证邮箱</span>        <span class="token punctuation">}</span>        checkPassword <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//验证密码</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>如上代码也就是意味着每次调用这个函数的时候，都会把之前的那个对象返回回来，当别人每次调用这个函数的时候都会返回一个新对象，这样执行的明面上是CheckObject对象，可实际上返回的是新对象，这样每个人使用的时候都是互不影响了，比如想要检测邮箱使用的时候</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">CheckObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span><span class="token function">checkEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="类方法也可以"><a href="#类方法也可以" class="headerlink" title="类方法也可以"></a>类方法也可以</h3><p>上面的代码虽然可以完成我们的需求，但是不是一个真正意义上类的创建方式，并且创建的a和对象CheckObject没有任何的关系（即返回出来的对象本身与CheckObject对象无关），所以要对其稍加改造一下</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token operator">=</span> CheckObject <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>checkName <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证名字</span>    <span class="token punctuation">}</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>checkEmail <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证邮箱</span>    <span class="token punctuation">}</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>checkPassword <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证密码</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>当然使用了如上的方法的话再去使用的话就变成了如下的形式</p><pre><code>var a = new CheckObject();a.checkEmail();</code></pre><p>这样就可以用CheckObject类创建出来的对象了</p><p>当然如上的写法，是把所有的方法放在函数内部了，通过this定义的，所以每一次通过new关键字创建新对象的时候，新创建的对象都会对类的this上的属性进行复制。所以这些新创建的对象都会有自己的一套方法，但是这样的消耗是很奢侈的，需要进行处理一下</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> CheckObject <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>CheckObject<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>    checkName <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证名字</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    checkEmail <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证邮箱</span>    <span class="token punctuation">}</span>    checkPassword <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证密码</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>但是这两种方法不能混合使用，如果一旦混合使用，那么后面为对象的原型对象赋值新对象的时候，就会覆盖掉之前对prototype对象赋值的方法</p><p>那么如果是要使用上面定义的方法，就是如下代码所示</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CheckObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span><span class="token function">checkName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span><span class="token function">checkEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span><span class="token function">checkPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="另类方法的使用"><a href="#另类方法的使用" class="headerlink" title="另类方法的使用"></a>另类方法的使用</h3><p>如上的代码，调用了3个方法，但是a.这个代码用了三次，这个情况是可以避免的，那么就要声明的每一个方法末尾都把当前的对象返回，在JavaScript中this指向的就是当前对象，所以可以把它返回，就例如本篇使用的第一个对象</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> CheckObject <span class="token operator">=</span> <span class="token punctuation">{</span>    checkName<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证名字</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    checkEmail<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证邮箱</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    checkPassword<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证密码</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>那么想要使用的他就可以这样</p><pre class=" language-javascript"><code class="language-javascript">CheckObject<span class="token punctuation">.</span><span class="token function">checkName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span>；</code></pre><p>当然同样的方式还可以放在类的原型对象当中</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> CheckObject <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>CheckObject<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>    checkName<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证名字</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    checkEmail<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证邮箱</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    checkPassword<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//验证密码</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>但是使用的时候也需要创建一下</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CheckObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span><span class="token function">checkName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="函数的祖先"><a href="#函数的祖先" class="headerlink" title="函数的祖先"></a>函数的祖先</h3><p>如果看过prototype.js的代码，会想到如下的书写方式</p><p>prototype是一个JavaScript框架，里面封装了很多的方法，最大的特点就是对原生的对象（JavaScript为我们提供的对象类，如Function、Array、Object等等）的拓展，比如每一个函数都添加一个检测邮箱的方法可以这么做</p><pre class=" language-javascript"><code class="language-javascript">Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>checkEmail <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证邮箱</span><span class="token punctuation">}</span></code></pre><p>那么创建的新对象都会包含这个方法</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>f<span class="token punctuation">.</span><span class="token function">checkEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>比如在vue中，如果要使用一些全局的js方法，那么是在main.js写上这行代码调用的，加入这个变量的名字是common</p><pre><code>import common from &quot;../common.js&quot;Vue.prototype.common = common</code></pre><p>也可以这么写</p><pre><code>var f = new Function();f.checkEmail();</code></pre><p>当然这么做是不允许的，因为污染了原生的对象Function，会造成不必要的开销，但是可以抽象出一个统一的方法的功能方法</p><pre class=" language-javascript"><code class="language-javascript">Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>addMethod <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> fn<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>这样写的话，那么如果是添加邮箱验证和姓名验证的方法可以这么做</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> methods <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>或者是</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> methods <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>methods<span class="token punctuation">.</span><span class="token function">addMethod</span><span class="token punctuation">(</span><span class="token string">'checkName'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证姓名</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>methods<span class="token punctuation">.</span><span class="token function">addMethod</span><span class="token punctuation">(</span><span class="token string">'checkEmail'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证邮箱</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>methods<span class="token punctuation">.</span><span class="token function">checkName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>methods<span class="token punctuation">.</span><span class="token function">checkEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="链式添加"><a href="#链式添加" class="headerlink" title="链式添加"></a>链式添加</h3><p>如果是想要链式添加，也就是把this返回</p><pre class=" language-javascript"><code class="language-javascript">Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>addMethod <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> fn<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>当然再想添加方法的话就要这么做了</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> methods <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>methods<span class="token punctuation">.</span><span class="token function">addMethod</span><span class="token punctuation">(</span><span class="token string">'checkName'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证姓名</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addMethod</span><span class="token punctuation">(</span><span class="token string">'checkEmail'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证邮箱</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>以上的方法肯定是错的，如果是想要把this返回实现的话，那么添加的每个方法都将this返回</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> methods <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>methods<span class="token punctuation">.</span><span class="token function">addMethod</span><span class="token punctuation">(</span><span class="token string">'checkName'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证姓名</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addMethod</span><span class="token punctuation">(</span><span class="token string">'checkEmail'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证邮箱</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>然后进行测试一下</p><pre class=" language-javascript"><code class="language-javascript">methods<span class="token punctuation">.</span><span class="token function">checkName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="把链式添加换成类方法的使用"><a href="#把链式添加换成类方法的使用" class="headerlink" title="把链式添加换成类方法的使用"></a>把链式添加换成类方法的使用</h3><p>如上链式代码的函数调用方式是没有问题了，但是如果是习惯了使用类方法的人来说，可以简单的修改一下</p><pre class=" language-javascript"><code class="language-javascript">Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>addMethod <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> fn<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>此时还可以按照上一种方式来添加代码</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> methods <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>methods<span class="token punctuation">.</span><span class="token function">addMethod</span><span class="token punctuation">(</span><span class="token string">'checkName'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证姓名</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addMethod</span><span class="token punctuation">(</span><span class="token string">'checkEmail'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//验证邮箱</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>但是使用的时候就不可以直接用了，要通过new关键字来创建新对象</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Methods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>m<span class="token punctuation">.</span><span class="token function">checkEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="JavaScript的面向对象编程"><a href="#JavaScript的面向对象编程" class="headerlink" title="JavaScript的面向对象编程"></a>JavaScript的面向对象编程</h2><p>在团队开发中，解决需求的时候都是按照一个对象一个对象的去编写，因为如果直接编写函数的话会多很多全局变量</p><p>团队的风格一般都是面向对象编程，也就是把需求抽象成一个对象，然后根据这个对象分析其特征（属性和方法），这个对象称之为类。面向对象的其中一个特征是封装，但是遗憾的是对于JavaScript而言这种解释性的弱类型语言没有强类型语言中的class关键字来编写类，只能通过一些特性来模仿，但是这样也给了JavaScript极高的灵活性</p><h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><h4 id="创建一个类"><a href="#创建一个类" class="headerlink" title="创建一个类"></a>创建一个类</h4><p>在JavaScript中，创建一个类很容易，如下所示：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> Book <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>bookname<span class="token punctuation">,</span>price<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id     <span class="token keyword">this</span><span class="token punctuation">.</span>bookname <span class="token operator">=</span> bookname    <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">}</span></code></pre><p>也可以在类的原型（类也是一个对象，所以也有原型prototype）上添加属性和方法两种方式，一种是一一位原型对象属性赋值，另一种则是将一个对象赋值给类的原型对象，但是这两种方式不能混用，例如：</p><pre class=" language-javascript"><code class="language-javascript">Book<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//展示这本书</span><span class="token punctuation">}</span></code></pre><p>或者</p><pre class=" language-javascript"><code class="language-javascript">Book<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>    display <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>这样就可以把所需要的方法和属性都封装在我们抽象的Book类里面了，当使用方法的时候不能直接使用这个Book类，需要用new关键字实例化创建新对象，如下所示：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'JavaScript设计模式'</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>bookname<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">//JavaScript设计模式</span></code></pre><p><strong>如上两份代码，一个用了this一个用了prototype，那么这两个方法有什么不同呢</strong></p><p><strong>通过this添加的属性、方法都是在当前对象上添加的，然而JavaScript是一种基于原型prototype的语言，每创建一个对象的时候（当然在JavaScript中函数也是一个对象），它都有一个原型prototype用于指向于其继承的属性、方法。这样通过prototype继承的方法并不是对象自身的，所以在使用这些方法的时候，需要通过prototype一级一级查询来得到。这样会发现通过this定义的属性或者方法都是自身拥有的，所以每次通过类创建一个对象的时候，this指向的属性和方法都会得到相应的创建，</strong></p><p><strong>而通过prototype继承的属性或者方法是对每个对象通过prototype访问到，所以每次通过类创建一个新对象的时候这些属性和方法不会再次创建</strong></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200518160833.png" alt="图2-1"></p><p>见图2-1 所示，constructor是一个属性，当创建一个函数或者是对象的时候都会为其创建一个原型对象的prototype，在prototype对象中又会像this一样创建一个constructor属性，那么constructor属性指向的就是拥有整个原型对象的函数或者是对象，例如在本例中的Book prototype中的constructor属性就是指向Book类对象</p><h4 id="属性的方法和封装"><a href="#属性的方法和封装" class="headerlink" title="属性的方法和封装"></a>属性的方法和封装</h4><p>比如在java中，有私有属性、公有属性、公有方法等，JavaScript中虽然没有这些东西，但是可以用技巧去实现他，由于JavaScript的函数级的作用域，声明在内部的变量和方法在外界都是访问不到的，由此可创建类的私有变量和私有方法。</p><p>在函数内部，通过this创建的属性和方法，在类创建对象的时候，每个对象都有一份外部可以访问到的的属性，因此通过this创建的属性可看做是对象共有属性和对象的共有方法。而这些this创建的方法和属性，还可以访问到类的私有属性和私有方法。这个可以看做是一个特权方法。在对象创建的时候通过这些特权方法可以初始化实例对象的一些属性，因此这个可以看做是一个构造器</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> Book <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>price<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">checkId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//特权方法</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>getName <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>getPrice <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>setName <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>setPrice <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//对象公有属性</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id    <span class="token comment" spellcheck="true">//对象共有方法</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>copy <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//构造器</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>如上代码可知，可以通过JavaScript的块级作用域的特征来实现在函数内部创建外界访问不到的私有变量和私有化方法。通过new关键字实例化对象时，由于只执行一次，所以类的内部this上定义的属性和方法都复制到新创建的对象上，成为公有化的属性和方法</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> JavaScript设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker学习笔记六</title>
      <link href="/2020/05/11/docker-xue-xi-bi-ji-liu/"/>
      <url>/2020/05/11/docker-xue-xi-bi-ji-liu/</url>
      
        <content type="html"><![CDATA[<h2 id="Kubernetes介绍"><a href="#Kubernetes介绍" class="headerlink" title="Kubernetes介绍"></a>Kubernetes介绍</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200513105938.png" alt=""></p><p><code>swarm</code>的架构就是一个<code>manager</code>节点和<code>worker</code>节点，<code>K8S</code>的集群架构大致是一样的，但是呢在<code>K8s</code>中，<code>manager</code>节点成为<code>master</code>节点 ，<code>worker</code>节点成为<code>node</code>节点，<code>master</code>节点会对外提供一些接口，通过接口可以对<code>K8s</code>的集群进行操作</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200513110330.png" alt="Master节点"></p><p><code>K8s</code>节点是整个集群的大脑，<code>master</code>的主要功能可以通过模块去看，从图中可知，主要有一个<code>API Server</code>（通过这个跟集群进行交互），<code>Scheduler</code>（调度模块，比如说部署一个应用，应用需要两个容器，容器要运行到哪个节点上去，也就是要<code>Scheduler</code>的调度算法来确定分配到哪个节点），<code>Controller</code>，<code>etcd</code>（就是一个存储K8S的整个状态和配置）</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200513165754.png" alt="Node节点"></p><p>对于<code>Node</code>节点来讲，最重要的概念就是Pod，Pod是容器调用的最小单位，Pod就是具有相同的namespace的一些container的组合</p><p>接下来看一下最下面的四个方块</p><p><code>Docker</code>就是容器的技术</p><p><code>Kubelet</code>：<code>node</code>节点是收到<code>master</code>节点的控制的，<code>master</code>节点如何去控制<code>node</code>节点呢，如何去创建pod、volume、网络等会通过Kubelet去创建</p><p><code>Kube-proxt</code>：这个是跟网络有关的，K8S如何是想要暴露一些端口给外界的去访问，<code>Kube-proxt</code>就去做一些代理的端口的代理和转发，在<code>K8S</code>的<code>serverice</code>里面也可以做一些负载均衡，<code>serverice</code>的发现和负载均衡也是通过<code>Kube-proxt</code>来实现的</p><p><code>Fluentd</code>：做日志的采集和存储以及查询的</p><p>除此之外还有一些<code>optional</code>的插件，有<code>DNS</code>服务模块来提供<code>DNS</code>服务的，<code>UI</code>来通过<code>web</code>的方式去访问<code>K8S</code>集群的；</p><p>最上层的还<code>有Imag Registry</code>来拉去<code>docker</code>需要的<code>image</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200513170828.png" alt=""></p><h2 id="K8S介绍"><a href="#K8S介绍" class="headerlink" title="K8S介绍"></a>K8S介绍</h2><p> Pod是K8s里面调度的最小单位，在K8s里面不对容container直接操作，Pod已经是最小单位了，那么pod和container是什么关系呢</p><p>一个pod可以包含一个或者多个container，一个pod共享一个namespace（用户、网络、存储等等），在一个pod里面的container就可以通过localhost去通信</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200514175857.png" alt=""></p><p>在运行容器之前需要安装一个单节点的K8S集群</p><pre><code>minikube start</code></pre><p>在使用集群之前要了解一个kubectl context（可以理解为上下文），kubectl 是一个client的cli，要去连接一个k8s的集群，k8s集群提供了一个API server，cli要去连接这个API server，必须要有一些基本的配置信息，比如说（API地址、IP地址、端口、基本的认证信息），把这些配置信息称之为一个context，minikube是已经帮我们生成好了</p><p>输入命令</p><pre><code>kubectl config view</code></pre><p> 可以看到当前的config的基本情况</p><pre><code>kubectl config get-contexts </code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200514202128.png" alt="image-20200514202126622"></p><p>可以看到有一个集群，只要是不同的集群就有不同的config，所以就可以通过config去连接</p><p>通过</p><pre><code>kubectl cluster-info</code></pre><p>就可以看到集群的情况</p><p>同时也可以进入virtualbox创建的虚拟机</p><pre><code>minikube ssh</code></pre><h2 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h2><p>在视频中的实验是取一个pod_nginx.yml文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515100826.png" alt="pod_nginx.yml"></p><p>然后使用命令创建集群</p><pre><code>kubectl create -f pod_nginx.yml</code></pre><p>跑起来的结果如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515091338.png" alt=""></p><p>可以看到Nginx其实是一个容器，其实就是一个pod，pod里面跑一个container，那么这个pod在哪呢</p><p>然后使用如下命令可以看到pod的详细信息</p><pre><code>kubectl get pods -o wide</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515091452.png" alt=""></p><p>可以看到是允许在minikube的这个节点上</p><p>如果现在是想进去容器里面那怎么办呢</p><p>可以进去minikube的这个节点里面，然后再在里面使用docker进行操作</p><p>即</p><pre><code>minikube ssh    #先进去pod里面docker ps        #进去里面再使用ps</code></pre><p>可以看到里面有个k8s_nginx</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515091646.png" alt=""></p><p>当然也可以直接通过kubectl进去</p><pre><code>kubectl exec -it nginx sh</code></pre><p>这个方法是只进入第一个容器，如果是有多个容器的话，先要查看这个pod的详细信息</p><pre><code>kubectl describe pods Nginx</code></pre><p>就可以打印出来Nginx的详细信息</p><p> <img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515095714.png" alt=""></p><p>可以看到IP为172.17.0.4，但是现在的操作环境是在minikube的外边是没办法访问到这个地址的</p><p>所以是要先进去minikube里面</p><pre><code>minikube ssh</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515095858.png" alt=""></p><p>无论是ping还是curl都可以访问到这个地址的</p><p>但是这个Nginx不是为了给开发者自己去访问的，是要给外边去访问的</p><p>此时就需要把这个Nginx地址映射到minikube的接口上</p><p>接下来要看下minikube的地址</p><pre><code>minikube ssh    #先进去minikubeip a            #然后查看ip</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515100120.png" alt=""></p><p>可以看到这个地址是可以供外面去访问的</p><p>为了端口映射出去可以让外部访问，有两种方法</p><p>第一种：</p><pre><code>kubectl port-forward nginx 8080:80</code></pre><p>可以看到映射成功</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515100343.png" alt=""></p><p>但是这个方法是要一直去运行的</p><h2 id="pods的拓展"><a href="#pods的拓展" class="headerlink" title="pods的拓展"></a>pods的拓展</h2><h3 id="ReplicationController"><a href="#ReplicationController" class="headerlink" title="ReplicationController"></a>ReplicationController</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515101009.png" alt="rc_nginx.yml"></p><p>还是按照老方法直接create方法去创建</p><pre><code>kubectl create -f rc_nginx.yml</code></pre><p>查看pods</p><pre><code>kubectl get pods    #查看所有的podskubectl get rx         #查看Nginx总量</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515101311.png" alt=""></p><p>如果删掉其中的一个pods</p><pre><code>kubectl delete pods nginx-6r92b</code></pre><p> 然后再查看</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515101442.png" alt=""></p><p>也就是说如果是通过ReplicationController去创建的话，pods会维持一个数目</p><p>那么如何去拓展呢，还是通过scael方法</p><pre><code>kubectl scale rc nginx --replicas=2</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515101658.png" alt=""></p><p>  当然也可以升</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515101725.png" alt=""></p><p>此时可以看到每个Nginx都是监听到80端口的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515102159.png" alt=""></p><p>可以看到每个Nginx都运行在minikube的这个节点上</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515102227.png" alt=""></p><p>在docker swarm中，是有个virtual IP（不变的虚拟IP）去做负载均衡</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515102623.png" alt=""></p><h3 id="ReplicaSet"><a href="#ReplicaSet" class="headerlink" title="ReplicaSet"></a>ReplicaSet</h3><p>ReplicaSet和Replication唯一不同就是ReplicaSet支持new ser-based selector</p><p>那么如何去使用ReplicaSet呢</p><p>这里需要修改原来的rc_nginx.yml文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515103212.png" alt="rs_nginx.yml"></p><p>第二和第三个地方是ReplicaSet和Replication要求不同的</p><p>然后修改好之后</p><pre><code>kubectl create -f rs_nginx.yml</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515103332.png" alt=""></p><p>如果是需要去拓展</p><pre><code>kubectl scale rs nginx --replicas=2</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515103428.png" alt=""></p><h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515103810.png" alt="Deployment官方文档介绍"></p><p>即如果我希望部署一个app，那么我要描述这个我希望的状态（比如我希望有三个拓展，pod的docker image是什么版本），Deployment Controller会努力使得这个声明实现，也就是让底层的pods和replicasets去帮我们实现这个所希望的拓展</p><p>但是如果是通过Deployment 去创建的pods和replicasets，我们就不能对他通过独立的去操作了，也不能delete删除掉replicasets，一定只能对Deployment 去操作</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515104414.png" alt="deployment_nginx.yml"></p><p>这里nginx是低版本的，等一下演示如何去升级</p><p>然后创建这个文件</p><pre><code>kubectl create -f deployment_nginx.yml</code></pre><p>此时已经是保持了三个replicas</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515104824.png" alt=""></p><p>可以看到deployment名为nginx-deployment，可以看到replicas的名字为deployment名字后面加随机数字</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515104945.png" alt=""></p><p>然后pods也是一样的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515105102.png" alt=""></p><p>可以看到前面的数字是一样的，后面接着的就是pods的随机字符串</p><p>先看一下所有的详细信息</p><pre><code>kubectl get deployment -o wide</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515105235.png" alt=""></p><p>此时对deployment进行升级</p><pre><code>kubectl set image deployment nginx-deployment</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515105418.png" alt=""></p><p>然后查看服务可以看到有个旧的被撤销了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515105442.png" alt=""></p><p>当然这个还可以进行版本的控制</p><p>这里先看一下版本</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515105524.png" alt=""></p><p>然后进行回滚</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515105608.png" alt=""></p><p>如图所示·版本回滚了，nginx的版本也变成了老版本</p><p>对于deployment来讲，可以很轻松的就可以进行版本的更新</p><p>以上讲部署nginx的方法（Pods、ReplicaSet、ReplicationController）都没办法吧minikube的端口让外部去访问，除非通过pod_forward</p><p>K8S提供了一个另外的方法，可以让端口暴露在节点上面</p><pre><code>kubectl expose deployment nginx-deployment --type=NodePort</code></pre><p> 然后看一下端口</p><pre><code>kubectl get svc</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515110325.png" alt=""></p><p>可以看到监听了minikube的30451端口 </p><p>然后可以通过IP地址+30541去访问nginx，在个地址也就是minikube的地址或者是K8S集群Node的地址</p><h2 id="network"><a href="#network" class="headerlink" title="network"></a>network</h2><p>service和网络有密切的关系，这里要重新搭建一个环境，minikube的单节点环境可以演示但是不够直观，这里通过coreos去演示</p><p>可以通过vagrant方式或者是virtualbox方式安装</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515110826.png" alt=""></p><p>当然这里肯定会遇到兼容的问题，让kubectl去选择</p><p> 这里通过pod_busybox.yml和pod_nginx.yml两个yml文件去创建了pods</p><p>以下是两个pods的运行情况</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515144509.png" alt=""></p><p>如果是在busybox-pod容器里面去ping以下另一个容器的话是可以ping通的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515144757.png" alt=""></p><p>这里假设是在同一个node里面才可以ping通的，现在拿另一个集群的另个一个服务器去ping</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515144953.png" alt=""></p><p>而且还是可以ping通的，这个可以联到docker swarm的多机通信overlay网络</p><p> <img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515145132.png" alt=""></p><p>如图所示：</p><p>C1可以ping通w1里面的两个地址，原因是因为两个地方之间做了一个overlay的网络</p><p>在这两台机器之间都安装了一个flanner的插件，这个插 件也是coreos的产品，通过这个插件实现了两个地方之间的overlay网络</p><p>里面的英文文章是k8s的网络说明文档，里面有列举很多插件，但是这些插件都要满足一个基本要求</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515145918.png" alt=""></p><ol><li>所有的容器跟其他容器之间可以直接通信，并且不需要NAT之间的转换</li><li>C1这台机器上的Node去ping W1上面的nginx和busybox，也就是在一个node上可以直接访问 其他的container，哪怕是这个container不在当前的节点上也是可以的</li><li>就是自己的IP是什么， 别人访问他的IP地址就是这个地址</li></ol><p>各个厂商都可以  根据这个规范要求去实现自己的插件 </p><p>在w1上使用ifconfig命令可以看到有一个flannel地址</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515150422.png" alt=""></p><h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><p>还是使用上面的图</p><p> <img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515145132.png" alt=""></p><p>虽然是可以内部通信了，但是类似nginx之类的服务是需要外部网络可以访问的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515150746.png" alt=""></p><p>里面的每个pod都有自己的IP地址，每个之间都是可以ping通的</p><p>只要一个是web service，需要外部访问，只需要IP地址+端口号就可以访问到这个服务，但是不能直接这么做，会出现很多问题</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515151000.png" alt=""></p><p>在水平拓展的时候是做伸缩还是拓展，如果是减少的话那么就要销毁pod，那么这个IP地址肯定是没了，那么外部访问这个IP肯定就是有问题的了，如果是一个web服务，他的scale=3，那么外部访问三个地址之间的哪个</p><p>如果是通过Deployment去部署这个pod，后期如果是需要更新image，升级或者是降级，那么之间的pod就会被销毁，会生成一个新的pod，那么这个pod的IP也会改变</p><p>假如一个service是数据库，那么我们希望的是无论怎么改变，这个IP地址和端口都不要去变化，哪怕是要升级或者是降级</p><p>综上所述也就是关于service的问题</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515151451.png" alt=""></p><p>以下三种都是基于IP地址的</p><h3 id="cluster-IP"><a href="#cluster-IP" class="headerlink" title="cluster IP"></a>cluster IP</h3><h4 id="pod"><a href="#pod" class="headerlink" title="pod"></a>pod</h4><p>顾名思义，cluster IP就是只有cluster 可以访问的地址，外界是无法访问的，假如创建一个数据库service，类型为cluster IP，cluster IP是不会去改变的，是这个service所对应的IP地址，这个service肯定有pod，和这个pod的IP地址和service之间是有一个一对一的对应关系，这个service的IP地址是不会去变化的了，这个pod的IP地址是可以变化的，但是对外提供的cluster IP不会变，所以说这个服务是稳定的</p><p>实验环境还是基于上图的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515152634.png" alt="image-20200515152633840"></p><p>然后使用命令</p><pre><code>kubectl expose pods nginx-pod</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515152702.png" alt=""></p><p>然后再获取service</p><pre><code>kubectl get svc</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515152727.png" alt=""></p><p>可以看到nginx-pod就是cluster IP，对外提供服务的话可以通过这个地址</p><p>10.2.0.252是nginx的pod地址，也是container的ip地址，自行销毁的话这个地址是会变化的，但是service ip是不会变化的</p><p>然后只需要在C1的服务器都可以访问到这个地址</p><h4 id="deployment"><a href="#deployment" class="headerlink" title="deployment"></a>deployment</h4><p>如果是通过deployment去访问的话，先创建并且查看信息</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515153240.png" alt=""></p><p>在C1服务器访问10.2.0.142和10.2.0.141还是可以访问到这个服务的</p><p>这个服务是返回hostname，可以看到两个返回的信息是不一样的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515153416.png" alt=""></p><p>然后把端口暴露给外部去访问</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515153520.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515153601.png" alt=""></p><p>然后再去C1的服务器去访问这个地址</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515153713.png" alt=""></p><p>也就是这个service会给我们做一个负载均衡</p><h4 id="使用deployment去做一个无宕机的更新"><a href="#使用deployment去做一个无宕机的更新" class="headerlink" title="使用deployment去做一个无宕机的更新"></a>使用deployment去做一个无宕机的更新</h4><p>这还是跟swarm的实验一样，使用循环去不停的访问地址</p><p>在C1的服务器上循环</p><pre><code>while true;do curl 10.3.120.168:8080;done</code></pre><p>在w1的服务器上可以set image，也就是使得docker image变化去更新deployment，看一下服务会不会中断</p><p>这里有另外一个方法：直接去编辑deployment文件，这里的编辑当然不是通过vim去编辑，而是使用kubectl去编辑这个deployment服务</p><pre><code>kubectl edit deployment service-test</code></pre><p>可以看到会打开启动这个service的yml文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515154331.png" alt=""></p><p>只改变输出的内容</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515154401.png" alt=""></p><p>保存退出后面可以看到服务会被down掉</p><p>中止了一断时间然后就变成新的输出内容了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515154440.png" alt=""></p><p>然后可以看到之前的pods已经被终止了还添加了一个新的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515154522.png" alt=""></p><p>但是这样并没有实现零宕机的更新，还是有那么一段时间没有访问到，因为这个并不是一个滚动的更新（Rolling Update）</p><h3 id="NodePort"><a href="#NodePort" class="headerlink" title="NodePort"></a>NodePort</h3><h3 id="expose创建"><a href="#expose创建" class="headerlink" title="expose创建"></a>expose创建</h3><p>顾名思义，是绑定到了一个node上面的，node是对外可以提供访问的</p><p> 这里先解释一下label</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515155356.png" alt=""></p><p>在K8S里面几乎是所有的资源都可以设置一个labels，labels是一个key-value的一个对，而且labels可以设置不止一个</p><p>先创建一个pod</p><pre><code>kubectl create -f pod_nginx.yml</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515155709.png" alt=""></p><p>这里先看看帮助，因为默认的就是cluster IP模式</p><p>可以看到</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515155821.png" alt=""></p><p>type默认的就是cluster ip，只需要type指定就可以了</p><pre><code>kubectl expose pods nginx-pod --type=NodePort</code></pre><p>可以看到会有个IP</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515160020.png" alt=""></p><p>主要是看80:31404</p><p>然后看一下node</p><pre><code>kubectl get node -o widekubectl describe node +节点名字</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515160254.png" alt=""></p><p>可以看到节点的IP地址为</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515160341.png" alt=""></p><p>在浏览器访问<code>172.17.4.101:31404</code>，可以看到访问nginx成功</p><p>再试一瞎另外一个node的地址<code>172.17.4.201:31404</code>，可以看到也可以访问</p><p>也就是NodePort这个service，可以把31404的这个整个端口映射到cluster里面的每个node的IP地址上</p><h3 id="通过yml文件去创建"><a href="#通过yml文件去创建" class="headerlink" title="通过yml文件去创建"></a>通过yml文件去创建</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515161352.png" alt="service_nginx.yml"></p><p>先创建这个服务</p><pre><code>kubectl create -f service_nginx.ml</code></pre><p>然后看一下服务</p><pre><code>kubectl get svc</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200515161421.png" alt=""></p><p>然后输入<code>172.17.4.101:32333</code>和<code>172.17.4.201:32333</code></p><p>但是这个NodePort，在端口低于3000的时候会报错，但是自己用的端口可能没那么大，可能是80、443 ，可以在后面加一个nginx代理映射或者是Port是暴露在所有的端口节点上，高端口数量是有限的，低端口不用是对端口是一种浪费，所以这个也不适合在生产环境用，但是可用。</p><p>在生产环境用的比较多的是ExternalName和LoadBalancer，LoadBalancer需要结合云服务商去用，ExternalName就是通过DNS的方式</p><h3 id="LoadBalancer"><a href="#LoadBalancer" class="headerlink" title="LoadBalancer"></a>LoadBalancer</h3><p>这个是需要云服务商去提供LoadBalancer，然后我们通过LoadBalancer就可以自动去访问pod里面的service</p><p>当然也可以去用DNS去做，但是是需要插件</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker学习笔记五</title>
      <link href="/2020/05/07/docker-xue-xi-bi-ji-wu/"/>
      <url>/2020/05/07/docker-xue-xi-bi-ji-wu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>总结慕课网docker课程的学习总结，本篇总结了docker swarm的理念和操作</p></blockquote><h2 id="Docker-swarm"><a href="#Docker-swarm" class="headerlink" title="Docker swarm"></a>Docker swarm</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507213343.png" alt=""></p><p>之前学的都是docker在一台机器上运行，但是一般的应用都是比较复杂的，不可能所有的应用都在一台机器上运行</p><p>生产环境一般都是在集群里面部署应用，这样就会涉及到很多容器，那么就会遇到如下等问题</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507213536.png" alt=""></p><p>在这样的情况下，需要一套容器的编排系统，在这样的情况下swarm就诞生了，swarm并不是唯一的一个编排的工具，但是swarm是唯一一个内置于docker的编排工具，之前的都是运行在单机的模式下，不是运行在swarm的模式下</p><p>这里先介绍一下swarm的架构，以及重要的概念</p><h2 id="swarm基础架构"><a href="#swarm基础架构" class="headerlink" title="swarm基础架构"></a>swarm基础架构</h2><p>swarm是一套集群的架构，有集群里面肯定是有节点，有节点的话就有角色</p><p>在swarm里面，节点主要有两种角色，一种叫manager，一种叫worker</p><p>第一种角色就是manager，manager是整个集群的大脑，既然是大脑，而且是生产环境，为了避免单点故障，大脑至少要有两个，如果是多个的话，那么就设计到状态的同步问题，这个就涉及到一个内置的分布式存储的数据库，这个数据呢是通过Raft协议去做的一个数据同步，Raft能够确保manager节点之间的信息是对称同步的</p><p>第二种角色就是worker，worker就是一个干活的节点，大部分的容器要部署，都要运行到worker节点上面，当然manger节点上也是可以运行的，但是主要还是在worker节点上面，因为worker节点比较多一点。worker节点也有数据需要同步，他们就通过一个叫Gossip的网络去做信息的同步</p><p>Swarm manager和worker节点之间通信是通过TLS去加密的，加密的信息的都是寸在于manager的节点的内置分布式存储数据库里面的，而且是通过加密存储在硬盘里面的</p><p>整体架构如下图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507214550.png" alt=""></p><h2 id="Service和Replicas"><a href="#Service和Replicas" class="headerlink" title="Service和Replicas"></a>Service和Replicas</h2><p>Service在docker compose里面的Service概念其实是一样的，一个Service就代表了一个容器，但是在Replicas模式的情况下，就是需要去做一个横向的拓展，既然是横向去拓展，在部署的时候，一个Replicas其实就是一个容器，比如下图的service是Nginx，要给它做三个拓展，实际上部署的时候就会产生三个容器，他们会通过调度系统来调度到不同的node上面（也就是通过swarm manager这个节点去部署一个service的时候，是不知道service会运行在哪些swarm节点上面的，这个是通过swarm的调度算法去算的，比如看哪些节点的负载比较轻一些，有充足的内存和cpu资源，就会把容器调度在这台机器上面）</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507214633.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508095409.png" alt="swam创建service的时候调度的过程"></p><p>基本上讲的就是在swarm manager上做所有的决策，最终的结果呢就是把service部署在哪台node节点上面，再去执行实际操作就可以了，这个就是一个基本的调度情况</p><h2 id="docker-swarm创建三个节点"><a href="#docker-swarm创建三个节点" class="headerlink" title="docker swarm创建三个节点"></a>docker swarm创建三个节点</h2><p>如果要安装一个 swarm cluster</p><p>先看初始化init的参数</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508103017.png" alt=""></p><p>主要看第一条参数指定地址</p><p>因为初始化swarm cluster就要宣告一个地址，cluster必须要有多个节点，要让别的节点知道这个节点的存在，就要添加一个本地的地址，本地的地址通过ip a查看</p><p>知道自己的服务器地址后直接添加manager节点即可</p><p>输入后可得到docker swarm join之类的结果，如下图所示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508110231.png" alt="manager节点"></p><p>只需要黏贴这串字符串执行，那么就可以添加为worker节点</p><p>然后再用一个服务器，执行这串命令，如下图所示就是成功</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508110447.png" alt="worker1节点"></p><p>再切回manager服务器查看节点</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508110529.png" alt="manager节点"></p><p>可以看到节点添加成功</p><p>实战需要三台服务器，所以我再用本地的docker添加为worker节点</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508110846.png" alt="worker2节点"></p><p>可以看到已经有三台服务器，有leader就是manager节点的服务器，其余皆是worker节点</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508110932.png" alt="manager节点"></p><p>当然还可以通过docker-machine和play-with-docker</p><p>并且play-with-docker还可以快速创建节点和环境</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508111622.png" alt=""></p><h2 id="docker-swarm-service"><a href="#docker-swarm-service" class="headerlink" title="docker swarm service"></a>docker swarm service</h2><p>在docker-compose里面一个service就是一个容器，而且是在允许在同一台机器上面</p><p>而在swarm模式下面呢，如果是创建一个service，这个service是一个容器，默认情况下会运行到cluster里面的任何一个节点上面</p><p>在docker swarm模式下创建service是不同的</p><p>先查看命令如何使用</p><pre><code>docker service</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508112139.png" alt="docker service"></p><p>这个create命令跟run命令很相似，但是run是在本地创建一个container，在cluster里面创建一个service，这个service不一定会在本地</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508112724.png" alt="docker service create命令"></p><p>这里先创建一个service</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508113037.png" alt="创建service"></p><p>busybox就是image的名字，sh也就是shell，这个就是command</p><p>然后<code>docker service ls</code>就可以看到<code>service</code>创建完成</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508113211.png" alt="docker service ls执行结果"></p><p>这个service也可以理解为container，这个在哪台机器上呢可以通过ps命令查看</p><pre><code>docker service ps +service的名字</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508113404.png" alt="查看service在哪个节点"></p><p>从图中看到，这个容器是在docker-desktop这个节点上的，也就是我本地window上的docker节点，然后在本地的docker查看一下运行的容器</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508114342.png" alt="在docker-desktop节点上查看运行的容器"></p><p>可以看到刚刚service创建的容器，这个名字并不叫demo，而是<code>demo+.随机数</code></p><p>接下来可以看<code>docker service ls</code>执行结果的<code>MODE</code>和<code>REPLTCAS</code></p><p>这两个说明这个service是可以水平拓展的，这个跟docker-compose的scale，可以把service去横向去拓展，拓展成多个，这个<code>REPLTCAS</code>也是同样的意思，那么如何对它进行拓展呢，其实命令差不多的，先执行下面的命令查看如何使用 </p><pre><code>docker service scale</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508115448.png" alt="docker service scale查看命令"></p><p>然后对service demo进行拓展</p><pre><code>docker service scale demo=5</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508115553.png" alt=""></p><p>因为这个service要平均部署到cluster里面，可能在其他的节点看到这个service（容器）</p><p>然后等待执行完毕再看看service</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508115722.png" alt=""></p><p>这里就变成了5个了，分母代表scale的数量，分子是代表有多少个service ready了</p><p>这里再看看service的详情</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508115834.png" alt=""></p><p>这里是部署到整个cluster里面的，具体详情如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508120046.png" alt="manager节点"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508120059.png" alt="worker1节点"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508120116.png" alt="worker2节点"></p><p>这里如果是我再其中一台服务器把service强制删除</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508120236.png" alt="错误：destop节点删除容器"></p><p>然后再ls看一下service的情况</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508120610.png" alt="错误：manager节点查看结果"></p><p>一开始是4/5的，几秒后就变成5/5了</p><p>下面这个也是一样</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508120524.png" alt="work1节点服务器删除容器"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508120549.png" alt="manager节点服务器查看结果"></p><p>然后等待几秒后再查看一次</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508120711.png" alt=""></p><p>这个究竟是什么原因让4/5变成5/5呢</p><p>这里详细查看一下demo</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508142754.png" alt="docker service ps demo"></p><p> 可以看到启动的容器数量还是没有少的，这个scale的5不仅是能做到横向拓展，还能够保证一定数量的拓展是有效的，也就是说swarm发现部分的节点失效了或者是退出了，然后通过cluster的任意节点去修补来达到特定数目的scale，能确保数量一定是5，而且是一定是有效的，也就是能确保系统是有效和有用的</p><p>如果是想删除的话</p><p>直接rm +service的名字即可，比如</p><pre><code>docker service rm demo</code></pre><p>虽然删除后ls和ps上是看不到了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508144847.png" alt=""></p><p>然后<code>docker ps</code> 马上看节点上的容器还是在运行的，要等几秒才能够删除完毕</p><p><code>docker service remove</code>这个过程是很快的，但是后台需要有一个比较复杂的操作，要看<code>service</code>有多少个容器在<code>cluster</code>里面，并且在哪台机器上面，然后再去把<code>container</code>删除，这个过程比较复杂，所以比较慢一点，但是<code>service</code>本身的删除是很快的</p><h2 id="WordPress实战"><a href="#WordPress实战" class="headerlink" title="WordPress实战"></a>WordPress实战</h2><p> 如果是用swarm来启动WordPress的话，要考虑到WordPress和mysql通信问题，这两个容器极有可能不在同一个节点上，这个其实可以用docker-compose的那个原理，只要两个容器在同一个网络上就可以进行通信</p><p>所以是先要创建一个overlay的network</p><pre><code>docker network create -d overlay demo</code></pre><p>先在manager节点服务器创建并且查看网络</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508151237.png" alt="manager节点查看网络"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508151324.png" alt="worker节点查看网络"></p><p>这里worker节点服务器是没有的</p><p>这里先去创建一个mysql的服务看一下</p><p><strong>注意：一定要是5.7及以下，因为mysql8.0有新的验证</strong></p><pre><code>docker service create --name mysql --env MYSQL_ROOT_PASSWORD=root --env MYSQL_DATABASE=wordpress --network demo --mount type=volume,source=mysql-data,destination=/var/lib/mysql mysql:5.7</code></pre><p> –env：就是环境变量</p><p>–mount：在docker run有个-v的参数来指定volume，在service就是–mount，格式是type就是volume，volume的名字就是mysql-data，destination就是文件的地址</p><p>–network：就是指定的网络名字</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508153243.png" alt="mysql创建成功"></p><p>然后ps看一下mysql这个service在哪个地方</p><pre><code>docker service ps mysql</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508153333.png" alt=""></p><p>然后发现是在manager的服务器上</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508153440.png" alt="manager节点服务器ps查看"></p><p>然后创建的应该是WordPress这个service</p><pre><code>docker service create --name wordpress -p 80:80 --env WORDPRESS_DB_PASSWORD=root --env WORDPRESS_DB_HOST=mysql --network demo wordpress</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508153813.png" alt="安装WordPress"></p><p>然后要查看一下WordPress被安装在哪个节点上了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508160412.png" alt="查看WordPress在哪个节点"></p><p>可以看到是在我的另一台worker1节点服务器上</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508160517.png" alt="worker1节点服务器"></p><p>然后输入这个节点的ip地址</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508162406.png" alt=""></p><p>则docker service之间是可以正常的访问的</p><p>而且无论你输入的是manager还是worker的节点，正常情况下输入ip地址：80端口都是可以访问WordPress的，但是因为我的服务器80端口部署着网站，所以就不再演示</p><p>在创建两个容器之前，创建了一个名为demo的network，但是在manager节点的服务器创建完之后并没有在worker服务器能够实时查看的到，但是创建完service以后，worker上的名为demo的network就可以显示了，这个过程是swarm去完成的，WordPress这个节点被分配到worker这个节点以后，要保证和manager节点进行通信的话，这个overlay的网络一定要同步，swarm这个底层的机制会自己去同步网络的创建，因为要实现多个节点之间的网络通信，肯定要通过overlay这个网络去实现</p><h2 id="集群之间的网络通信Rouing-Mesh之Internal"><a href="#集群之间的网络通信Rouing-Mesh之Internal" class="headerlink" title="集群之间的网络通信Rouing Mesh之Internal"></a>集群之间的网络通信Rouing Mesh之Internal</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509110347.png" alt="Rouing Mesh的两种体现方式"></p><p>上面的那个实战<code>WordPress</code>有两个<code>service</code>组成，一个<code>WordPress</code>，一个<code>mysql</code>，通过<code>service</code>的创建，把它部署到<code>swarm  cluster</code>里面</p><p>这两个<code>service</code>是在两个不同的节点上面的，注意这两个节点之间是需要相互通信的，这个就涉及到<code>DNS服务发现</code>的问题</p><p>通过<code>docker-compose</code>去部署一个app的话，如果app的<code>service</code>，如果他们连接到了一个网络上面去，他们之间就可以通过<code>service</code>的名字去相互访问的，底层是通过<code>DNS服务发现</code>去实现的，这个是<code>docker-compose</code>在单机的情况下</p><p>如果是在<code>swarm</code>的<code>cluster</code>里面，<code>service</code>是在不同的节点上面的，他们之间也是可以通过<code>service</code> 的名字去通信，这个肯定也有<code>DNS</code>的功劳在里面，对于<code>swarm</code>来讲，有内置的<code>DNS服务发现</code>的功能在里面 ，<code>service</code>之间如果是连到一个<code>overlay</code>的网络上面，然后就可以在<code>overlay</code>这个网络上面的所有<code>service</code>添加DNS的记录，通过DNS记录呢就可以得到他的IP地址，然后就可以访问这个服务了，但是实际上来讲，DNS的名字呢就是<code>service</code>的名字，但是对应的DNS记录后面的IP并不是这个<code>service</code>所在容器的<code>IP</code>，而是有一个虚拟的IP地址叫做<code>VIP</code>，为什么会这样呢，如果<code>service</code>有<code>scale</code>（即有横向的拓展），<code>service</code>有<code>scale</code>来说不一定在哪个节点上面，可能是因为某个节点进程的service down掉了，可能会在另一个节点上重新启动一个，这个时候IP地址都变了，或者说<code>scale</code>的时候有很多个<code>service</code>，对应着很多个IP地址，如果是在<code>DNS</code>里面，通过真实的IP地址去标识的话，这个就是很不稳定的，这个时候就可以通过虚拟的IP来解决这个问题（即<code>service</code>会分配一个<code>虚拟的IP</code>，而这个<code>IP</code>是不会变的），但是这个<code>虚拟IP</code>背后指的实际的IP，这个呢就是通过<code>LVS</code>来实现的，下面通过一个实验来证明</p><h3 id="确定不是真实的IP地址"><a href="#确定不是真实的IP地址" class="headerlink" title="确定不是真实的IP地址"></a>确定不是真实的IP地址</h3><p>（1） 首先要要确保有一个名为<code>demo</code>的<code>overlay</code>的<code>network</code>，如果没有就通过以下的命令去创建一个</p><pre><code>docker network create -d overlay demo</code></pre><p>（2） 接着创建一个名为whoami的service（是一个web服务，访问会返回容器的host name）</p><pre><code>docker service create --name whoami -p 8000:8000 --network demo -d jwilder/whoami</code></pre><p>（3） 看一下这个服务运行在哪个容器</p><pre><code>docker service ps whoami</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508171352.png" alt=""></p><p>（4） 可以看到是在manager的容器上面</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508171449.png" alt=""></p><p>（5） 输入这个ip地址+端口看看</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508171546.png" alt=""></p><p> （6）再创建一个service也连接到这个名为demo的network上面</p><pre><code>docker service create --name client -d --network demo busybox sh -c &quot;while true;do sleep 3600;done&quot;</code></pre><p>（7）创建好之后查看client这个service的信息</p><pre><code>docker service ls</code></pre><pre><code>docker service client</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508172017.png" alt=""></p><p>（8）查看这个服务的节点服务器</p><pre><code>docker ps</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508172042.png" alt=""></p><p>（9）进入这个容器<code>ping</code> <code>whoami</code>的这个<code>service</code></p><pre><code>docker exec --it 6ead sh</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508172218.png" alt=""></p><p>可以得出结论，不仅仅是可以<code>ping</code>的通的，而且<code>ping</code>的地址不是真实的IP地址而是<code>10.0.0.49</code></p><h3 id="确定地址不会改变"><a href="#确定地址不会改变" class="headerlink" title="确定地址不会改变"></a>确定地址不会改变</h3><p>上面已经得出结论ping的IP地址不是真实的IP</p><p>（1）这里再使用<code>scale</code>进行一次横向拓展</p><pre><code> docker service scale whoami=2</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508172559.png" alt=""></p><p>（2）查看部署到哪个节点了</p><pre><code>docker service ps whoami</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508172646.png" alt=""></p><p>（3）进入容器查看真实的DNS地址</p><p>可以从图中看到已经部署了两个容器,然后再进入容器里面</p><pre><code>docker exec -it 6ead sh</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508173351.png" alt=""></p><p>这个ping的IP和上面的居然还是一样的，还是<code>10.0.0.49</code></p><p>有两个whoami的service，它到底ping的是谁呢</p><p>这个<code>10.0.0.49</code>并不是任何一个容器的地址，其实是一个<code>VIP（virtual IP）</code></p><p>这里因为跟视频的操作有冲突，可能是版本不同，所有nslookup whoami没有反应</p><p>如果是按照视频中的操作的话，<code>nslookup whoami</code>会返回<code>10.0.0.49</code></p><p>如果<code>scale</code>了两个<code>whoami</code>，那么<code>nslookup tasks.whoami</code>会有两个地址，如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508183052.png" alt=""></p><p>这两个才是真实的容器地址</p><p>同理，如果<code>scale</code>横向拓展成三个，再取得<code>scale tasks.whoami</code>，就会返回三个记录</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508183327.png" style="zoom:67%;" /><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508183306.png" alt=""></p><p>这三个就是真实的<code>ip</code></p><p>如果是<code>ping whoami</code>的话返回的肯定只是唯一的结果，是视频中<code>service</code>的<code>VIP``10.0.0.7</code></p><p>而虚拟的IP会跟真实的IP有一个web关系，就通过这个web关系去找到<code>service</code>的实际ip地址</p><p>然后再去访问一下<code>whoami</code>的服务，会发现每一次访问得到的结果都是不一样的</p><p>原因如下：</p><p>首先<code>whoami</code>在三个节点上都有运行</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508202144.png" alt=""></p><p>然后访问<code>whoami</code>的DNS</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200508202313.png" alt=""></p><p>背后是有三个IP地址的</p><p>（4）测试负载均衡</p><p>进入容器后下载一下whoami，查看每次的host是否相同</p><p>每次访问视频里面的10.0.0.7，都会做一次负载均衡</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509100252.png" alt=""></p><p>从图中可知，每次的访问的得到的结果都不一样，是因为<code>swarm</code>部署到三个节点，再访问的话每三次返回的值都是不一样的</p><p>其中负载均衡都是通过<code>LVS</code>去实现的 ，整体架构如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509111935.png" alt=""></p><p>访问web的时候访问的是那个VIP，VIP如何映射到具体的container的IP呢，这个就是通过LVS去实现的，LVS的全称为Linux Virtual Server，如果在谷歌搜索LVS Keepalived配置，这两个东西可以部署一个高可用的负载均衡配置</p><p>两台web service和一台client service都连接到同一个overlay的网络，他们分别位于不同的swarm节点上面，client访问web的时候是通过VIP去访问的，VIP会自动负载均衡到每一个service节点上面，这个就是internal Load Balancing，具体过程如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509112515.png" alt=""></p><p>这张图的意思就是在client访问外边的service的时候，过程是DNS把service name解析成一个具体的VIP，VIP的话比如VIP去访问8000端口，那么具体会通过iptables以及IPVS（LVS）去做负载均衡，负载均衡到不同的service节点上去</p><h2 id="集群之间的网络通信Rouing-Mesh之Ingress"><a href="#集群之间的网络通信Rouing-Mesh之Ingress" class="headerlink" title="集群之间的网络通信Rouing Mesh之Ingress"></a>集群之间的网络通信Rouing Mesh之Ingress</h2><p>Ingress网络呢，就是service有绑定端口，比如说WordPress是绑定的80端口，whoami绑定的是8000端口。，但是呢service虽然只是在swarm的部分cluster节点上运行，但是呢可以在swarm的任何节点上通过端口去访问到这个服务，这个是就是Ingress</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509113821.png" alt=""></p><p> 这个ingress network其实之前的实验是有个现象的：把WordPress这个服务部署到swarm cluster里面，也就是只在一个cluster节点上，web服务暴露一个端口8080，但是在swarm cluster的任何节点上访问8080，都可以访问到WordPress ，这个就是ingress network去实现的</p><p>ingress network的作用就是，当去任何一台swarm节点上访问端口服务的时候，会把服务通过本节点的 IPVS（IPV6）去通过LVS去load balance到真正具有service的节点上面，比如图中的访问docker host3上的8080，但是docker host3上面肯定是没有这个service</p><p>但是可以通过ipvs把请求转发到另外两台具有service的docker host上面去，然后再把response返回，这个就是ingress network的一个主要的现象</p><p> 就想curl whoami，每次访问得到的结果都是不一样的，即便是在没有whoami的service的服务器，curl whoami也是照样可以返回结果</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509150834.png" alt=""></p><p>那么是为什么即使是在没有部署whoami的host上面，还是可以继续访问8000端口得到结果呢，这里可以通过看看iptables看看转化规则</p><pre><code>sudo iptables -nL -t nat</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509152459.png" alt=""></p><p>红线这行的意思就是访问8000端口，就可以把端口转发到172.19.0.2:8000地址上</p><p>然后先看看本地端口的情况</p><pre><code>ip a</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509152800.png" alt=""></p><p>可以看到两个标注的地方是同一个地址的</p><pre><code>brctl show</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509152916.png" alt=""></p><p>可以看到这个docker_gwbridge连接的interface有两个</p><p>看一下network的情况</p><pre><code>docker network lsdocker network inspect docker_gwbridge</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509153118.png" alt=""></p><p>而得到的结果中可以看到这个就是刚刚转发后的地址</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509153225.png" alt=""></p><p>但是端口转发后ingress-sbox后悔怎么样呢，这里就要先进到ingress-sbox里面看看</p><pre><code>sudo ls /var/run/docker/netnsnsenter --net=/var/run/docker/netns/ingress_sbox</code></pre><p> <img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509153511.png" alt=""></p><p>这里是因为我用的是paly with docker，所以是进不去，正常情况下进去的情况是这样的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509153755.png" alt=""></p><p>进去后角色就变成了root</p><p>整体情况如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509153916.png" alt=""></p><p>数据包 通过default_gwbridge转发到了一个叫做ingress-sbox里面，ingress-sbox这个其实是一个network inspect</p><p>在ingress-sbox里面通过iptables和IPVS（LVS）就可以看到数据被正确的转发到了另外一个host上面去，通过的网络就是ingress 的overlay的这个网络，经过vxlan的这个封装去到另一台机器上面</p><p>数据包进入到淡绿色框框里面了，要通过防火墙去看一下数据包的数据运行情况</p><pre><code>iptables -nL -t mangle</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509160221.png" alt=""></p><p>标注的地方就是给8000端口做了一个mark，这个其实就是做负载均衡的，是要通过lvs把去往8000端口的数据包呢做一个load balance来转换到具体实际的ip地址</p><p>继续去演示一下LVS</p><pre><code>yum install ipvsadmipvsadm -l</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509161455.png" alt=""></p><p>可以从图中看到做了一次load balance，选择了这两个地址，这两个地址就是真实IP地址</p><h2 id="DockerStack部署wordpress"><a href="#DockerStack部署wordpress" class="headerlink" title="DockerStack部署wordpress"></a>DockerStack部署wordpress</h2><p>Docker-compose是在本机上进行开发的工具和只能在本地进行部署的，在swarm里面不是单机的，是一个cluster，这里演示如何在swarm上面部署一个WordPress</p><p>docker- compose3版本中只增加了一个deploy命令</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509164117.png" alt="">    deploy支持的写法如下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509164220.png" alt=""></p><p>deploy之下有很多个子命令</p><h3 id="ENDPOINT-MODE"><a href="#ENDPOINT-MODE" class="headerlink" title="ENDPOINT_MODE"></a>ENDPOINT_MODE</h3><p>这个是指明endpoint的模式</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509164338.png" alt=""></p><p>这个有两种的取值方式，默认是使用VIp</p><p>第一种是VIP，也就是虚拟的IP，也就是上面提到的</p><p>第二种是dnsrr，也就是不使用虚拟的IP了，直接使用service的IP地址，但是service的IP地址肯定是有很多个 ，特别是使用scale拓展之后，每个service都有自己的IP地址，使用dnsrr的时候，就不通过ip地址去访问，通过dns的时候会帮我们去做一个robin（负载均衡的一种策略，如果是service有三个IP地址去循环使用）</p><h3 id="LABELS"><a href="#LABELS" class="headerlink" title="LABELS"></a>LABELS</h3><p>这个是一个帮助描述的一个信息，类似一个key-value的形式</p><h3 id="MODE"><a href="#MODE" class="headerlink" title="MODE"></a>MODE</h3><p>这个有两种，一种是global，一种是replicated，区别在于global的cluster只有一个（即不能做横向拓展，就是不能用scale命令去拓展）。第二种是replicated，这个刚刚好相反，这个是mode的默认值</p><h3 id="PLACEMENT"><a href="#PLACEMENT" class="headerlink" title="PLACEMENT"></a>PLACEMENT</h3><p>这个主要是为了限制service的条件，比如限制节点的角色为manager</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509170547.png" alt=""></p><p>如图限制角色为managr，则db这个service就只会部署到manager上面</p><h3 id="REPLICAS"><a href="#REPLICAS" class="headerlink" title="REPLICAS"></a>REPLICAS</h3><p>这个是mode设置成replicated的时候，就可以在初始化的时候指定需要几个replicas，比如说图中的6个，那么就会部署6个service</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509170938.png" alt=""></p><h3 id="RESOURCES"><a href="#RESOURCES" class="headerlink" title="RESOURCES"></a>RESOURCES</h3><p>这个很简单就是做一些资源的限制，比如cpu啊memory啊。或者是做一个保留，去做一个优先保留cpu、memory，可以优先的去使用这些资源</p><h3 id="RESTART-POLICY"><a href="#RESTART-POLICY" class="headerlink" title="RESTART_POLICY"></a>RESTART_POLICY</h3><p>这个如果是某个service因为某种原因停止了，那么是否需要去重启，重启的条件是什么，比如延时啊、最大重启的次数什么的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509171221.png" alt=""></p><h3 id="UPDATE-CONFIG"><a href="#UPDATE-CONFIG" class="headerlink" title="UPDATE_CONFIG"></a>UPDATE_CONFIG</h3><p>做一些配置，这个配置可以用于对service进行更新的时候遵循的原则，比如并行的数量</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509171343.png" alt=""></p><p>如上图，对service进行update的时候，有两个replicas，如果parallelism为1，delay为10s，那么意思就是每个更新的间隔都是10s</p><h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p>对比之前单机版的compose文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509171806.png" alt=""></p><p>首先如果是在swarm上面因为可能不在一台机器上面，所以就不能使用bridge网络了，要改成overlay</p><p>其次对mysql是有要求的，mysql只能有一台机器，不能够去做横向拓展，所以mode要改成global，而且还有额外的要求只能部署在manager节点上面</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509172058.png" alt=""></p><p>对于WordPress呢，首先是要可以横向拓展的，并且初始化replicated要等于3</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509172320.png" alt=""></p><p>第三个参数是RESTART_POLICY，重启或者是失败的情况下要设置一些参数</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509172517.png" alt=""></p><p>最后是要设置更新的策略</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509172624.png" alt=""></p><p>这里进入正题，在swarm模式下使用docker-compose去部署，命令是不同的</p><pre><code>docker stacks</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509173213.png" alt="docker stacks命令"></p><p><code>docker stack</code>的命令比较简单</p><p><code>deploy</code>是通过命令去部署一个<code>stack</code>，这个<code>stack</code>就是一个<code>service</code>，<code>service</code>是<code>docker.compose.yml</code>的文件里面去自定义的</p><p>看看<code>stack</code>的命令，可以看出是要给一个<code>stack</code>取一个名字</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509173424.png" alt=""></p><p>这里把<code>stack</code>取名为<code>WordPress</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509173611.png" alt=""></p><p>紧接着是<code>--compose-file</code>后面要接一个文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509173927.png" alt=""></p><p>如图创建成功</p><p><code>wordpress_my-network</code>这个前缀<code>wordpress_</code>就是前面取的<code>stack</code>的名字</p><p>然后查看一下<code>stack</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509174050.png" alt=""></p><p>再看一下细节</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200509174121.png" alt=""></p><h2 id="部署投票应用"><a href="#部署投票应用" class="headerlink" title="部署投票应用"></a>部署投票应用</h2><p>使用swarm部署投票应用的话是跟compose不同的</p><p>这里的image一定拉取才行不能通过build</p><h2 id="Docker-Secret管理和使用"><a href="#Docker-Secret管理和使用" class="headerlink" title="Docker Secret管理和使用"></a>Docker Secret管理和使用</h2><p> 上面的docker-compose.yml文件，如果要连接数据库的之类的话， 就需要添加密码，但是如果是生产环境的话，肯定是不可以把密码这么明显的信息放到文件里面的</p><p>所以肯定是希望docker可以访问到这个密码</p><p>Secret有如下几种类型</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200510202037.png" style="zoom: 50%;" /><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200510202108.png" alt="Docker Swarm架构图"></p><p>架构图如上图所示</p><p>Swarm manager和worker节点之间通信是通过TLS去加密的，加密的信息的都是寸在于manager的节点的内置分布式存储数据库里面的，而且是通过加密存储在硬盘里面的。基于这个环境之下，如果有个service想去用这个Secret的话，就比如说数据库想用一个密码，可以分配给这个service一个权限，能让他访问的到Secret就可以了</p><p>Docker Secret有如下那么几点</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200510202844.png" style="zoom:50%;" /><p>接下来查看一下secret的创建</p><pre><code>docker secret create</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511104344.png" alt=""></p><p>意思就是secret可以是从文件里面创建，也可以从标准的输入里面创建</p><p>这里先看一下从文件里面创建</p><h3 id="文件创建密码"><a href="#文件创建密码" class="headerlink" title="文件创建密码"></a>文件创建密码</h3><pre><code>vim password </code></pre><p>在里面随便写一个密码，比如我的是admin123，文件名字为password</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511105703.png" alt=""></p><p>然后再创建一个密码，password就是文件</p><pre><code>docker secret create my-pw password </code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511105958.png" alt=""></p><p>就可以创建一个secret，然后再去把这个文件删掉</p><p>然后就可以看到secret上有哪些密码了</p><pre><code>docker secret ls</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511110230.png" alt=""></p><h3 id="输入流创建密码"><a href="#输入流创建密码" class="headerlink" title="输入流创建密码"></a>输入流创建密码</h3><pre><code>echo &quot;adminadmin&quot; | docker secret create my-pw2 -</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511110409.png" alt=""></p><p>然后再看一下secret密码</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511110501.png" alt=""></p><h3 id="使用secret"><a href="#使用secret" class="headerlink" title="使用secret"></a>使用secret</h3><p>先看一下secret create的参数</p><pre><code>docker service create --help</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511112726.png" alt=""></p><p>这个行也就是说可以把secret暴露给一个service</p><pre><code>docker service create --name client --secret my-pw busybox sh -c &quot;while true;do sleep 3600;done&quot;</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511112955.png" alt=""></p><p>然后查看一下这个服务运行在哪个端口</p><pre><code>docker service lsdocker service ps clientdocker ps</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511113209.png" alt=""></p><p>看到到服务是在这台服务器上运行后，进入里面查看一下</p><pre><code>docker exec -it 容器ID sh</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511113405.png" alt=""></p><p>可以看到里面的密码就是我刚刚创建的</p><p>当然密码可以创建一个也可以创建多个，比如mysql有个root密码和普通用户的密码</p><p>这里拿mysql的看一下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511113731.png" alt=""></p><p>从图中看出是有这么一行参数来指定root密码的</p><p>然后再创建一下service</p><pre><code>docker service create --name db --secret my-pw -e MYSQL_ROOT_PASSWORD_FILE=/run/secrets/my-pw mysql</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511113951.png" alt=""></p><p>等待几分钟，创建好并且查询到之后找到这个容器</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511114355.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511114406.png" alt=""></p><p>进入这个容器查询密码</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511114700.png" alt=""></p><p>密码没错就是刚刚我创建的，然后再去执行进入mysql</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511114752.png" alt=""></p><p>密码我输入的就是admin123，如图是可以进入的，说明password生效了</p><h3 id="如何在docker-compose-yml文件使用secret"><a href="#如何在docker-compose-yml文件使用secret" class="headerlink" title="如何在docker-compose.yml文件使用secret"></a>如何在docker-compose.yml文件使用secret</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511115258.png" alt="docker-compose.yml"></p><p>这里图中标注的就是指定secret的名字和指定密码的存储位置</p><p>secret的来源有两种</p><p>一种是事先创建好了my-pw，也就是图中的写法，写好docker-compose.yml文件后，通过命令去创建即可</p><pre><code>docker stack deploy WordPress -c=docker-compose.yml</code></pre><p>另外一种是如果没有事先创建好，也可以在docker-compose.yml文件里面指定一个部分去专门定义secret</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511115521.png" alt=""></p><p>在当前的文件中也创建一个名为password的文件，在里面去指定密码，当然这种方式是肯定不推荐的，因为密码都已经保存在文件里面了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511115618.png" alt=""></p><h3 id="image更新"><a href="#image更新" class="headerlink" title="image更新"></a>image更新</h3><p>这个更新的意思是在运行的时候都进行更新，因为swarm是作用于生产环境的，也就是在swarm运行的是实际业务，当然是不可以停止几分钟去更新</p><p>这里进行一次简单的更新演示</p><p>实验前首先要确定有demo这个overlay的network</p><pre><code>docker network ls</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511150149.png" alt=""></p><p>如果没有就去创建一个</p><pre><code>docker network create -d overlay demo</code></pre><p>然后创建一个服务</p><pre><code>docker service create --name web --publish 8080:5000 --network demo xiaopeng163/python-flask-demo:1.0</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511151023.png" alt=""></p><p>注意这个只是1.0的版本，下面是演示如何更新到2.0版本</p><p> （1） 首先要对业务进行一个拓展，因为要停掉一个去重新创建，但是又不能让业务中止</p><pre><code>docker service scale web=2</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511152101.png" alt=""></p><p>（2） 为了证明服务没有中断，这里在work节点上写一个脚本不停地访问8080端口</p><pre><code>sh -c &quot;while true;do curl 127.0.0.1:8080&amp;&amp;sleep 1;done&quot;</code></pre><p>（3） 在manager使用service update</p><p>先看一下参数</p><pre><code>docker service update --help</code></pre><p>可以更新很多</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511152922.png" alt=""></p><p>比如说可以更新密码、更新端口、更新镜像等，这里就是要更新镜像</p><pre><code>docker service update --image xiaopeng163/python-flask-demo:2.0 web</code></pre><p>然后服务就已经开始更新了，这个时候就可以回去work节点查看是否更新成功</p><p>这个时候会出现如下状况</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511155028.png" alt=""></p><p>因为只更新了一个，另外一个是正在更新，等全部更新完之后就可以看到全部都是2.0了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511155130.png" alt=""></p><p>此时看看web服务的详情，会发现1.0的版本已经shutdown</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511155229.png" alt=""></p><p>说明更新是成功的</p><p>但是这个有个很严重的问题就是1.0和2.0的版本在更新的时候是并存的，这个是很有问题的</p><h3 id="端口更新"><a href="#端口更新" class="headerlink" title="端口更新"></a>端口更新</h3><pre><code>docker service update --publish-rm 8080:5000 --publish-add 8088:5000 web</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200511155838.png" alt=""></p><p>这个时候发现原来的端口不能用了，端口改成8088了</p><h3 id="docker-compose-yml更新"><a href="#docker-compose-yml更新" class="headerlink" title="docker-compose.yml更新"></a>docker-compose.yml更新</h3><p>如果是用过docker stack去更新的话，只需要改掉对应的地方即可，因为docker stack是没有update参数的</p><p>改完之后再docker stack deploy -c=docker-compose.yml即可</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker学习笔记四</title>
      <link href="/2020/05/06/docker-xue-xi-bi-ji-si/"/>
      <url>/2020/05/06/docker-xue-xi-bi-ji-si/</url>
      
        <content type="html"><![CDATA[<blockquote><p>总结慕课网docker课程的学习总结，本篇总结了docker compose的理念和操作</p></blockquote><h2 id="compose是什么"><a href="#compose是什么" class="headerlink" title="compose是什么"></a>compose是什么</h2><p>如果一个app，里面有多个容器组成，比如Django项目，就要部署mysql、redis等，一个docker image就要创建多个container，每个单独的配置还是不一样的，这样弄的话会使得docker变成十分的麻烦，docker compose就是一个批处理的工具，compose可以在一个文件里面定义一个文件，这个文件定义了这个app的所需要的container，然后再用一条命令定义所有容器的启动</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506154306.png" alt=""></p><p>这个yml文件有个默认的名字：docker-compose.yml，文件里面定义了三个重要的概念</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506154341.png" alt=""></p><p>docker compose是根据docker的更新而更新的，至我写这个博客的时间，已经有三个主要的版本了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506154735.png" alt=""></p><p>version2和version3都可以用，version3是主流使用的，version1已经被淘汰了</p><p>不同的docker compose版本对应着不同的docker版本，不同版本之间会有差异</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506154854.png" alt=""></p><p>version的版本只能用于单机（所有的容器都只能在同一台主机上面），version3可以用于多机（默认都是把所有的容器部署在同一台机器上面，而且可以把一个app的不同容器部署在不同的docker host上面，会用到swam）</p><p>services服务的概念如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506155337.png" alt=""></p><p>第一条的意思是docker contaer可以通过dockerfile build来创建，也可以通过从docker hub 拉去下来的容器run来创建</p><p>第二条的意思是在docker run可以指定的参数，都可以在docker compose体现出来（比如说定义volumes、networks等的参数，然后去引用）</p><p>比如下图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506155728.png" alt="第一种"></p><p>这一种是从docker hub去拉取的</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506155820.png" style="zoom:67%;" /><p>这一种呢的docker image不是从docker hub去拉取的，是从本地build出来的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506160332.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506160401.png" alt=""></p><p>这里把上一章的WordPress使用compose去运行的话</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506183210.png" alt=""></p><p>这里定义了两个services，一个叫WordPress，一个叫mysql，里面的networks指定的my-bridge就是引用最下面的</p><p>这个就是一个完整的docker compose</p><h2 id="使用docker-compose文件"><a href="#使用docker-compose文件" class="headerlink" title="使用docker compose文件"></a>使用docker compose文件</h2><p>首先是要安装docker compose，这个是docker的一个工具，如果是docker for mac或者是docker for window，默认是安装好的，而对于linux来说，安装docker都是单独安装的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506205024.png" alt="linux安装compose步骤"></p><p>只需要如上图的两步即可把compose安装完毕</p><p>如图即是安装成功</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506205146.png" alt=""></p><p>使用<code>docker-compose up</code>默认寻找的就是<code>docker-compose.yml</code></p><p>这个文件可以直接找官网的案例文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507105103.png" alt="docker-compose官网案例文件"></p><pre><code>docker-compose up</code></pre><p>如果不是这个名字的话也可以通过<code>-f</code>参数来指定文件</p><pre><code>docker-compose -f docker-compose.yml up</code></pre><p>如下所示即是用compose来启动WordPress和mysql容器</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506205713.png" alt=""></p><p>其余的命令在docker也可以查询到</p><p>主要的命令介绍如下</p><pre><code>#停止并且删除掉compose所有的容器docker-compose down</code></pre><pre><code>#compose在后台执行，不打印logsdocker-compose ip -d</code></pre><pre><code>#查询compose所有的imagedocker-compose images</code></pre><pre><code>#compsoe的execdocker-compose exec +compose的应用名字+bash#比如docker-compose exec mysql bash</code></pre><pre><code>#docker-compose builddocker-compose up其实是如果本地没有image，那么就是先build再up，就相当于docker-compose build -&gt;docker-compose up如果是services的Dockerfile有了变化，那么如过要获取最新的images就要先build再up</code></pre><h2 id="如果是使用build的compose文件"><a href="#如果是使用build的compose文件" class="headerlink" title="如果是使用build的compose文件"></a><strong>如果是使用build的compose文件</strong></h2><p>假如是不是直接使用镜像，而是通过build来创建一个镜像的话</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507115549.png" alt=""></p><p><code>context：</code>就是<code>dockerfile</code>的位置，<code>dockerfile：</code>后面制定的是<code>dockerfile</code>的名字</p><h2 id="docker-compose的拓展"><a href="#docker-compose的拓展" class="headerlink" title="docker-compose的拓展"></a>docker-compose的拓展</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507180503.png" alt="文件结构"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507180514.png" alt="app.py"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507180529.png" alt="docker-compose.yml"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507180542.png" alt="Dockerfile"></p><p>此外，还可以对docker-compose进行拓展</p><p>先要把docke-compose里面的端口删掉</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507154443.png" alt=""></p><p>然后执行</p><pre><code>docker-compose up --scale web=3 -d</code></pre><p> 执行后会有三个启动的web容器，每个容器都是指向同一个redis数据库</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507154623.png" alt=""></p><p>本质上就类似于负载均衡，如下图所示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507161945.png" alt=""></p><p>也就是可以把外界的访问量平均的分到多个web服务器上去</p><h2 id="负载均衡模拟"><a href="#负载均衡模拟" class="headerlink" title="负载均衡模拟"></a>负载均衡模拟</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507162943.png" alt="文件结构"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507163001.png" alt="app.py"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507163015.png" alt="docker-compose.yml"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507163033.png" alt="Dockerfile"></p><p> 然后把整个文件夹上传到服务器</p><p>执行命令</p><pre><code>docker-compose up -d</code></pre><p>然后输入服务器的ip地址+<code>:8000</code>查看内容</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507175140.png" alt=""></p><p>然后再创建三个web</p><pre><code>docker-compose up --scale web=3 -d</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507175255.png" alt="第一次输入地址"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507175314.png" alt="第二次输入地址"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507175334.png" alt="第三次输入地址"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507175351.png" alt="第四次输入地址"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507175405.png" alt="第五次输入地址"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507175408.png" alt="第六次输入地址"></p><p>这里把三个web测试了两遍，可以看到每三次访问的主机地址都是不同的，可以看到是进行分流操作</p><p>而且通过<code>scale</code>参数可以快速的改变<code>web</code>服务的数量，那么就可以很轻松的在高峰访问时间和平常访问时间的资源之间的切换，可以很方便的节省服务器的资源</p><p>但是如上都是在单机上运行的，负载均衡当然不可能只在单机上运行</p><h2 id="实战：投票应用"><a href="#实战：投票应用" class="headerlink" title="实战：投票应用"></a>实战：投票应用</h2><p>整体架构如下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507181036.png" alt=""></p><p>voting app是投票的情况，restults app是实时显示投票的情况，这两个都是web应用</p><p>而voting app是一个访问量比较大的应用，所以用的是redis的缓存，java worker是取得redis的结果，并且把他写到数据库里面，results app是直接从数据库里面去获取最新的实时投票的结果的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507181718.png" alt="投票项目文件结构"></p><p>restult-app是一个angular项目，voting是一个python项目，worker是一个java项目</p><p>里面包含了三个语言的项目，每个子项目文件夹里面都包括了一个Dockerfile</p><p>再看下docker-compose.yml文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200507181839.png" alt="docker-compose.yml"></p><p>由代码看出是有5个services，voting和result两个services是要对外访问的，所以都有个front-tier，同时又要与worker、redis、db进行通信，所以又共用一个back-tier</p><p>然后直接docker-compose up进行部署即可</p><p>voting会把本地的80映射到5000，result会把80映射到5001，所以通过5000端口是投票，5001是看结果</p><p>哪怕是本地没有环境，那么直接用docker-compose也可以一次性启动多个service</p><p>docker-compose是一个本地开发的工具，不是生产环境的工具，只是为了本地开发，为了方便看部署的结果</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker学习笔记三</title>
      <link href="/2020/04/29/docker-xue-xi-bi-ji-san/"/>
      <url>/2020/04/29/docker-xue-xi-bi-ji-san/</url>
      
        <content type="html"><![CDATA[<blockquote><p>总结慕课网docker课程的学习总结</p><p>对于dockerfile中指定的volume和run -v的区别，以下这两篇文章讲的更清楚，我的这篇文章是简化了的</p><p><a href="http://dockone.io/article/128" target="_blank" rel="noopener">http://dockone.io/article/128</a></p><p><a href="http://www.mamicode.com/info-detail-2531988.html" target="_blank" rel="noopener">http://www.mamicode.com/info-detail-2531988.html</a></p></blockquote><h2 id="Docker的存储"><a href="#Docker的存储" class="headerlink" title="Docker的存储"></a>Docker的存储</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430111256.png" alt=""></p><p>container是在image之上创建的一个运行时的一个可写的层，但是在container里面写的数据是仅限于container的，如果把容器停掉或者去删除，那么里面的数据就会消失，container本身是无法保存数据的，所以docker有一个持久化存储的方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430111524.png" alt=""></p><p>之前的方法是把数据写在一个可写的层上面的，docker有个机制可以把数据复制到本地或者在本地进行存储，那么存储的数据就跟容器隔离开了</p><p>docker对于数据的存储方案有两大类</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430111817.png" alt=""></p><p>第一个意思是存储数据化的时候是映射到本地硬盘上的</p><p>第二个是在第三方上进行存储，比如远程的NAS、AWS上</p><p>volume的类型有两种</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430112108.png" alt=""></p><p>第一个是存储位置是固定的，名字是以随机的字符串去命名的</p><p>第二个是绑定挂载的，需要用参数去指定</p><h2 id="Data-Volume"><a href="#Data-Volume" class="headerlink" title="Data Volume"></a>Data Volume</h2><p>volume数据持久化的方式有两种</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430154505.png" alt=""></p><p>以docker hub官方的mysql为例</p><p>可以看到</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430113137.png" alt=""></p><p>这里演示一下如何使用mysql的volume</p><p>当然mysq肯定是要密码的，这里我设置为空</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430113307.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430113824.png" alt="错误演示1"></p><p>直接这么写是会报错的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430113850.png" alt="错误演示2"></p><p>然后看一下本地的存储</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430113918.png" alt="错误演示3"></p><p>然后删掉即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430114115.png" alt="错误演示5"></p><p>因为上面我没有设置密码为true</p><p>下图中才是正确的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430114158.png" alt=""></p><p>这个时候mysql会在本地创建一个volume</p><p>查看这个volume的详细信息</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430114805.png" alt=""></p><p>这里再创建第二个container</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430114954.png" alt=""></p><p>如果把这两个容器停止再删掉，那这个容器的volume其实还是在的，这个让容器数据得以保存，如下图所示:</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430115308.png" alt=""></p><p>但是这里还是有个问题的，比如这个volume的名字，是随机生成的不太友好，inspect的时候都要查时间来看</p><p>其实是可以起一个别名的</p><p>这里先删掉刚刚创建的两个volume</p><pre><code>docker run -d -v mysql:/var/lib/mysql --name mysql -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430115914.png" alt=""></p><p>接下来要看看这个是否生效</p><p>先查看环境</p><pre><code>docker ps</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430153320.png" alt=""></p><p>然后进入这换个环境</p><pre><code>docker exec -it mysql1 /bin/bash</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430153433.png" alt=""></p><p>然后进入mysql环境</p><pre><code>mysql</code></pre><p>然后再查看数据库</p><pre><code>show databases;</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430153508.png" alt=""></p><p>然后创建一个名为docker的数据库再退出</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430153710.png" alt=""></p><p>然后停止删除这个容器</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430153825.png" alt=""></p><p>再看看volume</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430153932.png" alt=""></p><p>然后再重新创建一个，但是volume的位置一样</p><pre><code>docker run -d -v mysql:/var/lib/mysql --name mysql2 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430154034.png" alt=""></p><p>再以同样的步骤查看容器的mysql数据库</p><p> <img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430154204.png" alt=""></p><p>可以看到docker的数据库还是存在的</p><h2 id="volume-加参数-v-和不加的区别"><a href="#volume-加参数-v-和不加的区别" class="headerlink" title="volume 加参数-v 和不加的区别"></a>volume 加参数-v 和不加的区别</h2><p>上面的演示是在<code>dockerfile</code>写好了<code>volume</code>的基础上，<code>run</code>加参数和不加参数的区别</p><p>这里重新演示一下</p><p><code>mysql</code>本身是在<code>dockerfile</code>指定了<code>volume</code>目录的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430162426.png" alt="mysql dockerfile"></p><h3 id="dockerfile加了参数，但是run不指定"><a href="#dockerfile加了参数，但是run不指定" class="headerlink" title="dockerfile加了参数，但是run不指定"></a>dockerfile加了参数，但是run不指定</h3><pre><code>docker run -d --name mysql1 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql</code></pre><p>然后再查看，可以看到并没有<code>volume</code>的地址，而是在<code>/var/lib/docker/volumes/</code>目录之下绑定一个匿名卷</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430162723.png" alt=""></p><h3 id="docker加了参数，run也指定地址"><a href="#docker加了参数，run也指定地址" class="headerlink" title="docker加了参数，run也指定地址"></a>docker加了参数，run也指定地址</h3><pre><code>docker run -d -v mysql:/var/lib/mysql --name mysql2 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql</code></pre><p>然后再查看详细信息，可以看到<code>volume</code>的地址就为<code>dockerfile</code>和<code>run -v</code>指定的目录</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430163014.png" alt=""></p><h3 id="docker加了参数，run指定地址与dockerfile不同"><a href="#docker加了参数，run指定地址与dockerfile不同" class="headerlink" title="docker加了参数，run指定地址与dockerfile不同"></a>docker加了参数，run指定地址与dockerfile不同</h3><pre><code>docker run -d -v mysql:/var/lib/mysqltest --name mysql -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430174259.png" alt=""></p><p>这个情况比较复杂，对于我的这个版本来说，如果<code>run -v</code>和<code>dockerfile</code>指定的<code>volume</code>目录不同，会创建两个volume文件</p><p>一个是我指定名字的，一个是随机生成的名字，目录的话都是在<code>/var/lib.docker/volumes/</code></p><h2 id="Bind-Mounting"><a href="#Bind-Mounting" class="headerlink" title="Bind Mounting"></a>Bind Mounting</h2><p>这个与Data volume区别是，Data volume需要在dockerfile定义volume目录，，而Bind Mounting不需要，这个只需要在允许容器run -v的时候加上映射的参数，如下所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430175045.png" alt=""></p><p>这里视频中拿的是Nginx作为案例，是用80端口进行启动</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430175749.png" alt=""></p><p>如图查看-v后面接的是映射的目录，把当前的目录，映射为dockerfile的workdir目录 <img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430180527.png" alt=""></p><p>这种方法就是把容器的数据和服务器本地的数据做一个映射，这样数据就可以同步了，如下所示，在容器里面创建了一个test.txt文件，然后退出查看linux本机的目录也同样会生成一个test.txt文件</p><p><img src="D:%5Cworkplace%5Cblog%5Csource_posts%5Cupload%5Cimage-20200505200547603.png" alt=""></p><p>如果是在linux本机把test.txt文件内容添加一个abc，那么容器内的文件应该也会同样的修改</p><p><img src="D:%5Cworkplace%5Cblog%5Csource_posts%5Cupload%5Cimage-20200505200742792.png" alt=""></p><h2 id="实战Bind-Mounting"><a href="#实战Bind-Mounting" class="headerlink" title="实战Bind Mounting"></a>实战Bind Mounting</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430181255.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430181322.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430181549.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430181603.png" alt=""></p><p>最后把docker的5000端口映射到本地的80端口上，然后就可以通过本地的127.0.0.1访问这个服务了 </p><p>然后就可以在本地运行了，但是这样的话如果是要修改了项目的代码，那么就要重新的build，下面介绍如何使用bind mounting去进行文件的实时修改</p><p>这里先把container删除了，然后再执行一次运行的命令，-v 把本地的文件跟docker container的工作目录文件夹进行一次映射</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200430181732.png" alt=""></p><p>然后就可以把本地目录映射到容器的/skeleton目录下</p><p>然后只要本地的文件保存了，那么docker里面的容器就会同步的修改，与之同时的运行的项目也会对应的改变</p><h2 id="实战WordPress"><a href="#实战WordPress" class="headerlink" title="实战WordPress"></a>实战WordPress</h2><p>先创建mysql数据库，mysql的数据库如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506105703.png" alt="mysql image的参数"></p><p>先创建一个mysql的容器</p><pre><code>docker run -d --name mysql -v mysql-data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=wordpress mysql:5.7</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506153410.png" alt="创建mysql容器"></p><p><strong>mysql8.0的登录访问是要配置一些东西的，而mysql5.7及以下都是可以直接登录</strong></p><p>WordPress的使用数据库的参数如下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506105710.png" alt="WordPress的image参数"></p><p>这里的mysql就是容器的名字</p><pre><code>docker run -d -e WORDPRESS_DB_HOST=mysql:3306 --link mysql -p 8080:80 wordpress</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200506110449.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker学习笔记二</title>
      <link href="/2020/04/29/docker-xue-xi-bi-ji-er/"/>
      <url>/2020/04/29/docker-xue-xi-bi-ji-er/</url>
      
        <content type="html"><![CDATA[<blockquote><p>总结慕课网docker课程的学习总结，本篇介绍了docker的网络配置部分</p></blockquote><h2 id="docker网络"><a href="#docker网络" class="headerlink" title="docker网络"></a>docker网络</h2><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429172739.png" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker学习笔记一</title>
      <link href="/2020/04/27/docker-xue-xi-bi-ji-yi/"/>
      <url>/2020/04/27/docker-xue-xi-bi-ji-yi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>总结慕课网docker课程的学习总结，本篇总结了docker镜像与容器的操作</p></blockquote><h2 id="docker总体介绍"><a href="#docker总体介绍" class="headerlink" title="docker总体介绍"></a>docker总体介绍</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427180512.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427180559.png" alt=""></p><p><code>docker</code>整体就是一个<strong>c/s</strong>的架构</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427180706.png" alt="client和server的版本"></p><p>而client和dockerd中间是通过rest api server之间去通信的，dockerd比如是镜像、容器之类的管理 </p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427180953.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427181012.png" alt="docker整体架构"></p><p><code>client</code>可以跟<code>docker_host</code>在同一台机器上，可以在不同机器上通过网络去连接，因为<code>docker_host</code>有一个<code>restful api</code>供<code>client</code>去使用</p><p><code>docker_host</code>主要有两个，一个是镜像一个是容器</p><p>最后那个<code>registry</code>可以理解为跟<code>github</code>一样的公共存储服务器，可以把<code>images</code>存储到上面去 </p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427181849.png" alt=""></p><p><code>docker</code>不是一个完全创新的技术，因为底层全部是依赖于<code>linux</code>存在于好多年的技术，比如说<code>namespaces</code>本来就是<code>linux</code>的一个隔离技术，有独立的用户空间、网络空间、进程等，然后通过<code>control groups</code>做资源的限制</p><h2 id="docker-image"><a href="#docker-image" class="headerlink" title="docker image"></a>docker image</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427183012.png" alt=""></p><p><code>linux</code>分为内核空间和用户控件</p><p>最底层那个<code>linux kernel</code>就是内核空间</p><p>用户空间就是在<code>bootfs</code>之上做的各种linux的发行版：<code>ununtu、centos、debian</code>等</p><p><code>docker</code>里面的<code>image</code>是分层的，每一层都可以添加和删除文件，并且可以组成为一个新的<code>image</code></p><p>这些发行版质保函<code>base image</code>，不包含<code>linux kernel</code>，也就是可以共享主机的<code>linux kernel</code></p><p>然后就可以在<code>base image</code>上建立新的<code>image</code>，比如安装<code>apach、Nginx</code>等，然后就会产生新的一层<code>image</code></p><p>这里看一看image的centos大小</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427184239.png" alt=""></p><p>为什么会这么小呢， 一般的发行版都要十几个G，这里因为这里的base image只包含rootfs</p><h3 id="方式一：build-image"><a href="#方式一：build-image" class="headerlink" title="方式一：build image"></a>方式一：build image</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427201310.png" alt=""></p><p>第一行是一个基础的image，也就是base image</p><p>第二行是基本的标识，标识由谁制造</p><p>第三行是命令</p><p>第四行是暴露的端口</p><p>第五行是起点程序的入口，即图中的启动redis的入口</p><p>右图中的五步就是对应着左边的每一行</p><h3 id="方式二：pull-image"><a href="#方式二：pull-image" class="headerlink" title="方式二：pull image"></a>方式二：pull image</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427201715.png" alt=""></p><p>这个其实就跟github很像了，拉取别人的镜像</p><h2 id="docker-hub"><a href="#docker-hub" class="headerlink" title="docker hub"></a>docker hub</h2><p><code>docker hub</code>是<code>docker</code>的一个相当于<code>github</code>的一个仓库</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427202912.png" alt=""></p><p>具体分为两类，一类是官方的，一类是第三方的</p><p>直接拉去镜像的话默认是最新版本</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427203030.png" alt=""></p><p>如果是要指定版本的话比如说<code>ubuntu:14.04</code></p><p>如果是第三方的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427203314.png" alt=""></p><p>第三方的会有个<strong>用户名+/image</strong>的名字</p><h2 id="创建一个自己的image"><a href="#创建一个自己的image" class="headerlink" title="创建一个自己的image"></a>创建一个自己的image</h2><p>可以先拉去一个hello-world的image</p><pre><code>docker pull hello-world</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427210730.png" alt=""></p><p>然后执行run命令</p><pre><code>docker run hello-world</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427210840.png" alt=""></p><p> 这里先安装好gcc和vim的环境</p><pre class=" language-shell"><code class="language-shell"> yum -y install gcc gcc-c++ kernel-devel yum install -y vim yum install glibc-static yum install glibc</code></pre><p>然后编辑一个C语言的hello world</p><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello world\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>然后编译成可执行的c文件</p><pre class=" language-shell"><code class="language-shell">gcc -static hello.c -o hello</code></pre><p>读取试一试</p><pre class=" language-shell"><code class="language-shell">./hello</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427212050.png" alt=""></p><p>然后创建一个Dockerfile文件</p><p>因为是在原本的base image之上安装一些新的软件，来形成一个新的image</p><p>因为这里要写的就是一个base image，所以这里不能从一个base image去安装，所以第一行要写成<code>From scratch</code></p><pre><code>From scratchADD hello /CMD [&quot;/hello&quot;]</code></pre><p>这里的<code>ADD</code>就是添加<code>hello</code>这个文件</p><p><code>CMD</code>就是执行这个可执行文件的命令</p><p>然后执行<code>build</code>命令</p><pre><code>docker build -t 373005226/hello-world .</code></pre><p>前面的是<code>docker hub</code>的<code>id</code>，后面是名字 ， <code>.</code>是指当前目录</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427213227.png" alt=""></p><p>这里还可以查看<code>image</code>的分层</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427213454.png" alt=""></p><p>第一层是添加了一个文件，这里要注意，本来第一层是<code>From scratch</code>的，但是这里显示的是ADD file，<code>From scratch</code>的意思是没有base任何的image，也就是不算是一层，所以写了三行代码只有两层</p><p>第二层是运行了一个命令</p><p>这里就可以执行命令了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200427213744.png" alt=""></p><p>成功了也就意味着<code>hello world</code> 是可以变成一个<code>container</code>去执行的</p><p><code>docker image</code>就存一个可执行的文件，运行的时候其实是共享了宿主机<code>centos7</code>的<code>kernel</code>，在<code>kernel</code>之上执行了一个hello world，虽然十分小，但是这个是docker的基础架构</p><h2 id="docker-container"><a href="#docker-container" class="headerlink" title="docker container"></a>docker container</h2><h3 id="查看容器"><a href="#查看容器" class="headerlink" title="查看容器"></a>查看容器</h3><p><strong>总结：docker container ls是查看运行中的容器，docker container ls -a是查看所有的容器</strong></p><p><code>container</code>是通过<code>image</code>去创建的，<code>image</code>本身是只读的，但是如果是要去运行程序的话，就需要一个可写的空间</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428094829.png" alt=""></p><p>就比如，<code>image</code>是一个类，<code>container</code>是类的实例</p><p><code>image</code>负责app的存储和分发的，<code>container</code>负责运行app</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428101637.png" alt=""></p><p>这里没有显示<code>hello world</code>是因为这个不是一个常驻内存的进程，打印完<code>hello world</code>就退出了</p><p>这条命令就可以显示所有的容器，包括运行的和退出的</p><pre class=" language-shell"><code class="language-shell">docker container ls -a</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428101754.png" alt=""></p><p><code>command</code>就是执行<code>hello</code>可执行文件的命令，即相当于<code>./hello</code></p><p>这里执行以下常驻进程的容器</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428102127.png" alt=""></p><p>这里会报错，因为找不到<code>latest</code>这个版本，因为我只有<code>14.04</code>版本的，以下这样子才对</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428102258.png" alt=""></p><p>这里看一下<code>container ls</code>其实还是没有的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428102352.png" alt=""></p><p>因为这里的<code>command</code>是<code>/bin/bash</code>，这个命令不会常驻内存</p><p>这里如果是要交互式的运行呢</p><pre><code>docker run -it ubuntu:14.04</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428102801.png" alt=""></p><p>这里会看到已经进入了一个<code>linux</code>环境</p><p>这里再打开一个<code>ssh</code>连接界面，然后再去看看<code>container ls</code>，这里用另一个<code>ssh</code>就可以看到有容器正在运行</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428103039.png" alt=""></p><p>什么是交互式运行呢，来看一下<code>help</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428105215.png" alt=""></p><p>即进入一个交互式的标准输出里面</p><p><code>container</code>其实就是在<code>image</code>上多了一个可写的层</p><p>这里对容器内的<code>linux</code>系统进行<code>yum</code>一些东西或者创建文件，再<code>exit</code>退出</p><p>然后就可以看到</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428112535.png" alt=""></p><p><code>container ls</code>肯定是没有东西的，因为只显示运行中的容器，<code>container ls -a</code>就可以看到刚刚编辑的容器</p><p>当然如果把修改了的容器删掉了，那么数据就不会保存</p><h3 id="演示启动、进入容器"><a href="#演示启动、进入容器" class="headerlink" title="演示启动、进入容器"></a>演示启动、进入容器</h3><p>比如我刚刚进入了一个容器中，并且下载了vim（已经下载好了的）</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429162838.png" alt=""></p><p>我先进入第一个容器，因为已经存在这个容器了，我直接启动再进入就好了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429163100.png" alt=""></p><pre><code>docker ps                                     #确定容器没有开启docker ps -a                                 #查看容器的iddocker start be22658b1be3                    #启动需要的容器docker exec -it be22658b1be3 /bin/bash        #进入这个启动了的容器，或者使用docker attach be22658b1be3也行</code></pre><h2 id="docker常用简写"><a href="#docker常用简写" class="headerlink" title="docker常用简写"></a>docker常用简写</h2><h3 id="id简写"><a href="#id简写" class="headerlink" title="id简写"></a>id简写</h3><p>如果是要删除<code>container</code>的话，可以选择删除id或者是选择名字</p><p>如果是选择id来删除的话，那么可以直接选择id就行</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428114316.png" alt=""></p><p>当然也可以不写全，直接选择能区分开来的部分也行，比如下面图中的2bd，是对于当前的数字是比较独特的，就可以直接简写</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428114515.png" alt=""></p><p><code>docker</code>有很多简写的</p><p>比如<code>docker container ls -a</code>，可以写成<code>docker ps -a</code></p><p>效果都是一样的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428114925.png" alt=""></p><p>比如说<code>rm</code>删除容器，删除命令为<code>docker contaniner rm +标识</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428122331.png" alt=""></p><h3 id="查看容器简写"><a href="#查看容器简写" class="headerlink" title="查看容器简写"></a>查看容器简写</h3><p><code>docker image ls</code>可以简写为<code>docker images</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428122450.png" alt="image-20200428122449814"></p><h3 id="删除简写"><a href="#删除简写" class="headerlink" title="删除简写"></a>删除简写</h3><p><code>docker image rm +标识</code>  是删除镜像，<code>docker rm</code>默认是删除容器，<code>docker rmi</code>是删除镜像</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428122728.png" alt=""></p><h3 id="删除多个容器"><a href="#删除多个容器" class="headerlink" title="删除多个容器"></a>删除多个容器</h3><p>假如<code>run</code>多个镜像</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428123014.png" alt=""></p><p>就可以看到启动了很多个<code>container</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428123106.png" alt=""></p><p>这个时候如果要清除掉所有的话，可能就要一个个<code>rm</code>去清理</p><p>这时候可以一键删除所有的容器</p><p>先打印出第一列的内容</p><pre><code>docker container ls -aq</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428144115.png" alt=""></p><p>这个其实相当于</p><pre><code>docker container ls -a | awk {&#39;print$1&#39;}</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428144155.png" alt=""></p><p>除了这个表头之外没有其他的不同</p><p>此时就可以通过显示的表头去一键删除</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428144404.png" alt=""></p><p>此时已经全部删除了，如果有更复杂的情况</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428144521.png" alt=""></p><p>容器有退出的有启动的，此时就可以把退出的容器筛选出来再删掉</p><p>先列举退出状态的容器</p><pre><code>docker container ls -f &quot;status=exited&quot;</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428144722.png" alt=""></p><p>然后列举出来id</p><pre><code>docker container ls -f &quot;status=exited&quot; -q</code></pre><p>最后再按照之前的方法</p><pre><code>docker rm $(docker container ls -f &quot;status=exited&quot; -q)</code></pre><p>然后就可以一键删除掉了</p><h2 id="构建自己的镜像"><a href="#构建自己的镜像" class="headerlink" title="构建自己的镜像"></a>构建自己的镜像</h2><h3 id="使用container建立镜像"><a href="#使用container建立镜像" class="headerlink" title="使用container建立镜像"></a>使用container建立镜像</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428145320.png" alt=""></p><p>这里要介绍在基于<code>image</code>之上安装了某些软件来发布自己的镜像</p><p>也就是在基于某个<code>image</code>创建一个<code>container</code>，然后再<code>container</code>里面做一些变化（安装软件等），然后把<code>container</code> <code>commit</code>成一个新的<code>image</code></p><p>这个过程命令为</p><pre><code>docker container commit</code></pre><p>因为只有container可以commit，所以也可以简写为</p><pre><code>docker commit</code></pre><p>这里先进入一个<code>image</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428145858.png" alt=""></p><p>然后再里面做一些变化</p><p>里面一开始就是没有<code>vim</code>命令的，因为我把之前的<code>container</code>删掉了</p><p>安装完之后退出查看容器，可以看到我刚刚是退出状态的<code>container</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428150044.png" alt=""></p><p>这里就是想把这个<code>container commit</code>成一个<code>image</code>，这个<code>image</code>呢是基于干净的<code>centos7</code>之外还安装好了<code>vim</code></p><p>这里可以查看就接受的参数</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428150244.png" alt=""></p><p><code>CONTAINER</code>就是<code>ls -a</code>最后那列的<code>name</code> ，然后后面接的是<code>docker</code>的<code>id+/</code>新的<code>image</code>的名字</p><p>所以全部命令为</p><pre><code>docker commit +这个容器的名字 +需要生成的镜像名字</code></pre><p>比如下面的<code>lucid_franklink</code>就是容器名字，后面的<code>373005226/centos-vim</code>是我需要生成镜像的名字</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428150607.png" alt=""></p><p>生成后会给出一个唯一的sha256值</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428150657.png" alt=""></p><p><code>tag</code>如果不指定，默认就是<code>latest</code>的</p><p>新的那个镜像跟<code>centos</code>会共享很多的层，因为我的新镜像就是基于<code>centos</code>去开发的，可在下图看出基于<code>centos</code>之上安装了<code>vim</code>的镜像多了一层119MB的层</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428150902.png" alt=""></p><p>可以看到有三层都是一样的</p><pre><code>5e35e350aded        5 months ago        /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B                  &lt;missing&gt;           5 months ago        /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B                  &lt;missing&gt;           5 months ago        /bin/sh -c #(nop) ADD file:45a381049c52b5664…   203MB </code></pre><p>因为我只安装了<code>vim</code>工具，所以只添加了一层</p><p>这个的话其实是不建立这么做的，因为别人拿到我的<code>image</code>，就不知道我的<code>image</code>是怎么产生的，如果有不安全的东西放到<code>image</code>里面，就麻烦了。</p><p>当然最推荐的方式还是通过<code>dockerfile</code>去创建，通过<code>dockerfile</code> 去<code>build</code>成一个新的<code>image</code>，别人看<code>dockerfile</code>就可以知道我执行了什么样的命令，而不用担心我在里面安装了什么的病毒</p><h3 id="推荐方法：使用dockerfile建立镜像"><a href="#推荐方法：使用dockerfile建立镜像" class="headerlink" title="推荐方法：使用dockerfile建立镜像"></a>推荐方法：使用dockerfile建立镜像</h3><p>先创建一个<code>docker-centos-vim</code>目录，然后进去</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428154220.png" alt=""></p><p>这里要思考一下<code>docker image</code>是只读的，在只读的<code>image</code>里面怎么去安装一个<code>vim</code>呢</p><p>这里先介绍命令</p><p>建立镜像为</p><pre><code>docker image build</code></pre><p>因为只有image可以build，所以也可以简写为</p><pre><code>docker build</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428145653.png" alt=""></p><p>也就是把<code>dockerfile build</code>成一个新的<code>image</code></p><p>全部命令为</p><pre><code>docker build -t +镜像的名字 .</code></pre><p>最后面的那个<code>.</code>意思是说<code>dockerfile</code>是在当前目录下的</p><p>如上<code>dockerfile</code>写好之后，再<code>build</code>一下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428155117.png" alt=""></p><p>这里可以看到图中的这一层</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428155055.png" alt=""></p><p>其实这个是在<code>build</code>的过程中生成了一个新的临时的<code>container</code>，这个就是临时<code>container</code>的<code>id</code>，然后再这个<code>container</code>里面去安装<code>vim</code></p><p> 最后会显示这几行代码</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428154954.png" alt=""></p><p>也就是说最后还会remove删掉这个临时<code>container</code>的<code>id</code></p><p>虽然说两个大致是一样的，但是还是建议去使用<code>dockerfile</code>去生成<code>image</code></p><h2 id="Dockerfile语法"><a href="#Dockerfile语法" class="headerlink" title="Dockerfile语法"></a>Dockerfile语法</h2><p>dockerfile具体看<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">官网文档</a></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428161344.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428161451.png" alt=""></p><p>因为这个安全，其次就是label</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428161617.png" alt=""></p><p>即标注image的作者、版本、描述</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428161655.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428161752.png" alt=""></p><p>需要注意的是，每一次run，对于image都会生成新的一层临时的container，所以对于image来说</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428161939.png" alt=""></p><p>worddir其实就是设定工作目录的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428162159.png" alt=""></p><p>workdir /test就是在根目录找到test文件夹，如果没有呢就创建一个，</p><p>这里其实就是进入test目录，如果没有test就创建一个然后进去，然后进入demo目录，如果没有就创建一个再进去</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428163026.png" alt=""></p><p>绝对目录的话绝对是更清晰一些，不容易出错</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428163109.png" alt=""></p><p><code>ADD</code>这个是把本地的文件添加到<code>image</code>里面，也就是之前的<code>hello</code>这个可执行文件添加进去</p><p>然后再<code>RUN</code>执行</p><p><code>ADD</code>和<code>COPY</code>的区别就是<code>ADD</code>文件到目录后可以解压，<code>COPY</code>是单纯的复制这个文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428163524.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428163632.png" alt=""></p><p><code>ENV</code>就是设置常量</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428163711.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428163821.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428163841.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428170743.png" alt=""></p><p><code>run</code>每执行一次都会创建一次<code>image layer</code>新的一层</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428170939.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428172629.png" alt=""></p><p>这两个<code>dockerfile</code>就可以看出区别</p><p>在第一个中是可以直接打印<code>hello Docker</code></p><p>在第二个中是打印出<code>hello $name</code></p><p>因为在第一个中是可以<code>shell</code>去执行命令，也就是在<code>bash</code>里面执行，所可以可以识别<code>$name</code>是一个变量</p><p>但是如果是<code>exec</code>格式呢，执行的是<code>echo</code>的这个命令，而不是在<code>shell</code>里面执行<code>echo</code>，所以这里是需要改变一下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428173058.png" alt=""></p><p>这里就要把后面的命令都改成一个命令去执行才可以，如果是分开的话是为空的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428173413.png" alt=""></p><p>如果是第一个<code>docker run [image]</code>会打印出<code>hello Docker</code></p><p>如果是第二个，<code>docker run</code>指定了其他的命令，那么就不会执行<code>CMD</code></p><p>即如果指定了命令，那么就不会执行<code>CMD</code>，此外<code>CMD</code>还可以拿来接收参数，一般的话是跟<code>ENTRYPOINT</code>一起使用</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428173740.png" alt=""></p><p>这个的话一般是把应用程序以服务的形式去运行，一般的话会拿来做后台的进程，比如说要启动数据库的服务</p><p>比如说最后一个是<code>MongoDB</code>的<code>dockerfile</code>的一部分</p><p>就是<code>copy</code>一个<code>shell</code>脚本到本地目录。然后把这个<code>entrypoint</code>作为启动的脚本来去执行</p><p><code>entrypoint</code>在一些官方的脚本启动比较多，可以当成一个服务器去运行这个容器，而不是像<code>cmd</code>一样去执行</p><h2 id="docker-image的发布"><a href="#docker-image的发布" class="headerlink" title="docker image的发布"></a>docker image的发布</h2><h3 id="上传到docker-hub"><a href="#上传到docker-hub" class="headerlink" title="上传到docker hub"></a>上传到docker hub</h3><p>上面都讲了如何做一个镜像，这里就讲如何去发布</p><p><code>docker hub</code>就是跟<code>github</code>一样的东西，可以把自己的镜像放到上面</p><p>这里我还没有创建自己的<code>image</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428180148.png" alt=""></p><p>这里先要<code>docker login</code>进去</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428180733.png" alt=""></p><p>命令也很简单</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428180842.png" alt=""></p><p><code>docker push</code>和<code>docker image push</code>是一样的，因为只能发布<code>image</code></p><p>这里跟着的参数是<code>docker push +image</code>的名字<strong>+</strong>版本</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428181028.png" alt=""></p><p>然后在<code>push</code>完毕的时候会生成一个id</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428181102.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428181115.png" alt=""></p><p>这里就会显示我刚刚的<code>image</code></p><p>但是仅仅是这样放上去的话，没有说明别人就不知道是怎么产生的，这样还不如直接放上一个<code>dockerfile</code>上去</p><p><code>dockerfile</code>才是推荐的方式</p><p>点击到这个界面</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428182906.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428183223.png" alt=""></p><p>这里可以关联<code>github</code>仓库</p><p>只要<code>github</code>仓库有个<code>dockerfile</code>，<code>docker hub</code>就可以把<code>dockerfile</code>自动<code>build</code>成<code>image</code>到<code>docker hub</code>仓库中</p><h3 id="上传到私有hub"><a href="#上传到私有hub" class="headerlink" title="上传到私有hub"></a>上传到私有hub</h3><p>当然如果是需要公司内部的<code>docker</code>仓库的话</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428202643.png" alt=""></p><p>可以使用<code>docker</code>推荐的<code>registry</code>去搭建一个</p><p>只需要按照这上面的命令搭建即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428202905.png" alt=""></p><p>两个服务器之间要可以通信，在我的服务器上已经搭建好了registry这个环境后</p><pre class=" language-shell"><code class="language-shell">telnet *.*.*.* 5000</code></pre><p>来查看是否可以正常访问</p><p>出现</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428203409.png" alt=""></p><p>即访问成功，这样就可以往私有的<code>hub</code> 来<code>push image</code>了</p><p>这里先把原来的<code>image</code>删掉，再去重新<code>build</code>一个</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428203704.png" alt=""></p><p>如图删掉我创建的<code>hello-world</code>，然后再把<code>docker hub</code>的<code>id</code>改成服务器的IP地址和端口</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428203850.png" alt=""></p><p>直接<code>push</code>上去会报错的，如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428204041.png" alt=""></p><p>因为这个是对于<code>docker</code>来说是不可信任的，要去修改一个文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428204024.png" alt=""></p><p>要在里面添加一行代码</p><pre><code>&quot;insecure-registries&quot;:[&quot;39.106.12.6:5000&quot;]</code></pre><p>如下图所示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428204254.png" alt=""></p><p>然后还需要配置一个文件</p><pre><code>sudo vim /lib/systemd/system/docker.service</code></pre><p>然后再去添加这一行代码，需要读取这个环境的文件，然后配置才能被加载</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428204456.png" alt=""></p><p>然后需要重启<code>docker</code></p><pre><code>sudo service docker restart</code></pre><pre><code>sudo systemctl daemon-reload</code></pre><p>然后就可以<code>push</code>成功了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428204831.png" alt=""></p><p>然后这里看到私有hub的服务器上</p><p>命令查看docker registry api，这里可以看到命令是<code>GET /v2/_catalog</code>，即在IP地址后添加/v2/_catalog`</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428205035.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428205130.png" alt=""></p><p>当然<code>pull</code>的原理也一样</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200428205339.png" alt=""></p><p>直接把原来的<code>images</code>删掉，然后直接按照IP地址:5000端口+项目名字回来即可</p><h2 id="对进行中的容器进行操作"><a href="#对进行中的容器进行操作" class="headerlink" title="对进行中的容器进行操作"></a>对进行中的容器进行操作</h2><p>之前都是对退出的容器进行操作，这里介绍正在运行的容器操作</p><h3 id="进入运行中的容器"><a href="#进入运行中的容器" class="headerlink" title="进入运行中的容器"></a>进入运行中的容器</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429110050.png" alt=""></p><pre><code>docker exec -it +容器的id +需要执行的命令</code></pre><h3 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429110409.png" alt=""></p><p>可以直接简写</p><pre><code>docker stop +id或者是名字</code></pre><h3 id="run指定名字"><a href="#run指定名字" class="headerlink" title="run指定名字"></a>run指定名字</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429170938.png" alt=""></p><p>这个时候就可以stop指定名字了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429110936.png" alt=""></p><p>然后可以指定名字来启动了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429111015.png" alt=""></p><h3 id="docker-inspect查看容器详情"><a href="#docker-inspect查看容器详情" class="headerlink" title="docker inspect查看容器详情"></a>docker inspect查看容器详情</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429111209.png" alt=""></p><p>可以看到这个容器的详细信息(命令、网络配置、创建时间等)</p><h3 id="logs查看容器日志"><a href="#logs查看容器日志" class="headerlink" title="logs查看容器日志"></a>logs查看容器日志</h3><p>就是查看容器的日志</p><pre><code>docker logs +容器的id</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429111358.png" alt=""></p><h2 id="CMD与ENTRYPOINT共存"><a href="#CMD与ENTRYPOINT共存" class="headerlink" title="CMD与ENTRYPOINT共存"></a>CMD与ENTRYPOINT共存</h2><p>这里拿的是stress这个linux环境下的压力测试来演示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429112212.png" alt=""></p><p>如果定义一个十分大的内存的话，最大也不能超过宿主机的内存</p><p>这里先写一个<code>Dockerfile</code>来查看</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429113021.png" alt=""></p><p>这里的<code>CMD</code>用来接收参数，因为<code>vm</code> 设定内存等参数需要重复的填写，但是又是变动的，不能用<code>ENV</code>来默认</p><p>此时直接运行的话就会出现这种情况</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429115038.png" alt=""></p><p>因为没有加上参数，只会显示命令</p><p>这个时候就可以加上参数</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200429115307.png" alt=""></p><p>这个原理就是后面的参数都是放在<code>CMD</code>里面的，这个就是<code>ENTRYPOINT+CMD</code>的方式去结合的，这个是十分的流行的</p><p><code>CMD</code>可以放上默认的参数，也可以自己的指定的参数去运行</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vagrant</title>
      <link href="/2020/04/26/vagrant-xia-zai-jing-xiang-jia-su/"/>
      <url>/2020/04/26/vagrant-xia-zai-jing-xiang-jia-su/</url>
      
        <content type="html"><![CDATA[<blockquote><p>为什么要采用Oracle VM VirtualBox+vagrant</p></blockquote><blockquote><p>因为Oracle VM VirtualBox+vagrant两个都是是免费的，而VMware本身是收费的，再加上vagrant的VMware也是收费的，不只是要支付一个费用，还要把组合的费用也给出了</p></blockquote><h2 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h2><p>首先是进入vagrant的官网</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426095524.png" alt=""></p><p>搜索到自己的镜像之后，点击这个有镜像的版本</p><p>得到如下界面后</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426095607.png" alt=""></p><p>看这个地址栏<a href="https://app.vagrantup.com/centos/boxes/7/versions/1905.1" target="_blank" rel="noopener">https://app.vagrantup.com/centos/boxes/7/versions/1905.1</a></p><p>然后对地址栏进行拼接，在后面加上<code>/providers/virtualbox.box</code></p><p>即完整的地址栏是<a href="https://app.vagrantup.com/centos/boxes/7/versions/1905.1/providers/virtualbox.box" target="_blank" rel="noopener">https://app.vagrantup.com/centos/boxes/7/versions/1905.1/providers/virtualbox.box</a></p><p>就可以下载到镜像了</p><p>此外也可以直接赋值<code>Vagrantfile</code>框框里面的配置，然后在本地取名为<code>Vagrantfile</code>，然后<code>vagrant up</code>也可以加载</p><p>当然还可以下载别人的<code>vagrant</code>的文件进行加载，比如</p><pre class=" language-shell"><code class="language-shell">$ git clone https://github.com/coreos/coreos-vagrant.git</code></pre><h2 id="安装镜像"><a href="#安装镜像" class="headerlink" title="安装镜像"></a>安装镜像</h2><h3 id="在线下载"><a href="#在线下载" class="headerlink" title="在线下载"></a>在线下载</h3><p>即如果你的网络环境恰好是能访问国外的网站</p><p>那么直接关联到他的地址即可</p><p>比如：</p><pre class=" language-shell"><code class="language-shell">$ vagrant box add centos/7 https://app.vagrantup.com/centos/boxes/7</code></pre><p>然后就会出现</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426100109.png" alt=""></p><p>然后选择自己需要方式的即可</p><p>反正我这里访问不了</p><h3 id="本地加载"><a href="#本地加载" class="headerlink" title="本地加载"></a>本地加载</h3><p>我是下载到本地进行加载</p><p>按照如上介绍的方法下载好镜像后</p><p>加载本地镜像：</p><p>–name 后面接的是镜像的名字，再后面接的是镜像的地址</p><pre class=" language-shell"><code class="language-shell">vagrant box add --name centos/7 D:\software\CentOS-7-x86_64-Vagrant-1905_01.VirtualBox.box</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426100421.png" alt=""></p><p>再输入</p><pre class=" language-shell"><code class="language-shell">vagrant box list</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426100617.png" alt=""></p><p>就可以看到镜像已经加载了</p><p>然后再进行初始化</p><pre class=" language-shell"><code class="language-shell">vagrant init centos/7</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426100854.png" alt=""></p><p>然后在这个文件下加载镜像即可</p><pre><code>vagrant up</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426101526.png" alt=""></p><p>然后执行命令ssh即可运行虚拟机了</p><pre><code>vagrant ssh</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426101703.png" alt=""></p><p>退出的命令如下</p><pre><code>exit</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426102120.png" alt=""></p><h2 id="vagrant其余命令"><a href="#vagrant其余命令" class="headerlink" title="vagrant其余命令"></a>vagrant其余命令</h2><p>查看状态</p><pre><code>vagrant status</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426102224.png" alt=""></p><p>停止命令</p><pre><code>vagrant halt</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426102320.png" alt=""></p><p>删除命令</p><pre><code>vagrant destroy</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426102533.png" alt=""></p><pre class=" language-ruby"><code class="language-ruby">    $ vagrant init <span class="token comment" spellcheck="true"># 初始化</span>    $ vagrant up <span class="token comment" spellcheck="true"># 启动虚拟机</span>    $ vagrant halt <span class="token comment" spellcheck="true"># 关闭虚拟机</span>    $ vagrant reload <span class="token comment" spellcheck="true"># 重启虚拟机</span>    $ vagrant ssh <span class="token comment" spellcheck="true"># SSH 至虚拟机</span>    $ vagrant status <span class="token comment" spellcheck="true"># 查看虚拟机运行状态</span>    $ vagrant destroy <span class="token comment" spellcheck="true"># 销毁当前虚拟机</span>    $ vagrant suspend <span class="token comment" spellcheck="true"># 挂起虚拟机</span>    $ vagrant resume <span class="token comment" spellcheck="true"># 恢复挂起状态</span>    $ vagrant ssh<span class="token operator">-</span>config <span class="token comment" spellcheck="true"># 输出ssh连接信息</span>    $ vagrant package <span class="token comment" spellcheck="true"># 打包当前运行的虚拟机的环境</span>    $ vagrant plugin <span class="token comment" spellcheck="true"># 用于安装卸载插件</span>    $ vagrant box list <span class="token comment" spellcheck="true"># 查看已添加镜像</span>    $ vagrant box remove centos<span class="token operator">/</span><span class="token number">7</span> <span class="token comment" spellcheck="true"># 删除指定镜像</span>    $ vagrant box add <span class="token string">"boxIdentity"</span> <span class="token comment" spellcheck="true"># remoteUrlorLocalFile 添加box</span></code></pre><blockquote><p>此外推荐博客：</p><p><a href="https://www.jianshu.com/p/a6457bc5436b" target="_blank" rel="noopener">https://www.jianshu.com/p/a6457bc5436b</a></p><p><a href="http://www.54php.cn/default/26.html" target="_blank" rel="noopener">http://www.54php.cn/default/26.html</a></p><p><a href="https://blog.csdn.net/nie773546179/article/details/77964407" target="_blank" rel="noopener">vagrant常见错误</a></p></blockquote><p>最后在安装好docker之后执行如下命令，否则docker不能正常使用</p><pre><code>su root # 先切换到root用户, 再执行以下命令systemctl enable docker # 开机自动启动dockersystemctl start docker # 启动dockersystemctl restart docker # 重启dokcer</code></pre><h2 id="给用户添加使用docker权限"><a href="#给用户添加使用docker权限" class="headerlink" title="给用户添加使用docker权限"></a>给用户添加使用docker权限</h2><p>因为每个权限之前都要加上一个sudo ，这样比较麻烦</p><p>如这里还建议把当前的用户添加使用docker权限</p><h3 id="vagrant"><a href="#vagrant" class="headerlink" title="vagrant"></a>vagrant</h3><pre><code>sudo groupadd dockersudo gpasswd -a vagrant dockersudo service docker restartexit    #这里需要先退出去vagrant ssh    #然后重新登录才可以生效</code></pre><h3 id="云服务器"><a href="#云服务器" class="headerlink" title="云服务器"></a>云服务器</h3><pre><code>sudo susudo usermod -aG docker ${USER}sudo service docker restart</code></pre><h2 id="Vagrantfile添加命令"><a href="#Vagrantfile添加命令" class="headerlink" title="Vagrantfile添加命令"></a>Vagrantfile添加命令</h2><p>在Vagrantfile中可以添加ssh命令，比如</p><pre class=" language-shell"><code class="language-shell">  config.vm.provision "shell", inline: <<-SHELL    sudo yum install -y yum-utils    sudo yum-config-manager  --add-repo  https://download.docker.com/linux/centos/docker-ce.repo    sudo yum-config-manager --enable docker-ce-nightly    sudo yum install docker-ce docker-ce-cli containerd.io  SHELL</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200426210134.png" alt=""></p><p>这里的命令就是<code>docker</code>的<code>centos</code>版本的安装命令，只需要<code>Vagrant up</code>启动就会自动执行</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>其实<code>vagrant</code>和<code>docker-machine</code>都是创建虚拟机的方式，只是<code>docker-machine</code>能快速创建一个带着<code>docker</code>的环境</p><p>此外如果是<code>vagrant</code>创建虚拟机，执行到这一步的时候就卡住的话</p><pre class=" language-shell"><code class="language-shell">default: SSH auth method: private key </code></pre><p>这个不一定是什么虚拟化的问题，很可能只是硬盘虚拟化错误….多试几次就可以了</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> 运维工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django优秀资源大全</title>
      <link href="/2020/04/24/django-zi-yuan-hui-zong/"/>
      <url>/2020/04/24/django-zi-yuan-hui-zong/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://github.com/haiiiiiyun/awesome-django-cn" target="_blank" rel="noopener">https://github.com/haiiiiiyun/awesome-django-cn</a></p><p>需要采用最新的资源请到原文章查看</p></blockquote><h1 id="Django-优秀资源大全。"><a href="#Django-优秀资源大全。" class="headerlink" title="Django 优秀资源大全。"></a>Django 优秀资源大全。</h1><h2 id="Awesome-Django"><a href="#Awesome-Django" class="headerlink" title="Awesome Django "></a>Awesome Django <a href="https://camo.githubusercontent.com/13c4e50d88df7178ae1882a203ed57b641674f94/68747470733a2f2f63646e2e7261776769742e636f6d2f73696e647265736f726875732f617765736f6d652f643733303566333864323966656437386661383536353265336136336531353464643865383832392f6d656469612f62616467652e737667" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/13c4e50d88df7178ae1882a203ed57b641674f94/68747470733a2f2f63646e2e7261776769742e636f6d2f73696e647265736f726875732f617765736f6d652f643733303566333864323966656437386661383536353265336136336531353464643865383832392f6d656469612f62616467652e737667" alt="Awesome"></a></h2><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><a href="https://github.com/rosarior/awesome-django" target="_blank" rel="noopener">Awesome-Django</a> 是由 <a href="https://github.com/rosarior" target="_blank" rel="noopener">Roberto Rosario</a> 发起和维护的 Django 资源列表。该列表收集了大量 Django 相关的优秀应用、项目等资源，方便了 Django 用户参考查阅。</p><p><a href="https://github.com/haiiiiiyun/awesome-django-cn" target="_blank" rel="noopener">Django 优秀资源大全</a> 则是依据 <a href="https://github.com/rosarior/awesome-django" target="_blank" rel="noopener">Awesome-Django</a> 翻译而来。也欢迎你帮助推荐和提供建议</p><ul><li>Awesome Django<ul><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#管理界面" target="_blank" rel="noopener">管理界面</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#分析" target="_blank" rel="noopener">分析</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#资源管理" target="_blank" rel="noopener">资源管理</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#认证" target="_blank" rel="noopener">认证</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#授权" target="_blank" rel="noopener">授权</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#blog-管理" target="_blank" rel="noopener">Blog 管理</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#样板" target="_blank" rel="noopener">样板</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#缓存" target="_blank" rel="noopener">缓存</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#兼容性" target="_blank" rel="noopener">兼容性</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#仪表盘" target="_blank" rel="noopener">仪表盘</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#数据科学" target="_blank" rel="noopener">数据科学</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#数据库" target="_blank" rel="noopener">数据库</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#调试" target="_blank" rel="noopener">调试</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#email" target="_blank" rel="noopener">Email</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#数据项" target="_blank" rel="noopener">数据项</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#文件传输" target="_blank" rel="noopener">文件传输</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#表单" target="_blank" rel="noopener">表单</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#gis" target="_blank" rel="noopener">GIS</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#图片处理" target="_blank" rel="noopener">图片处理</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#导入导出" target="_blank" rel="noopener">导入/导出</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#数据迁移" target="_blank" rel="noopener">数据迁移</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#移动端支持" target="_blank" rel="noopener">移动端支持</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#数据模型扩展" target="_blank" rel="noopener">数据模型扩展</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#支持处理" target="_blank" rel="noopener">支持处理</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#项目管理" target="_blank" rel="noopener">项目管理</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#报表" target="_blank" rel="noopener">报表</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#restful-api" target="_blank" rel="noopener">RESTful API</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#seo" target="_blank" rel="noopener">SEO</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#搜索" target="_blank" rel="noopener">搜索</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#安全性" target="_blank" rel="noopener">安全性</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#设置" target="_blank" rel="noopener">设置</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#存储" target="_blank" rel="noopener">存储</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#标签" target="_blank" rel="noopener">标签</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#任务队列" target="_blank" rel="noopener">任务队列</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#测试" target="_blank" rel="noopener">测试</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#缩略图" target="_blank" rel="noopener">缩略图</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#翻译" target="_blank" rel="noopener">翻译</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#视图" target="_blank" rel="noopener">视图</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#web-前端集成" target="_blank" rel="noopener">Web 前端集成</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#wiki-应用" target="_blank" rel="noopener">Wiki 应用</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#工作流" target="_blank" rel="noopener">工作流</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#所见即所得编辑器" target="_blank" rel="noopener">所见即所得编辑器</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#其它" target="_blank" rel="noopener">其它</a></li></ul></li><li>项目<ul><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#cms" target="_blank" rel="noopener">CMS</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#文档管理" target="_blank" rel="noopener">文档管理</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#项目管理" target="_blank" rel="noopener">项目管理</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#电子商务" target="_blank" rel="noopener">电子商务</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#其它" target="_blank" rel="noopener">其它</a></li></ul></li><li>资源<ul><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#图书" target="_blank" rel="noopener">图书</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#会议" target="_blank" rel="noopener">会议</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#外部文档" target="_blank" rel="noopener">外部文档</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#视频" target="_blank" rel="noopener">视频</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#网站" target="_blank" rel="noopener">网站</a></li></ul></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#工具" target="_blank" rel="noopener">工具</a></li><li><a href="https://github.com/haiiiiiyun/awesome-django-cn#贡献" target="_blank" rel="noopener">贡献</a></li></ul><h2 id="管理界面"><a href="#管理界面" class="headerlink" title="管理界面"></a>管理界面</h2><p><em>扩展管理界面，增加或增强基功能特性的相关包。</em></p><ul><li><a href="https://github.com/newpanjing/simpleui/" target="_blank" rel="noopener">django-simpleui, star:159</a> - 可用于 Django 管理界面的一个Vue+Element-ui的现代主题。</li><li><a href="https://github.com/hersonls/djamin/" target="_blank" rel="noopener">djamin, star:214</a> - Django 管理界面的一种新样式。</li><li><a href="https://github.com/django-admin-bootstrap/django-admin-bootstrap" target="_blank" rel="noopener">django-admin-bootstrap, star:468</a> - Django 管理界面的自适应皮肤。</li><li><a href="https://github.com/django-admin-bootstrapped/django-admin-bootstrapped/" target="_blank" rel="noopener">django-admin-bootstrapped, star:1360</a> - 一种基于 Twitter Bootstrap 的 Django 管理界面主题。</li><li><a href="https://github.com/ebertti/django-admin-easy" target="_blank" rel="noopener">django-admin-easy, star:70</a> - 一个关于管理界面数据项和装饰器的集合。</li><li><a href="https://github.com/fabiocaccamo/django-admin-interface" target="_blank" rel="noopener">django-admin-interface, star:75</a> - 终级管理界面，它基于现代扁平式风格，能让你通过管理界面自身定制它的主题、logo 和配色。</li><li><a href="https://github.com/django-admin-tools/django-admin-tools" target="_blank" rel="noopener">django-admin-tools, star:221</a> - 一个关于默认 Django 管理界面的扩展/工具的集合。</li><li><a href="https://github.com/pydanny/django-admin2/" target="_blank" rel="noopener">django-admin2, star:952</a> - django.contrib.admin 的一个可扩展、能适配的版本。</li><li><a href="https://github.com/elky/django-flat-theme" target="_blank" rel="noopener">django-flat-theme, star:392</a> - 可用于 Django 管理界面的一种扁平式主题。现代、清新、简洁。</li><li><a href="https://github.com/edoburu/django-fluent-dashboard/" target="_blank" rel="noopener">django-fluent-dashboard, star:166</a> - Django 项目的增强型管理面板。</li><li><a href="https://github.com/sehmaschine/django-grappelli/" target="_blank" rel="noopener">django-grappelli, star:2087</a> - 可用于 Django 管理界面的一个绚丽皮肤。</li><li><a href="https://github.com/arteria/django-hijack/" target="_blank" rel="noopener">django-hijack, star:542</a> - 允许超级用户以其他用户微分登录和操作。</li><li><a href="https://github.com/geex-arts/django-jet" target="_blank" rel="noopener">django-jet, star:791</a> - 可用于管理界面的现代模板，并增强了功能。</li><li><a href="https://github.com/viewflow/django-material" target="_blank" rel="noopener">django-material, star:1037</a> - Material 风格的 Django 表单和管理界面。是模板驱动的。</li><li><a href="https://github.com/crccheck/django-object-actions" target="_blank" rel="noopener">django-object-actions, star:162</a> - 一个 Django 应用，用于在管理界面中为数据模型添加对象工具。</li><li><a href="https://github.com/darklow/django-suit/" target="_blank" rel="noopener">django-suit, star:1226</a> - 可用于 Django 管理界面的一个现代主题。</li><li><a href="https://github.com/barszczmm/django-wpadmin/" target="_blank" rel="noopener">django-wpadmin, star:202</a> - WordPress 风格的 Django 管理界面。</li><li><a href="https://github.com/sshwsfc/django-xadmin/" target="_blank" rel="noopener">django-xadmin, star:2016</a> - 一个 Django admin 的替代器，并附带很多不错的功能特性，完全支持用插件扩展，绚丽的 UI 基于 Twitter Bootstrap。</li><li><a href="https://github.com/yawd/yawd-admin/" target="_blank" rel="noopener">yawd-admin, star:129</a> - 用于 Django 的一个管理界面（3 年未更新）。</li></ul><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p><em>网站分析或与集成网站分析服务相关的包。</em></p><ul><li><a href="https://github.com/jcassee/django-analytical" target="_blank" rel="noopener">django-analytical, star:465</a> - 用一个通用接口来集成各种分析服务，无需修改模板文件。</li></ul><h2 id="资源管理"><a href="#资源管理" class="headerlink" title="资源管理"></a>资源管理</h2><p><em>有助于管理项目资源文件的包。</em></p><ul><li><a href="https://github.com/django-compressor/django-compressor/" target="_blank" rel="noopener">django-compressor, star:1862</a> - 将通过链接及内联的 javascript 或 CSS 压缩成单个缓存文件。</li><li><a href="https://github.com/gears/django-gears/" target="_blank" rel="noopener">django-gears, star:54</a> - 编译及合并 JavaScript 和 CSS 文件。</li><li><a href="https://github.com/cobrateam/django-htmlmin/" target="_blank" rel="noopener">django-htmlmin, star:340</a> - 用于 Python 框架的 HTML 压缩工具，完全支持 HTML 5 和 Django。</li><li><a href="https://github.com/jazzband/django-pipeline" target="_blank" rel="noopener">django-pipeline, star:1141</a> - Django 的资源文件管理包。</li><li><a href="https://github.com/sergei-maertens/django-systemjs" target="_blank" rel="noopener">django-systemjs, star:41</a> - Django SystemJS 将 Javascript 的未来版本带到当前的 Django 中。(JSPM 与 Django 集成)</li><li><a href="https://github.com/owais/django-webpack-loader/" target="_blank" rel="noopener">django-webpack-loader, star:807</a> - webpack 无缝集成到 django。</li><li><a href="https://github.com/markfinger/python-webpack" target="_blank" rel="noopener">python-webpack, star:58</a> - webpack 的 Python 绑定包，并与 django 集成。</li></ul><h2 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h2><p><em>增强或扩展了 Django 认证方法的相关包。</em></p><ul><li><a href="https://github.com/pennersr/django-allauth/" target="_blank" rel="noopener">django-allauth, star:3000</a> - 一套完整的 Django 应用，解决认证，注册，帐户管理及第三方（社交）帐户认证。</li><li><a href="https://github.com/bennylope/django-organizations" target="_blank" rel="noopener">django-organizations, star:338</a> - Django 项目的多用户帐户功能。</li><li><a href="https://bitbucket.org/psagers/django-otp/" target="_blank" rel="noopener">django-otp, bitbucket forks:39</a> - 一个可插拔框架，用于为 Django 添加使用一次性密码的双因子认证。</li><li><a href="https://github.com/macropin/django-registration/" target="_blank" rel="noopener">django-registration, star:554</a> - 一个简单的 Django 用户注册应用，意在使用户注册过程尽可以简单。</li><li><a href="https://github.com/Tivix/django-rest-auth" target="_blank" rel="noopener">django-rest-auth, star:793</a> - 一组 REST API，用于处理用户注册和认证任务。</li><li><a href="https://github.com/Bouke/django-two-factor-auth/" target="_blank" rel="noopener">django-two-factor-auth, star:391</a> - 用户友好的双因子认证。</li><li><a href="https://github.com/bread-and-pepper/django-userena/" target="_blank" rel="noopener">django-userena, star:1171</a> - Django 的帐户应用，使用极其简单。</li><li><a href="https://github.com/omab/python-social-auth/" target="_blank" rel="noopener">python-social-auth, star:2639</a> - Python Social Auth 是一个很容易设置的社交认证/注册机制，它支持多个框架和认证提供商。</li></ul><h2 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h2><p><em>与授权基础设施和权限相关的包。</em></p><ul><li><a href="https://github.com/django-guardian/django-guardian" target="_blank" rel="noopener">django-guardian, star:1412</a> - 实现对象级别的权限，来用作授权后端。</li><li><a href="https://github.com/evonove/django-oauth-toolkit" target="_blank" rel="noopener">django-oauth-toolkit, star:963</a> - Django 用来集成 OAuth2 的好东西。</li><li><a href="https://github.com/caffeinehit/django-oauth2-provider" target="_blank" rel="noopener">django-oauth2-provider, star:304</a> - 为你的应用提供 OAuth2 访问。</li><li><a href="https://github.com/angvp/django-oml/" target="_blank" rel="noopener">django-oml, star:10</a> - Object Moderation Layer, mixin for models that allows you moderate several content types.（2 年未更新）</li><li><a href="https://github.com/lambdalisue/django-permission/" target="_blank" rel="noopener">django-permission, star:227</a> - 一个增强的权限库，它能使用 <em>基于逻辑的权限系统</em> 来处理 Django 中的复杂权限问题。</li><li><a href="https://github.com/dfunckt/django-rules" target="_blank" rel="noopener">django-rules, star:431</a> - 一个微型但强大的应用，为 Django 提供了对象级别的权限，它无需使用数据。其核心是一个用于构建基于规则的系统的通用框架，类似决策树。它也可以以独立库的形式使用在其它上下文和框架中。</li></ul><h2 id="Blog-管理"><a href="#Blog-管理" class="headerlink" title="Blog 管理"></a>Blog 管理</h2><p><em>用于创建和管理 blog 应用的包。</em></p><ul><li><a href="https://github.com/Fantomas42/django-blog-zinnia" target="_blank" rel="noopener">django-blog-zinnia, star:1430</a> - 一个简单而且强大，又非常容易扩展的应用，用于管理 Django 网站中的 blog。</li><li><a href="https://github.com/APSL/puput" target="_blank" rel="noopener">puput, star:184</a> - 一个 用 <a href="https://github.com/wagtail/wagtail" target="_blank" rel="noopener">Wagtail</a> 实现的 Django blog 应用。</li></ul><h2 id="样板"><a href="#样板" class="headerlink" title="样板"></a>样板</h2><p><em>有关可快速开启一个新项目的包。</em></p><ul><li><a href="https://github.com/audreyr/cookiecutter/" target="_blank" rel="noopener">cookiecutter, star:4912</a> - 一个可根据 cookiecutters (项目模板）创建新项目的命令行工具。</li><li><a href="https://github.com/DrkSephy/django-hackathon-starter" target="_blank" rel="noopener">django-hackathon-starter, star:996</a> - 一个 Django Web 应用的样板，包含多种社交认证方法和多个流行的 API 示例（1 年未更新）。</li><li><a href="https://github.com/arocks/edge" target="_blank" rel="noopener">edge, star:456</a> - 一个 非常现代化非常先进的 Django 项目骨架。</li></ul><h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p><em>有助于缓存的包。</em></p><ul><li><a href="https://github.com/BertrandBordage/django-cachalot" target="_blank" rel="noopener">django-cachalot, star:453</a> - 对你的 Django ORM 进行缓存，并能自动使它们失效。</li><li><a href="https://github.com/django-cache-machine/django-cache-machine" target="_blank" rel="noopener">django-cache-machine, star:659</a> - 能在 ORM 中的 Django 数据模型自动进行缓存和使其失效（1 年未更新）。</li><li><a href="https://github.com/Suor/django-cacheops" target="_blank" rel="noopener">django-cacheops, star:668</a> - 一个精巧的 ORM 缓存，具有自动化细粒度事件驱动型的失效机制。</li><li><a href="https://github.com/tvavrys/django-memoize" target="_blank" rel="noopener">django-memoize, star:46</a> - Django 中 <a href="https://en.wikipedia.org/wiki/Memoization" target="_blank" rel="noopener">记忆(memoization)</a> 技术的一种实现。</li><li><a href="https://github.com/educreations/django-ormcache/" target="_blank" rel="noopener">django-ormcache, star:13</a> - 一个缓存管理器 mixin，提供了一些 ORM 对象的缓存功能。</li><li><a href="https://github.com/sebleier/django-redis-cache/" target="_blank" rel="noopener">django-redis-cache, star:745</a> - 用于 Django 的 Redis 缓存后端。</li><li><a href="https://github.com/jmoiron/johnny-cache/" target="_blank" rel="noopener">johnny-cache, star:265</a> - Johnny Cache 是一个用于 Django 应用的缓存框架。</li></ul><h2 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h2><p><em>有助于保存可重用性 app 在不同的 Django 版本间保存兼容性的包。</em></p><ul><li><a href="https://github.com/arteria/django-compat" target="_blank" rel="noopener">django-compat, star:91</a> - 为官方支持的 Django 版本提供向前和向后兼容层。</li><li><a href="https://github.com/ubernostrum/django-compat-lint" target="_blank" rel="noopener">django-compat-lint, star:36</a> - 为你的代理检查 Django 兼容性（2 年未更新）。</li></ul><h2 id="仪表盘"><a href="#仪表盘" class="headerlink" title="仪表盘"></a>仪表盘</h2><p><em>用于创建信息仪表盘以可视化数据的包。</em></p><ul><li><a href="https://github.com/talpor/django-dashing/" target="_blank" rel="noopener">django-dashing, star:381</a> - 一个可定制，模块化的仪表盘应用框架，用以在你的 Django 项目中可视化有兴趣的数据。灵感来自那个相当优秀的仪表盘框架 Dashing。</li></ul><h2 id="数据科学"><a href="#数据科学" class="headerlink" title="数据科学"></a>数据科学</h2><p><em>使得使用大数据更方便的包。</em></p><ul><li><a href="https://github.com/wq/django-rest-pandas/" target="_blank" rel="noopener">rest-pandas, star:435</a> - 通过 Django REST 框架架设你的 Pandas 数据帧服务，以在客户端（如 d3.js）可视化和离线分析（如 Excel）中使用。</li></ul><h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p><em>有于支持第三方数据库或添加数据库特定功能的包。</em></p><ul><li><a href="https://github.com/kennethreitz/dj-database-url/" target="_blank" rel="noopener">dj-database-url, star:562</a> - 在你的 Django 应用中使用数据库 URL。</li><li><a href="https://github.com/adamchainz/django-mysql/" target="_blank" rel="noopener">django-mysql, star:127</a> - 一个 Django 扩展，以使用 MySQL/MariaDB。</li><li><a href="https://github.com/stephenmcd/django-postgres-fuzzycount" target="_blank" rel="noopener">django-postgres-fuzzycount, star:55</a> - 在 Django 中使用快速 / 模糊的 PostgreSQL count 操作。</li><li><a href="https://github.com/kennethreitz/django-postgrespool/" target="_blank" rel="noopener">django-postgrespool, star: 259</a> - 用于 Django 的 Postgres 连接池，基于 SQLAlchemy。</li></ul><h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p><em>有助于查找 Bug 的包。</em></p><ul><li><a href="https://github.com/django-debug-toolbar/django-debug-toolbar/" target="_blank" rel="noopener">django-debug-toolbar, star:4136</a> - 可配置的一组面板，可显示有关当前请求/应答中的许多调试信息。</li><li><a href="https://github.com/dcramer/django-devserver/" target="_blank" rel="noopener">django-devserver, star:1190</a> - Django 内置 runserver 的简单替代者（1 年未更新）。</li><li><a href="https://github.com/bradmontgomery/django-querycount/" target="_blank" rel="noopener">django-querycount, star:83</a> - 一个中间件，用于将数据库查询数输出来 runserver 命令行中。</li><li><a href="https://github.com/django-silk/silk" target="_blank" rel="noopener">django-silk, star:905</a> - Django 中非常易用的剖析工具。</li><li><a href="https://github.com/jmcarp/nplusone/" target="_blank" rel="noopener">nplusone, star:262</a> - 自动检测 Django（及其它 ORM）中的 n+1 查询问题。</li><li><a href="https://github.com/getsentry/sentry" target="_blank" rel="noopener">sentry, star:12408</a> - 一个现代的错误记录和聚合平台。</li></ul><h2 id="Email"><a href="#Email" class="headerlink" title="Email"></a>Email</h2><p><em>有助于管理邮件发送的包。</em></p><ul><li><a href="https://github.com/pmclanahan/django-celery-email/" target="_blank" rel="noopener">django-celery-email, star:146</a> - 一个 Django 邮件后端，使用 celery 任务来发送邮件。</li><li><a href="https://github.com/LPgenerator/django-db-mailer/" target="_blank" rel="noopener">django-db-mailer, star:156</a> - 一个 Django 模块，能很容易地发送使用 Django 模板 的邮件/短信/push/tss 信息，而模板存于数据库中并通过 Django 管理后面管理。</li><li><a href="https://github.com/zapier/django-drip" target="_blank" rel="noopener">django-drip, star:543</a> - Django Admin based management for drip email campaigns（2 年未更新）。</li><li><a href="https://github.com/stephenmcd/django-email-extras" target="_blank" rel="noopener">django-email-extras, star:67</a> - 多种邮件工具: PGP 加密, multipart 模板, 浏览器测试后端等。</li><li><a href="https://github.com/BradWhittington/django-mailgun/" target="_blank" rel="noopener">django-mailgun, star:205</a> - 使用 Mailgun 的 Django 邮件后端。</li><li><a href="https://github.com/ui/django-post_office/" target="_blank" rel="noopener">django-post_office, star:331</a> - 一个用于发送和管理邮件的简单 Django 应用，支持模板，并能很容易与任务队伍集成。</li><li><a href="https://github.com/django-ses/django-ses" target="_blank" rel="noopener">django-ses, star:475</a> - 使用 Amazon Simple Email Service 的 Django 邮件后端。</li><li><a href="https://github.com/20tab/django-spoolgore" target="_blank" rel="noopener">django-spoolgore, star:5</a> - 使用 Spoolgore daemon 的 django 邮件后端（3 年未更新）。</li><li><a href="https://github.com/BradWhittington/django-templated-email" target="_blank" rel="noopener">django-templated-email, star:291</a> - 一个 Django 模板，能很容易地发送模板型邮件，可以使用 django 模板，或事务型邮件提供商（如 mailchimp, silverpop 等）。</li><li><a href="https://github.com/APSL/django-yubin" target="_blank" rel="noopener">django-yubin, star:22</a> - django-mailer2 + django-mailviews，及其它功能。</li><li><a href="https://github.com/bameda/djmail" target="_blank" rel="noopener">djmail, star:58</a> - 一个简单且非阻塞式的 django 邮件中间件。</li><li><a href="https://github.com/brack3t/Djrill/" target="_blank" rel="noopener">djrill, star:354</a> - 一个使用 MailChimp 的 Mandrill 事务型邮件邮件的邮件后端。</li></ul><h2 id="数据项"><a href="#数据项" class="headerlink" title="数据项"></a>数据项</h2><p><em>与扩展现有项类型功能或添加新项类型有关的包。</em></p><ul><li><a href="https://github.com/areski/django-audiofield" target="_blank" rel="noopener">django-audiofield, star:91</a> - 允许对音频文件进行上传，管理，将转换成不同的音频格式 (mp3, wav &amp; ogg)。</li><li><a href="https://github.com/disqus/django-bitfield/" target="_blank" rel="noopener">django-bitfield, star:282</a> - Django 数据模型的一个扩展，A BitField。</li><li><a href="https://github.com/SmileyChris/django-countries/" target="_blank" rel="noopener">django-countries, star:359</a> - 为表单提供国家选择，也基于国旗选择，还提供一个 CountryField。</li><li><a href="https://github.com/5monkeys/django-enumfield/" target="_blank" rel="noopener">django-enumfield, star:99</a> - 基于命名常数列表的 Django 定制数据项（1 看未更新）。</li><li><a href="https://github.com/bonsaistudio/django-image-tools/" target="_blank" rel="noopener">django-image-tools, star:36</a> - 在 Django 中处理图像的包(1 看未更新）。</li><li><a href="https://github.com/matthewwithanm/django-imagekit/" target="_blank" rel="noopener">django-imagekit, star:1154</a> - 在 Django 中自动处理图像。</li><li><a href="https://pypi.python.org/pypi/django-jsonfield" target="_blank" rel="noopener">django-jsonfield, bitbucket forks:49</a> - 用于 Django 数据模型中的 JSONField。 for Django models.</li><li><a href="https://github.com/caioariede/django-location-field/" target="_blank" rel="noopener">django-location-field, star:266</a> - 一个位置项及其组件，并与 google 地图集成。</li><li><a href="https://github.com/django-macaddress/django-macaddress" target="_blank" rel="noopener">django-macaddress, star:25</a> - 在 Django 中使用的 MAC 地址数据模型及其表单项。</li><li><a href="https://github.com/stefanfoulis/django-phonenumber-field/" target="_blank" rel="noopener">django-phonenumber-field, star:383</a> - 一个可以与 <a href="https://github.com/daviddrysdale/python-phonenumbers" target="_blank" rel="noopener">python-phonenumbers</a> 交互的 Django 库，以用来验证、格式输出和转换手机号码。</li><li><a href="https://github.com/gintas/django-picklefield/" target="_blank" rel="noopener">django-picklefield, star:92</a> - 用于 Django 的序列化对象项（pickled object field）。</li><li><a href="https://github.com/and3rson/django-searchable-select" target="_blank" rel="noopener">django-searchable-select, star:29</a> - 一个更好更快的多选组件，并附有提示功能。</li><li><a href="https://github.com/dcramer/django-uuidfield/" target="_blank" rel="noopener">django-uuidfield, star:261</a> - 用于 Django 的 UUIDField（2 年未更新）。</li><li><a href="https://github.com/WGBH/django-versatileimagefield/" target="_blank" rel="noopener">django-versatileimagefield, star:230</a> - django ImageField 的简单替代品，并提供了一个灵活、直观、易扩展的接口来快速地根据指定的图像创建一个表单项。</li></ul><h2 id="文件传输"><a href="#文件传输" class="headerlink" title="文件传输"></a>文件传输</h2><p><em>用于在项目间或用户间传输文件的包。</em></p><ul><li><a href="https://github.com/benoitbryon/django-downloadview/" target="_blank" rel="noopener">django-downloadview, star:129</a> - 用 Django 提供文件服务。</li><li><a href="https://github.com/johnsensible/django-sendfile/" target="_blank" rel="noopener">django-sendfile, star:311</a> - 这是对特定于 Web 服务器的方法的一个封闭器，用来将文件发送给 Web 客户端。</li></ul><h2 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h2><p><em>扩展表单功能或添加亲的表单类型的相关包。</em></p><ul><li><a href="https://github.com/yourlabs/django-autocomplete-light/" target="_blank" rel="noopener">django-autocomplete-light, star:794</a> - django-autocomplete-light 的目标是在 Django 项目中快速而适当地实现自动填充功能。</li><li><a href="https://github.com/tzangms/django-bootstrap-form/" target="_blank" rel="noopener">django-bootstrap-form, star:485</a> - 将 Twitter Bootstrap 使用到 Django 表单中。</li><li><a href="https://github.com/dyve/django-bootstrap3/" target="_blank" rel="noopener">django-bootstrap3, star:1731</a> - 以 Django 的方式，在 Django 模板中使用 Bootstrap。</li><li><a href="https://github.com/maraujop/django-crispy-forms/" target="_blank" rel="noopener">django-crispy-forms, star:2756</a> - 实现 DRY Django 表单的最好方式。该应用提供的 Tag 和 Filter 能让你快速将表单呈现成 div 格式，同时又提供大量的功能来配置和控制呈现的 HTML。</li><li><a href="https://github.com/gregmuellegger/django-floppyforms/" target="_blank" rel="noopener">django-floppyforms, star:681</a> - django-floppyforms 这个应用能让你完全控制表单的呈现结果。表单 API 和功能与 Django 的完全相同，主要的不同在同它的表单项和表单组件是在模板中呈现的，而不是使用字符串处理完成，因此它能让你在使用 Django 模板中完成控制输出的结果。</li></ul><h2 id="GIS"><a href="#GIS" class="headerlink" title="GIS"></a>GIS</h2><p><em>能更容易与地理信息系统项目协作的包。</em></p><ul><li><a href="https://github.com/philippbosch/django-geoposition/" target="_blank" rel="noopener">django-geoposition, star:261</a> - 一个数据模型项，可用来保存地理信息(经度/纬度)，并提供相应的后台管理/表单组件。</li><li><a href="https://github.com/caioariede/django-location-field/" target="_blank" rel="noopener">django-location-field, star:266</a> - 一个位置项及其组件，并与 google 地图集成。</li><li><a href="https://github.com/bkg/django-spillway/" target="_blank" rel="noopener">django-spillway, star:42</a> - Django REST 框架的 Geodata 扩展。</li><li><a href="https://github.com/djangonauts/django-rest-framework-gis/" target="_blank" rel="noopener">djangorestframework-gis, star:372</a> - Django REST 框架的地理信息扩展。</li></ul><h2 id="图片处理"><a href="#图片处理" class="headerlink" title="图片处理"></a>图片处理</h2><p><em>用于处理，修改或转换图片的包。</em></p><ul><li><a href="https://github.com/jonasundderwolf/django-image-cropping" target="_blank" rel="noopener">django-image-cropping, star:386</a> - 一个协助应用，能很容易地为后台或前端非破坏性的剪切任意大图片。</li><li><a href="https://github.com/WGBH/django-versatileimagefield/" target="_blank" rel="noopener">django-versatileimagefield, star:230</a> - django ImageField 的简单替代品，并提供了一个灵活、直观、易扩展的接口来快速地根据指定的图像创建一个表单项。</li></ul><h2 id="导入-导出"><a href="#导入-导出" class="headerlink" title="导入/导出"></a>导入/导出</h2><p><em>能在项目中加载、导入或导出数据的包。</em></p><h2 id="数据迁移"><a href="#数据迁移" class="headerlink" title="数据迁移"></a>数据迁移</h2><p><em>当有模式更新后，能用来进行数据库迁移的包。</em></p><ul><li><a href="https://bitbucket.org/andrewgodwin/south/src/" target="_blank" rel="noopener">South, bitbucket forks:169</a> - 一个提供了模式和数据迁移功能的 Django 应用，支持至 Django 1.6.x。(<a href="https://docs.djangoproject.com/en/dev/topics/migrations/" target="_blank" rel="noopener">Django 1.7 及以上版本已经集成了一个数据迁移系统，其基于 South 但不兼容</a>)</li></ul><h2 id="移动端支持"><a href="#移动端支持" class="headerlink" title="移动端支持"></a>移动端支持</h2><p><em>用于支持 iOS, Android 及其它移动端的包。</em></p><ul><li><a href="https://github.com/jleclanche/django-push-notifications" target="_blank" rel="noopener">django-push-notifications, star:911</a> - 一个微型 Django 应用，它实现了 Device 数据模型，可通过 APNS 和 GCM 发送消息。</li><li><a href="https://github.com/rakanalh/django-pushy" target="_blank" rel="noopener">django-pushy, star:157</a> - 一个 Django 应用，使用 celery 来提供推送功能。该应用的主要目的是帮助你批量向你的用户发送推送消息。如果你有多个已注册的设备码(registered device keys)，django-pushy 会将设备码分成小组，从而加快消息的发送过程。</li></ul><h2 id="数据模型扩展"><a href="#数据模型扩展" class="headerlink" title="数据模型扩展"></a>数据模型扩展</h2><p><em>能扩展数据模型功能或添加新数据模型类的包。</em></p><ul><li><a href="https://github.com/henriquebastos/django-aggregate-if/" target="_blank" rel="noopener">django-aggregate-if, star:125</a> - 对 Django 查询进行条件聚合，就如 Excel 中的 SumIf 和 CountIf（2 年未更新）。</li><li><a href="https://github.com/django/django-localflavor/" target="_blank" rel="noopener">django-localflavor, star:290</a> - 与国家信息有关的 Django 辅助包，即原先的 fame 贡献包。</li><li><a href="https://github.com/carljm/django-model-utils/" target="_blank" rel="noopener">django-model-utils, star:1126</a> - Django 数据模型的 mixins 和工具集。</li><li><a href="https://github.com/django-mptt/django-mptt/" target="_blank" rel="noopener">django-mptt, star:1439</a> - 用来在 Django 中实现一个修订版的先序遍历树的工具集。</li><li><a href="https://github.com/tabo/django-treebeard" target="_blank" rel="noopener">django-treebeard, star:370</a> - Django 中树数据结构的另一种实现(提供了 3 种不同的层级数据排序方法，包括 MPTT )。</li></ul><h2 id="支付处理"><a href="#支付处理" class="headerlink" title="支付处理"></a>支付处理</h2><p><em>与支付处理提供商集成有关的包。</em></p><ul><li><a href="https://github.com/pydanny/dj-stripe/" target="_blank" rel="noopener">dj-stripe, star:370</a> - 使得 Django + Stripe 更容易。</li><li><a href="https://github.com/agiliq/merchant/" target="_blank" rel="noopener">django-merchant, star:862</a> - 一个 Django 应用，为多个可插拔支付后端提供了辅助工具（2 年未更新）。</li><li><a href="https://github.com/oscaro/django-oscar-adyen/" target="_blank" rel="noopener">django-oscar-adyen, star:5</a> - 这个包提供了与 Adyen 支付网关的集成功能。它意在与电子商务框架 django-oscar 进行无缝对接，但也可以独立于 Oscar 使用。</li><li><a href="https://github.com/django-oscar/django-oscar-paymentexpress/" target="_blank" rel="noopener">django-oscar-paymentexpress, star:6</a> - 这个包提供了与 PaymentExpress 支付网关（使用它们的 PX POST API）的集成功能。它意在与电子商务框架 django-oscar 进行无缝对接，但也可以独立于 Oscar 使用（5 年未更新）。</li><li><a href="https://github.com/django-oscar/django-oscar-paypal/" target="_blank" rel="noopener">django-oscar-paypal, star:70</a> - PayPal 集成进 django-oscar。也可以独立于 Oscar 使用。</li><li><a href="https://github.com/spookylukey/django-paypal" target="_blank" rel="noopener">django-paypal, star:378</a> - 一个可插拔的 Django 应用，进于集成 PayPal 标准支持和高级支付功能。</li><li><a href="https://github.com/rossp/django-pinpayments/" target="_blank" rel="noopener">django-pinpayments, star:19</a> - 可简化使用 Pin 的支付过程的 Django 库（1 年未更新）。</li><li><a href="https://github.com/GoodCloud/django-zebra/" target="_blank" rel="noopener">django-zebra, star:177</a> - 表单，组件，模板标签及模板，以使 Stripe + Django 更容易(3 年未更新）。</li></ul><h2 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h2><ul><li><a href="https://github.com/caktus/django-timepiece/" target="_blank" rel="noopener">django-timepiece, star:251</a> - 一个多用户的 Django 应用，用于跟踪用户在项目上的时间（1 年未更新）。</li></ul><h2 id="报表"><a href="#报表" class="headerlink" title="报表"></a>报表</h2><p><em>创建报表相关的包。</em></p><ul><li><a href="https://github.com/juanpex/django-model-report/" target="_blank" rel="noopener">django-model-report, star:156</a> - 一个集成了 highcharts 的 Django 报表应用。</li><li><a href="https://github.com/burke-software/django-report-builder/" target="_blank" rel="noopener">django-report-builder, star:453</a> - Django ORM 的一个用户界面。能构建自定义的查询并显示结果。目标用户是系统管理员及不会编程的终端用户。</li></ul><h2 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h2><p><em>开发 REST API 的包。</em></p><ul><li><a href="https://github.com/funkybob/django-nap/" target="_blank" rel="noopener">django-nap, star:176</a> - 实现对象序列化，RESTful 视图和 RPC 视图的一种极简方式。</li><li><a href="https://github.com/Tivix/django-rest-auth/" target="_blank" rel="noopener">django-rest-auth, star:793</a> - 该应用将所有与注册和验证相关的功能都以 CBV (Class Base View) 和 REST (JSON) 的形式提供，从而使用它来构建 Django SPA (Single Page App) 或移动应用是极其方便的。</li><li><a href="http://www.django-rest-framework.org/" target="_blank" rel="noopener">django-rest-framework, star:7811</a> - 一个功能强大且灵活的工具集，用它来构建 Web API 很容易。</li><li><a href="https://github.com/gilsondev/django-rest-localflavor/" target="_blank" rel="noopener">django-rest-localflavor, star:11</a> - 用于 Django Rest 框架的一些本地化相关序列化器。</li><li><a href="https://github.com/marcgibbons/django-rest-swagger/" target="_blank" rel="noopener">django-rest-swagger, star:1465</a> - Django REST 框架的 <a href="http://swagger.io/" target="_blank" rel="noopener">Swagger</a> 文档生成器。</li><li><a href="https://github.com/ekonstantinidis/django-rest-framework-docs" target="_blank" rel="noopener">drfdocs, star:342</a> - 为使用 Django REST 框架开发的 Web API 提供文档。</li><li><a href="http://tastypieapi.org/" target="_blank" rel="noopener">django-tastypie, star:3174</a> - 自 2010 年来就能为 Django 应用创建完美的 API。</li><li><a href="https://github.com/toastdriven/restless/" target="_blank" rel="noopener">restless, star:601</a> - 一个在 Python 中使用的轻量级 REST 微框架。</li></ul><h2 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h2><p><em>为项目提供搜索能力的包。</em></p><ul><li><a href="https://github.com/django-haystack/django-haystack" target="_blank" rel="noopener">django-haystack, star:2181</a> - Django 中的模块化搜索包。</li><li><a href="https://github.com/etianen/django-watson/" target="_blank" rel="noopener">django-watson, star:577</a> - 快速的多数据模式的全文搜索插件。</li><li><a href="https://github.com/linuxlewis/djorm-ext-pgfulltext" target="_blank" rel="noopener">djorm-ext-pgfulltext, star:237</a> - PostgreSQL 全文搜索与 django orm 整合（1 年未更新）。</li></ul><h2 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h2><p><em>用于改善项目安全性的包。</em></p><ul><li><a href="https://github.com/dmpayton/django-admin-honeypot/" target="_blank" rel="noopener">django-admin-honeypot, star:363</a> - 一个伪装的 Django 管理后台登录界面，用来向管理员发送未授权访问尝试信息。</li><li><a href="https://github.com/django-pci/django-axes/" target="_blank" rel="noopener">django-axes, star:315</a> - 是一种用于记录失败登录尝试的简单方法，即可用于 Django 管理后台，也可用于你的应用系统。</li><li><a href="https://github.com/lpomfrey/django-debreach/" target="_blank" rel="noopener">django-debreach, star:67</a> - 为你的 Django 应用提供 BREACH 防御。</li><li><a href="https://github.com/atugushev/django-password-session/" target="_blank" rel="noopener">django-password-session, star:10</a> - 当修改密码后会使所有活跃会话全部失效(<a href="https://docs.djangoproject.com/en/dev/topics/auth/default/#session-invalidation-on-password-change" target="_blank" rel="noopener">Django 1.7+ 中已有此功能</a>)（2 年未更新）。</li><li><a href="https://github.com/carljm/django-secure/" target="_blank" rel="noopener">django-secure, star:489</a> - 提醒你通过完成一些简单地任务来提高你的 Django 网站的安全性，该项目已整合入 Django 1.8+，故不再维护（2 年未更新）。</li><li><a href="https://github.com/gotlium/django-secure-auth" target="_blank" rel="noopener">django-secure-auth, star:23</a> - 通过 TOTP, 短信, 代码 &amp; 答案等进行安全认证。能根据 IP 和 captcha 进行登录保护。</li><li><a href="https://github.com/sdelements/django-security/" target="_blank" rel="noopener">django-security, star:108</a> - 一组数据模型，视图、中间件和表单，用来加固 Django 项目的安全性。</li><li><a href="https://github.com/rdegges/django-sslify/" target="_blank" rel="noopener">django-sslify, star:287</a> - 在你的 Django 网站上强制使用 SSL。</li><li><a href="https://github.com/mgrouchy/django-stronghold/" target="_blank" rel="noopener">django-stronghold, star:227</a> - Stronghold 是一个中间件，用来默认将你的所有视图导向 login required。</li><li><a href="https://github.com/mattrobenolt/django-sudo" target="_blank" rel="noopener">django-sudo, star:235</a> - Sudo 模式是你的最敏感页面的一个额外安全层。这是 Django 中的 GitHub Sudo 模式的一种实现。</li></ul><h2 id="SEO"><a href="#SEO" class="headerlink" title="SEO"></a>SEO</h2><p>*帮助改善项目 SEO ( 搜索引擎优化 ) 的包。</p><ul><li><a href="https://github.com/nephila/django-meta/" target="_blank" rel="noopener">django-meta, star:144</a> - 一个可插拔的应用，Django 开发人员可以用它来快速地将 meta 标签和 OpenGraph, Twitter, 和 Google Plus 属性添加到他们的 HTML 页面中。</li><li><a href="https://github.com/jazzband/django-robots" target="_blank" rel="noopener">django-robots, star:205</a> - 一个用于管理 robots.txt 文件的应用，它遵循 robots 扩展协议。</li><li><a href="https://github.com/romansalin/django-seo2/" target="_blank" rel="noopener">django-seo2, star:34</a> - 提供了一组工具来管理 Django 站点的搜索引擎优化 (SEO) 元数据。</li></ul><h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><p><em>用来管理项目的配置的包。</em></p><ul><li><a href="https://github.com/jazzband/django-configurations" target="_blank" rel="noopener">django-configurations, star:512</a> - 一个依据广为接受的编程模式来组织 Django 项目配置信息的辅助包。</li><li><a href="https://github.com/jazzband/django-constance" target="_blank" rel="noopener">django-constance, star:730</a> - 一个能将动态设置信息存储在可插拔后端（内置 Redis 和 Django 数据模型后端）的 Django 应用，并已与 Django 后台管理应用整合。</li><li><a href="https://github.com/henriquebastos/python-decouple/" target="_blank" rel="noopener">python-decouple, star:386</a> - 严格地将配置与代码分离。</li><li><a href="https://github.com/joke2k/django-environ" target="_blank" rel="noopener">django-environ, star:667</a> - 能让你使用 12factor 的环境变量来配置你的 Django 应用。</li><li><a href="https://github.com/sobolevn/django-split-settings" target="_blank" rel="noopener">django-split-settings, star:131</a> - 将 Django 设置信息组织到多个文件和目录中。能容易地实现对设置的覆盖和修改。能使用通配符和可选的设置文件。</li></ul><h2 id="存储"><a href="#存储" class="headerlink" title="存储"></a>存储</h2><p><em>扩展了现有存储后端的功能或提供新存储后端的相关包。</em></p><ul><li><a href="https://github.com/EliotBerriot/django-dynamic-preferences" target="_blank" rel="noopener">django-dynamic-preferences, star:75</a> - 为你的 Django 项目实现动态、全局的实例设置。</li><li><a href="https://github.com/marazmiki/django-selectel-storage" target="_blank" rel="noopener">django-selectel-storage, star:10</a> - 使用该应用能容易地将媒体或静态文件保存到 <a href="https://selectel.ru/" target="_blank" rel="noopener">Selectel</a> 云存储上。</li><li><a href="https://bitbucket.org/david/django-storages/src/" target="_blank" rel="noopener">django-storages, bitbucket forks: 268</a> - django-storages 是一个有关自定义 Django 存储后端的列表（4 年未更新）。</li><li><a href="https://github.com/jazzband/django-queued-storage" target="_blank" rel="noopener">django-queued-storage, star:245</a> - 为 Django 存储后端提供了代理功能，从而使你能像在本地一样上传文件，但最终是保存在远程。</li><li><a href="https://github.com/marazmiki/django-webdav-storage" target="_blank" rel="noopener">django-webdav-storage, star:11</a> - Django 存储后端，能将文件存储在自定义的 WebDAV 存储中。</li></ul><h2 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h2><ul><li><a href="https://github.com/alex/django-taggit/" target="_blank" rel="noopener">django-taggit, star:1644</a> - Django 的简单标签应用。</li><li><a href="https://github.com/mfcovington/django-taggit-helpers" target="_blank" rel="noopener">django-taggit-helpers, star:17</a> - django-taggit 标签的 Django 后台管理辅助类（1 年未更新）。</li></ul><h2 id="任务队列"><a href="#任务队列" class="headerlink" title="任务队列"></a>任务队列</h2><p><em>能更容易使用任务/后台队队的包。</em></p><ul><li><a href="https://github.com/celery/django-celery" target="_blank" rel="noopener">django-celery, star:1011</a> - Celery 与 Django 集成。(Celery 3.1+ 已不再需要该包)</li><li><a href="https://github.com/Koed00/django-q" target="_blank" rel="noopener">django-q, star:477</a> - 一个 Django 多进程任务队列。</li><li><a href="https://github.com/ui/django-rq" target="_blank" rel="noopener">django-rq, star:620</a> - 在你的 Django 项目监测和使用 <a href="http://python-rq.org/" target="_blank" rel="noopener">RQ</a> 的最简单方法。</li><li><a href="https://github.com/coleifer/huey/" target="_blank" rel="noopener">huey, star:1190</a> - 一个 Python 中的小型多线程任务队列。</li></ul><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p><em>有助于测试代码或创建测试数据的包。</em></p><ul><li><a href="https://github.com/behave/behave-django" target="_blank" rel="noopener">behave-django, star:29</a> - 将行为驱动开发 (<a href="https://pypi.python.org/pypi/behave" target="_blank" rel="noopener">Behave BDD</a>) 集成到 Django 中。</li><li><a href="https://github.com/django-behave/django-behave/" target="_blank" rel="noopener">django-behave, star:173</a> - Behave BDD 模块的 TestRunner。</li><li><a href="https://github.com/paulocheque/django-dynamic-fixture" target="_blank" rel="noopener">django-dynamic-fixture, star:252</a> - 可为测试目的动态地创建数据模拟实例。</li><li><a href="https://github.com/joke2k/django-faker/" target="_blank" rel="noopener">django-faker, star:144</a> - 使用 <a href="https://github.com/joke2k/faker/" target="_blank" rel="noopener">Fake-factory</a> 来创建测试数据（2 年未更新）。</li><li><a href="https://github.com/kmmbvnr/django-jenkins" target="_blank" rel="noopener">django-jenkins, star:799</a> - 在 Django 中即插即用 jenkins 进行持续集成。</li><li><a href="https://github.com/django-nose/django-nose/" target="_blank" rel="noopener">django-nose, star:743</a> - 使用 nose 进行测试。</li><li><a href="https://github.com/dragoon/django-selenium/" target="_blank" rel="noopener">django-selenium, star:84</a> - 支持用 Selenium 测试。</li><li><a href="https://github.com/stephenmcd/django-shotgun" target="_blank" rel="noopener">django-shotgun, star:8</a> - 测试整个 Django 网站（3 年未更新）。</li><li><a href="https://github.com/realpython/django-slow-tests" target="_blank" rel="noopener">django-slowtests, star:106</a> - 定位出最慢的测试。</li><li><a href="https://github.com/revsys/django-test-plus" target="_blank" rel="noopener">django-test-plus, star:208</a> - 增强了 Django 默认的 TestCase 的功能，能极大减少样板代码。</li><li><a href="https://github.com/rbarrois/factory_boy/" target="_blank" rel="noopener">factory_boy, star:1150</a> - Python test fixtures 一个替代器。</li><li><a href="http://hitchtest.com/" target="_blank" rel="noopener">hitchtest, star:32</a> - 与 Django 高度集成的一个测试框架。</li><li><a href="https://github.com/stringfellow/lettuce-django-terrain/" target="_blank" rel="noopener">lettuce-django-terrain, star:12</a> - 用于 Django 项目中 <a href="https://github.com/gabrielfalcao/lettuce" target="_blank" rel="noopener">lettuce</a> 的 Terrain 文件（5 年未更新，但 lettuce 网站上的代码框显示很赞）。</li><li><a href="https://github.com/klen/mixer" target="_blank" rel="noopener">mixer, star:395</a> - 一个用来产生 Django 或 SQLAlchemy 数据模型实例的应用。能快速便捷地创建测试数据。</li><li><a href="https://github.com/dcramer/mock-django" target="_blank" rel="noopener">mock-django, star:191</a> - 一个简单的库，能为诸如 ORM 等一些 Django 行为设置模拟信息（1 年未更新）。</li><li><a href="https://github.com/vandersonmota/model_mommy/" target="_blank" rel="noopener">model-mommy, star:660</a> - 为进行更好地测试提供了智能 fixtures。</li><li><a href="https://github.com/pytest-dev/pytest-django" target="_blank" rel="noopener">pytest-django, star:308</a> - pytest 的一个 Django 插件。</li><li><a href="https://github.com/cobrateam/splinter/" target="_blank" rel="noopener">splinter, star:1355</a> - Web 应用的一个 Python 测试框架。</li></ul><h2 id="缩略图"><a href="#缩略图" class="headerlink" title="缩略图"></a>缩略图</h2><p><em>用于创建缩略图的包。</em></p><ul><li><a href="https://github.com/codingjoe/django-stdimage/" target="_blank" rel="noopener">django-stdimage, star:125</a> - 用于 Django 的缩略图和图像工具。</li><li><a href="https://github.com/WGBH/django-versatileimagefield/" target="_blank" rel="noopener">django-versatileimagefield, star:230</a> - Django ImageField 的简单替代器，它提供了一个灵活易用、易扩展的接口，能根据数据项中设置的图片快速地创建新的图片。</li><li><a href="https://github.com/SmileyChris/easy-thumbnails" target="_blank" rel="noopener">easy-thumbnails, star:898</a> - 一个易用的 Django 缩略图应用。</li><li><a href="https://github.com/mariocesar/sorl-thumbnail/" target="_blank" rel="noopener">sorl-thumbnail, star:1050</a> - 用于 Django 的缩略图应用。</li></ul><h2 id="翻译"><a href="#翻译" class="headerlink" title="翻译"></a>翻译</h2><p><em>有助于翻译工程项目的包。</em></p><ul><li><a href="https://github.com/KristianOellegaard/django-hvad" target="_blank" rel="noopener">django-hvad, star:417</a> - 可在 django 中进行轻松地翻译，使用通常的 ORM。能很容易集成到现存的项目和应用中。能从 django-multilingual-ng 很容易地转换过来。</li><li><a href="https://github.com/angvp/django-klingon/" target="_blank" rel="noopener">django-klingon, star:35</a> - 意在能 django 数据模型的翻译更加容易（2 年未更新）。</li><li><a href="https://github.com/deschler/django-modeltranslation/" target="_blank" rel="noopener">django-modeltranslation, star:483</a> - 将现有 Django 数据模型中的动态数据翻译成任何的语言，而无需修改原来的数据模型类。</li><li><a href="https://github.com/edoburu/django-parler" target="_blank" rel="noopener">django-parler, star:236</a> - 简单的 Django 数据模型翻译工具，没有奇技淫巧。</li><li><a href="https://github.com/mbi/django-rosetta/" target="_blank" rel="noopener">django-rosetta, star:608</a> - Rosetta 是一个 ango 应用，它使你的 Django 项目的翻译过程更加容易。</li></ul><h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p><em>用于增强或提供新的视图类的包。</em></p><ul><li><a href="https://github.com/AndrewIngram/django-extra-views/" target="_blank" rel="noopener">django-extra-views, star:593</a> - Django 的基于类的通用视图都很赞，那就再实现一些。</li><li><a href="https://github.com/tomchristie/django-vanilla-views/" target="_blank" rel="noopener">django-vanilla-views, star:656</a> - 一些非常简洁的基于类的视图。</li></ul><h2 id="Web-前端集成"><a href="#Web-前端集成" class="headerlink" title="Web 前端集成"></a>Web 前端集成</h2><ul><li><a href="https://github.com/jrief/django-angular/" target="_blank" rel="noopener">django-angular, star:1074</a> - 使 AngularJS 与 Django 整合。</li><li><a href="https://github.com/nvbn/django-bower" target="_blank" rel="noopener">django-bower, star:491</a> - 使在 Django 项目中使用 <a href="http://bower.io/" target="_blank" rel="noopener">bower</a> 更加容易。</li><li><a href="https://github.com/ierror/django-js-reverse" target="_blank" rel="noopener">django-js-reverse, star:331</a> - 一个 Django 应用，实现 Javascript url 处理。</li><li><a href="https://github.com/appliedsec/djangular/" target="_blank" rel="noopener">djangular, star:214</a> - 一个可复用的 Django app，为 Angular.js 提供了更好的集成及工具。（1 年未更新）</li></ul><h2 id="所见即所得编辑器"><a href="#所见即所得编辑器" class="headerlink" title="所见即所得编辑器"></a>所见即所得编辑器</h2><p><em>方便文本翻译的包。</em></p><ul><li><a href="https://github.com/django-ckeditor/django-ckeditor/" target="_blank" rel="noopener">django-ckeditor, star:820</a> - Django 管理界面与 CKEditor 集成。</li><li><a href="https://github.com/summernote/django-summernote/" target="_blank" rel="noopener">django-summernote, star:325</a> - Summernote 是一个简单的所见即所得编辑器。django-summernote 能将 Summernote 方便地嵌入到 Django 中。支持 mixins 和 widgets。</li><li><a href="https://github.com/aljosa/django-tinymce/" target="_blank" rel="noopener">django-tinymce, star:615</a> - TinyMCE 与 Django 集成。</li><li><a href="https://github.com/pydanny/django-wysiwyg/" target="_blank" rel="noopener">django-wysiwyg, star:440</a> - 一个 Django 应用，实现将 Django 文本框变成富文本编辑器。可用作模板标签，也可用于表单组件。</li></ul><h2 id="Wiki-应用"><a href="#Wiki-应用" class="headerlink" title="Wiki 应用"></a>Wiki 应用</h2><ul><li><a href="https://github.com/django-wiki/django-wiki" target="_blank" rel="noopener">django-wiki, star:727</a> - 一个 wiki 系统，功能复杂，集成容易，界面优秀。能将你的知识配以样式进行存储：使用 django 数据模型。</li><li><a href="https://github.com/mgaitan/waliki" target="_blank" rel="noopener">waliki, star:254</a> - 一个可扩展的 Django wiki 应用，使用 Git 后端。</li></ul><h2 id="工作流"><a href="#工作流" class="headerlink" title="工作流"></a>工作流</h2><p><em>用于过程或业务任务管理的包。</em></p><ul><li><a href="https://github.com/carlio/django-flows/" target="_blank" rel="noopener">django-flows, star:87</a> - django-flows 能保存逻辑复杂流中的状态和位置，允许基于每个用户的一系列动作进行可能的分支和复杂路径分离。（1 年未更新）</li><li><a href="https://github.com/kmmbvnr/django-fsm/" target="_blank" rel="noopener">django-fsm, star:831</a> - Django 对有限状态机的友好支持。</li><li><a href="https://github.com/javrasya/django-river/" target="_blank" rel="noopener">django-river, star:303</a> - Django 状态机和工作流库，提供即时修改功能。</li><li><a href="https://github.com/vikingco/django-states2/" target="_blank" rel="noopener">django-states, star:113</a> - django 数据模型的状态机。</li><li><a href="https://github.com/viewflow/viewflow" target="_blank" rel="noopener">django-viewflow, star:631</a> - Django 中的可复用工作流库。</li><li><a href="https://bitbucket.org/jerzyk/django-workflows/" target="_blank" rel="noopener">django-workflows, bitbucket forks:1</a> - django-workflows 为 Django 提供了一个通用的工作流引擎。</li><li><a href="https://github.com/rbarrois/django_xworkflows/" target="_blank" rel="noopener">django-xworkflows, star:73</a> - 一个将 xworkflows 整合到 django 数据模型中的库。</li></ul><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><ul><li><a href="https://github.com/hellysmile/django-activeurl" target="_blank" rel="noopener">django-activeurl, star:94</a> - 使在 django 更容易使用活跃 URL 高亮。（2 年未更新）</li><li><a href="https://github.com/justquick/django-activity-stream/" target="_blank" rel="noopener">django-activity-stream, star:1181</a> - 基于站点上的行为创建通用的活动流。用户可关注任何行为者的个人活动流。</li><li><a href="https://github.com/saxix/django-adminactions/" target="_blank" rel="noopener">django-adminactions, star:169</a> - 一组非常有用的行为集，可用于 django.contrib.admin.ModelAdmin 和 django.contrib.admin.AdminSite。</li><li><a href="https://github.com/rosarior/django-autoadmin/" target="_blank" rel="noopener">django-autoadmin, star:28</a> - 为 Django 项目自动创建管理员用户。（2 年未更新）</li><li><a href="https://github.com/brack3t/django-braces/" target="_blank" rel="noopener">django-braces, star:1220</a> - 可复用的，通用的 Django mixins。</li><li><a href="https://github.com/bitmazk/django-calendarium/" target="_blank" rel="noopener">django-calendarium, star:167</a> - 一个可复用的应用，用于在模板中管理和显示日历。</li><li><a href="https://github.com/angvp/django-changuito/" target="_blank" rel="noopener">django-changuito, star:46</a> - django 网站的购物篮应用，django-cart 的分支版本。</li><li><a href="https://github.com/ottoyiu/django-cors-headers" target="_blank" rel="noopener">django-cors-headers, star:1435</a> - 一个用于处理跨源资源共享(CORS) 所需的服务器头的 Django 应用。</li><li><a href="https://github.com/praekelt/django-dfp" target="_blank" rel="noopener">django-dfp, star:4</a> - 一个应用，提供了用于获取 Google DFP 广告的标签。（2 年未更新）</li><li><a href="https://github.com/holgerd77/django-dynamic-scraper/" target="_blank" rel="noopener">django-dynamic-scraper, star:552</a> - 能通过 Django 管理界面创建 Scrapy 抓取器。</li><li><a href="https://github.com/django-extensions/django-extensions/" target="_blank" rel="noopener">django-extensions, star:3111</a> - 该仓库收集了有关 Django 框架的全局自定义管理扩展功能。</li><li><a href="https://github.com/alex/django-filter/" target="_blank" rel="noopener">django-filter, star:1743</a> - 一个通用的系统，能基于用户选择过滤 Django QuerySets。</li><li><a href="https://github.com/revsys/django-friendship/" target="_blank" rel="noopener">django-friendship, star:291</a> - 用于管理从属或双向关系的 Django 应用。</li><li><a href="https://github.com/twaddington/django-gravatar/" target="_blank" rel="noopener">django-gravatar2, star:93</a> - 主要实现在 Django 中支持 Gravatar。功能有辅助函数，模板标签和完整的测试。</li><li><a href="https://github.com/DrkSephy/django-hackathon-starter" target="_blank" rel="noopener">django-hackathon-starter, star:1005</a> - Django Web 应用的样板，包含各种社交认证方法和许多流行 API 的例子。（1 年未更新）</li><li><a href="https://github.com/un33k/django-ipware" target="_blank" rel="noopener">django-ipware, star:323</a> - 一个用于获取用户 IP 地址的 Django 应用。</li><li><a href="https://github.com/kronoscode/django-magicembed" target="_blank" rel="noopener">django-magic-embed, star:18</a> - 一个简单易用的 Django 模板标签和工具，用于嵌入视频，并从视频提供者处获取缩略图。（2 年未更新）</li><li><a href="https://github.com/zsiciarz/django-markitup" target="_blank" rel="noopener">django-markitup, star:41</a> - 一个可复用的 Django 应用，用于端到端的标签处理。</li><li><a href="https://github.com/LPgenerator/django-mmc" target="_blank" rel="noopener">django-mmc, star:30</a> - 一个用于监测 Django 中的管理命令的应用。</li><li><a href="https://github.com/stephenmcd/django-overextends" target="_blank" rel="noopener">django-overextends, star:90</a> - Django 中的环型模板继承。</li><li><a href="https://github.com/ericflo/django-pagination" target="_blank" rel="noopener">django-pagination, star:505</a> - <a href="https://github.com/ericflo/django-pagination。（3" target="_blank" rel="noopener">https://github.com/ericflo/django-pagination。（3</a> 年未更新)</li><li><a href="https://github.com/shtalinberg/django-el-pagination" target="_blank" rel="noopener">django-el-pagination, star:113</a> - Django EL(Endless) Pagination 可用于提供 Twitter 风格或 Digg 风格的分页，可支持 Ajax。</li><li><a href="https://github.com/tomwalker/django_quiz/" target="_blank" rel="noopener">django-quiz-app, star:196</a> - 这是一个可配置的 Django 调查问答应用。</li><li><a href="https://github.com/praekelt/django-recaptcha/" target="_blank" rel="noopener">django-recaptcha, star:391</a> - Django reCAPTCHA 表单项/组件集成应用。</li><li><a href="https://github.com/semente/django-smuggler/" target="_blank" rel="noopener">django-smuggler, star:228</a> - Django Smuggler 是 Django Web 框架中的一个可插拔应用，可用于在自动生成的管理界面中导入/导出 fixtures。</li><li><a href="https://github.com/lazybird/django-solo/" target="_blank" rel="noopener">django-solo, star:273</a> - 有助于使用单例 – 全局设置等那些你想在管理站点上进行编辑的事物。</li><li><a href="https://github.com/epantry/django-sql-explorer/" target="_blank" rel="noopener">django-sql-explorer, star:1251</a> - 能通过 SQL 查询进行数据共享更加容易。</li><li><a href="https://github.com/evonove/django-stored-messages/" target="_blank" rel="noopener">django-stored-messages, star:71</a> - 将 Django 消息保存到你的项目后端。（1 年未更新）</li><li><a href="https://github.com/jsocol/django-ratelimit/" target="_blank" rel="noopener">django-ratelimit, star:336</a> - 为限速率视图提供了一个装饰器。可基于 IP 地址或请求中的某项（GET 或 POST 中的变量）进行限制。</li><li><a href="https://github.com/un33k/django-uuslug/" target="_blank" rel="noopener">django-uuslug, star:187</a> - 一个 slugify 应用，能保证唯一性，且能处理 Unicode。</li><li><a href="https://github.com/mwarkentin/django-watchman/" target="_blank" rel="noopener">django-watchman, star:145</a> - django-watchman 为你的数据库，缓存等后端服务提供状态端点。</li><li><a href="https://github.com/jrief/django-websocket-redis" target="_blank" rel="noopener">django-websocket-redis, star:611</a> - 为 Django 应用实现的 Websockets，使用 Redis 作为消息队列。</li><li><a href="http://tryolabs.github.io/metamon/" target="_blank" rel="noopener">metamon, star:348</a> - 一组 Ansible playbooks 集合，可用于快速创建 Django 应用。</li><li><a href="https://github.com/coleifer/micawber/" target="_blank" rel="noopener">micawber, star:338</a> - 一个用于从 URL 抽取内容的小型库。</li><li><a href="https://github.com/matthiask/towel/" target="_blank" rel="noopener">towel, star:68</a> - 一个工具集，能极大地方便你的 Django 开发。</li></ul><h1 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h1><p><em>出色的 Django 项目</em></p><h2 id="CMS"><a href="#CMS" class="headerlink" title="CMS"></a>CMS</h2><ul><li><a href="https://github.com/divio/django-cms/" target="_blank" rel="noopener">django-cms, star:4880</a> - 易用且对开发者友好的 CMS。</li><li><a href="https://github.com/ridethepony/django-fiber" target="_blank" rel="noopener">django-fiber, star:552</a> - Django Fiber, 一个简单易用的 CMS，可用于所有的 Django 项目中。</li><li><a href="https://github.com/feincms/feincms/" target="_blank" rel="noopener">feincms, star:697</a> - 一个基于 Django 的 CMS，关注于扩展性和代码的简洁性。</li><li><a href="https://github.com/stephenmcd/mezzanine/" target="_blank" rel="noopener">Mezzanine, star:3057</a> - 一个使用 Django 框架构建的内容管理平台。</li><li><a href="https://github.com/torchbox/wagtail/" target="_blank" rel="noopener">wagtail, star:4325</a> - 一个新的 Django 内容管理系统。</li><li><a href="https://github.com/django-leonardo/django-leonardo/" target="_blank" rel="noopener">leonardo, star:61</a> - 一个新的 Django 内容管理系统，基于 FeinCMS 和 OpenStack Horizon 构建。</li></ul><h2 id="文档管理"><a href="#文档管理" class="headerlink" title="文档管理"></a>文档管理</h2><ul><li><a href="https://github.com/mayan-edms/mayan-edms/" target="_blank" rel="noopener">mayan-edms, star:251</a> - 一个开源的，基于 Django 的 DMS (文档管理系统)，它具有自定义元数据索引、文件服务集成、OCR 功能、文档版本控制和电子签名验证等功能。</li></ul><h2 id="电子商务"><a href="#电子商务" class="headerlink" title="电子商务"></a>电子商务</h2><ul><li><a href="https://github.com/stephenmcd/cartridge" target="_blank" rel="noopener">Cartridge, star:523</a> - Django/Mezzanine 的电子商务应用。</li><li><a href="https://github.com/django-oscar/django-oscar" target="_blank" rel="noopener">django-oscar, star:2495</a> - Django 中基于领域驱动的电子商务框架。</li><li><a href="http://www.getlfs.com/" target="_blank" rel="noopener">Lighting Fas Shop</a> - Lighting Fas Shop 是一个用 Django 构建的电子商务解决方案。</li><li><a href="http://getsaleor.com/" target="_blank" rel="noopener">Saleor</a> - 在 Python 和 Django 中使用的电子商务店铺。</li><li><a href="http://satchless.com/" target="_blank" rel="noopener">Satchless</a> - Satchless 将电子商务和 Python 结合了起来。</li><li><a href="https://bitbucket.org/chris1610/satchmo/src/" target="_blank" rel="noopener">Satchmo</a> - Satchmo 是一个用 Django 构建的电子商务框架，它能使你开发独一无二且健壮的在线商店。</li></ul><h2 id="其它-1"><a href="#其它-1" class="headerlink" title="其它"></a>其它</h2><ul><li><a href="https://github.com/pydanny/djangopackages/" target="_blank" rel="noopener">Django packages, star:248</a> - Django Packages 是一个 Django 的可复用应用，站点，工具等的目录。</li><li><a href="https://github.com/wunki/django-salted/" target="_blank" rel="noopener">django-salted, star:329</a> - 使用 Vagrant 的 Django 项目全栈 SaltStack 配置。（4 年前更新）</li><li><a href="https://github.com/stephenmcd/drum" target="_blank" rel="noopener">Drum, star:319</a> - Reddit / Hacker News 的克隆版，使用 Django/Mezzanine。</li><li><a href="https://github.com/tfroehlich82/koalixcrm" target="_blank" rel="noopener">koalixcrm, star:60</a> - 适用于小业务的完美的 CRM/ERP。</li></ul><h2 id="项目管理-1"><a href="#项目管理-1" class="headerlink" title="项目管理"></a>项目管理</h2><ul><li><a href="https://github.com/orges/itsy/" target="_blank" rel="noopener">ITSY, star:74</a> - 问题跟踪系统。（3 年前更新）</li><li><a href="https://github.com/taigaio/taiga-back" target="_blank" rel="noopener">taiga, star:3467</a> - 敏捷，免费而且开源的项目管理工具，基于 Django 和 Angular。</li></ul><h1 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h1><p><em>探索新 Django 应用和项目的地方。</em></p><h2 id="图书"><a href="#图书" class="headerlink" title="图书"></a>图书</h2><ul><li><a href="https://github.com/kevinlondon/django-by-example" target="_blank" rel="noopener">Django by Example</a> (1.2)</li><li><a href="http://agiliq.com/books/djenofdjango/" target="_blank" rel="noopener">Djen of Django</a> (&lt; 1.7)</li><li><a href="http://www.effectivedjango.com/" target="_blank" rel="noopener">Effective Django</a> (1.5)</li><li><a href="http://gettingstartedwithdjango.com/" target="_blank" rel="noopener">Getting started with Django</a> (video)</li><li><a href="https://highperformancedjango.com/" target="_blank" rel="noopener">High Performance Django</a> (1.7) - 部署快速、可扩展的 Django 站点。</li><li><a href="http://shop.oreilly.com/product/0636920032502.do" target="_blank" rel="noopener">Lightweight Django</a> (1.7) - 使用 REST, WebSockets, Backbone 和 Django。</li><li><a href="http://www.tangowithdjango.com/" target="_blank" rel="noopener">Tango With Django</a> (1.5)</li><li><a href="http://chimera.labs.oreilly.com/books/1234000000754/index.html" target="_blank" rel="noopener">Test-Driven Web Development with Python</a> (1.7)</li><li><a href="https://www.twoscoopspress.com/products/two-scoops-of-django-1-8/" target="_blank" rel="noopener">Two Scoops of Django: Best Practices for Django 1.8</a> - 关于 Python 和 Django 开发的最佳实践的书。</li></ul><h2 id="网站"><a href="#网站" class="headerlink" title="网站"></a>网站</h2><ul><li><a href="http://tutorial.djangogirls.org/" target="_blank" rel="noopener">Django Girls Tutorial</a> - 一篇有趣并且吸引人的教程，显示了如何使用 Django 创建一个 blog 并部署到 Heroku。</li><li><a href="http://www.django-introduction.com/" target="_blank" rel="noopener">Django Introduction</a> - 一组可复用的幻灯片，可用于向更多人传授关于 Django 的知识。</li><li><a href="https://github.com/pydanny/djangopackages/" target="_blank" rel="noopener">Django packages</a> - Django Packages 是一个 Django 的可复用应用，站点，工具等的目录。</li><li><a href="https://www.djangosites.org/" target="_blank" rel="noopener">Django Sites</a> - Django Sites 收集了基于 Django 的网站的案例。</li><li><a href="http://www.fullstackpython.com/django.html" target="_blank" rel="noopener">Full Stack Python’s Django page</a> - 包含对 Django 哲学及其组件的解释，并且还有链向其它资源和教程的链接。</li></ul><h2 id="会议"><a href="#会议" class="headerlink" title="会议"></a>会议</h2><ul><li><a href="https://www.djangobeer.com/" target="_blank" rel="noopener">Django Beer</a> - 佛罗伦萨 Django 社区的聚会。</li><li><a href="http://djangovillage.it/" target="_blank" rel="noopener">Django Village</a> - 意大利 Django 社会大会。与全意大利及海外 Django 人的好机会。</li><li><a href="https://twitter.com/djangoweekend" target="_blank" rel="noopener">Django Weekend</a> - 是一个 Django/Python 非营利社区活动，完全由自愿者组织和运营。该大会主要关注 Django，但是有关 Python 的各个方面也都在其范围内。</li><li><a href="http://www.djangounderthehood.com/" target="_blank" rel="noopener">Django: Under The Hood</a> - 是一个令人兴奋的针对有经验的 Django 开发人员的新 Django 会议。来学习关于 Django 的内部机理，帮助规划其愿景。</li><li><a href="http://www.djangocon.eu/" target="_blank" rel="noopener">DjangoCon Europe</a> - 是欧洲年度最大的 Django 会议，通常在暮春举行。</li><li><a href="http://www.djangocon.us/" target="_blank" rel="noopener">DjangoCon US</a> - 是北美最大的 Django 会议，通常在每年九月的第一周举行。</li></ul><h1 id="非-Python-包"><a href="#非-Python-包" class="headerlink" title="非 Python 包"></a>非 Python 包</h1><ul><li><a href="https://github.com/pydanny/cookiecutter-django" target="_blank" rel="noopener">cookiecutter-django, star:2559</a> - 一个 cookiecutter 模板，用于快速创建 Django 项目。</li></ul><h2 id="外部文档"><a href="#外部文档" class="headerlink" title="外部文档"></a>外部文档</h2><p><em>关于 Django 特性的其它信息源。</em></p><ul><li><a href="http://ccbv.co.uk/" target="_blank" rel="noopener">Classy Class-Based Views</a> - 对每个 Django 中基于类的通用视图的全部方法和属性进行了详细的描述。</li><li><a href="http://www.cdrf.co/" target="_blank" rel="noopener">Classy Django REST Framework</a> - 对 Django REST 框架中每个基于类的视图和序列化器的全部方法和属性进行了详细的描述。</li></ul><h2 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h2><ul><li><a href="https://www.codingforentrepreneurs.com/projects/" target="_blank" rel="noopener">CodingforEntrepreneur</a> - 一组关于 Django 及所有基于 Django 的项目的最佳视频集。</li><li><a href="https://godjango.com/" target="_blank" rel="noopener">GoDjango</a> - 包含了从初级到高级的 Django 视频。囊括了从第 3 方应用到 Django 核心组件的内容。</li><li><a href="https://github.com/rosarior/django-must-watch/" target="_blank" rel="noopener">Must Watch Django Videos</a> - 关于 Django 和 Python 的必看视频。</li><li><a href="https://onemonth.com/" target="_blank" rel="noopener">One Month Django</a> - 这组视频集将在一个月内教会你 Django。</li></ul><h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><p><em>那些方便 Django 使用的非 Django 项目。</em></p><ul><li><a href="https://github.com/timonweb/Django-manage.py-anywhere/" target="_blank" rel="noopener">Django-manage.py-anywhere, star:14</a> - 可从任意地方运行 manage.py。找到距离最近的 manage.py 文件，并基于该文件运行命令。</li><li><a href="https://github.com/dcramer/logan" target="_blank" rel="noopener">Logan, star:192</a> - 一个用于单独运行 Django 应用的工具集。它提供了用于创建一个 CLI 运行器，管理配置信息，及启动程序的工具（2 年前更新）。</li></ul><h1 id="贡献"><a href="#贡献" class="headerlink" title="贡献"></a>贡献</h1><p>Just fork and send a pull request with your awesome Django apps, projects or resources. By contributing you agree to abide by the Code of Merit.</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python工具包 </tag>
            
            <tag> 后端文章转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python中的虚拟环境（Virtualenv）及其工作原理</title>
      <link href="/2020/04/24/python-xu-ni-huan-jing-yuan-li/"/>
      <url>/2020/04/24/python-xu-ni-huan-jing-yuan-li/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://note.qidong.name/2019/03/python-virtualenv/" target="_blank" rel="noopener">https://note.qidong.name/2019/03/python-virtualenv/</a></p><p>文章作者：<a href="http://weibo.com/u/2837672545" target="_blank" rel="noopener">匿蟒</a></p><p>作者博客：<a href="https://note.qidong.name/" target="_blank" rel="noopener">https://note.qidong.name/</a></p></blockquote><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>也许Python由于2和3的分裂，Python发展出了虚拟环境（<a href="https://virtualenv.pypa.io/" target="_blank" rel="noopener">virtualenv</a>）的技术。 还有一个原因——可能这才是主要原因——Python的包只能同时安装一个版本。 这种行为是学自系统包管理器。 对系统来说，一个包安装一个版本就够了。 但是对一个开发多个复杂项目的环境来说，只有像Java系的Maven库那样，多个版本同时保留，依赖检查延迟到打包时，才能确保并行开发。 否则，A项目需要S软件的1.0版本，B项目需要它的2.0，这就没法一起玩了。</p><p><a href="https://virtualenv.pypa.io/" target="_blank" rel="noopener">virtualenv</a>的关键词是隔离（Isolation）。 它能创造一个包含特定版本的Python环境，并且确保Python软件包非常干净。 它创造性地使用了一些Shell和Python原有的机制，实现了虚拟环境的功能。</p><p>因此，开发每个Python项目时，都推荐创建对应的<a href="https://virtualenv.pypa.io/" target="_blank" rel="noopener">virtualenv</a>来隔离开发。 这样可以不受系统Python软件包的影响，安装任意包的任意版本，并且最终能通过<code>pip freeze &gt; requirements.txt</code>获取依赖列表。 （当然，这个列表通常需要裁剪。）</p><h3 id="安装virtualenv"><a href="#安装virtualenv" class="headerlink" title="安装virtualenv"></a>安装virtualenv</h3><p>使用<code>apt</code>、<code>yum</code>等包管理器安装的版本老旧，推荐使用<code>pip</code>安装。</p><pre class=" language-sh"><code class="language-sh">pip3 install --user virtualenv</code></pre><h3 id="准备virtualenv"><a href="#准备virtualenv" class="headerlink" title="准备virtualenv"></a>准备virtualenv</h3><p>每个项目，都需要独立创建一个（或多个）虚拟环境，隔离开发。</p><pre class=" language-sh"><code class="language-sh">virtualenv -p python3 venv</code></pre><p><code>-p</code>是显式指定Python版本，避免使用默认的<code>python</code>。 虚拟环境的常用名，可选择<code>env</code>、<code>venv</code>、<code>.env</code>、<code>.venv</code>。 <code>venv</code>是PyCharm的默认虚拟环境名称。</p><h3 id="激活virtualenv"><a href="#激活virtualenv" class="headerlink" title="激活virtualenv"></a>激活virtualenv</h3><p>默认使用的是用户+系统环境，激活后才是虚拟环境。</p><pre class=" language-sh"><code class="language-sh">source venv/bin/activate</code></pre><p>激活虚拟环境后，可以看到只有三个Python包。 这个环境可以随意使用，所有安装都会在<code>./venv/</code>下，不会影响系统环境。 干净的环境，也能帮助开发人员确认依赖。</p><pre class=" language-shell"><code class="language-shell">$ pip listPackage    Version---------- -------pip        19.0.3setuptools 40.8.0wheel      0.33.1</code></pre><p>在这个虚拟环境中，<code>python</code>就是<code>python3</code>，而系统环境的<code>python</code>通常是<code>python2</code>。 在安装软件时，直接使用<code>pip</code>，即可安装到虚拟环境中。 而不像一般状态下，要么加<code>sudo</code>提权（[brew]或Windows环境下不用），要么安装时需要加<code>--user</code>，安装到用户目录下。</p><p>以下是系统、用户、虚拟环境三种方式安装，以及可执行文件<code>pylint</code>被安装的位置。</p><pre class=" language-shell"><code class="language-shell">$ sudo pip install pylint$ ls /usr/local/bin/pylint/usr/local/bin/pylint$ pip install --user pylint$ ls ~/.local/bin/pylint/home/user/.local/bin/pylint$ source venv/bin/activate$ pip install pylint$ ls venv/bin/pylintvenv/bin/pylint</code></pre><h3 id="退出virtualenv"><a href="#退出virtualenv" class="headerlink" title="退出virtualenv"></a>退出virtualenv</h3><pre class=" language-sh"><code class="language-sh">deactivate</code></pre><p>退出后，回到用户+系统环境。</p><h2 id="虚拟环境的原理"><a href="#虚拟环境的原理" class="headerlink" title="虚拟环境的原理"></a>虚拟环境的原理</h2><p>上面的实操指南，只要照做，就能把虚拟环境用起来。 用多了，自然能够理解它。 <a href="https://virtualenv.pypa.io/" target="_blank" rel="noopener">virtualenv</a>是如何创建一个隔离的Python虚拟环境？这个环境有什么特点？</p><p>这个环境的特点有二：</p><ul><li>Python版本固定。即使系统的Python升级了，虚拟环境中的仍然不受影响，保留开发状态。</li><li>所有Python软件包，都只在这个环境生效。一旦退出，则回到用户+系统的默认环境中。</li></ul><p>这两个特点，由两个小手段实现。</p><ul><li>改变当前Shell的<code>PATH</code>。</li><li>改变Python运行时的<code>sys.path</code>。</li></ul><p>以下为<code>python:alpine</code>镜像中，以<code>root</code>用户演示的例子。</p><h3 id="改变PATH"><a href="#改变PATH" class="headerlink" title="改变PATH"></a>改变<code>PATH</code></h3><p>首先看一下它的目录结构：</p><pre class=" language-shell"><code class="language-shell"># ls venvbin      include  lib# ls /usr/localbin      include  lib      share</code></pre><p>环境内所有的新内容，都在这个新生成目录下。 <code>bin</code>是可执行文件的位置，<code>include</code>是C/C++的头文件位置，<code>lib</code>是库文件位置。 它和<code>/usr/local</code>内的主要目录几乎相同，也和<code>~/.local</code>下类似。</p><p>魔法都在两个<code>PATH</code>中。</p><pre class=" language-shell"><code class="language-shell"># echo $PATH/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin# . venv/bin/activate(venv) # echo $PATH/root/venv/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code></pre><p>显然，这个<code>activate</code>，为当前<code>PATH</code>增加了<code>venv/bin</code>这个位置在最前方，因此虚拟环境中的可执行文件拥有最高优先级。 而<code>lib</code>与<code>include</code>，仅仅是<code>bin</code>下面的可执行文件做相对路径运算来寻找的位置。 所以，改变了<code>PATH</code>，就改变了很多事。</p><pre class=" language-shell"><code class="language-shell"># ls -hl venv/bin/total 88-rw-r--r--    1 root     root        2.0K Mar 31 08:06 activate-rw-r--r--    1 root     root        1.1K Mar 31 08:06 activate.csh-rw-r--r--    1 root     root        3.0K Mar 31 08:06 activate.fish-rw-r--r--    1 root     root        1.5K Mar 31 08:06 activate.ps1-rw-r--r--    1 root     root         986 Mar 31 08:06 activate.xsh-rw-r--r--    1 root     root        1.5K Mar 31 08:06 activate_this.py-rwxr-xr-x    1 root     root         238 Mar 31 08:06 easy_install-rwxr-xr-x    1 root     root         238 Mar 31 08:06 easy_install-3.7-rwxr-xr-x    1 root     root         220 Mar 31 08:06 pip-rwxr-xr-x    1 root     root         220 Mar 31 08:06 pip3-rwxr-xr-x    1 root     root         220 Mar 31 08:06 pip3.7-rwxr-xr-x    1 root     root       35.8K Mar 31 08:06 python-rwxr-xr-x    1 root     root        2.3K Mar 31 08:06 python-configlrwxrwxrwx    1 root     root           6 Mar 31 08:06 python3 -> pythonlrwxrwxrwx    1 root     root           6 Mar 31 08:06 python3.7 -> python-rwxr-xr-x    1 root     root         216 Mar 31 08:06 wheel</code></pre><p>由于优先级最高，所以环境里的<code>python</code>、<code>pip</code>等，包括后来用<code>pip</code>安装的可执行文件，都使用的是<code>venv</code>下的。</p><h3 id="改变sys-path"><a href="#改变sys-path" class="headerlink" title="改变sys.path"></a>改变<code>sys.path</code></h3><pre class=" language-shell"><code class="language-shell">(venv) # python -m sitesys.path = [    '/root',    '/root/venv/lib/python37.zip',    '/root/venv/lib/python3.7',    '/root/venv/lib/python3.7/lib-dynload',    '/usr/local/lib/python3.7',    '/root/venv/lib/python3.7/site-packages',]USER_BASE: '/root/.local' (doesn't exist)USER_SITE: '/root/.local/lib/python3.7/site-packages' (doesn't exist)ENABLE_USER_SITE: False(venv) # deactivate# python -m sitesys.path = [    '/root',    '/usr/local/lib/python37.zip',    '/usr/local/lib/python3.7',    '/usr/local/lib/python3.7/lib-dynload',    '/usr/local/lib/python3.7/site-packages',]USER_BASE: '/root/.local' (doesn't exist)USER_SITE: '/root/.local/lib/python3.7/site-packages' (doesn't exist)ENABLE_USER_SITE: True</code></pre><p>可见，<code>sys.path</code>发生了翻天覆地的变化。 除了当前路径<code>/root</code>和标准库<code>/usr/local/lib/python3.7</code>被保留以外，其它位置都换成了<code>venv</code>下的。 这就是为什么<code>pip list</code>看不见什么软件包的原因，也是环境隔离的最大秘密。</p><h2 id="标准库venv"><a href="#标准库venv" class="headerlink" title="标准库venv"></a>标准库venv</h2><p>从Python 3.3开始，标准库中就自带了一个<a href="https://docs.python.org/3/library/venv.html" target="_blank" rel="noopener">venv</a>模块，拥有<a href="https://virtualenv.pypa.io/" target="_blank" rel="noopener">virtualenv</a>的部分功能。 因此，也可以通过以下命令来创建虚拟环境。</p><pre class=" language-sh"><code class="language-sh">python3 -m venv venv</code></pre><p>但还是推荐使用<a href="https://virtualenv.pypa.io/" target="_blank" rel="noopener">virtualenv</a>。 <a href="https://docs.python.org/3/library/venv.html" target="_blank" rel="noopener">venv</a>只能创建当前版本的虚拟环境，不能创建其它Python 3.x的版本，以及Python 2的环境。</p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>虚拟环境技术，早已成为当今Python生态的一个核心内容。 除了广泛而频繁的使用以外，它也成为了其它技术的基石。</p><ul><li><a href="https://github.com/kennethreitz/autoenv" target="_blank" rel="noopener">autoenv</a>是一个让你<code>cd</code>到某个目录下，就自动<code>source</code>进入虚拟环境的小工具，省去了手动<code>source</code>的操作。</li><li><a href="https://github.com/pypa/pipenv" target="_blank" rel="noopener">pipenv</a>基于<a href="https://github.com/pypa/pipfile" target="_blank" rel="noopener">Pipfile</a>，结合了<code>pip</code>和<a href="https://virtualenv.pypa.io/" target="_blank" rel="noopener">virtualenv</a>，让你可以有更好的依赖管理。</li><li><a href="https://tox.readthedocs.io/" target="_blank" rel="noopener">tox</a>是一个标准化、自动化的测试技术。 基于<a href="https://virtualenv.pypa.io/" target="_blank" rel="noopener">virtualenv</a>，它能同时在不同平台、类型与版本的Python下测试，确保软件包的兼容性。</li><li><a href="https://conda.io/" target="_blank" rel="noopener">conda</a>是专为数据科学而设计的<a href="https://www.anaconda.com/" target="_blank" rel="noopener">Anaconda</a>的包管理器。 它不仅是<code>pip</code>的另一个替代，而且更进一步，自建了完整生态。 它充分利用了<a href="https://virtualenv.pypa.io/" target="_blank" rel="noopener">virtualenv</a>的特点，把C/C++的包也纳入管理，改进了原先<code>pip</code>+<code>apt</code>才能实现的依赖管理。</li></ul><p>当然，最近几年，由[Docker]兴起而导致的革命，改变了一切。 在生产环境，虚拟环境最终被容器所取代，仅在开发环境和部分测试环境据守。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://virtualenv.pypa.io/" target="_blank" rel="noopener">Virtualenv — virtualenv 16.4.4.dev0 documentation</a></li><li><a href="https://docs.python.org/3/library/venv.html" target="_blank" rel="noopener">venv — Creation of virtual environments — Python 3.7.3 documentation</a></li><li><a href="https://docs.python-guide.org/dev/virtualenvs/" target="_blank" rel="noopener">Pipenv &amp; Virtual Environments — The Hitchhiker’s Guide to Python</a> Python由于2和3的分裂，发展出了虚拟环境（<a href="https://virtualenv.pypa.io/" target="_blank" rel="noopener">virtualenv</a>）的技术。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 后端文章转载 </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python中的多进程（multiprocessing）</title>
      <link href="/2020/04/24/python-zhong-de-duo-jin-cheng/"/>
      <url>/2020/04/24/python-zhong-de-duo-jin-cheng/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://note.qidong.name/2018/11/python-multiprocessing/" target="_blank" rel="noopener">https://note.qidong.name/2018/11/python-multiprocessing/</a></p><p>文章作者：<a href="http://weibo.com/u/2837672545" target="_blank" rel="noopener">匿蟒</a></p><p>作者博客：<a href="https://note.qidong.name/" target="_blank" rel="noopener">https://note.qidong.name/</a></p></blockquote><p>Python中的多线程、包括协程，由于CPython的<a href="https://docs.python.org/3/glossary.html#term-global-interpreter-lock" target="_blank" rel="noopener">GIL</a>（Global interpreter Lock ，全局解释锁）问题，只能实现并发（Concurrency），不能实现并行（Parallelism）。 因此，在并行计算场景，多进程是Python最简单的选择。</p><h2 id="Python多进程概念"><a href="#Python多进程概念" class="headerlink" title="Python多进程概念"></a>Python多进程概念</h2><p>概念，就是<code>class</code>。 了解概念，就会了解<code>class</code>之间的关系。</p><h3 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h3><p>与普通的多进程类似，Python多进程的核心概念是<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Process" target="_blank" rel="noopener">Process</a>（进程）。 一个简单的进程使用示例如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    p0 <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>f<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'alice'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    p1 <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>f<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'bob'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    p0<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    p1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    p0<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>    p1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>进程使用三部曲：</p><ol><li>创建<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Process" target="_blank" rel="noopener">Process</a>。</li><li><code>start</code>，开始执行。</li><li><code>join</code>，等待执行完毕。</li></ol><h3 id="Pipe"><a href="#Pipe" class="headerlink" title="Pipe"></a>Pipe</h3><p><a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Pipe" target="_blank" rel="noopener">Pipe</a>即管道，是Bash中最常见的跨进程通信手段。 <code>echo hello | tee stdout.log</code>，中间的<code>|</code>就是管道，把前一个进程的stdout传递给下一个进程。</p><p><a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Pipe" target="_blank" rel="noopener">Pipe</a>创建时，返回两个<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.connection.Connection" target="_blank" rel="noopener">Connection</a>，前者负责<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.connection.Connection.send" target="_blank" rel="noopener">send</a>而后者负责<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.connection.Connection.recv" target="_blank" rel="noopener">recv</a>。 两个进程各执一端，就可以实现单向通信。</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> Pipe<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">:</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> None<span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    receiver<span class="token punctuation">,</span> sender <span class="token operator">=</span> Pipe<span class="token punctuation">(</span><span class="token punctuation">)</span>    p <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>f<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>receiver<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># prints "[42, None, 'hello']"</span>    p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>如果在创建<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Pipe" target="_blank" rel="noopener">Pipe</a>时，指定<code>duplex=True</code>，比如<code>Pipe(True)</code>，两个<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.connection.Connection" target="_blank" rel="noopener">Connection</a>即可实现双向通信。 默认<code>duplex=False</code>。</p><h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><p><a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Queue" target="_blank" rel="noopener">Queue</a>是一个基于标准模块<a href="https://docs.python.org/3/library/queue.html#module-queue" target="_blank" rel="noopener">queue</a>、包装了<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Pipe" target="_blank" rel="noopener">Pipe</a>的类。 它不仅具有先进先出（FIFO）的特性，还能实现跨进程通信。</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> Queue<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">:</span>    q<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> None<span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>    p <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>f<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># prints "[42, None, 'hello']"</span>    p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>在实际使用中，除了少数简单场景外，都不会直接使用<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Process" target="_blank" rel="noopener">Process</a>、<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Pipe" target="_blank" rel="noopener">Pipe</a>、<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Queue" target="_blank" rel="noopener">Queue</a>来实现多进程。 这种低层级（low level，无贬义）的API，可读性差，容易出错。 常用的是高层级API——进程池。</p><h3 id="Pool"><a href="#Pool" class="headerlink" title="Pool"></a>Pool</h3><p>由于<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Process" target="_blank" rel="noopener">Process</a>创建、销毁有较大开销，并且并行数受机器CPU数量的限制，过多无益。 一个<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool" target="_blank" rel="noopener">Pool</a>（进程池）会统一创建并维持一定数量的<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Process" target="_blank" rel="noopener">Process</a>，并行地执行Task。 在所有Task执行完毕后，再统一地关闭<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Process" target="_blank" rel="noopener">Process</a>。</p><p>这里Task（任务）的概念，并未被实现为一个<code>class</code>，而是一个<code>callable</code>，比如下面的<code>f</code>、<code>g</code>。</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python3</span><span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span><span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>pool <span class="token keyword">import</span> Pool<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> x <span class="token operator">*</span> x<span class="token keyword">def</span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> x<span class="token operator">**</span>y<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pool<span class="token punctuation">:</span>        result <span class="token operator">=</span> pool<span class="token punctuation">.</span>map<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    <span class="token keyword">with</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pool<span class="token punctuation">:</span>        result <span class="token operator">=</span> pool<span class="token punctuation">.</span>starmap<span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>以上代码保存为<code>multi.py</code>文件，执行结果如下：</p><pre class=" language-shell"><code class="language-shell">$ python3 multi.py<class 'list'>[1, 4, 9, 16, 25]<class 'list'>[1, 16, 243, 4096, 78125]</code></pre><p><a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.map" target="_blank" rel="noopener">map</a>的用法类似内置函数<code>map</code>，专门处理单个参数的<code>callable</code>； 而<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.starmap" target="_blank" rel="noopener">starmap</a>则是用来处理多个参数的<code>callable</code>。</p><p>此外，还有利用<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool" target="_blank" rel="noopener">Pool</a>执行单个Task的<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.apply" target="_blank" rel="noopener">apply</a>。 除非Task本身就是一个个来的，否则使用<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.apply" target="_blank" rel="noopener">apply</a>的效率不高。</p><p>比起<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.apply" target="_blank" rel="noopener">apply</a>，更值得关注的是<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.imap" target="_blank" rel="noopener">imap</a>和<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.imap_unordered" target="_blank" rel="noopener">imap_unordered</a>。 <a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.imap" target="_blank" rel="noopener">imap</a>和<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.map" target="_blank" rel="noopener">map</a>非常类似，而这个多出来的<code>i</code>，则是<code>Iterable</code>。 <a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.map" target="_blank" rel="noopener">map</a>使用的是<code>list</code>而<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.imap" target="_blank" rel="noopener">imap</a>则是<code>Iterable</code>，前者效率略高，而后者内存消耗显著的小。 在处理结果上，<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.imap" target="_blank" rel="noopener">imap</a>可以尽快返回一个<code>Iterable</code>的结果，而<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.map" target="_blank" rel="noopener">map</a>则需要等待全部Task执行完毕，返回<code>list</code>。 无论<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.map" target="_blank" rel="noopener">map</a>还是<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.imap" target="_blank" rel="noopener">imap</a>，都需要按顺序等待Task执行完成，而<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.imap_unordered" target="_blank" rel="noopener">imap_unordered</a>则不必。 <a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.imap_unordered" target="_blank" rel="noopener">imap_unordered</a>返回的<code>Iterable</code>，会优先迭代到先执行完成的Task。 三者各有特点，要按需使用。</p><h3 id="AsyncResult"><a href="#AsyncResult" class="headerlink" title="AsyncResult"></a>AsyncResult</h3><p>以上为进程池的同步使用方案。 同步方案会卡在<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.map" target="_blank" rel="noopener">map</a>或<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.starmap" target="_blank" rel="noopener">starmap</a>这一行，直到所有任务都执行完毕。 有时，我们会需要一个异步方案，这时就需要用到<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.map_async" target="_blank" rel="noopener">map_async</a>或<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.starmap_async" target="_blank" rel="noopener">starmap_async</a>。 它们返回的结果，就是<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.AsyncResult" target="_blank" rel="noopener">AsyncResult</a>。</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python3</span><span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span><span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>pool <span class="token keyword">import</span> Pool<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> x <span class="token operator">*</span> x<span class="token keyword">def</span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> x<span class="token operator">**</span>y<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pool<span class="token punctuation">:</span>        result <span class="token operator">=</span> pool<span class="token punctuation">.</span>map_async<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pool<span class="token punctuation">:</span>        result <span class="token operator">=</span> pool<span class="token punctuation">.</span>starmap_async<span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>以上代码保存为<code>multi_async.py</code>文件，执行结果如下：</p><pre class=" language-shell"><code class="language-shell">$ python3 multi_async.py<class 'multiprocessing.pool.MapResult'>[1, 4, 9, 16, 25]<class 'multiprocessing.pool.MapResult'>[1, 16, 243, 4096, 78125]</code></pre><p>以上代码中，实际等待位置是<code>result.get()</code>那一行。</p><h2 id="Timeout"><a href="#Timeout" class="headerlink" title="Timeout"></a>Timeout</h2><p>以上多进程代码，其实是不完善的。 除非Task非常简单，并无IO、网络等资源依赖，否则多进程也好、多线程也好，都有可能执行不完。 为了避免未知原因的挂起，及时止损，通常需要设置<code>timeout</code>。 <a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.AsyncResult" target="_blank" rel="noopener">AsyncResult</a>在阻塞时，可以用<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.AsyncResult.wait" target="_blank" rel="noopener">wait</a>或<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.AsyncResult.get" target="_blank" rel="noopener">get</a>，设置<code>timeout</code>参数。</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python3</span><span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span><span class="token keyword">import</span> time<span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>pool <span class="token keyword">import</span> Pool<span class="token punctuation">,</span> TimeoutError<span class="token keyword">def</span> <span class="token function">sleep</span><span class="token punctuation">(</span>duration<span class="token punctuation">)</span><span class="token punctuation">:</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>duration<span class="token punctuation">)</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'result.log'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> file<span class="token punctuation">:</span>        file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>str<span class="token punctuation">(</span>duration<span class="token punctuation">)</span><span class="token punctuation">)</span>        file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> duration<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pool<span class="token punctuation">:</span>        result <span class="token operator">=</span> pool<span class="token punctuation">.</span>map_async<span class="token punctuation">(</span>sleep<span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> TimeoutError<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>TimeoutError<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>以上代码保存为<code>timeout.py</code>文件，执行结果如下：</p><pre class=" language-shell"><code class="language-shell">$ python3 timeout.pyTimeoutError$ cat result.log01234</code></pre><p>可以看到，由于<code>timeout=5</code>，4秒以前的Task都成功了，而大于（等于）5秒的Task都失败了。</p><p>当<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.AsyncResult.get" target="_blank" rel="noopener">get</a>需要等待所有进程结束时，需要在<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool" target="_blank" rel="noopener">Pool</a>关闭以前。 因此，需要在<code>with</code>作用域中执行，否则将超时或（没设<code>timeout</code>）挂死。 如果使用<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.AsyncResult.wait" target="_blank" rel="noopener">wait</a>，则<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.AsyncResult.get" target="_blank" rel="noopener">get</a>可以在<code>with</code>以外获取结果。 因此，更<strong>推荐使用</strong><a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.AsyncResult.wait" target="_blank" rel="noopener">wait</a>配合<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.AsyncResult.get" target="_blank" rel="noopener">get</a>。</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pool<span class="token punctuation">:</span>        result <span class="token operator">=</span> pool<span class="token punctuation">.</span>map_async<span class="token punctuation">(</span>sleep<span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        result<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> TimeoutError<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>TimeoutError<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span></code></pre><p>替换<code>main()</code>，执行结果如下：</p><pre class=" language-shell"><code class="language-shell">$ python3 timeout.py[0, 1, 2, 3, 4, 5, 6, 7]</code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>前面提到Python做并行计算的选择，多进程<a href="https://docs.python.org/3/library/multiprocessing.html" target="_blank" rel="noopener">multiprocessing</a>只是最简单的一个选择。 另外还有两个常见选择： 一是使用其它解释器实现的Python，比如PyPy、Jython等； 二是使用C语言优化需要并行的代码，在Native层绕过GIL的限制； 三是使用协程（或线程）加<a href="https://docs.python.org/3/library/subprocess.html" target="_blank" rel="noopener">subprocess</a>，这也算是多进程的一个方案。 此外，确认代码是否真的会被GIL所影响，是首要工作。 如果代码中真正耗时的计算是在Native层执行——这在Python中非常常见，比如OpenCV——那么用多线程也没问题。</p><p>另外，要注意多进程的测试覆盖问题。 在另一个进程执行的代码，是无法被<a href="https://pypi.org/project/coverage/" target="_blank" rel="noopener">coverage</a>确认为已覆盖的。 需要对执行内容进行单独测试，或者在程序中预留未用多进程优化的原始方案。</p><p>其实，多进程带来的额外通信、切换开销，有时候也是很明显的。 还有个问题是，主进程被杀掉后，子进程会仍然存活，这在某些场景下会产生未知问题。 所以，在机器不是很强大的场景下，用原始的单线程串行方案，是最经济实用的选择。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://docs.python.org/3/library/multiprocessing.html" target="_blank" rel="noopener">multiprocessing — Process-based parallelism — Python 3.7.1 documentation</a></li><li><a href="https://stackoverflow.com/a/26521507/5588463" target="_blank" rel="noopener">python - multiprocessing.Pool: What’s the difference between map_async and imap? - Stack Overflow</a></li><li><a href="https://zhuanlan.zhihu.com/p/30275154" target="_blank" rel="noopener">谈谈Python协程技术的演进 - 知乎</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 后端文章转载 </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用cookiecutter来创建新项目</title>
      <link href="/2020/04/24/cookiecutter-chuang-jian-xin-xiang-mu/"/>
      <url>/2020/04/24/cookiecutter-chuang-jian-xin-xiang-mu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://note.qidong.name/2018/10/cookiecutter/" target="_blank" rel="noopener">https://note.qidong.name/2018/10/cookiecutter/</a></p><p>文章作者：<a href="http://weibo.com/u/2837672545" target="_blank" rel="noopener">匿蟒</a></p><p>作者博客：<a href="https://note.qidong.name/" target="_blank" rel="noopener">https://note.qidong.name/</a></p></blockquote><p>IDE都会有一套生成新项目的向导（Wizard），通过点点点，就可以得到一个可以运行的某类程序。 这样的程序，具备了推荐的项目结构，配置的基本的编译、打包、测试，尽管功能只是一个<code>helloworld</code>。 这个功能，极大地降低了初学者的进入门槛，也统一了某类项目的文件结构，是一个了不起的进步。 最早使用这类手段的，似乎是Visual Studio。</p><p>令人惋惜的是，Python的IDE——PyCharm并不自带这个功能。 这其中，也有Python项目千变万化的因素。 Python的适用范围太广，从桌面到服务器，从游戏到数据分析，都做一套显然投入太大。 而Python又是一门解释型语言，随便写个文件也能直接执行，似乎没有这个必要。</p><p>然而，我要说，还是有必要的！</p><p>因为Python系缺失一个Wizard，也缺少项目结构的标准，于是出现了<a href="https://github.com/audreyr/cookiecutter" target="_blank" rel="noopener">cookiecutter</a>。 这是一个项目生成器，也可称为引擎，因为它只完成了最核心的功能。 真正决定一个项目长什么样的模板，却可以自由定制。 也因此，它能生成任何一种语言的项目。</p><h2 id="安装cookiecutter"><a href="#安装cookiecutter" class="headerlink" title="安装cookiecutter"></a>安装cookiecutter</h2><pre class=" language-sh"><code class="language-sh">pip install cookiecutter</code></pre><p><a href="https://github.com/audreyr/cookiecutter" target="_blank" rel="noopener">cookiecutter</a>就是一个已经发布的Python包，因此用Python的手段可以直接安装。</p><p>对于非Python系的程序员来说，也可以使用包管理器的方式安装。</p><pre class=" language-sh"><code class="language-sh"># For Macbrew install cookiecutter# For Debian/Ubuntusudo apt install cookiecutter</code></pre><h2 id="使用cookiecutter"><a href="#使用cookiecutter" class="headerlink" title="使用cookiecutter"></a>使用cookiecutter</h2><p>首先，寻找一个合适的<a href="https://github.com/audreyr/cookiecutter" target="_blank" rel="noopener">cookiecutter</a>项目。 最主要的方式，就是访问其GitHub主页的<a href="https://github.com/audreyr/cookiecutter/tree/db14e06a1dcc0187beeafde72685c3acef93eb68#a-pantry-full-of-cookiecutters" target="_blank" rel="noopener">A Pantry Full of Cookiecutters</a>。</p><p>如果挑选完毕（这里以<a href="https://github.com/audreyr/cookiecutter-pypackage" target="_blank" rel="noopener">cookiecutter-pypackage</a>为例），则可直接执行<code>cookiecutter</code>生成项目。</p><pre class=" language-sh"><code class="language-sh">$ cookiecutter https://github.com/audreyr/cookiecutter-pypackage.gitfull_name [Yan QiDong]:email [yanqd0@outlook.com]:github_username [yanqd0]:project_name [Python Boilerplate]: trycookieproject_slug [trycookie]:project_short_description [Python Boilerplate contains all the boilerplate you need to create a Python package.]: A descriptionpypi_username [yanqd0]:version [0.1.0]:use_pytest [n]:use_pypi_deployment_with_travis [y]:add_pyup_badge [n]:Select command_line_interface:1 - Click2 - No command-line interfaceChoose from 1, 2 (1, 2) [1]:create_author_file [y]:Select open_source_license:1 - MIT license2 - BSD license3 - ISC license4 - Apache Software License 2.05 - GNU General Public License v36 - Not open sourceChoose from 1, 2, 3, 4, 5, 6 (1, 2, 3, 4, 5, 6) [1]:</code></pre><p>在项目生成过程中，会产生一些提示，需要输入对应信息。 这和各类Wizard的GUI中，填写项目名、包名什么的，是同类操作。 以上是，除了项目名叫<code>trycookie</code>，基本都选默认的一个结果。</p><p>查看项目结构：</p><pre class=" language-sh"><code class="language-sh">$ tree -a trycookietrycookie├── .editorconfig├── .github│   └── ISSUE_TEMPLATE.md├── .gitignore├── .travis.yml├── AUTHORS.rst├── CONTRIBUTING.rst├── HISTORY.rst├── LICENSE├── MANIFEST.in├── Makefile├── README.rst├── docs│   ├── Makefile│   ├── authors.rst│   ├── conf.py│   ├── contributing.rst│   ├── history.rst│   ├── index.rst│   ├── installation.rst│   ├── make.bat│   ├── readme.rst│   └── usage.rst├── requirements_dev.txt├── setup.cfg├── setup.py├── tests│   ├── __init__.py│   └── test_trycookie.py├── tox.ini└── trycookie    ├── __init__.py    ├── cli.py    └── trycookie.py4 directories, 30 files</code></pre><p>如此庞大而复杂的一个项目结构，融合了作者<a href="https://github.com/audreyr" target="_blank" rel="noopener">audreyr</a>对一个开源PyPI项目的理解。 虽然未必适用于任何一个人，但对于什么也不懂的菜鸟来说，却无疑是福音。</p><h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><p><a href="https://github.com/audreyr/cookiecutter" target="_blank" rel="noopener">cookiecutter</a>的工作原理，是先下载一个模板项目，然后替换模板项目的某些内容，生成新的项目。 在以上的示例中，<code>https://github.com/audreyr/cookiecutter-pypackage.git</code>就是一个项目的Git链接。 这可以换成任何一个可以用<code>git clone</code>来下载的链接，包括各种私有Git托管平台。</p><p>如果是GitHub，还可以用以下的等效形式：</p><pre class=" language-sh"><code class="language-sh">cookiecutter gh:audreyr/cookiecutter-pypackage</code></pre><p><a href="https://github.com/audreyr/cookiecutter" target="_blank" rel="noopener">cookiecutter</a>的简短形式，支持以下三种平台。</p><table><thead><tr><th>Platform</th><th>abbreviation</th></tr></thead><tbody><tr><td><a href="https://github.com/" target="_blank" rel="noopener">GitHub</a></td><td><code>gh</code></td></tr><tr><td><a href="https://bitbucket.org/" target="_blank" rel="noopener">BitBucket</a></td><td><code>bb</code></td></tr><tr><td><a href="https://gitlab.com/" target="_blank" rel="noopener">GitLab</a></td><td><code>gl</code></td></tr></tbody></table><p><a href="https://github.com/audreyr/cookiecutter" target="_blank" rel="noopener">cookiecutter</a>也支持Mercurial（<code>hg</code>）。</p><pre class=" language-sh"><code class="language-sh">cookiecutter hg+ssh://hg@bitbucket.org/audreyr/cookiecutter-pypackage</code></pre><p>使用过模板的项目，默认都已经被下载到<code>~/.cookiecutter</code>目录下。 如果需要再次使用，而又无需更新，可以直接用项目名。</p><pre class=" language-sh"><code class="language-sh">cookiecutter cookiecutter-pypackage</code></pre><p>利用这个特点，可以先用各种手段，把模板项目下载到<code>~/.cookiecutter</code>目录下，再来使用。</p><p>参考：<a href="https://cookiecutter.readthedocs.io/en/latest/usage.html" target="_blank" rel="noopener">Usage — cookiecutter 1.6.0 documentation</a></p><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>默认情况下，<code>~/.cookiecutterrc</code>就是配置文件。 它实际上是一个YAML文件。 以下是孤的配置文件示例。</p><pre class=" language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># vim: set filetype=yaml:</span><span class="token key atrule">default_context</span><span class="token punctuation">:</span>  <span class="token key atrule">full_name</span><span class="token punctuation">:</span> <span class="token string">"Yan QiDong"</span>  <span class="token key atrule">email</span><span class="token punctuation">:</span> <span class="token string">"yanqd0@outlook.com"</span>  <span class="token key atrule">github_username</span><span class="token punctuation">:</span> <span class="token string">"yanqd0"</span><span class="token key atrule">cookiecutters_dir</span><span class="token punctuation">:</span> <span class="token string">"~/.cookiecutters/"</span><span class="token key atrule">abbreviations</span><span class="token punctuation">:</span>    <span class="token key atrule">pp</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/audreyr/cookiecutter<span class="token punctuation">-</span>pypackage.git    <span class="token key atrule">gh</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span>.git</code></pre><p>可配置项中，<code>default_context</code>是设置生成项目时，一些提示信息的默认参数。 <code>cookiecutters_dir</code>则是项目的下载位置，一般默认就好。 <code>abbreviations</code>是自定义简短形式，属于高级定制功能，仅适用于重度用户。 通常，填一填<code>default_context</code>就好。</p><p>如果对<code>~/.cookiecutterrc</code>这个配置文件的名称和位置不满意， 可以通过环境变量<code>COOKIECUTTER_CONFIG</code>， 或者在命令行指定参数<code>--config-file</code>来指定新的配置文件。</p><p>参考：<a href="https://cookiecutter.readthedocs.io/en/latest/advanced/user_config.html" target="_blank" rel="noopener">User Config (0.7.0+) — cookiecutter 1.6.0 documentation</a></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><a href="https://github.com/audreyr/cookiecutter" target="_blank" rel="noopener">cookiecutter</a>是一个简单好用的项目生成器引擎，并且已经有很多各种类型的模板。 除了Python项目，还有很多其它语言的项目模板。 它可以极大地省去一个项目初始化的重复劳动，也可以帮助菜鸟程序员成长。</p><p>当然，如果不满意，还是可以自己修改、定制模板的。</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python工具包 </tag>
            
            <tag> 后端文章转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cookiecutter更好的项目模板工具（3）高级用法</title>
      <link href="/2020/04/24/cookiecutter-3/"/>
      <url>/2020/04/24/cookiecutter-3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://www.cnblogs.com/taceywong/p/10508314.html" target="_blank" rel="noopener">https://www.cnblogs.com/taceywong/p/10508314.html</a></p><p>文章作者：Tacey Wong</p></blockquote><p>本文中的<strong>Hook</strong>就是<strong>钩子</strong>,<strong>钩子</strong>就是<strong>Hook</strong></p><h2 id="使用生成前-生成后钩子脚本"><a href="#使用生成前-生成后钩子脚本" class="headerlink" title="使用生成前/生成后钩子脚本"></a>使用生成前/生成后钩子脚本</h2><p>你可以在项目生成之前和/或之后运行Python或Shell脚本。</p><p>像这样把它们放进Hook里：</p><pre class=" language-text"><code class="language-text">cookiecutter-something/├── {{cookiecutter.project_slug}}/├── hooks│   ├── pre_gen_project.py│   └── post_gen_project.py└── cookiecutter.json</code></pre><p>Shell脚本工作方式类似：</p><pre class=" language-text"><code class="language-text">cookiecutter-something/├── {{cookiecutter.project_slug}}/├── hooks│   ├── pre_gen_project.sh│   └── post_gen_project.sh└── cookiecutter.json</code></pre><p>将Cookiecutter扩展到使用其他类型的脚本应该不会太难。你可以根据你系统中存在的脚本系统尝试一下。</p><p>为了可移植性，你应该为Hook使用Python脚本(扩展名为.py)，因为这些脚本可以在任何平台上运行。但是，如果您希望模板仅在单个平台上运行，则shell脚本（或Windows上的.bat文件）原则上都是可行的。</p><h3 id="编写钩子"><a href="#编写钩子" class="headerlink" title="编写钩子"></a>编写钩子</h3><p>这里有一些关于如何编写生成前/生成后钩子脚本的细节。</p><p><strong>以适当的状态退出</strong></p><p>确保钩子脚本以一种健壮的方式工作。如果钩子脚本运行失败(也就是说它以非零退出状态结束)，项目生成将停止，生成的目录将被清除。</p><p><strong>当前工作目录</strong></p><p>运行钩子脚本时，它们的工作目录是生成的项目的根目录。这使得后生成挂钩可以使用相对路径轻松查找生成的文件。</p><p>** 模板变量在脚本中呈现**</p><p>就像你的项目模板一样，Cookiecutter也在你的脚本中呈现Jinja模板语法。这使您可以将Jinja模板变量合并到脚本中。例如，这行Python将<code>module_name</code>设置为<code>cookiecutter.module_name</code>模板变量的值：</p><pre class=" language-python"><code class="language-python">module_name <span class="token operator">=</span> <span class="token string">'{{ cookiecutter.module_name }}'</span></code></pre><h3 id="示例：验证模板变量"><a href="#示例：验证模板变量" class="headerlink" title="示例：验证模板变量"></a>示例：验证模板变量</h3><p>下面是一个脚本示例，它在生成项目之前验证模板变量,将其保存到<code>hooks/pre_gen_project.py:</code>中：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">import</span> sysMODULE_REGEX <span class="token operator">=</span> r<span class="token string">'^[_a-zA-Z][_a-zA-Z0-9]+$'</span>module_name <span class="token operator">=</span> <span class="token string">'{{ cookiecutter.module_name }}'</span><span class="token keyword">if</span> <span class="token operator">not</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span>MODULE_REGEX<span class="token punctuation">,</span> module_name<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ERROR: %s  不是有效的Python模块名称！'</span> <span class="token operator">%</span> module_name<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 以状态1退出，表示失败</span>    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></code></pre><h2 id="用户配置"><a href="#用户配置" class="headerlink" title="用户配置"></a>用户配置</h2><p>如果你经常使用Cookiecutter，你会发现有一个用户配置文件很有用。默认情况下，Cookiecutter尝试从主目录中的.cookiecutterrc文件中检索设置。从1.3.0版本开始，您还可以通过<code>--config-file</code>在命令行上指定配置文件。</p><pre class=" language-bash"><code class="language-bash">$ cookiecutter --config-file /home/tacey/my-custom-config.yaml    cookiecutter-pypackage</code></pre><p>或者你可以设置<code>COOKIECUTTER_CONFIG</code>环境变量：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">export</span> COOKIECUTTER_CONFIG<span class="token operator">=</span>/home/tacey/my-custom-config.yaml </code></pre><p>如果您希望坚持使用内置配置而不加载任何用户配置文件，请使用cli选项<code>--default-config</code>。阻止Cookiecutter加载用户设置对于在隔离环境中编写集成测试至关重要。</p><p>用户配置示例：</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">default_context</span><span class="token punctuation">:</span>    <span class="token key atrule">full_name</span><span class="token punctuation">:</span> <span class="token string">"Tacey Wong"</span>    <span class="token key atrule">email</span><span class="token punctuation">:</span> <span class="token string">"xinyong.wang@qq.com"</span>    <span class="token key atrule">github_username</span><span class="token punctuation">:</span> <span class="token string">"taceywong"</span><span class="token key atrule">cookiecutters_dir</span><span class="token punctuation">:</span> <span class="token string">"/home/tacey/my-custom-cookiecutters-dir/"</span><span class="token key atrule">replay_dir</span><span class="token punctuation">:</span> <span class="token string">"/home/tacey/my-custom-replay-dir/"</span><span class="token key atrule">abbreviations</span><span class="token punctuation">:</span>    <span class="token key atrule">pp</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/audreyr/cookiecutter<span class="token punctuation">-</span>pypackage.git    <span class="token key atrule">gh</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span>.git    <span class="token key atrule">bb</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//bitbucket.org/<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span></code></pre><p>可用的设置是：</p><ul><li>default_context: 每当使用Cookiecutter生成项目时，您希望作为上下文注入的键/值对的列表。生成任何项目时，这些值将被视为cookiecutter.json中的默认值。</li><li>cookiecutters_dir: 当你使用Cookiecutter和git repo参数时，你的Cookiecutter模板被克隆到的目录。</li><li>replay_dir: Cookiecutter转储上下文数据的目录，稍后您可以在使用replay功能时获取该目录。</li><li>abbreviations: cookiecutters的缩写列表。缩写可以是repo名称的简单别名，也可以用作<code>别名:后缀</code>形式的前缀。任何后缀都将使用标准的Python字符串格式插入到扩展中以代替文本{0}，使用上面的别名，你可以简单地通过<code>cookiecutter pp</code>或<code>或cookiecutter gh:audreyr/cookiecutter-pypackage</code>来使用cookiecutter -pypackage模板。上面显示的gh (github)、bb (bitbucket)和gl (gitlab)缩略语实际上是内置的，不需要自己定义就可以使用它们。</li></ul><h2 id="在Python代码中调用Cookiecutter"><a href="#在Python代码中调用Cookiecutter" class="headerlink" title="在Python代码中调用Cookiecutter"></a>在Python代码中调用Cookiecutter</h2><p>你可以在Python代码中使用Cookiecutter</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> cookiecutter<span class="token punctuation">.</span>main <span class="token keyword">import</span> cookiecutter<span class="token comment" spellcheck="true">#根据cookiecutter-pypackage/ 模板创建项目</span>cookiecutter<span class="token punctuation">(</span><span class="token string">'cookiecutter-pypackage/'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 根据cookiecutter-pypackage.git repo 模板创建项目</span>cookiecutter<span class="token punctuation">(</span><span class="token string">'https://github.com/audreyr/cookiecutter-pypackage.git'</span><span class="token punctuation">)</span></code></pre><p>如果您正在编写一个web框架，并且需要为开发人员提供一个类似于django-admin.py startproject或npm init的工具，这将非常有用。</p><h3 id="抑制命令行提示"><a href="#抑制命令行提示" class="headerlink" title="抑制命令行提示"></a>抑制命令行提示</h3><p>使用<code>no_input</code>抑制要求输入的提示。</p><p><strong>基本示例：使用默认设置</strong></p><p>如果与<code>no_input</code>一起使用，Cookiecutter将选择一个默认值：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> cookiecutter<span class="token punctuation">.</span>main <span class="token keyword">import</span> cookiecuttercookiecutter<span class="token punctuation">(</span>    <span class="token string">'cookiecutter-django'</span><span class="token punctuation">,</span>    no_input<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token punctuation">)</span></code></pre><p>在这种情况下，它将使用cookiecutter.json或.cookiecutterrc中定义的默认值。(来自cookiecutter.json的值将被.cookiecutterrc中的值覆盖)</p><p><strong>高级示例：默认+额外的上下文</strong><br>如果将<code>extra_context dict</code>与<code>no_input</code>参数组合在一起， 您可以使用设置的上下文参数列表以编程方式创建项目，而无需任何命令行提示：</p><pre class=" language-python"><code class="language-python">cookiecutter<span class="token punctuation">(</span><span class="token string">'cookiecutter-pypackage/'</span><span class="token punctuation">,</span>             no_input<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>             extra_context<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'project_name'</span><span class="token punctuation">:</span> <span class="token string">'TheGreatest'</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>有关这部分的更多详细信息，请参阅<a href="https://cookiecutter.readthedocs.io/en/latest/index.html#apiref" target="_blank" rel="noopener">API参考</a>。</p><h2 id="上下文值中的模板"><a href="#上下文值中的模板" class="headerlink" title="上下文值中的模板"></a>上下文值中的模板</h2><p>cookiecutter.json的值（但不是键！）也是Jinja2模板。用户提示符中的值会立即添加到上下文中，这样就可以从以前的值派生出一个上下文值。通过提供更合理的默认值，这种方法可以潜在地为用户节省许多键盘按键操作。</p><h3 id="基础示例：上下文中的模板"><a href="#基础示例：上下文中的模板" class="headerlink" title="基础示例：上下文中的模板"></a>基础示例：上下文中的模板</h3><p>Python包显示了其命名约定的一些模式：</p><ul><li>一个人类可读的项目名称</li><li>小写、横岗组成的库名</li><li>一个可导入的，无破折号的包名称</li></ul><p>这是一个带有此模式模板值的cookiecutter.json：</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"project_name"</span><span class="token operator">:</span> <span class="token string">"My New Project"</span><span class="token punctuation">,</span>  <span class="token property">"project_slug"</span><span class="token operator">:</span> "<span class="token punctuation">{</span><span class="token punctuation">{</span> cookiecutter.project_name|lower|replace(' '<span class="token punctuation">,</span> '-'<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>"<span class="token punctuation">,</span>  <span class="token property">"pkg_name"</span><span class="token operator">:</span> "<span class="token punctuation">{</span><span class="token punctuation">{</span> cookiecutter.project_slug|replace('-'<span class="token punctuation">,</span> ''<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>"<span class="token punctuation">}</span></code></pre><p>如果用户采用默认值或使用<code>no_input</code>，则模板化值将为：</p><ul><li>my-new-project</li><li>mynewproject</li></ul><p>或者，如果用户提供Yet Another New Project，则值为：</p><ul><li>yet-another-new-project</li><li>yetanothernewproject</li></ul><h2 id="复制而不渲染"><a href="#复制而不渲染" class="headerlink" title="复制而不渲染"></a>复制而不渲染</h2><p>可以在cookiecutter.json中使用_copy_without_render键来避免渲染cookiecutter的目录和文件。此键的值接受Unix shell样式通配符列表：</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"project_slug"</span><span class="token operator">:</span> <span class="token string">"sample"</span><span class="token punctuation">,</span>    <span class="token property">"_copy_without_render"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token string">"*.html"</span><span class="token punctuation">,</span>        <span class="token string">"*not_rendered_dir"</span><span class="token punctuation">,</span>        <span class="token string">"rendered_dir/not_rendered_file.ini"</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h2 id="重播项目生成"><a href="#重播项目生成" class="headerlink" title="重播项目生成"></a>重播项目生成</h2><p>在调用时，Cookiecutter将json文件转储到<code>〜/.cookiecutter_replay/</code>，这使你可以稍后重放。</p><p>换句话说，它会保留您对模板的输入，并在您再次运行相同模板时获取它。</p><p>重播文件的示例（通过<code>cookiecutter gh：hackebrot/cookiedoze</code>r创建）：</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"cookiecutter"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"app_class_name"</span><span class="token operator">:</span> <span class="token string">"FooBarApp"</span><span class="token punctuation">,</span>        <span class="token property">"app_title"</span><span class="token operator">:</span> <span class="token string">"Foo Bar"</span><span class="token punctuation">,</span>        <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"raphael@example.com"</span><span class="token punctuation">,</span>        <span class="token property">"full_name"</span><span class="token operator">:</span> <span class="token string">"Raphael Pierzina"</span><span class="token punctuation">,</span>        <span class="token property">"github_username"</span><span class="token operator">:</span> <span class="token string">"hackebrot"</span><span class="token punctuation">,</span>        <span class="token property">"kivy_version"</span><span class="token operator">:</span> <span class="token string">"1.8.0"</span><span class="token punctuation">,</span>        <span class="token property">"project_slug"</span><span class="token operator">:</span> <span class="token string">"foobar"</span><span class="token punctuation">,</span>        <span class="token property">"short_description"</span><span class="token operator">:</span> <span class="token string">"A sleek slideshow app that supports swipe gestures."</span><span class="token punctuation">,</span>        <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.1.0"</span><span class="token punctuation">,</span>        <span class="token property">"year"</span><span class="token operator">:</span> <span class="token string">"2015"</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>要在不在命令行上提示的情况下获取此上下文数据，您可以使用以下任一方法。</p><p>在命令行上传递相应选项：</p><pre class=" language-bash"><code class="language-bash">cookiecutter --replay gh:hackebrot/cookiedozer</code></pre><p>或者使用Python API：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> cookiecutter<span class="token punctuation">.</span>main <span class="token keyword">import</span> cookiecuttercookiecutter<span class="token punctuation">(</span><span class="token string">'gh:hackebrot/cookiedozer'</span><span class="token punctuation">,</span> replay<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>如果要从更新的模板创建新项目，此功能就会派上用场。</p><h2 id="命令行选项"><a href="#命令行选项" class="headerlink" title="命令行选项"></a>命令行选项</h2><p><code>-V, --version</code><br>显示版本并退出。</p><p><code>--no-input</code><br>不要提示参数，只使用cookiecutter.json文件内容</p><p><code>-c, --checkout</code><br>branch, tag or commit to checkout after git clone</p><p><code>-v, --verbose</code><br>打印调试信息</p><p><code>--replay</code><br>不要提示参数，只使用之前输入的信息</p><p><code>-f, --overwrite-if-exists</code><br>如果输出目录的内容已经存在，则覆盖它</p><p><code>-o, --output-dir</code><br>将生成的项目目录输出到哪里，即指定创建项目的目录。</p><p><code>--config-file</code><br>指定用户配置文件</p><p><code>--default-config</code><br>不要加载配置文件。使用默认值</p><p><code>--debug-file</code><br>指定用作DEBUG日志记录流文件</p><h2 id="选择变量"><a href="#选择变量" class="headerlink" title="选择变量"></a>选择变量</h2><p>选择变量在创建项目时提供不同的选择。 根据用户的选择，模板以不同的方式渲染内容。</p><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>选择变量是常规键/值对，但值是字符串列表。</p><p>例如，如果在<code>cookiecutter.json</code>中提供以下选项变量：</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"license"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"MIT"</span><span class="token punctuation">,</span> <span class="token string">"BSD-3"</span><span class="token punctuation">,</span> <span class="token string">"GNU GPL v3.0"</span><span class="token punctuation">,</span> <span class="token string">"Apache Software License 2.0"</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><p>运行Cookiecutter时你会得到以下选择：</p><pre class=" language-text"><code class="language-text">Select license:1 - MIT2 - BSD-33 - GNU GPL v3.04 - Apache Software License 2.0Choose from 1, 2, 3, 4 [1]:</code></pre><p>根据用户的选择，Cookiecutter将渲染不同的许可证。<br>上面的许可选择变量创建了<code>cookiecutter.license</code>，可以像下面这样使用：</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>%- if cookiecutter.license == <span class="token string">"MIT"</span> -%<span class="token punctuation">}</span># 此处可能的许可内容<span class="token punctuation">{</span>%- elif cookiecutter.license == <span class="token string">"BSD-3"</span> -%<span class="token punctuation">}</span># 这里有更多可能的许可内容</code></pre><p>Cookiecutter使用<a href="http://jinja.pocoo.org/docs/dev/templates/#if" target="_blank" rel="noopener">Jinja2 s if条件表达式</a>来确定正确的许可证。</p><p>创建的选择变量仍然是常规的Cookiecutter变量，可以像这样使用：</p><pre class=" language-text"><code class="language-text">License-------Distributed under the terms of the `{{cookiecutter.license}}`_ license,</code></pre><h3 id="覆盖默认选择值"><a href="#覆盖默认选择值" class="headerlink" title="覆盖默认选择值"></a>覆盖默认选择值</h3><p>选择变量可以使用用户配置文件覆盖。</p><p>例如，可以使用列表作为值在<code>cookiecutter.json</code>中创建选择变量：</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"license"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"MIT"</span><span class="token punctuation">,</span> <span class="token string">"BSD-3"</span><span class="token punctuation">,</span> <span class="token string">"GNU GPL v3.0"</span><span class="token punctuation">,</span> <span class="token string">"Apache Software License 2.0"</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><p>默认情况下，值列表中的第一个条目用作提示中的默认值。</p><p>将默认许可协议设置为Apache Software License 2.0可以在用户配置文件中使用以下方法完成：</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">default_context</span><span class="token punctuation">:</span>    <span class="token key atrule">license</span><span class="token punctuation">:</span> <span class="token string">"Apache Software License 2.0"</span></code></pre><p>提示会发生变化，如下所示:</p><pre class=" language-text"><code class="language-text">Select license:1 - Apache Software License 2.02 - MIT3 - BSD-34 - GNU GPL v3.0Choose from 1, 2, 3, 4 [1]</code></pre><p><strong>注意：</strong>如你所见，选项的顺序从<code>1 - MIT</code>更改为<code>1 - Apache Software License 2.0</code>。 Cookiecutter将列表中的第一个值作为默认值。</p><h2 id="字典变量"><a href="#字典变量" class="headerlink" title="字典变量"></a>字典变量</h2><p>字典变量提供了一种在渲染模板时定义深层结构化信息的方法。</p><h3 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h3><p>顾名思义，字典变量是键值对的字典。 字典值本身可以是其他字典和列表 - 数据结构可以根据需要进行深入。</p><p>例如，您可以在<code>cookiecutter.json</code>中提供以下字典变量：</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"project_slug"</span><span class="token operator">:</span> <span class="token string">"new_project"</span><span class="token punctuation">,</span>    <span class="token property">"file_types"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"png"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Portable Network Graphic"</span><span class="token punctuation">,</span>            <span class="token property">"library"</span><span class="token operator">:</span> <span class="token string">"libpng"</span><span class="token punctuation">,</span>            <span class="token property">"apps"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"GIMP"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token property">"bmp"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Bitmap"</span><span class="token punctuation">,</span>            <span class="token property">"library"</span><span class="token operator">:</span> <span class="token string">"libbmp"</span><span class="token punctuation">,</span>            <span class="token property">"apps"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"Paint"</span><span class="token punctuation">,</span>                <span class="token string">"GIMP"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>上面的file_type字典变量创建了cookiecutter.file_types，可以像这样使用：</p><pre class=" language-html"><code class="language-html">{% for extension, details in cookiecutter.file_types|dictsort %}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span>Format name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">></span></span>{{ details.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span>Extension:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">></span></span>{{ extension }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span>Applications:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>      {% for app in details.apps -%}          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>{{ app }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>      {% endfor -%}      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">></span></span>{% endfor %}</code></pre><p>Cookiecutter使用<a href="http://jinja.pocoo.org/docs/dev/templates/#for" target="_blank" rel="noopener">Jinja2 for表达式</a>来迭代字典中的条目。</p><h2 id="模板扩展"><a href="#模板扩展" class="headerlink" title="模板扩展"></a>模板扩展</h2><p>模板可以使用自定义<a href="http://jinja2.readthedocs.io/en/latest/extensions.html#extensions" target="_blank" rel="noopener">Jinja2扩展</a>扩展Cookiecutter环境，可以添加额外的过滤器，测试，全局变量甚至扩展解析器。</p><p>为此，模板作者必须在<code>cookiecutter.json</code>中指定所需的扩展名，如下所示：</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"project_slug"</span><span class="token operator">:</span> <span class="token string">"Foobar"</span><span class="token punctuation">,</span>    <span class="token property">"year"</span><span class="token operator">:</span> <span class="token string">"{% now 'utc', '%Y' %}"</span><span class="token punctuation">,</span>    <span class="token property">"_extensions"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"jinja2_time.TimeExtension"</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><p>在调用时，Cookiecutter尝试导入扩展并分别将它们添加到其环境中。</p><p>在上面的示例中，Cookiecutter在安装j<a href="https://www.cnblogs.com/taceywong/p/10508314.html" target="_blank" rel="noopener">inja2_time.TimeExtension</a>之后提供了附加标记<a href="https://www.cnblogs.com/taceywong/p/10508314.html" target="_blank" rel="noopener">now</a>,并在<code>cookiecutter.json</code>中启用它。</p><p>请注意，Cookiecutter<strong>不会</strong>自行安装任何依赖项！ 作为用户，您需要确保已安装所有扩展，然后在需要自定义Jinja2扩展的模板上运行Cookiecutter。</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python工具包 </tag>
            
            <tag> 后端文章转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cookiecutter更好的项目模板工具（2）安装及基础使用</title>
      <link href="/2020/04/24/cookiecutter-2/"/>
      <url>/2020/04/24/cookiecutter-2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://www.cnblogs.com/taceywong/p/10508130.html" target="_blank" rel="noopener">https://www.cnblogs.com/taceywong/p/10508130.html</a></p><p>文章作者：Tacey Wong</p></blockquote><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><strong>通过python包管理工具</strong><br>命令行输入</p><pre class=" language-bash"><code class="language-bash"> <span class="token variable">$pip</span> <span class="token function">install</span>  cookiecutter</code></pre><p>或者</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># mac os经常会禁止用户全局安装python包</span><span class="token variable">$pip</span> <span class="token function">install</span> --user cookiecutter</code></pre><p>如果使用的是anaconda，想使用<code>conda</code>安装，可以</p><pre class=" language-bash"><code class="language-bash"><span class="token variable">$conda</span> config --add channels conda-forge<span class="token variable">$conda</span> <span class="token function">install</span> cookiecutter</code></pre><p>***特别提醒：要保证Python在你的系统PATH路径下，同时保证<code>bin</code>目录在你的系统PATH路径下。特别提醒，anaconda安装的Python，其安装的python执行文件默认不在系统路径下，一般在·$ANACONDA/bin·,请将其放置在系统路径下。</p><hr><p><strong>通过系统的包管理</strong></p><p>ubuntu</p><pre class=" language-bash"><code class="language-bash"><span class="token variable">$sudo</span> apt <span class="token function">install</span> cookiecutter</code></pre><p>mac os</p><pre class=" language-bash"><code class="language-bash"><span class="token variable">$brew</span> <span class="token function">install</span> cookiecutter</code></pre><h2 id="Cookiecutter模板基础使用"><a href="#Cookiecutter模板基础使用" class="headerlink" title="Cookiecutter模板基础使用"></a>Cookiecutter模板基础使用</h2><p>Cookiecutter模板的形式：</p><ul><li>模板文件夹</li><li>模板文件夹的zip压缩文件</li><li>模板文件夹的git地址</li><li>模板文件夹的zip压缩文件url地址</li><li>模板文件夹在cookiecutter目录下</li></ul><p>针对具体形式分别使用相同的命令形式：</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 模板文件夹</span>$ cookiecutter /path/to/template<span class="token comment" spellcheck="true"># 模板文件夹zip压缩包文件</span>$ cookiecutter /path/to/template.zip<span class="token comment" spellcheck="true"># 模板文件夹的git地址</span>$ cookiecutter git地址$ cookiecutter https://github.com/audreyr/cookiecutter-pypackage.git --checkout develop<span class="token comment" spellcheck="true"># 模板文件夹zip压缩文件URL</span>$  cookiecutter  https://example.com/path/to/template.zip<span class="token comment" spellcheck="true"># 模板文件夹在cookiecutter目录（缺省会~/.cookiecutters/目录下）</span>$ cookiecutter    模板名字</code></pre><p>特别针对有密码的zip文件,cookiecutter回给出提示符让你输入密码，如果想跳过密码输入，可以设置<code>COOKIECUTTER_REPO_PASSWORD</code>环境变量，在zip文件需要密码的时候会自动填入该环境变量的值。</p><p>整体需要注意的：</p><ul><li>无论何时你根据一个模板生成了一个项目，生成的项目都会在你的当前路径下</li><li>克隆的cookiecutters默认存储在<code>〜/.cookiecutters/</code>目录中</li></ul><h2 id="创建Cookiecutter模板"><a href="#创建Cookiecutter模板" class="headerlink" title="创建Cookiecutter模板"></a>创建Cookiecutter模板</h2><p>Cookiecutter功能原理是获取模板的源目录树并将其复制到新项目中，将在模板用<code></code>标记中找到的所有名称替换为<code>cookiecutter.json</code>文件中找到的名称。</p><p>替换的名称可以是文件名、目录名和文件中的字符串。</p><p>使用Cookiecutter，你可以轻松地从一个标准表单引导一个新项目，这意味着在开始一个新项目时，你可以跳过所有常见的错误，拜托琐碎操作带来的时间消耗以快速开始有真正意义的工作。</p><p>以下以一个简单的“Hello World”来介绍Cookiecuter的创建过程：</p><p>首先，在您的计算机上创建一个目录。这个目录的名称将是您的Cookiecutter模板的名称，但是它并不限制任何其他内容——例如，生成的项目不需要使用模板名称。我们将项目名称设为<code>HelloWorld</code></p><pre class=" language-bash"><code class="language-bash">$ <span class="token function">mkdir</span> HelloWorld$ <span class="token function">cd</span> HelloWorld</code></pre><p>我们在此目录中创建要复制到生成项目中的目录树。我们想要为此目录生成一个名称，所以我们将目录名称放在模板标签中:</p><pre class=" language-bash"><code class="language-bash">$ <span class="token function">mkdir</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> cookircutter.directory_name <span class="token punctuation">}</span><span class="token punctuation">}</span>$ <span class="token function">cd</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> cookircutter.directory_name <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>模板标记中的任何内容都可以放在名称空间中。<code>cookiecutter.directory_name</code>将被从<code>cookiecutter.json</code>文件中查找，因为该项目是由Cookiecutter生成的。</p><p>现 我们在将要被复制的目录树中。对于这个最简单的Cookiecutter模板，我们打算只包含一个文件。同样，我们希望从<code>cookiecutter.json</code>中查找文件名，因此我们将其命名为：</p><pre class=" language-bash"><code class="language-bash">$ <span class="token function">touch</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>cookiecutter.file_name<span class="token punctuation">}</span><span class="token punctuation">}</span>.py</code></pre><p>(<code>touch</code>会创建一个空文本文件;你可以在编辑器中打开它）。 现在编辑文件，使其包含：</p><pre class=" language-bash"><code class="language-bash">print<span class="token punctuation">(</span><span class="token string">"Hello, {{cookiecutter.greeting_recipient}}!"</span><span class="token punctuation">)</span></code></pre><p>最后，我们来创建<code>cookiecutter.json</code>文件，以便Cookiecutter可以查找我们所需要模板项。</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"directory_name"</span><span class="token operator">:</span> <span class="token string">"Hello"</span><span class="token punctuation">,</span>    <span class="token property">"file_name"</span><span class="token operator">:</span> <span class="token string">"Howdy"</span><span class="token punctuation">,</span>    <span class="token property">"greeting_recipient"</span><span class="token operator">:</span> <span class="token string">"Tacey"</span><span class="token punctuation">}</span></code></pre><p>现在我们可以运行Cookiecutter并从模板创建一个新项目。切换到要创建新项目的目录。然后运行Cookiecutter并将模板所在的目录传给它。</p><pre class=" language-bash"><code class="language-bash">$ cookiecutter /the/path/of/HelloWorlddirectory_name <span class="token punctuation">[</span>Hello<span class="token punctuation">]</span>:file_name <span class="token punctuation">[</span>Howdy<span class="token punctuation">]</span>:greeting_recipient <span class="token punctuation">[</span>Tacey<span class="token punctuation">]</span>:</code></pre><p>Cookiecutter告诉我们每个项目的默认名称是什么，并为我们提供了用新名称替换该名称的选项。在这种情况下我只是简单的按回车接受所有的默认值~</p><p>现在我们生成了一个名为<code>Hello</code>的目录，其中包含一个文件<code>how .py</code>。当我们运行它：</p><pre class=" language-bash"><code class="language-bash">$ python Howdy.pyHello, Tacey<span class="token operator">!</span></code></pre><p>Wow!这就完事儿了~</p><h2 id="本章结语"><a href="#本章结语" class="headerlink" title="本章结语"></a>本章结语</h2><p>到了这里，如果你在开始新项目时发现自己在重复工作，你就已经会知道如何使用cookiecutter消除这种无谓的重复了。对于一些常见的项目，不妨尝试选择使用<a href="https://www.cnblogs.com/taceywong/p/10506032.html" target="_blank" rel="noopener">Cookiecutter: 更好的项目模板工具：（1）简介及可用资源汇总</a>中的某个模板<del>~</del></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python工具包 </tag>
            
            <tag> 后端文章转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cookiecutter更好的项目模板工具（1）简介及可用资源汇总</title>
      <link href="/2020/04/24/cookiecutter-1/"/>
      <url>/2020/04/24/cookiecutter-1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于：<a href="https://www.cnblogs.com/taceywong/p/10506032.html" target="_blank" rel="noopener">https://www.cnblogs.com/taceywong/p/10506032.html</a></p><p>文章作者：Tacey Wong</p></blockquote><p>原文档地址：<a href="https://cookiecutter.readthedocs.io/en/latest/" target="_blank" rel="noopener">https://cookiecutter.readthedocs.io/en/latest/</a></p><p>本系列只介绍cookiecutter的基础使用，而且会删除与功能使用无关的部分。深度使用及了解更多详情请请参考原文档。</p><p>关于Cookiecutter的中文译名，我不知道别人怎么翻译的，我将其翻译为<strong>饼干制造机</strong>。本系列中将不对其作翻译，直接使用英文原名。</p><h2 id="Cookiecutter简介"><a href="#Cookiecutter简介" class="headerlink" title="Cookiecutter简介"></a>Cookiecutter简介</h2><p><img src="https://img2018.cnblogs.com/blog/673170/201903/673170-20190310154708274-19053537.png" alt="img"></p><p>Cookiecutter 是一个通过项目模板创建项目的命令行工具。比如，通过Python Package模板来创建Python package项目。（通过Python代码调用Cookiecutter的API可以扩展为自动化创建服务和带有Web UI的服务程序）</p><h3 id="功能特点"><a href="#功能特点" class="headerlink" title="功能特点"></a>功能特点</h3><ul><li>跨平台：官方支持Windows、Mac和Linux</li><li>可以在Python 2.7, 3.4, 3.5, 3.6, and PyPy.环境中正常使用（此处指的是Cookiecutter的运行环境，而不是你项目的运行环境。使用Cookiecutter不需要你懂得编写Python代码）</li><li>项目模板可以是任何编程语言或标记格式：Python, JavaScript, Ruby, CoffeeScript, RST, Markdown, CSS, HTML等任何你能叫出名字的。你也可以在同一个项目模板中使用多种语言。</li><li>命令行的简单使用：</li></ul><pre class=" language-sh"><code class="language-sh"># 从cookiecutter-pypackage.git模板创建项目# 你将会被提示输入相应的值。# 然后Cookiecutter将基于你的输入在当前工作目录中创建Python包$ cookiecutter https://github.com/audreyr/cookiecutter-pypackage# 为了简洁起见，repos在GitHub上可以只使用“gh”前缀$ cookiecutter gh:audreyr/cookiecutter-pypackage</code></pre><ul><li>在命令行中使用本地模板：</li></ul><pre class=" language-sh"><code class="language-sh"># 从本地在当前目录创建项目# cookiecutter-pypackage/ template$ cookiecutter cookiecutter-pypackage/</code></pre><ul><li>目录名和文件名可以模板化。例如：<code>//.py</code></li><li>支持无限层级的目录嵌套。</li><li>文件和目录名称100%使用Jinja2完成模板化。</li><li>只需在·cookiecutter.json·文件中定义模板变量即可。 例如：</li></ul><pre class=" language-sh"><code class="language-sh">{    "full_name": "Tacey Wong",    "email": "xinyong.wang@qq.com",    "project_name": "Complexity",    "repo_name": "complexity",    "project_short_description": "令人耳目一新的简单的静态网站生成器.",    "release_date": "2019-03-10",    "year": "2019",    "version": "0.0.1"}</code></pre><ul><li>没有你用·–no-input·来禁止，系统会提示你输入：<ul><li><code>cookiecutter.json</code>中键/key对应的值/value。</li><li><code>cookiecutter.json</code>中的缺省值</li><li>提示符按顺序显示</li></ul></li><li>跨平台支持<code>~/.cookiecutterrc</code>文件：</li></ul><pre class=" language-sh"><code class="language-sh">default_context:    full_name: "Tacey Wong"    email: "xinyong.wang@qq.com"    github_username: "taceywong"cookiecutters_dir: "~/.cookiecutters/"</code></pre><ul><li>克隆的Cookiecutter项目模板会缺省放置在<code>~/.cookiecutters/</code>目录下，如果特殊指定，会放置在<code>cookiecutters_dir</code>对应的目录下：</li></ul><pre class=" language-sh"><code class="language-sh"># 克隆cookiecutter-pypackage$ cookiecutter gh:audreyr/cookiecutter-pypackage# 现在你可以根据名字使用对应的模板$ cookiecutter cookiecutter-pypackage</code></pre><ul><li>您可以使用你本地模板、远程Git repos</li><li>默认上下文:指定在生成项目时要用作默认值的键/值对</li><li>用命令行参数注入额外的上下文：</li></ul><pre class=" language-bash"><code class="language-bash">$ cookiecutter --no-input gh:msabramo/cookiecutter-supervisor program_name<span class="token operator">=</span>foobar startsecs<span class="token operator">=</span>10</code></pre><ul><li>直接访问Cookiecutter API允许注入额外的上下文。</li><li>预生成和后生成挂钩/hook:在生成项目之前或之后运行的Python或shell脚本。</li><li>本地项目的路径可以指定为绝对路径或相对路径。</li><li>项目始终生成到当前目录。</li></ul><h3 id="可用的Cookiecutter模板"><a href="#可用的Cookiecutter模板" class="headerlink" title="可用的Cookiecutter模板"></a>可用的Cookiecutter模板</h3><p>现在在已经有很多开源的Cookiecutter 项目模板可供选择。</p><h4 id="特定的Cookiecutter模板"><a href="#特定的Cookiecutter模板" class="headerlink" title="特定的Cookiecutter模板"></a>特定的Cookiecutter模板</h4><p>这些模板由cookiecutter官方团队进行维护：</p><ul><li><a href="https://github.com/audreyr/cookiecutter-pypackage" target="_blank" rel="noopener">cookiecutter-pypackage</a>:<a href="https://github.com/audreyr" target="_blank" rel="noopener">@audreyr</a>终极Python包项目模板。</li><li><a href="https://github.com/pydanny/cookiecutter-django" target="_blank" rel="noopener">cookiecutter-django</a>: 一个具有Bootstrap 4、可定制用户应用程序、启动器模板、用户注册、celery设置等功能的Django项目模板。</li><li><a href="https://github.com/pytest-dev/cookiecutter-pytest-plugin" target="_blank" rel="noopener">cookiecutter-pytest-plugin</a>: 编写pytest插件的最小Cookiecutter模板，帮助你编写更好的程序。</li></ul><h4 id="Cookiecutter模板分类"><a href="#Cookiecutter模板分类" class="headerlink" title="Cookiecutter模板分类"></a>Cookiecutter模板分类</h4><p>社区驱动的各类Cookiecutter模板（非Cookiecutter官方维护）</p><p><strong>Python</strong></p><ul><li><a href="https://github.com/audreyr/cookiecutter-pypackage" target="_blank" rel="noopener">cookiecutter-pypackage</a>: <a href="https://github.com/audreyr" target="_blank" rel="noopener">@audreyr</a>的终极Python包项目模板。</li><li><a href="https://github.com/wdm0006/cookiecutter-pipproject" target="_blank" rel="noopener">cookiecutter-pipproject</a>: pip可安装项目的最小软件包</li><li><a href="https://github.com/kragniz/cookiecutter-pypackage-minimal" target="_blank" rel="noopener">cookiecutter-pypackage-minimal</a>: 一个最小的Python包模板。</li><li><a href="https://github.com/alexkey/cookiecutter-lux-python" target="_blank" rel="noopener">cookiecutter-lux-python</a>: 一个Python样板项目，旨在利用方便的Makefile工具和额外的辅助工具创建Python包。</li><li><a href="https://github.com/sloria/cookiecutter-flask" target="_blank" rel="noopener">cookiecutter-flask</a> :带有 Bootstrap 3、启动器模板和工作用户注册的Flask模板。</li><li><a href="https://github.com/wdm0006/cookiecutter-flask" target="_blank" rel="noopener">cookiecutter-flask-2</a>: 一个更重的cookiecutter-flask，有更多的样板，包括忘记密码和Heroku集成功能</li><li><a href="https://github.com/JackStouffer/cookiecutter-Flask-Foundation" target="_blank" rel="noopener">cookiecutter-flask-foundation</a> : 带有缓存、表单、sqlalchemy和单元测试的Flask模板。</li><li><a href="https://github.com/candidtim/cookiecutter-flask-minimal" target="_blank" rel="noopener">cookiecutter-flask-minimal</a> : 最小但production就绪的Flask项目模板，除了Flask本身之外，没有其他依赖。</li><li><a href="https://github.com/realpython/cookiecutter-flask-skeleton" target="_blank" rel="noopener">cookiecutter-flask-skeleton</a> : Flask启动项目。</li><li><a href="https://github.com/avelino/cookiecutter-bottle" target="_blank" rel="noopener">cookiecutter-bottle</a> : 用于快速创建可重复使用的Bottle项目的cookiecutter模板。</li><li><a href="https://github.com/openstack-dev/cookiecutter" target="_blank" rel="noopener">cookiecutter-openstack</a>: OpenStack项目的模板。</li><li><a href="https://github.com/sloria/cookiecutter-docopt" target="_blank" rel="noopener">cookiecutter-docopt</a>: Python命令行脚本的模板，使用<a href="http://docopt.org/" target="_blank" rel="noopener">docopt</a>进行参数解析。</li><li><a href="https://github.com/pythonhub/cookiecutter-quokka-module" target="_blank" rel="noopener">cookiecutter-quokka-module</a>: 用于创建Quokka Flask CMS蓝图模块的模板。</li><li><a href="https://github.com/hackebrot/cookiecutter-kivy" target="_blank" rel="noopener">cookiecutter-kivy</a>:基于kivy python-framework构建的NUI应用程序模板。</li><li><a href="https://github.com/hackebrot/cookiedozer" target="_blank" rel="noopener">cookiedozer</a>: Python Kivy应用程序的模板，已准备好使用Buildozer部署到Android设备。</li><li><a href="https://github.com/ionelmc/cookiecutter-pylibrary" target="_blank" rel="noopener">cookiecutter-pylibrary</a>: 一个旨在快速开始进行良好的测试和打包的复杂模板，（Tox，Pytest，Travis-CI，Coveralls，AppVeyor，Sphinx docs，isort，转换，打包、检查等工作配置）。</li><li><a href="https://github.com/robinandeer/cookiecutter-pyvanguard" target="_blank" rel="noopener">cookiecutter-pyvanguard</a>: 用于尖端Python开发的模板。[invoke](<a href="http://docs.pyinvoke.org/en/latest" target="_blank" rel="noopener">http://docs.pyinvoke.org/en/latest</a> /)、pytest、bumpversion和Python 2/3兼容性。</li><li><a href="https://github.com/pybee/Python-iOS-template" target="_blank" rel="noopener">Python-iOS-template</a>: 用于创建在iOS设备上运行的Python项目模板。</li><li><a href="https://github.com/pybee/Python-Android-template" target="_blank" rel="noopener">Python-Android-template</a>: 用于创建在Android设备上运行的Python项目模板。</li><li><a href="https://bitbucket.org/tryton/cookiecutter-tryton" target="_blank" rel="noopener">cookiecutter-tryton</a>用于创建基本和外部Tryton模块的模板。</li><li><a href="https://github.com/fulfilio/cookiecutter-tryton" target="_blank" rel="noopener">cookiecutter-tryton-fulfilio</a>: 用于创建tryton模块的模板。</li><li><a href="https://github.com/pytest-dev/cookiecutter-pytest-plugin" target="_blank" rel="noopener">cookiecutter-pytest-plugin</a>: 用于创作<a href="http://pytest.org/latest/" target="_blank" rel="noopener">pytest</a>插件的最小Cookiecutter模板，可帮助您编写更好的程序。</li><li><a href="https://github.com/tox-dev/cookiecutter-tox-plugin" target="_blank" rel="noopener">cookiecutter-tox-plugin</a>: 编写<a href="https://tox.readthedocs.io/" target="_blank" rel="noopener">tox</a> 插件的最小Cookiecutter模板，用于更改或扩展测试自动化的行为。</li><li><a href="https://github.com/vintasoftware/cookiecutter-tapioca" target="_blank" rel="noopener">cookiecutter-tapioca</a>: 用于构建基于Web API包装器（客户端）的[tapioca-wrapper]（<a href="https://github.com/vintasoftware/tapioca-wrapper）的模板。" target="_blank" rel="noopener">https://github.com/vintasoftware/tapioca-wrapper）的模板。</a></li><li><a href="https://github.com/drgarcia1986/cookiecutter-muffin" target="_blank" rel="noopener">cookiecutter-muffin</a>: 带有Bootstrap 3，启动器模板和工作用户注册的Muffin模板。</li><li><a href="https://github.com/OctoPrint/cookiecutter-octoprint-plugin" target="_blank" rel="noopener">cookiecutter-octoprint-plugin</a>: 用于构建<a href="https://github.com/foosel/OctoPrint" target="_blank" rel="noopener">OctoPrint</a>.插件的模板</li><li><a href="https://github.com/tokibito/cookiecutter-funkload-friendly" target="_blank" rel="noopener">cookiecutter-funkload-friendly</a>: <a href="https://github.com/tokibito/funkload-friendly" target="_blank" rel="noopener">funkload-friendly</a> 项目的Cookiecutter模板。</li><li><a href="https://github.com/mdklatt/cookiecutter-python-app" target="_blank" rel="noopener">cookiecutter-python-app</a>: 用于创建具有子命令、日志记录、YAML配置、pytest测试和Virtualenv部署的Python CLI应用程序的模板。</li><li><a href="https://github.com/morepath/morepath-cookiecutter" target="_blank" rel="noopener">morepath-cookiecutter</a>:超强web微框架Morepath的Cookiecutter模板，。</li><li><a href="https://github.com/Springerle/hovercraft-slides" target="_blank" rel="noopener">Springerle/hovercraft-slides</a>: 新<a href="https://hovercraft.readthedocs.io/" target="_blank" rel="noopener">Hovercraft!</a> 展现项目模板（reStructuredText中嵌入<code>impress.js</code>幻灯片）</li><li><a href="https://github.com/xguse/cookiecutter-snakemake-analysis-pipeline" target="_blank" rel="noopener">cookiecutter-snakemake-analysis-pipeline</a>: 一种轻松设置<a href="https://bitbucket.org/snakemake/snakemake/wiki/Home" target="_blank" rel="noopener">Snakemake</a>分析管道的方法。</li><li><a href="https://github.com/ivanlyon/cookiecutter-py3tkinter" target="_blank" rel="noopener">cookiecutter-py3tkinter</a>: Python 3 Tkinter应用程序gui的模板。</li><li><a href="https://github.com/mandeepbhutani/cookiecutter-pyqt5" target="_blank" rel="noopener">cookiecutter-pyqt5</a>: 预构建的PyQt4 GUI模板，具有日志记录支持、用于测试和分离ui和工作组件的结构。</li><li><a href="https://github.com/aeroaks/cookiecutter-pyqt4" target="_blank" rel="noopener">cookiecutter-pyqt4</a>: A prebuilt PyQt4 GUI template with a logging support, structure for tests and separation of ui and worker components.</li><li><a href="https://github.com/laerus/cookiecutter-xontrib" target="_blank" rel="noopener">cookiecutter-xontrib</a>: 用于构建xontribs的模板，a.k.a <a href="https://github.com/xonsh/xonsh" target="_blank" rel="noopener">xonsh</a>贡献</li><li><a href="https://github.com/conda/cookiecutter-conda-python" target="_blank" rel="noopener">cookiecutter-conda-python</a>: 用于构建Conda Python包的模板</li><li><a href="https://github.com/mckaymatt/cookiecutter-pypackage-rust-cross-platform-publish" target="_blank" rel="noopener">cookiecutter-pypackage-rust-cross-platform-publish</a>: 包含Rust二进制模块的Python wheel 模板，支持在Windows，OSX和Linux上发布。</li><li><a href="https://github.com/Ars2014/cookiecutter-telegram-bot" target="_blank" rel="noopener">cookiecutter-telegram-bot</a>: 一个带有基于CherryPy webhook的Telegram机器人模板项目。</li><li><a href="https://github.com/Kwpolska/python-project-template" target="_blank" rel="noopener">python-project-template</a>: 一个用于Python项目的模板，具有复杂的发布自动化功能。</li><li><a href="https://github.com/AnyBlok/cookiecutter-anyblok-project" target="_blank" rel="noopener">cookiecutter-anyblok-project</a>: 基于Anyblok的项目模板。</li><li><a href="https://github.com/xuanluong/cookiecutter-python-cli" target="_blank" rel="noopener">cookiecutter-python-cli</a>:用于使用“click”创建Python CLI应用程序的cookiecutter模板</li></ul><p><strong>Python-Django</strong></p><ul><li><a href="https://github.com/pydanny/cookiecutter-django" target="_blank" rel="noopener">cookiecutter-django</a>: 带有Bootstrap 4的前沿Django项目模板，可自定义的用户应用程序，入门模板，用户注册，celery设置等等。</li><li><a href="https://github.com/agconti/cookiecutter-django-rest" target="_blank" rel="noopener">cookiecutter-django-rest</a>: 用于为移动和Web应用程序创建REST api。</li><li><a href="https://github.com/marcofucci/cookiecutter-simple-django" target="_blank" rel="noopener">cookiecutter-simple-django</a>: 快速创建可重用Django项目的cookiecutter 模板</li><li><a href="https://github.com/legios89/django-docker-bootstrap" target="_blank" rel="noopener">django-docker-bootstrap</a>: Djangodocker开发/生产环境，并集成了 Postgres, NodeJS(React), Nginx, uWSGI.</li><li><a href="https://github.com/pydanny/cookiecutter-djangopackage" target="_blank" rel="noopener">cookiecutter-djangopackage</a>:用于创建可重用的第三方PyPI友好Django应用程序的cookicutter模板。 用教程格式编写文档</li><li><a href="https://github.com/palazzem/cookiecutter-django-cms" target="_blank" rel="noopener">cookiecutter-django-cms</a>: Django CMS的模板，带有简单的Bootstrap 3模板。 它具有快速启动和部署文档。</li><li><a href="https://github.com/wildfish/cookiecutter-django-crud" target="_blank" rel="noopener">cookiecutter-django-crud</a>: 用于围绕工厂模式和测试的模型创建带有CRUD样板的Django应用程序。</li><li><a href="https://github.com/lborgav/cookiecutter-django" target="_blank" rel="noopener">cookiecutter-django-lborgav</a>:Django项目的另一个cookiecutter模板，带有Bootstrap 3和FontAwesome 4</li><li><a href="https://github.com/pbacterio/cookiecutter-django-paas" target="_blank" rel="noopener">cookiecutter-django-paas</a>: 准备在像Heroku，OpenShift等PAAS平台中使用的Django模板</li><li><a href="https://github.com/jpadilla/cookiecutter-django-rest-framework" target="_blank" rel="noopener">cookiecutter-django-rest-framework</a>: 用于创建可重用Django REST框架包的模板。</li><li><a href="https://github.com/dolphinkiss/cookiecutter-django-aws-eb" target="_blank" rel="noopener">cookiecutter-django-aws-eb</a>: 在AWS Elastic Beanstalk上启动并运行Django。</li><li><a href="https://github.com/torchbox/cookiecutter-wagtail" target="_blank" rel="noopener">cookiecutter-wagtail</a> : 基于<a href="https://github.com/torchbox/wagtail" target="_blank" rel="noopener">Wagtail</a> CMS的网站模板</li><li><a href="https://github.com/chrisdev/wagtail-cookiecutter-foundation" target="_blank" rel="noopener">wagtail-cookiecutter-foundation</a>: Wagtail CMS项目的完整模板，带有 <a href="http://foundation.zurb.com/" target="_blank" rel="noopener">Zurb Foundation</a> 6,ansible资源调配和部署,使用bower进行前端相关性管理，模块化的应用程序，使您的网站启动和运行照片画廊，RSS流等。</li><li><a href="https://github.com/tkjone/django-starter" target="_blank" rel="noopener">django-starter</a>: 包含vagrant和provisioning脚本的Django模板- 灵感来自12factor应用程序和cookiecutter-django。</li><li><a href="https://github.com/valerymelou/cookiecutter-django-gulp" target="_blank" rel="noopener">cookiecutter-django-gulp</a>: 在Django项目中集成前端开发工具的Cookiecutter模板</li><li><a href="https://github.com/tkjone/wagtail-starter-kit" target="_blank" rel="noopener">wagtail-starter-kit</a>: 配有wagtail，django布局，vagrant，配置脚本，前端构建系统等等的cookiecutter模板。</li><li><a href="https://github.com/dulaccc/cookiecutter-django-herokuapp" target="_blank" rel="noopener">cookiecutter-django-herokuapp</a>: 一个为Heroku python3优化的Django 1.7+模板。</li><li><a href="https://github.com/shenyushun/cookiecutter-simple-django-cn" target="_blank" rel="noopener">cookiecutter-simple-django-cn</a>:一个简单的Django中文模板。</li><li><a href="https://bitbucket.org/levit_scs/cc_django_ember_app" target="_blank" rel="noopener">cc_django_ember_app</a>: 用于使用Django和EmberJS创建应用程序</li><li><a href="https://bitbucket.org/levit_scs/cc_project_app_drf" target="_blank" rel="noopener">cc_project_app_drf</a>: 用于基于“project app”项目体系结构创建REST api</li><li><a href="https://bitbucket.org/levit_scs/cc_project_app_full_with_hooks" target="_blank" rel="noopener">cc_project_app_full_with_hooks</a>: 用于基于“project app”项目体系结构创建Django项目</li><li><a href="https://github.com/TAMU-CPT/cc-automated-drf-template" target="_blank" rel="noopener">cc-automated-drf-template</a>: 模板+脚本，根据模型文件作为输入自动创建包含序列化程序，视图，URL和管理文件的Django REST项目。</li><li><a href="https://github.com/Parbhat/cookiecutter-django-foundation" target="_blank" rel="noopener">cookiecutter-django-foundation</a>: <a href="https://github.com/pydanny/cookiecutter-django" target="_blank" rel="noopener">cookiecutter-django</a>分支， 基于 <a href="http://foundation.zurb.com/" target="_blank" rel="noopener">Zurb Foundation</a> 6前端框架。</li><li><a href="https://github.com/HackSoftware/cookiecutter-django-ansible" target="_blank" rel="noopener">cookiecutter-django-ansible</a>: 用于快速启动ansible项目，以便为您的* cookiecutter-django *应用程序提供服务器的框架</li><li><a href="https://github.com/wemake-services/wemake-django-template" target="_blank" rel="noopener">wemake-django-template</a>: 前沿Django模板专注于代码质量和安全性。</li></ul><p><strong>Python-Pyramid</strong></p><ul><li><a href="https://github.com/Pylons/pyramid-cookiecutter-alchemy" target="_blank" rel="noopener">pyramid-cookiecutter-alchemy</a>:Cookiecutter (项目模板)，使用SQLite创建Pyramid项目，SQLAlchemy用于ORM，URL调度用于路由，Jinja2用于模板。</li><li><a href="https://github.com/Pylons/pyramid-cookiecutter-starter" target="_blank" rel="noopener">pyramid-cookiecutter-starter</a>: 使用URL调度进行路由分配，使用Jinjab 2、Chameleon或Mako模板创建Pyramid入门项目的Cookiecutter (项目模板)。</li><li><a href="https://github.com/Pylons/pyramid-cookiecutter-zodb" target="_blank" rel="noopener">pyramid-cookiecutter-zodb</a>:Cookiecutter（项目模板），用于创建Pyramid项目，使用ZODB进行持久存储，遍历路由，使用Chameleon进行模板化。</li><li><a href="https://github.com/Pylons/substanced-cookiecutter" target="_blank" rel="noopener">substanced-cookiecutter</a>: 用于创建Substance D初始项目的cookiecutter（项目模板）。 Substance D是基于Pyramid实现的。</li><li><a href="https://github.com/mikeckennedy/cookiecutter-pyramid-talk-python-starter" target="_blank" rel="noopener">cookiecutter-pyramid-talk-python-starter</a>: 一个自以为是的Cookiecutter模板，用于创建PyramidWeb应用程序，从开发链的下游开始。这个cookiecutter模板将创建一个新的Pyramid Web应用程序，其中包含电子邮件，sqlalchemy，rollbar以及更多的集成。</li></ul><p>*<em>Cookiecutter (meta) *</em></p><p>用于生成Cookiecutter项目模板的元模板。</p><ul><li><a href="https://github.com/eviweb/cookiecutter-template" target="_blank" rel="noopener">cookiecutter-template</a>: 用于创建一个Cookiecutter模板</li></ul><p><strong>Ansible</strong></p><ul><li><a href="https://github.com/retr0h/cookiecutter-molecule" target="_blank" rel="noopener">cookiecutter-molecule</a>: 按照最佳实践创建Create <a href="http://molecule.readthedocs.io/en/v2/" target="_blank" rel="noopener">Molecule</a>角色, 利用Test-kitchen，Docker和InSpec实现已经实施的测试基础架构。<a href="http://molecule.readthedocs.io/en/v2/" target="_blank" rel="noopener">Molecule</a>, Docker and Testinfra.</li><li><a href="https://github.com/iknite/cookiecutter-ansible-role" target="_blank" rel="noopener">cookiecutter-ansible-role</a>: 用于创建ansible角色的模板。 忘记文件创建，专注于操作。</li><li><a href="https://github.com/ferrarimarco/cookiecutter-ansible-role" target="_blank" rel="noopener">cookiecutter-ansible-role-ci</a>: 按照最佳实践创建Ansible角色，利用Test-kitchen，Docker和InSpec实现已经实施的测试基础架构。</li></ul><p><strong>Git</strong></p><ul><li><a href="https://github.com/NathanUrwin/cookiecutter-git" target="_blank" rel="noopener">cookiecutter-git</a>: Git repo项目模板</li></ul><p><strong>C</strong></p><ul><li><a href="https://github.com/vincentbernat/bootstrap.c" target="_blank" rel="noopener">bootstrap.c</a>: 用C语言编写的带有autotools的简单项目模板。</li><li><a href="https://github.com/solarnz/cookiecutter-avr" target="_blank" rel="noopener">cookiecutter-avr</a>: avr开发的模板。</li></ul><p><strong>C++</strong></p><ul><li><a href="https://github.com/Paspartout/BoilerplatePP" target="_blank" rel="noopener">BoilerplatePP</a>: 一个简单的cmake模板，对用C ++编写的项目进行单元测试。</li><li><a href="https://github.com/SpotlightKid/cookiecutter-dpf-effect" target="_blank" rel="noopener">cookiecutter-dpf-effect</a>: DISTRHO插件框架（DPF）的音频插件项目模板</li><li><a href="https://github.com/SpotlightKid/cookiecutter-dpf-audiotk" target="_blank" rel="noopener">cookiecutter-dpf-audiotk</a>: 一个音频插件项目模板，用于发行版插件框架(DPF)和音频工具包(ATK) DSP库</li><li><a href="https://github.com/13coders/cookiecutter-kata-gtest" target="_blank" rel="noopener">cookiecutter-kata-gtest</a>: 使用Google Test框架的C ++测试驱动开发katas模板。</li><li><a href="https://github.com/13coders/cookiecutter-kata-cpputest" target="_blank" rel="noopener">cookiecutter-kata-cpputest</a>: 使用CppUTest框架的C ++测试驱动开发katas的模板。</li></ul><p><strong>C#</strong></p><ul><li><a href="https://github.com/SandyChapman/cookiecutter-csharp-objc-binding" target="_blank" rel="noopener">cookiecutter-csharp-objc-binding</a>: 生成用于绑定Objective-C静态库的C＃绑定项目的cookircutter模板。</li></ul><p><strong>Common Lisp</strong></p><ul><li><a href="https://github.com/svetlyak40wt/cookiecutter-cl-project" target="_blank" rel="noopener">cookiecutter-cl-project</a>: 带有bootstrap脚本和Slime集成的Common Lisp项目cookiecutter模板，</li></ul><p><strong>Elm</strong></p><ul><li><a href="https://github.com/m-x-k/cookiecutter-elm.git" target="_blank" rel="noopener">cookiecutter-elm</a>: 基于Elm带有html样例的cookiecutter模板。</li></ul><p><strong>Golang</strong></p><ul><li><a href="https://github.com/lacion/cookiecutter-golang" target="_blank" rel="noopener">cookiecutter-golang</a>: 根据最佳实践创建基golang新项目的模板</li></ul><p><strong>Java</strong></p><ul><li><a href="https://github.com/m-x-k/cookiecutter-java.git" target="_blank" rel="noopener">cookiecutter-java</a>: 使用gradle的基本java应用程序设置的cookiecutter模板。</li><li><a href="https://github.com/m-x-k/cookiecutter-spring-boot.git" target="_blank" rel="noopener">cookiecutter-spring-boot</a>: 标准java spring boot gradle应用程序的Cookiecutter模板。</li><li><a href="https://github.com/alexfu/cookiecutter-android" target="_blank" rel="noopener">cookiecutter-android</a>:基于Gradle的Android项目Cookiecutter模板。</li></ul><p><strong>JS</strong></p><ul><li><a href="https://github.com/agconti/cookiecutter-es6-boilerplate" target="_blank" rel="noopener">cookiecutter-es6-boilerplate</a>:S6中的前端项目cookiecutter模板</li><li><a href="https://github.com/hzdg/cookiecutter-webpack" target="_blank" rel="noopener">cookiecutter-webpack</a>: Webpack 2项目的模板，包括热重新加载，babel es6模块和反应。</li><li><a href="https://github.com/audreyr/cookiecutter-jquery" target="_blank" rel="noopener">cookiecutter-jquery</a>:一个基于jQuery Boilerplate的jQuery插件项目模板。</li><li><a href="https://github.com/audreyr/cookiecutter-jswidget" target="_blank" rel="noopener">cookiecutter-jswidget</a>: 为多个JS打包系统创建一个通用的前端非jQuery JS小部件的项目模板。</li><li><a href="https://github.com/audreyr/cookiecutter-component" target="_blank" rel="noopener">cookiecutter-component</a>: Component JS 包模板</li><li><a href="https://github.com/christabor/cookiecutter-tampermonkey" target="_blank" rel="noopener">cookiecutter-tampermonkey</a>: TamperMonkey浏览器脚本的模板。</li><li><a href="https://github.com/ratson/cookiecutter-es6-package" target="_blank" rel="noopener">cookiecutter-es6-package</a>: 使用ES6通过babel编写nodejs包的模板。</li><li><a href="https://github.com/matheuspoleza/cookiecutter-angular2" target="_blank" rel="noopener">cookiecutter-angular2</a>: 带有typescript应用程序的模块化angular2模板。</li><li><a href="https://github.com/TAMU-CPT/CICADA" target="_blank" rel="noopener">CICADA</a>: 自动为AngularJS前端创建列表/细节控制器和片段，以连接到DRF后端的模板和脚本。 与<a href="https://github.com/TAMU-CPT/cc-automated-drf-template" target="_blank" rel="noopener">cc-automated-drf-template</a>配合的很好。</li></ul><p><strong>Kotlin</strong></p><ul><li><a href="https://github.com/thomaslee/cookiecutter-kotlin-gradle" target="_blank" rel="noopener">cookiecutter-kotlin-gradle</a>: 基于Gradle的Kotlin项目简单模板。</li></ul><p><strong>LaTeX/XeTeX</strong></p><ul><li><a href="https://github.com/larsyencken/pandoc-talk" target="_blank" rel="noopener">pandoc-talk</a>:用于与pandoc和XeTeX进行对接的cookiecutter模板。</li><li><a href="https://github.com/Kreger51/cookiecutter-latex-article" target="_blank" rel="noopener">cookiecutter-latex-article</a>: 针对学术界使用的LaTeX模板</li><li><a href="https://github.com/luismartingil/cookiecutter-beamer" target="_blank" rel="noopener">cookiecutter-beamer</a>: LaTeX Beamer展示模板</li></ul><p><strong>PHP</strong></p><ul><li><a href="https://github.com/JonasGroeger/cookiecutter-mediawiki-extension" target="_blank" rel="noopener">cookiecutter-mediawiki-extension</a>: MediaWiki扩展的模板。</li></ul><p><strong>Sublime Text</strong></p><ul><li><a href="https://github.com/kkujawinski/cookiecutter-sublime-text-3-plugin" target="_blank" rel="noopener">cookiecutter-sublime-text-3-plugin</a>: Sublime Text 3 插件模板， 包括自定义设置、命令、键绑定和主菜单</li><li><a href="https://github.com/agenoria/sublime-snippet-package-template" target="_blank" rel="noopener">sublime-snippet-package-template</a>: 包含片段型Sublime Text包的模板。</li></ul><p><strong>Berkshelf-Vagrant</strong></p><ul><li><a href="https://github.com/mahmoudimus/cookiecutter-slim-berkshelf-vagrant" target="_blank" rel="noopener">slim-berkshelf-vagrant</a>: 与 vagrant/berkshelf cookbooks保持一致的cookbook简单模板</li></ul><p><strong>HTML</strong></p><ul><li><a href="https://github.com/audreyr/cookiecutter-complexity" target="_blank" rel="noopener">cookiecutter-complexity</a>:一个使用Bootstrap 3的复杂静态站点cookiecutter模板。</li><li><a href="https://github.com/keimlink/cookiecutter-reveal.js" target="_blank" rel="noopener">cookiecutter-reveal.js</a>: reveal.js演示文稿的cookiecutter模板。</li><li><a href="https://github.com/relekang/cookiecutter-tumblr-theme" target="_blank" rel="noopener">cookiecutter-tumblr-theme</a>: 使用GruntJS作为连接工具的Tumblr主题项目的cookiecutter模板。<br><strong>Scala</strong></li><li><a href="https://github.com/Plippe/cookiecutter-scala" target="_blank" rel="noopener">cookiecutter-scala</a>:带有几个库的简单scala hello world应用程序cookiecutter模板</li><li><a href="https://github.com/jpzk/cookiecutter-scala-spark" target="_blank" rel="noopener">cookiecutter-scala-spark</a>: 用Scala编写的Apache Spark应用程序的cookiecutter模板。<br><strong>6502 Assembly</strong></li><li><a href="https://github.com/joeyjoejoejr/cookiecutter-atari2600" target="_blank" rel="noopener">cookiecutter-atari2600</a>: Atari2600项目的cookiecutter模板。</li></ul><p><strong>Data Science</strong></p><ul><li><a href="https://github.com/jupyter/widget-cookiecutter" target="_blank" rel="noopener">widget-cookiecutter</a>: 用于创建自定义Jupyter小部件项目的cookiecutter模板。</li><li><a href="https://github.com/drivendata/cookiecutter-data-science" target="_blank" rel="noopener">cookiecutter-data-science</a>:为在Python中进行和共享数据科学工作的逻辑的、合理标准化的、灵活的项目结构。<a href="http://drivenndata.github.io/cookiegrate-data-science/" target="_blank" rel="noopener">此处</a>提供了的完整文档 。</li><li><a href="https://github.com/bdcaf/cookiecutter-r-data-analysis" target="_blank" rel="noopener">cookiecutter-r-data-analysis</a>: 组织基于R的工作流-&gt;doc(通过pandoc)-&gt;pdf报告(通过latex)的模板</li><li><a href="https://github.com/docker-science/cookiecutter-docker-science" target="_blank" rel="noopener">cookiecutter-docker-science</a>: Cookiecutter template for data scientists working in Docker containers.为使用Docker容器工作的数据科学家准备的Cookiecutter模板。</li></ul><p><strong>Reproducible Science</strong></p><ul><li><a href="https://github.com/mkrapp/cookiecutter-reproducible-science" target="_blank" rel="noopener">cookiecutter-reproducible-science</a>: 用于开始一个可重复和透明的科学项目，包括数据，模型，分析和报告的cookiecutter模板 (比如你的科学论文)。与上面数据科学Cookiecutter模板的哲学非常一致</li></ul><p><strong>数据驱动的Journalism</strong></p><ul><li><a href="https://github.com/jastark/cookiecutter-data-driven-journalism" target="_blank" rel="noopener">cookiecutter-data-driven-journalism</a>: 通过持续组织数据日志项目和一些预先填充的文件来促进数据日志的透明度的Cookiecutter模板(包括 .gitignore, README, AUTHORS)</li></ul><p><strong>持续交付</strong></p><ul><li><a href="https://github.com/painless-software/painless-continuous-delivery" target="_blank" rel="noopener">painless-continuous-delivery</a>: 用于包含持续交付的软件开发设置cookiecutter模板。支持Python (Django, Flask), 实验性支持 PHP 。</li><li><a href="https://bitbucket.org/greenguavalabs/cookiecutter-devenv.git" target="_blank" rel="noopener">cookiecutter-devenv</a>: 用于将开发和ci环境添加到现有项目的模板。</li></ul><h3 id="云工具"><a href="#云工具" class="headerlink" title="云工具"></a>云工具</h3><ul><li><a href="https://github.com/DualSpark/cookiecutter-tf-module" target="_blank" rel="noopener">cookiecutter-tf-module</a>: 用于构建一致Terraform模块的Cookiecutter模板。</li></ul><h3 id="Tornado"><a href="#Tornado" class="headerlink" title="Tornado"></a>Tornado</h3><ul><li><a href="https://github.com/hkage/cookiecutter-tornado" target="_blank" rel="noopener">cookiecutter-tornado</a>: 创建Tornado项目的Cookiecutter模板</li></ul><p><strong>其他</strong></p><ul><li><a href="https://github.com/Pawamoy/cookiecutter-awesome" target="_blank" rel="noopener">cookiecutter-awesome</a>: 创建[awesome]（<a href="https://github.com/sindresorhus/awesome）列表的Cookiecutter模板。" target="_blank" rel="noopener">https://github.com/sindresorhus/awesome）列表的Cookiecutter模板。</a></li><li><a href="https://github.com/bdcaf/cookiecutter_dotfile" target="_blank" rel="noopener">cookiecutter_dotfile</a>: 由stow管理的dotfiles文件夹的模板。</li><li><a href="https://github.com/genzj/cookiecutter-raml" target="_blank" rel="noopener">cookiecutter-raml</a>: RAML v1.0 API文档的模板。</li></ul><h3 id="与Cookiecutter类似的项目"><a href="#与Cookiecutter类似的项目" class="headerlink" title="与Cookiecutter类似的项目"></a>与Cookiecutter类似的项目</h3><ul><li><a href="http://pythonpaste.org/script/#paster-create" target="_blank" rel="noopener">Paste</a> 具有创建骨架项目的创建选项。</li><li><a href="https://github.com/novagile/diecutter" target="_blank" rel="noopener">Diecutter</a>: 一个提供模板和变量的配置文件的API服务。</li><li><a href="https://docs.djangoproject.com/en/1.9/ref/django-admin/#cmdoption-startapp--template" target="_blank" rel="noopener">Django</a>的tartproject和startapp命令可以使用-template选项。</li><li><a href="https://github.com/fcurella/python-packager" target="_blank" rel="noopener">python-packager</a>:使用自己的模板创建Python包，并提供可配置的选项。</li><li><a href="https://github.com/yeoman/generator" target="_blank" rel="noopener">Yeoman</a> 有一个受Rails启发的生成器系统，为应用程序提供脚手架。</li><li><a href="http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/scaffolding.html" target="_blank" rel="noopener">Pyramid</a>的pcreate命令，用于从脚手架模板创建Pyramid 项目。</li><li><a href="https://github.com/iElectric/mr.bob" target="_blank" rel="noopener">mr.bob</a> 是一个文件系统模板渲染器，用于弃用paster和templer等工具</li><li><a href="https://github.com/gruntjs/grunt-init" target="_blank" rel="noopener">grunt-init</a> 曾经被内置到Grunt中，现在是一个独立的脚手架工具，可以自动创建项目。</li><li><a href="https://github.com/paulmillr/scaffolt" target="_blank" rel="noopener">scaffolt</a> 使用Handlebars 的JSON生成器。</li><li><a href="https://github.com/paulmillr/init-skeleton" target="_blank" rel="noopener">init-skeleton</a> 克隆或复制存储库，执行npm安装和bower安装，并删除.git目录。</li><li><a href="https://bitbucket.org/ned/cog" target="_blank" rel="noopener">Cog</a> 由Ned Batchelder开发的基于python的代码生成工具包</li><li><a href="https://github.com/christabor/Skaffold" target="_blank" rel="noopener">Skaffold</a> 基于python和json配置的django / MVC生成器，带有一些附加组件和集成。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python工具包 </tag>
            
            <tag> 后端文章转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DRF面试题总结</title>
      <link href="/2020/04/23/drf-mian-shi-ti-zong-jie/"/>
      <url>/2020/04/23/drf-mian-shi-ti-zong-jie/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转载于<a href="https://www.cnblogs.com/gfhh/p/12103640.html#d20" target="_blank" rel="noopener">https://www.cnblogs.com/gfhh/p/12103640.html#d20</a></p></blockquote><h3 id="1-drf组件提供的功能"><a href="#1-drf组件提供的功能" class="headerlink" title="1.drf组件提供的功能"></a>1.drf组件提供的功能</h3><pre><code> 免除csrf认证 视图(三种：(1)APIView,(2)ListAPIview,(3)ListModelMixin) 版本处理 认证 权限 节流（频率限制） 解析器 筛选器 分页 序列化和数据校验：可以对QuerySet进行序列化，也可以对用户提交的数据进行校验——展示特殊的数据     depth     source：无需加括号，在源码内部会去判断是否可执行，如果可执行自动加括号。【多对一、一对一/choice】     SerializerMethodField定义钩子方法【多对多】 渲染器：可以帮我们把json数据渲染到drf自己的页面上。</code></pre><h3 id="2-drf继承过哪些视图类？以及他们之间的区别？"><a href="#2-drf继承过哪些视图类？以及他们之间的区别？" class="headerlink" title="2.drf继承过哪些视图类？以及他们之间的区别？"></a>2.drf继承过哪些视图类？以及他们之间的区别？</h3><p> <strong>第一种：<code>APIView</code></strong><br>     第一种遵循了CBV的模式，里面的功能比较多但是需要自己写的代码也有很多<br>     提供了免除csrf认证，版本处理、认证、权限、节流、解析器、筛选器、分页、序列化、渲染器</p><p> <strong>第二种：<code>ListAPIView,RetrieveAPIView,CreateAPIView,UpdateAPIView,DestroyAPIView</code></strong><br>     第二种则在第一种的基础上，封装了许多我们需要自己的写的代码，许多功能的实现只需要给专属的变量名赋值就可以实现该功能</p><p> <strong>第三种：<code>GenericViewSet、ListModelMixin,RetrieveModelMixin,CreateModelMixin,UpdateModelMixin,DestroyModelMixin</code></strong><br>     第三种则重构了<code>APIView</code>中的<code>as_view()</code>方法，结合请求方法和不同<code>Mixin</code>类的方法名从而进行执行不同的功能。与前面两种最主要的区别是url路由中<code>as_view()</code>方法中需要传值。<br>     目前使用的主要目的是把第二种的bug(查询全部数据的功能和查询单个数据的功能无法在一个类中实现)实现在一个类中！</p><h3 id="3-drf版本的实现过程？"><a href="#3-drf版本的实现过程？" class="headerlink" title="3.drf版本的实现过程？"></a>3.drf版本的实现过程？</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># drf自带的版本类</span>     <span class="token string">"DEFAULT_VERSIONING_CLASS"</span><span class="token punctuation">:</span> <span class="token string">"rest_framework.versioning.URLPathVersioning"</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 允许出现的版本</span>     <span class="token string">"ALLOWED_VERSIONS"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">,</span> <span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># 如果没有传版本，可以使用默认版本</span>     default_version <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_VERSION <span class="token comment" spellcheck="true"># 设置url中获取版本的变量，默认是version</span>     version_param <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>VERSION_PARAM</code></pre><p>当前端来请求时，执行了<code>as_views()</code>方法，如果设置了全局版本或者进入了设置了版本的功能函数，则会先执行<code>APIView</code>类中的<code>dispatch</code>方法，之后再执行<code>initial</code>方法，然后进入了<code>self.determine_version</code>方法，</p><p>里面会先判断是否有<code>versioning_class</code>，如果没有就返回<code>(None,None)</code>，就代表没有版本，如果有就执行<code>versioning_class(URLPathVersioning)</code>类中的<code>determine_version</code>方法,它会返回版本，里面会判断</p><p>如果获取到的<code>version</code>为空则返回默认版本，并且还要判断版本是否存在允许出现的版本列表中，返回版本之后，再把版本号和版本类分别赋值给<code>request.version</code>和<code>request.versioning_scheme</code></p><h5 id=""><a href="#" class="headerlink" title=""></a><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184427876-956432096.png" alt="img"></h5><h5 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184449951-352038703.png" alt="img"></h5><h5 id="-2"><a href="#-2" class="headerlink" title=""></a><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184511493-333740807.png" alt="img"></h5><h3 id="4-drf组件认证的实现过程？"><a href="#4-drf组件认证的实现过程？" class="headerlink" title="4.drf组件认证的实现过程？"></a>4.drf组件认证的实现过程？</h3><p>当用户进行登录的时候，运行了登录类的<code>as_view()</code>方法，</p><ol><li>进入了<code>APIView</code>类的<code>dispatch</code>方法</li><li>执行了<code>self.initialize_request</code>这个方法，是重定义<code>request</code>，并且得到了自己定义的认证类对象</li><li>执行<code>self.initial</code>方法中的<code>self.perform_authentication</code>，里面运行了<code>user</code>方法</li><li>执行了<code>user</code>方法里面的<code>self._authenticate()</code>方法</li><li>然后执行了自己定义的类中的<code>authenticate</code>方法，自己定义的类继承了<code>BaseAuthentication</code>类，里面有  <code>authenticate</code>方法，如果自己定义的类中没有<code>authenticate</code>方法会报错。</li><li>把从<code>authenticate</code>方法得到的<code>user</code>和<code>auth</code>赋值给<code>user</code>和<code>auth</code>方法</li><li>这两个方法把<code>user</code>和<code>auth</code>的值赋值给了<code>request.user</code>：是登录用户的对象<code>,request.auth</code>：是认证的信息字典</li></ol><h5 id="-3"><a href="#-3" class="headerlink" title=""></a><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184530291-417601024.png" alt="img"></h5><h5 id="-4"><a href="#-4" class="headerlink" title=""></a><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184545939-435067623.png" alt="img"></h5><p><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184603205-521483617.png" alt="img"></p><p><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184621343-1161823402.png" alt="img"></p><p><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184634923-915787997.png" alt="img"></p><p><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184648677-892449560.png" alt="img"></p><h5 id="-5"><a href="#-5" class="headerlink" title=""></a><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184708498-411230673.png" alt="img"></h5><p><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184719526-1079270113.png" alt="img"></p><h3 id="5-drf组件权限的实现过程？"><a href="#5-drf组件权限的实现过程？" class="headerlink" title="5.drf组件权限的实现过程？"></a>5.drf组件权限的实现过程？</h3><p> 当用户执行一个业务的时候，运行了<code>as_view</code>方法</p><ol><li>进入了<code>APIView</code>类的<code>dispatch</code>方法</li><li>进入<code>self.initial</code>方法中的<code>self.check_permissions(request)</code>方法</li><li>里面执行了for循环，把每个权限类实例化对象，</li><li>执行自己定义的权限类里面的<code>has_permission</code>方法，里面会判断<code>request.user</code>是否存在</li><li>不存在就返回<code>False</code>，存在就返回<code>True</code></li><li>之后执行<code>self.permission_denied</code>报错方法，返回的是<code>False</code>就报错，可以自定义报错信息，在<code>has_permission</code>方法中写<code>message = {&quot;status&quot;: False, &quot;error&quot;: &quot;登录成功之后才能评论&quot;}</code>，    就实现了自定义报错</li><li>如果返回的是<code>True</code>就让他进入功能</li></ol><h5 id="-6"><a href="#-6" class="headerlink" title=""></a><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184747222-829444943.png" alt="img"></h5><p><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184800627-1337250377.png" alt="img"></p><p><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184815886-1003379064.png" alt="img"></p><p><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184829968-1036353484.png" alt="img"></p><h3 id="6-drf组件中节流的实现方式？"><a href="#6-drf组件中节流的实现方式？" class="headerlink" title="6.drf组件中节流的实现方式？"></a>6.drf组件中节流的实现方式？</h3><pre class=" language-python"><code class="language-python">匿名用户通过ip地址来控制访问频率，已登录用户通过id来控制 首先要设置配置文件： <span class="token comment" spellcheck="true"># 也可以设置全局，</span>     <span class="token string">"DEFAULT_THROTTLE_CLASSES"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">"rest_framework.throttling.AnonRateThrottle"</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># 设置访问频率——一分钟10次</span>     <span class="token string">"DEFAULT_THROTTLE_RATES"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>             <span class="token string">"anon"</span><span class="token punctuation">:</span><span class="token string">"10/m"</span>         <span class="token punctuation">}</span> <span class="token operator">-</span> 实现原理     把所有登录记录时间放在一个列表中，当用户请求网页的时候，用现在的时间减去约束的时间间隔，然后把小于这个时间记录排除，再计算出时间间隙的记录条数，          如果其中的条数小于规定的条数则可以访问并且把当前时间添加进列表中，如果大于或等于则不让其访问。 <span class="token operator">-</span> 具体流程     当用户请求网页的时候，后台允许该界面的url中的as_views<span class="token punctuation">(</span><span class="token punctuation">)</span>，运行源码的APIView中的dispatch方法，运行initial方法，里面的check_throttles方法，         循环运行节流类中的allow_request方法，但是AnonRateThrottle等类中没有，去执行SimpleRateThrottle类中的allow_request方法，里面就是实现原理中的代码，          如果可以访问返回<span class="token boolean">True</span>，如果不让访问则返回<span class="token boolean">False</span>，之后返回check_throttles，如果是<span class="token boolean">False</span>则运行SimpleRateThrottle类中的wait方法得到需要等待的时间在页面上显示！</code></pre><h5 id="-7"><a href="#-7" class="headerlink" title=""></a><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184919186-474514373.png" alt="img"></h5><p><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123184953997-1674626370.png" alt="img"></p><p><img src="https://img2018.cnblogs.com/common/1674415/201911/1674415-20191123185019005-840831653.png" alt="img"></p><h3 id="7-什么是jwt？-它的优势是什么？"><a href="#7-什么是jwt？-它的优势是什么？" class="headerlink" title="7.什么是jwt？ 它的优势是什么？"></a>7.什么是jwt？ 它的优势是什么？</h3><pre class=" language-python"><code class="language-python"> jwt的全称是json web token， 一般用于用户认证 jwt的实现原理：     <span class="token operator">-</span> 用户登录成功之后，会给前端返回一段token。     <span class="token operator">-</span> token是由<span class="token punctuation">.</span>分割的三段组成。         <span class="token operator">-</span> 第一段header：类型<span class="token operator">+</span>算法<span class="token operator">+</span>base64url加密         <span class="token operator">-</span> 第二段paylod：用户信息<span class="token operator">+</span>超时时间<span class="token operator">+</span>base64url加密         <span class="token operator">-</span> 第三段sign：hs256（前两段拼接）加密 <span class="token operator">+</span> base64url     <span class="token operator">-</span> 以后前端再次发来信息时         <span class="token operator">-</span> 超时验证         <span class="token operator">-</span> token合法性校验 优势：     <span class="token operator">-</span> token只在前端保存，后端只负责校验。     <span class="token operator">-</span> 内部集成了超时时间，后端可以根据时间进行校验是否超时。     <span class="token operator">-</span> 由于内部存在hash256加密，所以用户不可以修改token，只要一修改就认证失败。</code></pre><h3 id="8-反射"><a href="#8-反射" class="headerlink" title="8.反射"></a>8.反射</h3><pre class=" language-python"><code class="language-python">应用场景： <span class="token number">1</span>、django中的View类的dispatch通过接收到的请求方法变为小写从而使用反射得到类中的相对应方法，比如get方法。 <span class="token keyword">class</span> <span class="token class-name">View</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">def</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token comment" spellcheck="true"># Try to dispatch to the right method; if a method doesn't exist,</span>         <span class="token comment" spellcheck="true"># defer to the error handler. Also defer to the error handler if the</span>         <span class="token comment" spellcheck="true"># request method isn't on the approved list.</span>         <span class="token keyword">if</span> request<span class="token punctuation">.</span>method<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>http_method_names<span class="token punctuation">:</span>             handler <span class="token operator">=</span> getattr<span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">.</span>method<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>http_method_not_allowed<span class="token punctuation">)</span>         <span class="token keyword">else</span><span class="token punctuation">:</span>             handler <span class="token operator">=</span> self<span class="token punctuation">.</span>http_method_not_allowed         <span class="token keyword">return</span> handler<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span> <span class="token number">2</span>、django中的settings配置文件的源码也使用了反射，并且结合了 <span class="token keyword">import</span> importlib self<span class="token punctuation">.</span>SETTINGS_MODULE <span class="token operator">=</span> settings_module  <span class="token comment" spellcheck="true"># 获取到settings文件的路径</span> mod <span class="token operator">=</span> importlib<span class="token punctuation">.</span>import_module<span class="token punctuation">(</span>self<span class="token punctuation">.</span>SETTINGS_MODULE<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 通过importlib.import_module获取到settings文件对象</span> <span class="token keyword">for</span> setting <span class="token keyword">in</span> dir<span class="token punctuation">(</span>mod<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 循环获取到settings文件对象里面的属性</span>     <span class="token keyword">if</span> setting<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 得到大写的属性名</span>     setting_value <span class="token operator">=</span> getattr<span class="token punctuation">(</span>mod<span class="token punctuation">,</span> setting<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 得到属性值比如中间件等其他配置属性</span></code></pre><h3 id="9-跨域问题"><a href="#9-跨域问题" class="headerlink" title="9.跨域问题"></a>9.跨域问题</h3><pre><code> CORS（跨域资源共享）：是一种使用额外的 HTTP 头部来允许浏览器可以在一个不同域的网站内获取另一个域下的服务器资源的机制。 本质是设置响应头。</code></pre><h3 id="10-基于django的fbv和cbv都能实现遵循restful规范的接口"><a href="#10-基于django的fbv和cbv都能实现遵循restful规范的接口" class="headerlink" title="10.基于django的fbv和cbv都能实现遵循restful规范的接口"></a>10.基于django的fbv和cbv都能实现遵循restful规范的接口</h3><pre><code> FBV: def user(request):     if request.method == &quot;GET&quot;:     pass CBV: class UserView(View):     def get():         pass     def post():         pass</code></pre><p>FBV和CBV的区别：<br> FBV顾名思义就是函数处理请求，代码冗余比较多，不是面向对象编程<br> CBV则是使用类中的不同方法来处理请求，迎合了python所推崇的面向对象编程思想。<br> 相比FBV的优点：</p><ol><li>提高了代码的复用性，可以使用面向对象的计算，比如<code>Mixin(多继承)</code></li><li>可以用不同的函数针对不同的<code>http</code>请求方法处理，而不是通过过多的if判断，提高了代码的可读性</li></ol>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DRF的常用函数总结</title>
      <link href="/2020/04/22/drf-de-chang-yong-han-shu/"/>
      <url>/2020/04/22/drf-de-chang-yong-han-shu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>介绍了restframwork在做的时候各种项目小结</p></blockquote><h2 id="get-queryset"><a href="#get-queryset" class="headerlink" title="get_queryset"></a>get_queryset</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416152030.png" alt="">get_queryset是返还的所有请求的结果，这里可以过滤掉不属于自己的请求，可以过滤掉想要过滤的值，比如说获取请求为price_min的参数，并且返还值</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416154137.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 项目总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> Restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos7安装docker</title>
      <link href="/2020/04/22/centos7-an-zhuang-docker/"/>
      <url>/2020/04/22/centos7-an-zhuang-docker/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文引用于csdn的博客：</p><p><a href="https://blog.csdn.net/u014069688/article/details/100532774" target="_blank" rel="noopener">https://blog.csdn.net/u014069688/article/details/100532774</a> (docker的安装)</p><p><a href="https://www.cnblogs.com/wchw2008/p/10161952.html" target="_blank" rel="noopener">https://www.cnblogs.com/wchw2008/p/10161952.html</a> (docker安装错误解决办法)</p><p><a href="https://blog.csdn.net/Qevery678/article/details/102811576" target="_blank" rel="noopener">https://blog.csdn.net/Qevery678/article/details/102811576</a>  (docker安装错误解决办法)</p><p>这篇博客的意义在于把centos7安装docker的常见错误和安装过程整合在一起</p></blockquote><h2 id="docker的安装"><a href="#docker的安装" class="headerlink" title="docker的安装"></a>docker的安装</h2><h3 id="官网的安装方法"><a href="#官网的安装方法" class="headerlink" title="官网的安装方法"></a>官网的安装方法</h3><blockquote><p>官网地址：<a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener">https://docs.docker.com/engine/install/centos/</a></p></blockquote><p>第一步：</p><pre><code>sudo yum remove docker \                  docker-client \                  docker-client-latest \                  docker-common \                  docker-latest \                  docker-latest-logrotate \                  docker-logrotate \                  docker-engine</code></pre><p>第二步：</p><pre><code>sudo yum-config-manager \    --add-repo \    https://download.docker.com/linux/centos/docker-ce.repo</code></pre><p>第三步：</p><pre><code>sudo yum install docker-ce docker-ce-cli containerd.io</code></pre><p>第四步：</p><pre><code>sudo systemctl start docker</code></pre><h3 id="一般的安装方法"><a href="#一般的安装方法" class="headerlink" title="一般的安装方法"></a>一般的安装方法</h3><p>……这里省略docker是什么</p><ol><li>root账户登录，查看内核版本如下</li></ol><pre class=" language-shell"><code class="language-shell">[root@localhost ~]# uname -aLinux localhost.localdomain 3.10.0-957.el7.x86_64 #1 SMP Thu Nov 8 23:39:32 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</code></pre><ol start="2"><li>把yum包更新到最新</li></ol><pre class=" language-shell"><code class="language-shell">[root@localhost ~]# yum update已加载插件：fastestmirrorLoading mirror speeds from cached hostfile * base: centos.ustc.edu.cn * extras: mirrors.aliyun.com * updates: mirrors.cn99.combase                                                                                                  | 3.6 kB  00:00:00     extras                                                                                                | 3.4 kB  00:00:00     updates                                                                                               | 3.4 kB  00:00:00     正在解决依赖关系--> 正在检查事务---> 软件包 NetworkManager.x86_64.1.1.12.0-6.el7 将被 升级---> 软件包 NetworkManager.x86_64.1.1.12.0-10.el7_6 将被 更新</code></pre><p>（期间要选择确认，输入 y 即可）</p><ol start="3"><li>安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</li></ol><pre class=" language-shell"><code class="language-shell">[root@localhost ~]# yum install -y yum-utils device-mapper-persistent-data lvm2已加载插件：fastestmirrorLoading mirror speeds from cached hostfile * base: centos.ustc.edu.cn * extras: mirrors.aliyun.com * updates: mirrors.cn99.com软件包 device-mapper-persistent-data-0.7.3-3.el7.x86_64 已安装并且是最新版本软件包 7:lvm2-2.02.180-10.el7_6.8.x86_64 已安装并且是最新版本正在解决依赖关系--> 正在检查事务---> 软件包 yum-utils.noarch.0.1.1.31-50.el7 将被 安装--> 正在处理依赖关系 python-kitchen，它被软件包 yum-utils-1.1.31-50.el7.noarch 需要......</code></pre><ol start="4"><li>设置yum源（选择其中一个）</li></ol><p>yum-config-manager –add-repo <a href="http://download.docker.com/linux/centos/docker-ce.repo（中央仓库）" target="_blank" rel="noopener">http://download.docker.com/linux/centos/docker-ce.repo（中央仓库）</a></p><p>yum-config-manager –add-repo <a href="http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo（阿里仓库）" target="_blank" rel="noopener">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo（阿里仓库）</a></p><pre class=" language-shell"><code class="language-shell">[root@localhost ~]# yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo已加载插件：fastestmirroradding repo from: https://download.docker.com/linux/centos/docker-ce.repograbbing file https://download.docker.com/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.reporepo saved to /etc/yum.repos.d/docker-ce.repo</code></pre><ol start="5"><li>可以查看所有仓库中所有docker版本，并选择特定版本安装</li></ol><pre class=" language-shell"><code class="language-shell">[root@localhost ~]# yum list docker-ce --showduplicates | sort -r已加载插件：fastestmirror可安装的软件包 * updates: mirrors.cn99.comLoading mirror speeds from cached hostfile * extras: mirrors.aliyun.comdocker-ce.x86_64            3:19.03.2-3.el7                     docker-ce-stabledocker-ce.x86_64            3:19.03.1-3.el7                     docker-ce-stabledocker-ce.x86_64            3:19.03.0-3.el7                     docker-ce-stabledocker-ce.x86_64            3:18.09.8-3.el7                     docker-ce-stabledocker-ce.x86_64            3:18.09.7-3.el7                     docker-ce-stabledocker-ce.x86_64            3:18.09.6-3.el7                     docker-ce-stabledocker-ce.x86_64            3:18.09.5-3.el7                     docker-ce-stabledocker-ce.x86_64            3:18.09.4-3.el7                     docker-ce-stabledocker-ce.x86_64            3:18.09.3-3.el7                     docker-ce-stabledocker-ce.x86_64            3:18.09.2-3.el7                     docker-ce-stabledocker-ce.x86_64            3:18.09.1-3.el7                     docker-ce-stabledocker-ce.x86_64            3:18.09.0-3.el7                     docker-ce-stabledocker-ce.x86_64            18.06.3.ce-3.el7                    docker-ce-stabledocker-ce.x86_64            18.06.2.ce-3.el7                    docker-ce-stabledocker-ce.x86_64            18.06.1.ce-3.el7                    docker-ce-stabledocker-ce.x86_64            18.06.0.ce-3.el7                    docker-ce-stabledocker-ce.x86_64            18.03.1.ce-1.el7.centos             docker-ce-stabledocker-ce.x86_64            18.03.0.ce-1.el7.centos             docker-ce-stabledocker-ce.x86_64            17.12.1.ce-1.el7.centos             docker-ce-stable</code></pre><ol start="6"><li>安装Docker，命令：yum install docker-ce-版本号，我选的是docker-ce-18.03.1.ce，如下</li></ol><pre class=" language-shell"><code class="language-shell">[root@localhost ~]# yum install docker-ce-18.03.1.ce已加载插件：fastestmirrorLoading mirror speeds from cached hostfile * base: centos.ustc.edu.cn * extras: mirrors.aliyun.com * updates: mirrors.cn99.com正在解决依赖关系--> 正在检查事务---> 软件包 docker-ce.x86_64.0.18.03.1.ce-1.el7.centos 将被 安装</code></pre><ol start="7"><li>启动Docker，命令：systemctl start docker，然后加入开机启动，如下</li></ol><pre class=" language-shell"><code class="language-shell">[root@localhost ~]# systemctl start docker[root@localhost ~]# systemctl enable  dockerCreated symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.[root@localhost ~]# docker versionClient: Version:      18.03.1-ce API version:  1.37 Go version:   go1.9.5 Git commit:   9ee9f40 Built:        Thu Apr 26 07:20:16 2018 OS/Arch:      linux/amd64 Experimental: false Orchestrator: swarmServer: Engine:  Version:      18.03.1-ce  API version:  1.37 (minimum version 1.12)  Go version:   go1.9.5  Git commit:   9ee9f40  Built:        Thu Apr 26 07:23:58 2018  OS/Arch:      linux/amd64  Experimental: false</code></pre><blockquote><p>附一些常用Docker命令，更多命令详解，请访问：<a href="http://www.docker.org.cn/dockerppt/106.html" target="_blank" rel="noopener">http://www.docker.org.cn/dockerppt/106.html</a>:</p><p>docker ps 查看当前正在运行的容器</p><p>docker ps -a 查看所有容器的状态</p><p>docker start/stop id/name 启动/停止某个容器</p><p>docker attach id 进入某个容器(使用exit退出后容器也跟着停止运行)</p><p>docker exec -ti id 启动一个伪终端以交互式的方式进入某个容器（使用exit退出后容器不停止运行）</p><p>docker images 查看本地镜像<br>docker rm id/name 删除某个容器<br>docker rmi id/name 删除某个镜像</p><p>docker run –name test -ti ubuntu /bin/bash  复制ubuntu容器并且重命名为test且运行，然后以伪终端交互式方式进入容器，运行bash</p><p>docker build -t soar/centos:7.1 .  通过当前目录下的Dockerfile创建一个名为soar/centos:7.1的镜像</p><p>docker run -d -p 2222:22 –name test soar/centos:7.1  以镜像soar/centos:7.1创建名为test的容器，并以后台模式运行，并做端口映射到宿主机2222端口，P参数重启容器宿主机端口会发生改变</p></blockquote><h2 id="docker关于python环境的报错"><a href="#docker关于python环境的报错" class="headerlink" title="docker关于python环境的报错"></a>docker关于python环境的报错</h2><h3 id="File-“-usr-bin-yum”-line-30-except-KeyboardInterrupt-e-SyntaxError-invalid-syntax"><a href="#File-“-usr-bin-yum”-line-30-except-KeyboardInterrupt-e-SyntaxError-invalid-syntax" class="headerlink" title="File “/usr/bin/yum”, line 30 except KeyboardInterrupt, e: SyntaxError: invalid syntax"></a>File “/usr/bin/yum”, line 30 except KeyboardInterrupt, e: SyntaxError: invalid syntax</h3><p>这个报错的解决办法是</p><p>修改文件1</p><pre class=" language-shell"><code class="language-shell">vim /usr/bin/yum#!/usr/bin/python2.7import systry:    import yumexcept ImportError:    print >> sys.stderr, """\</code></pre><p>修改文件2</p><pre class=" language-shell"><code class="language-shell">vim /usr/libexec/urlgrabber-ext-down#! /usr/bin/python2.7#  A very simple external downloader#  Copyright 2011-2012 Zdenek Pavlas#   This library is free software; you can redistribute it and/or#   modify it under the terms of the GNU Lesser General Public</code></pre><p>然后再继续执行命令即可</p><h3 id="File-“-usr-bin-yum-config-manager”-line-133-except-yum-Errors-RepoError-e"><a href="#File-“-usr-bin-yum-config-manager”-line-133-except-yum-Errors-RepoError-e" class="headerlink" title="File “/usr/bin/yum-config-manager”, line 133 except yum.Errors.RepoError, e:"></a>File “/usr/bin/yum-config-manager”, line 133 except yum.Errors.RepoError, e:</h3><p>这个报错的解决办法是</p><pre><code>vim /usr/bin/yum-config-manager </code></pre><p>把头部的python改成python2</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200422121205.png" alt=""></p><p>再继续执行命令即可</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>毕业设计总结</title>
      <link href="/2020/04/16/bi-ye-she-ji-zong-jie/"/>
      <url>/2020/04/16/bi-ye-she-ji-zong-jie/</url>
      
        <content type="html"><![CDATA[<blockquote><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这里是对之前的restframwork的简述和对restframwork的部分功能配置做一个总结<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文的案例、讲解均为慕课网天天生鲜项目后的总结</p></blockquote><h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><h3 id="全局分页配置"><a href="#全局分页配置" class="headerlink" title="全局分页配置"></a>全局分页配置</h3><p>点击restframwork的源码的setting.py文件，可以看到DRF的所有的配置，如下图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415182030.png" alt="图19：DRF的所有配置"></p><p>这里可以看到分页的配置，如下图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415182236.png" alt="图20，分页配置"></p><p>然后在项目的setting.py里面重新配置就可以配置全局分页了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415182332.png" alt="图21，全局分页配置"></p><h3 id="局部分页"><a href="#局部分页" class="headerlink" title="局部分页"></a>局部分页</h3><p>但是不是所有的数据都是需要分页的，而且默认的分页的字段是叫<code>page</code>，分页是可以局部配置的，比如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415184435.png" alt="图22 官网分页案例"></p><p>如案例的下图：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415201140.png" alt="使用案例图"></p><p>其中<code>page_size_query_param</code>就是配置显示多少条数据</p><h2 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h2><p>官网的文档有详细的说明</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416154525.png" alt=""></p><p>如上图所说，下载<code>django-filter</code>后要把<code>django_filters</code>加入到<code>apps</code>里面</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416155712.png" alt="使用方法"></p><p>直接在<code>filterset_fields</code> 编写过滤的字段就可以对字段进行过滤了，但是这个十分的严格，因为这个要精确查询的，只是按照这种写法是无法满足日常的开发需求的，因为没可能搜索需要数字和名字都一一对应的</p><p>所以这里可以看向django_filters,在github上搜索django_filter</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416160108.png" alt=""></p><p>找到榜一的项目进入文档</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416160157.png" alt=""></p><p>这里可以看到有关于DRF的过滤功能</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416160359.png" alt=""></p><p>这里可以添加一个filters的文件，里面填写我们要过滤的字段</p><p>然后就可以自己去编写过滤的方法了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416160616.png" alt=""></p><p>然后要把原来的<code>filterset_fields</code> 改成<code>django_filter</code>的<code>filterset_class</code> </p><p>这样子才可以利用<code>django-filter</code>来进行模糊查询，就可以选择字段的区间</p><h2 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h2><p>虽然<code>Django_filters</code>过滤字段也可可以搜索，但是这里还是介绍一下<code>restframwork</code>自带的搜索功能</p><p>如官网所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416173922.png" alt=""></p><p>这里要导入filters包和进行一些配置，这里我拿我的项目来演示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416174259.png" alt=""></p><p>当然官网有更详细的配置</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416174059.png" alt=""></p><p>可以使用正则表达式来进行查询</p><h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><p>如官网所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416173840.png" alt=""></p><p>如图所示的配置：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416174213.png" alt=""></p><h2 id="设置开发文档"><a href="#设置开发文档" class="headerlink" title="设置开发文档"></a>设置开发文档</h2><p>在setting里面添加如下字段：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417105410.png" alt=""></p><p>再在urls里面添加路由即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417105507.png" alt=""></p><p>进入开发文档界面如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417110810.png" alt=""></p><h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><p>对于登录而言，其实DRF自带了一个登录也就是开发文档的那个登录</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416175725.png" alt=""></p><p>这个是因为在路由里面进行了设置</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416175859.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416180423.png" alt="DRF登录、登出的方法"></p><p>这里可以看到有登录和登出的方法</p><p>再点进去看一下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416180513.png" alt=""></p><p>这里<code>csrf_protect</code>是针对于<code>DRF</code>开发文档的那个来做的，但实际上<code>DRF</code>开发的是不用管<code>csrf</code>的问题，因为前后端分离本身就是跨域的</p><p>这里直接上<code>DRF</code>的官方文档</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416182434.png" alt=""></p><p>DRF的登录原理，其实还是依靠于Django的认证的，其部分源码如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416201545.png" alt=""></p><p>这里没有做什么特殊的步骤，只是把request的user取出来而已，依赖的还是Django的session和auth</p><p>但是呢因为是前后端分离了，一般都是app端之类的，所以用的一般都是token</p><p>官网的文档如下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416212551.png" alt=""></p><p>插入authtoken后还要重新数据库迁移，迁移后会出现一张名为authtoken_token的表，但是这个表是没有任何的数据的，如下图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417110717.png" alt=""></p><p>这里先配置登录的接口：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416213541.png" alt="登录方式"></p><p>然后拿上面配置好的开发接口文档来进行验证：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417110925.png" alt=""></p><p>在进行账号密码登录的时候就可以获取一个token，并且存到数据库中</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417110941.png" alt=""></p><p>​    在setting的REST_FRAMEWORK添加TokenAuthentication配置好这个就可以在全局配置Token验证了，如下图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417111233.png" alt=""></p><p>这里是对全局进行配置的，也就是对所有的页面都需要登录后才能访问，但是我们日常开发是需要部分的页面需要验证，所以这里的局部配置如下，先在REST_FRAMEWORK删掉token</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417111343.png" alt=""></p><p>然后在视图文件中在指定需要登录的页面配置好authentication_classes即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417150717.png" alt=""></p><p>这里在mixins里面打个断点，然后使用postman测试一下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417150840.png" alt=""></p><p>可看到user中的admin就是我的admin的token</p><p>但是这个token是有缺陷的，比如不能设置过期时间，如果被人拿到token就可以一直登录</p><h2 id="JWT登录"><a href="#JWT登录" class="headerlink" title="JWT登录"></a>JWT登录</h2><p><a href="https://www.jianshu.com/p/180a870a308a" target="_blank" rel="noopener">JWT的详细介绍</a></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417160417.png" alt=""></p><p>点击文档查看流程</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417160938.png" alt=""></p><p>配置如上所示，进行如下步骤：</p><pre><code>$ pip install djangorestframework-jwt</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417161222.png" alt=""></p><p>然后配置路由</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417161411.png" alt=""></p><p>测试结果如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417162042.png" alt=""></p><p>依照文档的说法：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417162150.png" alt=""></p><p>所以之后的验证都是把Token改为JWT</p><p>先把验证的方法改成JWT，这里跟token是一样的， 如果是在setting里面配置，那么就是所有的都要进行JWT登录验证，如果是放在视图类里面就是局部的验证</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417165400.png" alt=""></p><p>然后再去打断点验证的话</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417165642.png" alt=""></p><h2 id="发送短信功能"><a href="#发送短信功能" class="headerlink" title="发送短信功能"></a>发送短信功能</h2><p>这里我注册采用的是手机短信注册，这里我采用的是最便宜的云片网功能</p><p>注册序列化就不可以使用<code>ModelSerializers</code>了，因为验证码的数据字段是有个code，但是code是必填字段，所以是需要使用<code>serializers.Serializer</code></p><p>此时还需要对手机号进行验证，如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417175947.png" alt=""></p><p>这个方法前头的<code>validate_</code>是源码里面规定前头的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417180557.png" alt="官网文档"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417180148.png" alt="源码"></p><p>同时在视图的create方法中，还要写一个发送验证码的功能和生成验证码的函数，这个时候就要重写create方法才可以</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417181801.png" alt=""></p><p>写到这一步后，剩下的验证模块需要看云片网的文档来写</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417181828.png" alt=""></p><p>依照文档的code的0代表成功，所以返回的是400错误，如果成功了，那么就保存这个code和返还mobile信息和201状态码</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417181844.png" alt="image-20200417181843523"></p><h2 id="注册功能"><a href="#注册功能" class="headerlink" title="注册功能"></a>注册功能</h2><p>注册的话需要验证手机号验证码是否被注册、发送了几次验证码来取最后一次、验证码是否过期、长度验证等问题</p><p>验证方法的话官网有详细的说明，如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419170539.png" alt="官网关于验证字段的详细说明文档"></p><h3 id="验证验证码是否存在"><a href="#验证验证码是否存在" class="headerlink" title="验证验证码是否存在"></a>验证验证码是否存在</h3><p>先获取短信的所有记录，这个code肯定要和手机号绑定起来的，是要查询手机号码里面的短信记录</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200417205724.png" alt=""></p><p>这里的<code>self.initial_data</code>的意思就是获取前端输入的数据</p><h3 id="验证码的先后顺序和验证正确与否"><a href="#验证码的先后顺序和验证正确与否" class="headerlink" title="验证码的先后顺序和验证正确与否"></a>验证码的先后顺序和验证正确与否</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419154826.png" alt=""></p><p>需要取得验证码的先后顺序，然后再对验证码进行验证</p><p>这里不去用get的原因是怕手机生成的字符串是一样的，第二get如果是在不匹配的情况下可能不返回数据，这里就要对数据异常进行各种检测，如果是使用filter的话就不用考虑那么多，如果没有数据就返回一个空数组，如果是有多个数据就返回个数组在进行判断</p><p>进行来这一步之后，code字段是多余的，因为在注册表中code这个字段没有必要存在，也就是在后面的数据中要把code这个字段设置为none</p><h3 id="对所有的字段进行验证"><a href="#对所有的字段进行验证" class="headerlink" title="对所有的字段进行验证"></a>对所有的字段进行验证</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419165738.png" alt=""></p><p>此处可以需要把上面没有实现的去除code和把username辅助给mobile去实现</p><p>validate这个函数是作用域全部的序列化字段之上的，attrs是每个字段validate_之后返回的所有字段</p><h3 id="验证账号是否存在"><a href="#验证账号是否存在" class="headerlink" title="验证账号是否存在"></a>验证账号是否存在</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419180612.png" alt=""></p><p>这里官网有详细的说明，对字段进行验证</p><p>我的项目结果如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419202112.png" alt=""></p><h3 id="输入框变成隐藏密码格式"><a href="#输入框变成隐藏密码格式" class="headerlink" title="输入框变成隐藏密码格式"></a>输入框变成隐藏密码格式</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419202714.png" alt=""></p><p>此处因为input输入的密码还是一个text的格式，需要输入框变成type=”password”才可以达到想要的效果</p><h3 id="输入密码存储为密文"><a href="#输入密码存储为密文" class="headerlink" title="输入密码存储为密文"></a>输入密码存储为密文</h3><p>此时存储的密码还是以明文的形式存储，此时需要把密码变成密文存储到数据库中</p><p>这里是有两种方法的</p><h4 id="方法1："><a href="#方法1：" class="headerlink" title="方法1："></a>方法1：</h4><p>因为model继承的是AbstractBaseUser，所以进去找到这个的方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419210633.png" alt="image-20200419210631784"></p><p>然后使用create方法在创建的时候使得密码变成密文即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419211535.png" alt=""></p><p>这里设置的话只是对于这个方法可以把明文转换为密文</p><p>而方法2使用信号量的机制却可以把所有的新建用户的操作（admin后台操作）都可以设置</p><h4 id="方法2："><a href="#方法2：" class="headerlink" title="方法2："></a>方法2：</h4><p>第二种就是采用Django自带的一个信号量的机制</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419212217.png" alt=""></p><p>官网的文档反正我看不懂….建议直接去找博客看</p><p>DRF的文档倒是有详细的说明</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419212709.png" alt=""></p><p>文档里面的sender指的是User，created指的是是否是新建的时候修改，这里肯定是新建用户的时候修改密码</p><p>先创建一个<code>signals.py</code>的文件，依照文档的说明写</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419212958.png" alt=""></p><p>然后在apps.py的这个文件夹设置一个ready方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200419213133.png" alt=""></p><h2 id="用户收藏"><a href="#用户收藏" class="headerlink" title="用户收藏"></a>用户收藏</h2><h3 id="收藏功能"><a href="#收藏功能" class="headerlink" title="收藏功能"></a>收藏功能</h3><p>用户收藏的话应该是只需要填写商品即可，用户的ID默认为当前登录的用户，文档有说明</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420115456.png" alt=""></p><p>此时选择商品添加即可，不用再去选择是哪个用户</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420115545.png" alt=""></p><h3 id="判断是否已收藏"><a href="#判断是否已收藏" class="headerlink" title="判断是否已收藏"></a>判断是否已收藏</h3><p>一般情况下做出来的接口会是如下情况</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420120111.png" alt=""></p><p>此时需要在model里面把用户和商品做一个联合唯一索引</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420120313.png" alt=""></p><p>这条代码的意思就是如果记录重复了，数据库就会抛出异常，数据表的设计如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420142521.png" alt=""></p><p>再继续收藏的话那么就会报如下错误：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420142610.png" alt=""></p><p>在DRF里面也可以自定义</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420142906.png" alt=""></p><p>两者可以都用也可以只用一个，DRF还可以自定义错误</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420143104.png" alt=""></p><p>再继续收藏已收藏的商品就会报错</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420143204.png" alt=""></p><p>此外，因为是联合查询，就要定义retrieve的查询字段，lookup_field，默认的查询是pk，这里指定为goods的id</p><p><img src="D:%5Cworkplace%5Cblog%5Csource_posts%5Cupload%5Cimage-20200421092529564.png" alt=""></p><h2 id="权限认证"><a href="#权限认证" class="headerlink" title="权限认证"></a>权限认证</h2><p>DRF有丰富的权限认证</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420144145.png" alt=""></p><p>这里的第一个验证IsAuthenticated是验证用户是否登录，如果没有登录的话那么就返回一个401错误</p><p>但是只有这个的话远远不够，需要自定义权限来判断删除的东西是属于自己的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420145252.png" alt=""></p><p>图中的第一个是白名单设置，第二个是自定义权限设置，这里直接采用第二个即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420145609.png" alt=""></p><h2 id="动态权限设置"><a href="#动态权限设置" class="headerlink" title="动态权限设置"></a>动态权限设置</h2><p>这里是用户注册的时候，这里可以有两种写法，一种是动态权限设置，一种是写两种的方法</p><p>这里我选择的是第一种</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420153531.png" alt=""></p><p>这里因为注册的话，那么肯定是不能要登录后才能注册的，如果是查看个人信息的话肯定是要登录后的，于是就是这样设置</p><p>他源码的方法在<code>viewsets.GenericViewSet-&gt;GenericViewSet-&gt;GenericAPIView-&gt;APIView-&gt;get_permissions</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200420153838.png" alt=""></p><p>依照源码的方法所示：</p><p><img src="D:%5Cworkplace%5Cblog%5Csource_posts%5Cupload%5Cimage-20200420214016211.png" alt=""></p><h2 id="动态序列化设置"><a href="#动态序列化设置" class="headerlink" title="动态序列化设置"></a>动态序列化设置</h2><p>源码地址为：<code>viewsets.GenericViewSet-&gt;generics.GenericAPIView-&gt;GenericAPIView-&gt;get_serializer_class</code></p><p><img src="D:%5Cworkplace%5Cblog%5Csource_posts%5Cupload%5Cimage-20200420215012918.png" alt="image-20200420215012918"></p><p>所以就可以重载这个函数</p><p><img src="D:%5Cworkplace%5Cblog%5Csource_posts%5Cupload%5Cimage-20200421091453768.png" alt=""></p><p>这里的<code>self.actiion</code>是只有<code>viewsets</code>才有的</p><h2 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h2><p>购物车其实是比较复杂的，如果使用之前的viewset和serializers的方法，那么如果购物车已存在商品，那么再加入购物车， 就会报错说商品已经存在，这里需要重写部分的方法来改变原来的功能</p><p>比如说更新数据就是update、没有商品创建就是create，删除就是delete，展示就是list，已经把所有的方法都用上了</p><p>首先用户和商品应构成一个联合唯一索引</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421134148.png" alt=""></p><p>其次应该要进行验证，商品已存在应该是+1，而不是报错</p><p>此时用的应该是serializers.Serializer方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421135024.png" alt=""></p><p>这里goods是外键，但是官方文档那里写的是没有queryset的，因为官网文档使用的是ModelSerializer</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421135300.png" alt=""></p><p>接下来要重写create方法，create方法分为两种情况，一种是从无到有，一种是有了继续增加</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421135910.png" alt=""></p><p>这里create方法的validated_data，是序列化后的数据，initial_data就是没序列化之前的数据，这里的context[“request”]是请求过来的数据</p><p>接下来要判断数据是否已经存在于购物车表中</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421142326.png" alt=""></p><p>先是判断如果存在，就取得第一条的数据，然后把数量+1</p><p>如果是不存在，那么就创建一个新数据</p><p>接下来视图函数也要加上</p><pre><code>lookup_field = &quot;goods_id&quot;</code></pre><p>因为详情修改的时候不是传入pk而是传入商品的ID才行</p><p>此时还是不能进行更新操作的，会报错</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421143053.png" alt=""></p><p>因为还没有重载update方法 ，为什么ModelSerializer不需要呢</p><p>这里看向源码<code>Serializer-&gt;BaseSerializer-&gt;update</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421143631.png" alt="image-20200421143630232"></p><p>而在ModelSerializer中<code>ModelSerializer-&gt;update</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421143815.png" alt=""></p><p>是重写了update各种方法的</p><p>所以这里重写update方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421143914.png" alt=""></p><p>instance就是ShoppingCart这个model的实例</p><p>update方法在重写后就可以正常使用了</p><p>delete方法是不需要自己去重写的</p><h2 id="订单"><a href="#订单" class="headerlink" title="订单"></a>订单</h2><p>订单的话首先考虑的是如何清除购物车的商品，现在视频设计的是把购物车全部清空，这个等我有空我要改回来</p><p>视频中首先是把购物车的商品加到订单上，然后再把购物车的商品清空这两步</p><p>这里首先设计的是要生成订单号，订单号不能冲突，不然的话支付宝返回的支付地址就会出错</p><p>所以这里设计的是当前时间+随机数</p><p> 视频中建议在序列化文件中写</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421153047.png" alt=""></p><p>然后使用validate方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421153703.png" alt=""></p><p>在使用validate方法后</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421153841.png" alt="image-20200421153840088"></p><p>调用save就可以拿到order的实例了</p><p>接下来就可以把购物车的数据加入到订单的商品表，并且在最后清除掉购物车的数据</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421154138.png" alt=""></p><h2 id="支付系统"><a href="#支付系统" class="headerlink" title="支付系统"></a>支付系统</h2><p>因为支付宝的文档规定了很多的东西，所以这里就需要使用APIView来开发</p><p>get方法要处理支付宝返回的支付链接，post方法要处理支付宝的notift_url</p><p>这里要先去验证函数是否能接收返回的信息</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421160930.png" alt=""></p><p>这里要把app_notify_url和return_url都改成设置好的返回函数，也就是如下图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421161244.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421161315.png" alt=""></p><p>先打断点看看函数是否可以接收到返回信息，再去写具体的业务逻辑</p><p>支付后返回的断点查看信息，所有的数据都在post里面</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421161514.png" alt="image-20200421161514048"></p><h2 id="商品的点击数的修改"><a href="#商品的点击数的修改" class="headerlink" title="商品的点击数的修改"></a>商品的点击数的修改</h2><p> 点击数的话，因为商品视图表继承了RetrieveModelMixin，只需要重写这个方法即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421164229.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421164300.png" alt=""></p><h2 id="收藏数的修改"><a href="#收藏数的修改" class="headerlink" title="收藏数的修改"></a>收藏数的修改</h2><p>方法1：</p><p>在收藏商品操作中，重写mixins.CreateModelMixin的perform_create方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421183451.png" alt=""></p><p>instance就是UserFav的实例</p><p>方法2：</p><p>其次还有一个信号量这个方法可以用，这个方法的代码分离性比较好</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421185927.png" alt=""></p><h2 id="修改购物车商品数量"><a href="#修改购物车商品数量" class="headerlink" title="修改购物车商品数量"></a>修改购物车商品数量</h2><p>这里先要记录保存之前的数据，再和现在的数据进行比对</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421210750.png" alt=""></p><h2 id="商品销量增加"><a href="#商品销量增加" class="headerlink" title="商品销量增加"></a>商品销量增加</h2><p>商品销量增加肯定是在购买后才可以增加的，所以要在订单视图函数里面配置</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421211026.png" alt=""></p><p>这里是反向查询数据的</p><h2 id="缓存设置"><a href="#缓存设置" class="headerlink" title="缓存设置"></a>缓存设置</h2><p>部分页面的话不必要每次都查询数据库，Django本身是有个缓存机制的，DRF的缓存也是基于DJango的缓存机制开发的，但是这里不能直接拿Django的去用，因为Django的模板语言开发和前后端分离开发是有区别的，这里可以看向别人拓展的包</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421212938.png" alt=""></p><p>只需要</p><pre><code>from rest_framework_extensions.cache.mixins import CacheResponseMixin</code></pre><p>然后把CacheResponseMixin放到继承的第一个类中即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421213250.png" alt=""></p><p>这里已经是可以使用缓存了，但是这里最好还要配置一下redis作为缓存，因为这个默认方法是基于内存来缓存的，但是项目重启之后就失效了。这里还可以设置过期时间</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421213716.png" alt=""></p><h2 id="使用redis缓存"><a href="#使用redis缓存" class="headerlink" title="使用redis缓存"></a>使用redis缓存</h2><p> redis有更多的好处，比如如果只是在内存中存储，我们是看不到存储了什么的，如果是redis来存储的话可以看到更多的细节问题，比如请求列表的时候，缓存的是html还是json，比如说请求的参数不同对应的缓存是什么，通过redis的key就可以来看到</p><p> 使用Django redis的话需要用到一个第三方的库，是专门用来做Django的redis的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421214333.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421214805.png" alt=""></p><p>第一步当然是安装Django-redis，然后开启redis</p><p>接下来只需要把下面这段代码加入到setting里面就可以了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200421215003.png" alt=""></p><h2 id="限速问题"><a href="#限速问题" class="headerlink" title="限速问题"></a>限速问题</h2><p>为了防止恶意爬虫和DDOS攻击，要对数据进行一个限速，限速这个功能是DRF自带的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200422091201.png" alt=""></p><p>把这段代码加到restframwork的配置中</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200422091303.png" alt=""></p><p>第一个是不登录也可以请求，第二个是登录后的请求</p><p>这里可以定义单位为分钟、秒、小时、日期等</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200422091508.png" alt=""></p><p>然后只需要导入包</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>throttling <span class="token keyword">import</span> UserRateThrottle<span class="token punctuation">,</span>AnonRateThrottle <span class="token comment" spellcheck="true">#配置访问的速率</span></code></pre><p>再配置throttle_classes即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200422091658.png" alt=""></p><p>其内部实现原理如下：</p><p><code>AnonRateThrottle-&gt;SimpleRateThrottle-&gt;parse_rate</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200422091901.png" alt=""></p><p>通过parse_rate解析速度，然后在下面allow_request使用Django的cache把每一个IP的请求次数放到缓存里面</p><p>获取IP的方法在这<code>SimpleRateThrottle-&gt;BaseThrottle-get_ident</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200422092137.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 项目总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> Restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>详解Restframework</title>
      <link href="/2020/04/16/xiang-jie-restframework/"/>
      <url>/2020/04/16/xiang-jie-restframework/</url>
      
        <content type="html"><![CDATA[<blockquote><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这里是对之前的restframwork的简述和对restframwork的部分功能配置做一个总结<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文的案例、讲解均为慕课网天天生鲜项目后的总结</p></blockquote><h2 id="Restframwork的通用配置"><a href="#Restframwork的通用配置" class="headerlink" title="Restframwork的通用配置"></a>Restframwork的通用配置</h2><ol><li>在开始之前需要安装如下的包：</li></ol><pre class=" language-python"><code class="language-python">pip install djangorestframework pip install markdown <span class="token comment" spellcheck="true"># Markdown </span>pip install django<span class="token operator">-</span>filter <span class="token comment" spellcheck="true"># 可选 </span>pip install coreapi <span class="token comment" spellcheck="true"># 可选</span></code></pre><p>其次需要在<code>INSTALLED_APPS</code>添加<code>&#39;rest_framework&#39;</code>，因为<code>rest_framework</code>其实就是一个app，是把原本的http请求封装成一个自己的方式</p><ol start="2"><li>配置好自己的数据库字段，其次需要然后配置好自己的序列化文件<code>serializers.py</code>，如下所示：</li></ol><p><strong>models.py</strong>:</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415155822.png" alt="图1"></p><p><strong>serializers.py</strong>:</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415155832.png" alt="图2"></p><p>然后再类视图<strong>views.py</strong>中配置好自己的字段</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415155834.png" alt="图3"></p><p>最后需要在<strong>urls.py</strong>里面配置好路由地址，这里是采用路由器配置的，不用再像函数式编程一样编写各种方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415155837.png" alt="图4"></p><p>这里的<code>path(&#39;&#39;, include(router.urls)),</code>就是配置首页的接口文档地址，如图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415155840.png" alt="图5"></p><p><code>path(r&#39;^api-auth/&#39;, include(&#39;rest_framework.urls&#39;, namespace=&#39;rest_framework&#39;)),</code>是可以登录页面，即右上角的login</p><h2 id="serializers的结构"><a href="#serializers的结构" class="headerlink" title="serializers的结构"></a>serializers的结构</h2><p>把models里面的数据序列化出来有两种方法，具体如下所示：</p><h3 id="serializers-Serializer"><a href="#serializers-Serializer" class="headerlink" title="serializers.Serializer"></a>serializers.Serializer</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415163852.png" alt="图6"></p><p>这里的<code>objects</code>其实是<code>Model</code>的一个管理器，<code>create</code>只是其中的一个方法。<code>ModelSerializer</code>则是把常用的方法固定，如果要重写方法的话还是得用<code>serializers.Serializer</code></p><p>其中<code>create</code>方法和<code>update</code>方法里面的字段都是固定的写法的，重复代码太多，这里的原理就跟<code>Django</code>的<code>forms</code>验证是一样的，重复的代码那么多可以简写，也就是<code>ModelSerializers</code></p><p>如果只是寻常的增删改查的功能的序列化的话，那么就可以把这些的配置转换为<code>ModelSerializer</code></p><h3 id="serializers-ModelSerializer"><a href="#serializers-ModelSerializer" class="headerlink" title="serializers.ModelSerializer"></a>serializers.ModelSerializer</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415164510.png" alt="图7"></p><h3 id="需要serializers-Serializer情景"><a href="#需要serializers-Serializer情景" class="headerlink" title="需要serializers.Serializer情景"></a>需要serializers.Serializer情景</h3><p>一般的话是不需要使用<code>serializers.Serializer</code>的方式的，因为重复的代码太多。如果是一些需要特定的验证，比如：</p><p>验证购物车（<strong>需要获取到购物车的数据，如果商品存在于数据库，就取得第一个数据；商品如果没有存在于购物车中，就按照正常的存储</strong>）：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415164933.png" alt="图8"></p><p>验证手机号（需要验证手机号发送的频率）：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415165723.png" alt="图9"></p><p>以上类似这些功能的话<code>serializers.ModelSerializer</code>是完全封装好的，所以就只能用<code>serializers.ModelSerializer</code></p><h2 id="Views的结构"><a href="#Views的结构" class="headerlink" title="Views的结构"></a>Views的结构</h2><h3 id="APIView"><a href="#APIView" class="headerlink" title="APIView"></a>APIView</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415171818.png" alt="图10"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415172547.png" alt="图11"></p><p>这个方法是DRF的<code>views</code>基本的方法，而<code>APIView</code>又是基于<code>Django</code>的<code>View</code>，其余的所有方法都是基于<code>APIView</code>来写的</p><p>这里<code>is_vaild</code>方法是跟<code>Django</code>的<code>forms</code>表单验证一样的</p><p>这里的<code>request.data</code>其实在<code>Django</code>里面是没有的，但是<code>DRF</code>进行了封装，无论用户是<code>POST</code>过来的数据还是什么，都会放在<code>data</code>里面，这样取的数据就会很统一，不用再去判断什么<code>get、post</code>方法</p><h3 id="USing-mixins"><a href="#USing-mixins" class="headerlink" title="USing mixins"></a>USing mixins</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415173818.png" alt="图12"></p><p>这里是官方文档介绍的方法，这里先介绍<code>generics.GenericAPIVie</code>的源码，源码如图：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415174124.png" alt="图13"></p><p>他是继承于<code>APIView</code>的，<code>APIView</code>是<code>DRF</code>的东西，其中<code>APIView</code>又继承与<code>Django</code>的<code>View</code></p><p>此外这一层封装了很多东西，在下文有详细说明</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415180029.png" alt="图14"></p><p>如图12所示，为什么还要重写<code>get</code>方法和<code>post</code>方法呢，因为点击<code>ListModelMixin</code>的源码可知：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415174606.png" alt="图15"></p><p>里面有一个list方法，所以在使用的时候是需要重写的单单定义一个<code>serializers_class</code>是没有用的，还需要重写对应的方法才可以使用，如果不重写<code>get</code>方法的话就会出现如下错误：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415174922.png" alt="不重写get方法的错误提示"></p><p>这里的<code>get、psot、put、delete</code>的四种方法分别对应着<code>http</code>的四种方法</p><p>至此这里的方法已经很简单了，但是还是每个接口都需要调用一下<code>get、psot</code>等重复的字段，那么以下的方法更为的简洁</p><p>这里可以看一下源码的结构，打开源码后点开这里：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415180545.png" alt="图16：查看源码结构"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415180624.png" alt="图17:ListAPIView源码"></p><p>这里<code>DRF</code>又做了进一步的封装，原本需要重写<code>get</code>的方法，在这里已经重写了。这里就可以在<code>views</code>直接继承这个方法，而不用去重写原来的字段了，其余的<code>post、put、delete</code>三种方法也是一样的，即<code>cbv</code>的写法</p><h3 id="Using-generic-class-based-views"><a href="#Using-generic-class-based-views" class="headerlink" title="Using generic class-based views"></a>Using generic class-based views</h3><p>采用了图17的<code>ListAPIView</code>的写法后，只需要很少的代码就可以显示所有的结果了，如下图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200415181213.png" alt="图18"></p><h2 id="generics和ViewSets的结构区别"><a href="#generics和ViewSets的结构区别" class="headerlink" title="generics和ViewSets的结构区别"></a>generics和ViewSets的结构区别</h2><p><code>generics</code>的方法和<code>viewsets</code>的方法其实本质上是一样的，这里我来部署一下结构图：</p><h3 id="generics结构图"><a href="#generics结构图" class="headerlink" title="generics结构图"></a>generics结构图</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416163708.png" alt="generics第一层：引入generics"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416163754.png" alt="generics第二层：重点！"></p><p>第二层是重点，因为这一层引入了很多功能，比如图中的<code>api_settings</code>，这个就是官网文档的默认的<code>DRF</code>配置，如下图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416164327.png" alt="DRF的默认配置"></p><p>此外可以看向<code>generics</code>第二层的其他结构</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416164458.png" alt="generics.GenericAPIView"></p><p>这里先可以看到<code>generics</code>也是继承与<code>APIView</code>的</p><p>此外因为<code>generics.GenericAPIView</code>是没有<code>get、post</code>等方法的，所以如果只是继承于<code>generics.GenericAPIView</code>，就要在<code>views</code>视图文件里面重写<code>get、post</code>等方法</p><p>但是<code>generics</code>的其他方法就已经做好了这个功能，比如<code>generics.ListAPIView</code>如下图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416164701.png" alt="generics.ListAPIView"></p><p>这里<code>ListAPIView</code>就已经重写了<code>get</code>方法，所以在视图文件中就可以直接调用，如图18所示</p><p>此外，还有其他的组合方法，需要什么方法都直接继承于一个组合类即可</p><p>​    <img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416165258.png" alt="组合方法"></p><p>这里继续看到第三层</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416165427.png" alt="generics第三层"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416165456.png" alt="generics第四层"></p><p>可以看出，最终的继承的类还是<code>django</code>的<code>view</code></p><h3 id="ViewSets结构图"><a href="#ViewSets结构图" class="headerlink" title="ViewSets结构图"></a>ViewSets结构图</h3><p><code>generics</code>是内部除了<code>GenericAPIView</code>之外都实现了<code>get、post</code>等方法，但是<code>viewset</code>不同，因为他内部没有去实现那些<code>get、post</code>等方法</p><p>这里直接摆<code>viewsets</code>结构图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416105906.png" alt="viewsets第一层"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416105921.png" alt="重点！viewsets第二层"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416110022.png" alt="重点！viewsets第二层的ViewSetMixin方法，详情见下文"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416105947.png" alt="viewsets第三层"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416105959.png" alt="viewsets第四层"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416165651.png" alt="viewsets第五层"></p><p>无论<code>viewsets</code>还是generics，最终继承的都是Django的View</p><p>重点是<code>viewsets</code>第二层的<code>ViewSetMixin</code>方法，里面是没有实现get、post等方法的，具体如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416110129.png" alt="ViewSetMixin方法详情"></p><p>所以如果是没有<code>http</code>的那五个方法的话，就需要在路由上设置，这里要重点看向<code>as_view</code>方法，这个方法是编辑路由文件的重点</p><p>上面所述都是使用视图的方法来创建<code>API</code>的，但是如果是要显示在<code>url</code>上的话，还需要进行路由的配置，这里有两种不同的方法</p><h3 id="配置路由的三种方法"><a href="#配置路由的三种方法" class="headerlink" title="配置路由的三种方法"></a>配置路由的三种方法</h3><h4 id="方法1：配置-api-view来显示api"><a href="#方法1：配置-api-view来显示api" class="headerlink" title="方法1：配置@api_view来显示api"></a>方法1：配置@api_view来显示api</h4><p>在配置完<code>viewset</code>或者<code>generics</code>的视图代码后，我们要在路由显示可用的API，具体局部的实现看我<a href="https://liuyuan636.gitee.io/2019/10/31/restframework-chao-lian-jie-api/" target="_blank" rel="noopener">gitee-Restframework之超链接API</a>或者是<a href="https://373005226.github.io/2019/10/31/restframework-chao-lian-jie-api/" target="_blank" rel="noopener">github-Restframework之超链接API</a>之超链接API这篇文章</p><h4 id="方法2：as-view配置API"><a href="#方法2：as-view配置API" class="headerlink" title="方法2：as_view配置API"></a>方法2：as_view配置API</h4><p>如图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416114450.png" alt="as_view配置API"></p><p>这里需要一个方法一个视图的来配置，代码极为的复杂</p><h4 id="方法3：使用路由器的方法来配置API"><a href="#方法3：使用路由器的方法来配置API" class="headerlink" title="方法3：使用路由器的方法来配置API"></a>方法3：使用路由器的方法来配置API</h4><p>这个才是最主要的写法，直接看图：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416112831.png" alt="路由器的写法"></p><p>这里就可以实现跟方法1和方法2同样的功能，但是却可以使用更少的代码来实现。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>这里就跟官网说的一样</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200416113025.png" alt="官网文档总结"></p><p>如果是使用路由器的写法，代码更少；如果是使用as_view的写法的话结构更为清晰，只不过这里建议如果是要清晰的话建议使用swgger来编写开发文档呢，我认为开发速度和代码的简洁对于开发者来说是比较重要的，对于团队协作的话使用swgger来编写文档还可以写上自己的开发思路。</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> Restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>后端技术公众号</title>
      <link href="/2020/04/14/hou-duan-ji-zhu-gong-zhong-hao/"/>
      <url>/2020/04/14/hou-duan-ji-zhu-gong-zhong-hao/</url>
      
        <content type="html"><![CDATA[<h3 id="python技巧"><a href="#python技巧" class="headerlink" title="python技巧"></a>python技巧</h3><p><a href="https://mp.weixin.qq.com/s/jIeQGYqJztUZEsLg9bGPUw" target="_blank" rel="noopener">使用WSL在Windows上搭建Python开发环境</a></p><p><a href="https://mp.weixin.qq.com/s/4zXnXpZaYcoZMg_HonuXyg" target="_blank" rel="noopener">入坑 Python 后强烈推荐的一套工具库</a></p><p><a href="https://mp.weixin.qq.com/s/bYNnbDATOs_1_vFD7QU4wQ" target="_blank" rel="noopener">很冷门，但非常实用的 Python 库</a></p><p><a href="https://mp.weixin.qq.com/s/eFYDW20YPynjsW_jcp-QWw" target="_blank" rel="noopener">Python要点总结，我使用了100个小例子！</a></p><p><a href="https://mp.weixin.qq.com/s/wlqvAvKvqPCclZm8AvkUSw" target="_blank" rel="noopener">Python 中更优雅的异常处理方案</a></p><p><a href="https://mp.weixin.qq.com/s/-sjLzKWrEOl4rFCKrn1GEw" target="_blank" rel="noopener">Pandas 4 个小 trick，都很实用！</a></p><p><a href="https://mp.weixin.qq.com/s/i0Dd_EHoR4VMdQdEvRo12A" target="_blank" rel="noopener">推荐一些能能提高生产力的 Python 库</a></p><p><a href="https://mp.weixin.qq.com/s/7bNljisifcF4l_xbRiKp4A" target="_blank" rel="noopener">Python 中各种下划线的骚操作：<em>、</em>xx、xx_、<strong>xx、</strong>xx__、<em>classname</em></a></p><p><a href="https://mp.weixin.qq.com/s/ojg04FHxF5f6-3zTqasBsQ" target="_blank" rel="noopener">7个Python特殊技巧，助力你的数据分析工作之路</a></p><p><a href="https://mp.weixin.qq.com/s/B-gzfyQpK2ojSAV0ince-w" target="_blank" rel="noopener">开源 sk-dist，超参数调优仅需 3.4 秒，sk-learn 训练速度提升 100 倍！</a></p><p><a href="https://mp.weixin.qq.com/s/CGYoUi3GjQdJsPITcQzAQw" target="_blank" rel="noopener">30倍！使用Cython加速Python代码</a></p><p><a href="https://mp.weixin.qq.com/s/2ZFZ8olllPnrQ4wtCPPkMA" target="_blank" rel="noopener">Python 69个内置函数分8类总结，这样记更方便！</a></p><p><a href="https://mp.weixin.qq.com/s/zXzv52SyRRx-Ia0DOMtjsg" target="_blank" rel="noopener">代码整洁之道-编写 Pythonic 代码</a></p><p><a href="https://mp.weixin.qq.com/s/upy3HVQhcO29kXPEd4vYwQ" target="_blank" rel="noopener">你常常看到的 <strong>init</strong>.py 到底是个啥？</a></p><h3 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h3><p><a href="https://mp.weixin.qq.com/s/1_miuPAShyAAL3qbWcuhVQ" target="_blank" rel="noopener">商城抢购秒杀服务器架构设计解析</a></p><h3 id="推荐系统"><a href="#推荐系统" class="headerlink" title="推荐系统"></a>推荐系统</h3><p><a href="https://mp.weixin.qq.com/s/gDMGXN_5nj1asNZSBMMX7Q" target="_blank" rel="noopener">相当全面：推荐系统干货总结</a></p><p><a href="https://mp.weixin.qq.com/s/uz26A1_GRiodeO7cKI1LpA" target="_blank" rel="noopener">详解今日头条、抖音的推荐算法原理！</a></p><p><a href="https://mp.weixin.qq.com/s/3QR-QhP4FH1OvhAkwghZPQ" target="_blank" rel="noopener">今日头条、抖音推荐算法原理全文详解！</a></p><p><a href="https://mp.weixin.qq.com/s/1zlyk_XzHxyJ6CfbezxRDg" target="_blank" rel="noopener">现实世界中的推荐系统</a></p><p><a href="https://mp.weixin.qq.com/s/kETcLo5VA9Oi1WV6JRGIyw" target="_blank" rel="noopener">推荐系统结合知识图谱简单总结</a></p><h3 id="深度学习"><a href="#深度学习" class="headerlink" title="深度学习"></a>深度学习</h3><p><a href="https://mp.weixin.qq.com/s/yYfVM20DamQdJVwdpaQT_Q" target="_blank" rel="noopener">一文理解PyTorch：附代码实例</a></p><p><a href="https://mp.weixin.qq.com/s/TqZIAiyI91ZgaPypaUDc1g" target="_blank" rel="noopener">深度学习必须掌握的 13 种概率分布</a></p><p><a href="https://mp.weixin.qq.com/s/xnDIgaVWefyDpJICKhLyWA" target="_blank" rel="noopener">强烈推荐！GitHub开源项目 手写30多个机器学习主流算法！</a></p><p><a href="https://mp.weixin.qq.com/s/LBGHUOhsSeqPUbJK9PidNg" target="_blank" rel="noopener">深度学习简单开发？这里有一份优秀答案</a></p><p><a href="https://mp.weixin.qq.com/s/x_d0Iw_LdLv2XCthptpWBw" target="_blank" rel="noopener">飞桨火力全开，重磅上线3D模型：PointNet++、PointRCNN！</a></p><p><a href="https://mp.weixin.qq.com/s/5qi3vuGEt8pQmL5C2HCCJQ" target="_blank" rel="noopener">[建精读]阿里前端专家，揭秘职位描述下的潜台词</a></p><p><a href="https://mp.weixin.qq.com/s/Wlhdr9slnA60vuA_gnBCSw" target="_blank" rel="noopener">豆瓣评分9.8！历经三年才完成，复旦教授的《神经网络与深度学习》免费下载了</a></p><p><a href="https://mp.weixin.qq.com/s/J_O84dcQ98IQtzbEFCo5Xw" target="_blank" rel="noopener">五行代码用图提升模型表现，TensorFlow开源NSL神经结构学习框架</a></p><p><a href="https://mp.weixin.qq.com/s/quWxGWxzgy_qVmDBbjATsw" target="_blank" rel="noopener">最通俗的方式解释神经网络的数学过程</a></p><p><a href="https://mp.weixin.qq.com/s/nMRj24nRPQ97bW8YRkVI8w" target="_blank" rel="noopener">字节跳动开源分布式训练框架BytePS，登上GitHub热榜</a></p><p><a href="https://mp.weixin.qq.com/s/LgPUL4OjZuD3_-DhJubz2g" target="_blank" rel="noopener">Pytorch常见的坑汇总</a></p><p><a href="https://mp.weixin.qq.com/s/FPDqupz9vCRDVXHqwbRRGQ" target="_blank" rel="noopener">Pytorch节省内存（显存）的小技巧</a></p><h3 id="数据分析与数据挖掘"><a href="#数据分析与数据挖掘" class="headerlink" title="数据分析与数据挖掘"></a>数据分析与数据挖掘</h3><p><a href="https://mp.weixin.qq.com/s/Rgh9SIKlbBpOzOpZLUSqZA" target="_blank" rel="noopener">Python数据分析学习路线个人总结</a></p><p><a href="https://mp.weixin.qq.com/s/Nx995uTbOSdxRWMq9FL1iQ" target="_blank" rel="noopener">数据挖掘竞赛指南：曾经的数据挖掘少年，如今的阿里算法大佬</a></p><p><a href="https://mp.weixin.qq.com/s/WPMvwCQOCTxlt9KxdSzTAQ" target="_blank" rel="noopener">太赞了！Python 数据科学速查表中文版强势来袭</a></p><p><a href="https://mp.weixin.qq.com/s/NqCz_SOzebibhsYc4BE_6g" target="_blank" rel="noopener">分享10个强大的神器工具，你一定会需要！</a></p><p><a href="https://mp.weixin.qq.com/s/IqBWWcBdHcvO5lXu7Y_niQ" target="_blank" rel="noopener">Pandas、Matplotlib、Pyecharts数据分析实践</a></p><p><a href="https://mp.weixin.qq.com/s/n6e4-VUxLkoOmWgRbQg9UA" target="_blank" rel="noopener">「最全」实至名归，NumPy 官方早有中文教程，结合深度学习，还有防脱发指南</a></p><p><a href="https://mp.weixin.qq.com/s/xh-fiDHvn30XD7bUX5ttVg" target="_blank" rel="noopener">Pandas官方文档中文版PDF下载</a></p><p><a href="https://mp.weixin.qq.com/s/d0xo6UebEhTgPThnJTuLYw" target="_blank" rel="noopener">「数据分析」之零基础入门数据挖掘</a></p><p><a href="https://mp.weixin.qq.com/s/A2vChdNXRqlddyIY0iJ3zQ" target="_blank" rel="noopener">「特征工程」之零基础入门数据挖掘</a></p><p><a href="https://mp.weixin.qq.com/s/gJWLQRLsXn8JNbopDsnaQQ" target="_blank" rel="noopener">加一行注释，让你的 Python 程序提速 10+ 倍！Numba 十分钟上手指南</a></p><p><a href="https://mp.weixin.qq.com/s/MxXQqB0-EnB6mCdneS73pA" target="_blank" rel="noopener">数据小白如何入门数据分析？</a></p><p><a href="https://mp.weixin.qq.com/s/CR_JrvpsRGL__giaggINxw" target="_blank" rel="noopener">快乐学习Pandas！开源教程《Joyful-Pandas》发布</a></p><p><a href="https://mp.weixin.qq.com/s/8Ntp_Lx044azwSPbZ_KjPg" target="_blank" rel="noopener">快乐学习Pandas入门篇：Pandas基础</a></p><p><a href="https://mp.weixin.qq.com/s/7ORyiSRb5OY3CDedZadPfA" target="_blank" rel="noopener">数据挖掘入门指南！！！</a></p><p><a href="https://mp.weixin.qq.com/s/lnfiJzQ3_xiwCjepkJWy-Q" target="_blank" rel="noopener">【可视化】seaborn常用的10种数据分析图表</a></p><p><a href="https://mp.weixin.qq.com/s/Qhb1yDcMti63bZQGFSk3tQ" target="_blank" rel="noopener">Python数据分析实战：获取数据</a></p><p><a href="https://mp.weixin.qq.com/s/UlIeyF1Qk-vOIe-57U0xlA" target="_blank" rel="noopener">NumPy进阶修炼｜你真的了解NumPy吗</a></p><p><a href="https://mp.weixin.qq.com/s/Y_L6QPOQwuUEtt1LVRs4bA" target="_blank" rel="noopener">干货 | 一文让你了解Pandas数据结构</a></p><h3 id="机器学习"><a href="#机器学习" class="headerlink" title="机器学习"></a>机器学习</h3><p><a href="https://mp.weixin.qq.com/s/5lQMlZ_nhs1H5ajd8dD9OA" target="_blank" rel="noopener">数学基础、机器学习经典算法、统计学习方法，这份机器学习在线手册来帮你</a></p><p><a href="https://mp.weixin.qq.com/s/fIHUOyK8KIyuPjGGOMoubQ" target="_blank" rel="noopener">阿里机器学习算法面经（已offer）</a></p><p><a href="https://mp.weixin.qq.com/s/gX174_0CtgnFuqMZXTSHsA" target="_blank" rel="noopener">我爱了！700 页的机器学习笔记火了！完整版开放下载</a></p><p><a href="https://mp.weixin.qq.com/s/O4fPxLJiFJhPQ2_8hfRb7w" target="_blank" rel="noopener">周志华教授谈如何做研究与写论文 完整PPT开放下载！</a></p><p><a href="https://mp.weixin.qq.com/s/rvk6-nOEGrh9l-7JI-tKMQ" target="_blank" rel="noopener">决策树原理学习笔记（一）</a></p><p><a href="https://mp.weixin.qq.com/s/7DSBCDRTAIiv96wKyp6yFA" target="_blank" rel="noopener">【白话机器学习】算法理论+实战之AdaBoost算法</a></p><p><a href="https://mp.weixin.qq.com/s/SZXQqE76NHgFSQQvzsFaTw" target="_blank" rel="noopener">你离开学只差这个视频：李宏毅机器学习2020版正式开放上线2</a></p><p><a href="https://mp.weixin.qq.com/s/46dSfHW-Tei6pxUUZRjamg" target="_blank" rel="noopener">自学机器学习课程怕踩雷？有人帮你选出了top 5优质课</a></p><p><a href="https://mp.weixin.qq.com/s/W7MNDKowPqtyGbSec6rOmA" target="_blank" rel="noopener">90题细品吴恩达《机器学习》，感受被刷题支配的恐惧</a></p><p><a href="https://mp.weixin.qq.com/s/cIhpub2KfYtg0rcJjN92LA" target="_blank" rel="noopener">普林斯顿博士：手写 30 个主流机器学习算法，全都开源了！</a></p><p><a href="https://mp.weixin.qq.com/s/uR0gn3UV7Sojly2soIMUkQ" target="_blank" rel="noopener">有没有必要把机器学习算法自己实现一遍？</a></p><p><a href="https://mp.weixin.qq.com/s/XNDbIL7hwNvdEbjWqHOcdw" target="_blank" rel="noopener">Github 上评价最高的 5 个机器学习项目</a></p><p><a href="https://mp.weixin.qq.com/s/qpJWOjWEPaEyfuDxrMcVZQ" target="_blank" rel="noopener">Python 将时间戳转换为指定格式日期</a></p><p><a href="https://mp.weixin.qq.com/s/m9CpQZ0rpIzehB3M-zk8zA" target="_blank" rel="noopener">GitHub万星资源：强化学习算法实现，教程代码样样全，还有详细学习规划</a></p><p><a href="https://mp.weixin.qq.com/s/k2vm1ZKXI7Nh9xhSPM8VFg" target="_blank" rel="noopener">斯坦福学霸分享的10个自用的免费在线课程</a></p><p><a href="https://mp.weixin.qq.com/s/YGtYJZ19N_LBY7YLUKbUWA" target="_blank" rel="noopener">入门者的机器学习/深度学习自学指南</a></p><p><a href="https://mp.weixin.qq.com/s/_1DTHbaLDhu61GzwkVGegw" target="_blank" rel="noopener">李航《统计学习方法》读书笔记</a></p><p><a href="https://mp.weixin.qq.com/s/DDyjJ75pZ6SoHu2yz37Lrg" target="_blank" rel="noopener">使用Scikit-Learn轻松实现数据缩放</a></p><p><a href="https://mp.weixin.qq.com/s/fc4dmz8nsSoySJHLoRKmzw" target="_blank" rel="noopener">WWW2020推荐系统论文合集(已分类整理，并提供下载)</a></p><p><a href="https://mp.weixin.qq.com/s/puQfDdwnwLbSIpGcrbO4RQ" target="_blank" rel="noopener">近期机器学习系列文章汇总</a></p><p><a href="https://mp.weixin.qq.com/s/Vd69YfY9_5PrHKG_VEvWEg" target="_blank" rel="noopener">机器阅读理解方向有什么值得follow的大佬，网站等等?</a></p><p><a href="https://mp.weixin.qq.com/s/9SfN2nN0wXLXy49oQNzKiA" target="_blank" rel="noopener">【白话机器学习】算法理论+实战之关联规则</a></p><h3 id="运维管理"><a href="#运维管理" class="headerlink" title="运维管理"></a>运维管理</h3><p><a href="https://mp.weixin.qq.com/s/LH7bABN8Lj9vUenI4OVRyA" target="_blank" rel="noopener">Lazydocker：一款功能强大的Docker管理套件</a></p><p><a href="https://mp.weixin.qq.com/s/DhJNXNvC9EM_zz-KyBEZYg" target="_blank" rel="noopener">Kubernetes 还是 DC/OS？实现云原生的路上，选型只是开始！</a></p><p><a href="https://mp.weixin.qq.com/s/kJ54xTF-iM22xSlO-0iaOQ" target="_blank" rel="noopener">原创 | 全网最实在的docker入门教程四</a></p><p><a href="https://mp.weixin.qq.com/s/MUa5FdN_QY-_BGwncP9AYQ" target="_blank" rel="noopener">Linux容器技术原理和使用</a></p><p><a href="https://mp.weixin.qq.com/s/CXUwpTbAVoXEeB7EcrCjAw" target="_blank" rel="noopener">不搞虚的！快速把你拉入Docker 的门里 | 原力计划</a></p><p><a href="https://mp.weixin.qq.com/s/hGKmzyVngqEJGb7wQMnXyg" target="_blank" rel="noopener">Docker 概念很难理解？一文搞定 Docker 端口绑定</a></p><p><a href="https://mp.weixin.qq.com/s/qLsKEn1iEYI-LHeuS1_fOA" target="_blank" rel="noopener">终于有人把 Docker 讲清楚了，万字详解！（建议收藏）</a></p><p><a href="https://mp.weixin.qq.com/s/IR11v7n9uu_sFARt-iEy8w" target="_blank" rel="noopener">从安全到镜像流水线，Docker 最佳实践与反模式一览</a></p><p><a href="https://mp.weixin.qq.com/s/qAleX1onlCyxdeEx-BLCuw" target="_blank" rel="noopener">两小时入门 Docker（好文推荐）</a></p><h3 id="实用网站"><a href="#实用网站" class="headerlink" title="实用网站"></a>实用网站</h3><p><a href="https://mp.weixin.qq.com/s/hJxNLwDl7yTFzPXKBGDOSw" target="_blank" rel="noopener">「秘」那些管UI小姐姐要来的网站</a></p><p><a href="https://mp.weixin.qq.com/s/EAZBXhNhM6aN1KiF134zQw" target="_blank" rel="noopener">60个相见恨晚的神器工具</a></p><h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><p><a href="https://mp.weixin.qq.com/s/C6xcIZFWag3ou8R0E8Bixg" target="_blank" rel="noopener">支付宝应用的架构到底有多牛？</a></p><p><a href="https://mp.weixin.qq.com/s/Fy4x-FrXWuEXeWHoOf8aGA" target="_blank" rel="noopener">面试必问四角关系！QPS、TPS、并发用户数、吞吐量！</a></p><p><a href="https://mp.weixin.qq.com/s/HM-3gs-KP8-js4LHWWxQbA" target="_blank" rel="noopener">五分钟看懂 Nginx 负载均衡</a></p><p><a href="https://mp.weixin.qq.com/s/akBoBjaPLtctdJrs-Hvhtg" target="_blank" rel="noopener">12张手绘图，终于搞懂了微服务架构</a></p><h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><p><a href="https://mp.weixin.qq.com/s/SBu9XwZZ_qG3nq7vnwfQgg" target="_blank" rel="noopener">面试问我，创建多少个线程合适？我该怎么说</a></p><h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><p><a href="https://mp.weixin.qq.com/s/xiVWDnQjhnbBzUJgcdsV-g" target="_blank" rel="noopener">Linux 11个炫酷的终端命令！你知道几个？</a></p><h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><p><a href="https://mp.weixin.qq.com/s/IgaRneLCKcBraBF_4_srBg" target="_blank" rel="noopener">厉害了，SQL在线模拟器！还装个毛的环境！</a></p><p><a href="https://mp.weixin.qq.com/s/yxS4tpX_6fz9LBsh0UoHpw" target="_blank" rel="noopener">什么是 MySQL 索引?</a></p><p><a href="https://mp.weixin.qq.com/s/29W0mEkvLgjGG0DkRkm8KQ" target="_blank" rel="noopener">面试问Redis锁，我脸都绿了……</a></p><p><a href="https://mp.weixin.qq.com/s/7pSLPQQyeqRd7SuWGu8oJg" target="_blank" rel="noopener">一文深入了解 Redis 内存模型，Redis 的快是有原因的！</a></p><p><a href="https://mp.weixin.qq.com/s/y0xFct21wIVK8N3cdE7s1w" target="_blank" rel="noopener">超详细的redis入门</a></p><p><a href="https://mp.weixin.qq.com/s/Tta36pxSIGDvnW_Rb-FkQA" target="_blank" rel="noopener">吊打面试官之消息队列基础</a></p><p><a href="https://mp.weixin.qq.com/s/wKZGkxBIac-C1UUaJUlShQ" target="_blank" rel="noopener">平时不努力，面试弟中弟</a></p><p><a href="https://mp.weixin.qq.com/s/MxRVprNoGswL_vWuwt43kg" target="_blank" rel="noopener">一次 SQL 查询优化原理分析（900W+ 数据，从 17s 到 300ms）</a></p><h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><p><a href="https://mp.weixin.qq.com/s/ORpfjtU-EwGZIPrqp1V4uw" target="_blank" rel="noopener">拜托，别再问我什么是B+树 了</a></p><p><a href="https://mp.weixin.qq.com/s/-bI9ien3dGVDDKrDve0qRQ" target="_blank" rel="noopener">用Python手写十大经典排序算法</a></p><p><a href="https://mp.weixin.qq.com/s/NmIUAfoeEw1iw57lC6eylA" target="_blank" rel="noopener">最全Python算法入门</a></p><p><a href="https://mp.weixin.qq.com/s/pIMCxFpiqs85jXAiVuuUxA" target="_blank" rel="noopener">好些粉丝私信我要不要学算法？？帅地决定怒怼那些张口就说算法无用论的人！</a></p><p><a href="https://mp.weixin.qq.com/s/clVnq9tXbSUC1U1kCnA8YA" target="_blank" rel="noopener">当输入 xxxxHub 后，到网页显示，其间发生了什么？这问题被面试官问了五六十次，熬夜赶出这篇文章</a></p><p><a href="https://mp.weixin.qq.com/s/k28aCwdZNe84HaBr6YTS8g" target="_blank" rel="noopener">动画：用动画给面试官解释 KMP 算法</a></p><p><a href="https://mp.weixin.qq.com/s/9oGJJ32Mrxct2sROlZv4sQ" target="_blank" rel="noopener">拒绝跟风，谈谈几种算法岗的区别和体验</a></p><p><a href="https://mp.weixin.qq.com/s/qbGBa6pThRkAmkRZ4Lacgg" target="_blank" rel="noopener">为什么要学数据结构？| 原力计划</a></p><p><a href="https://mp.weixin.qq.com/s/0mK_iZBWuGd85VFtSMkmWQ" target="_blank" rel="noopener">如何科学的打开 Leetcode</a></p><p><a href="https://mp.weixin.qq.com/s/tDzjti8hOEqetFdlns253w" target="_blank" rel="noopener">有了这套模板，女朋友再也不用担心我刷不动 LeetCode 了</a></p><p><a href="https://mp.weixin.qq.com/s/EiJum3-44TqXZN4apuSQUQ" target="_blank" rel="noopener">如何找到字符串中的最长回文子串？</a></p><p><a href="https://mp.weixin.qq.com/s/_m9rG2cvo8xZzt4wyEnvjg" target="_blank" rel="noopener">神一样的随机算法</a></p><p><a href="https://mp.weixin.qq.com/s/mIKk20MaMMAh2p1_fxQPsA" target="_blank" rel="noopener">算法菜鸟的春招之路</a></p><p><a href="https://mp.weixin.qq.com/s/34ZeJPRzBQ3FA8TX_HCl6Q" target="_blank" rel="noopener">游戏中的敏感词过滤算法如何实现的？</a></p><p><a href="https://mp.weixin.qq.com/s/3uCQj0-WBXENZyr1mQ1mZQ" target="_blank" rel="noopener">漫画：“哈夫曼编码” 是什么鬼？</a></p><p><a href="https://mp.weixin.qq.com/s/0f77h18dTe-d9V9eG1vqFQ" target="_blank" rel="noopener">用 Python 挪车、管理农场，这届 PyCon 有点香</a></p><p><a href="https://mp.weixin.qq.com/s/zivOyNWi99r8L7WO3HhByA" target="_blank" rel="noopener">什么是线段树？</a></p><p><a href="https://mp.weixin.qq.com/s/mEFlywVDmAgTFSDr5TSxdA" target="_blank" rel="noopener">呕心泣血算法指导篇（真正的干货，怒怼那些说算法没用的人）</a></p><p><a href="https://mp.weixin.qq.com/s/DLxjVLm419Ecyriv0PB3Fg" target="_blank" rel="noopener">二叉树就是这么简单(面试常考点)</a></p><p><a href="https://mp.weixin.qq.com/s/YPt8FY4hXoEosu3XEBKEZg" target="_blank" rel="noopener">非常详细的 Linux C/C++ 学习路线总结！助我拿下腾讯off</a></p><p><a href="https://mp.weixin.qq.com/s/7hLLl7CXpLfzK2hwURv1Ug" target="_blank" rel="noopener">跟大家聊 10 道考察前端算法基础的高频题</a></p><p><a href="https://mp.weixin.qq.com/s/k4-RaW4ROlo6chSXsO_4AA" target="_blank" rel="noopener">数据结构里各种难啃的“树”，一文搞懂它</a></p><h3 id="后端技巧"><a href="#后端技巧" class="headerlink" title="后端技巧"></a>后端技巧</h3><p><a href="https://mp.weixin.qq.com/s/dIjFzuJYvc7LI4RTBtcNsg" target="_blank" rel="noopener">扫码登录的技术原理好像没那么难</a></p><p><a href="https://mp.weixin.qq.com/s/cohWZy_eUOUqbmUxhXzzNA" target="_blank" rel="noopener">Elasticsearch快速入门，掌握这些刚刚好！</a></p><h3 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h3><p><a href="https://mp.weixin.qq.com/s/uDUGsD0cr2RUq9JAtht3cA" target="_blank" rel="noopener">程序员必知的 89 个操作系统核心概念</a></p><p><a href="https://mp.weixin.qq.com/s/YBplUgUv2F4-l-unnvZ2_w" target="_blank" rel="noopener">牛逼！有人用漫画带你了解 Linux 内核长啥样</a></p><p><a href="https://mp.weixin.qq.com/s/QjFsrWzekBunIT9GE2GB4Q" target="_blank" rel="noopener">别再说你不懂Linux内存管理了，10张图给你安排的明明白白！</a></p><p><a href="https://mp.weixin.qq.com/s/VsQ7IpP-jnXSjJhOAzl-ew" target="_blank" rel="noopener">硬核科普：程序员必知的 89 个操作系统核心概念</a></p><p><a href="https://mp.weixin.qq.com/s/qNyQn_zef3KyBeW_nWJ7FA" target="_blank" rel="noopener">漫画：什么是openEuler社区？</a></p><h3 id="其余知识"><a href="#其余知识" class="headerlink" title="其余知识"></a>其余知识</h3><p><a href="https://mp.weixin.qq.com/s/s7DSkjV_a9_iOIXPkWr_Nw" target="_blank" rel="noopener">RabbitMQ和Kafka的比较</a></p><p><a href="https://mp.weixin.qq.com/s/8BTx0Wj38Sc8rccKbZktjA" target="_blank" rel="noopener">应该选择RabbitMQ还是Kafka？</a></p><p><a href="https://mp.weixin.qq.com/s/gPiiNmMKb1X2DBW0DilBpA" target="_blank" rel="noopener">面试了15位来自985/211高校的2020届研究生，思考许久，熬夜赶出了这篇文章</a></p><p><a href="https://mp.weixin.qq.com/s/BnbBQGL-S2sGdRtNh7DN1A" target="_blank" rel="noopener">二本无实习上岸滴滴京东58·复盘(中)</a></p><p><a href="https://mp.weixin.qq.com/s/hAE3ket5N_vC-OlV0ISAzQ" target="_blank" rel="noopener">关于NodeJS工作原理的五个误解</a></p><p><a href="https://mp.weixin.qq.com/s/OTFFG0qL6KVDTZgALN30sA" target="_blank" rel="noopener">讲道理，MD5 到底是不是加密算法？</a></p><p><a href="https://mp.weixin.qq.com/s/-ZEhPTQWlJx0GgTiwIm6tA" target="_blank" rel="noopener">如何设计一个高性能短链？</a></p><p><a href="https://mp.weixin.qq.com/s/cvwgDrXcoJrWfHdY2sI6zQ" target="_blank" rel="noopener">面经 | 腾讯NLP实习面经（Offer已拿）</a></p><p><a href="https://mp.weixin.qq.com/s/AOz9GYrBDowZJMgIwi4Aqw" target="_blank" rel="noopener">记一次腾讯社招前端面试（已拿到offer入职）</a></p><p><a href="https://mp.weixin.qq.com/s/XraK63GniDXeJ5aQppEo7A" target="_blank" rel="noopener">凭什么 FastAPI 火成这样？看这篇文章就知道了</a></p><p><a href="https://mp.weixin.qq.com/s/1Jacyz_PwKknZW3-OA2T4A" target="_blank" rel="noopener">630页！帅地把高评分原创文章整理成一份带高清书签的电子书，送给大家</a></p><p><a href="https://mp.weixin.qq.com/s/zOoQBCfJkEWeoSPLTfJYQA" target="_blank" rel="noopener">吐血整理今年 89 道大厂面试题，附答案</a></p><p><a href="https://mp.weixin.qq.com/s/yBQ6SarY3CV4utxweygMDg" target="_blank" rel="noopener">如果没准备这些面试题，找工作还是先缓缓吧</a></p><p><a href="https://mp.weixin.qq.com/s/LoFS4NLbcCpWstFZmbCkxA" target="_blank" rel="noopener">5面终于拿到了字节跳动offer! 鬼知道我经历了啥…</a></p><p><a href="https://mp.weixin.qq.com/s/AyLwYqMhTpAL2qgxYaZOWA" target="_blank" rel="noopener">讲一讲当时春秋招时做过的项目以及推荐几个项目+面试视频</a></p><p><a href="https://mp.weixin.qq.com/s/09u5Au96QUBBRYFd1NVHlA" target="_blank" rel="noopener">卧槽！GitHub 标星 1.6w+，我发现了一个宝藏项目，作为编程新手有福了！</a></p><p><a href="https://mp.weixin.qq.com/s/e24Hc4FguEB1GJl5XZX_7w" target="_blank" rel="noopener">神器推荐！在浏览器中运行 VS Code，随时随地写代码</a></p><p><a href="https://mp.weixin.qq.com/s/-IcKIm15ZcX4t4G3Ur8atQ" target="_blank" rel="noopener">这几个百度搜索技巧，太好用了</a></p><p><a href="https://mp.weixin.qq.com/s/tDzjti8hOEqetFdlns253w" target="_blank" rel="noopener">有了这套模板，女朋友再也不用担心我刷不动 LeetCode 了</a></p><p><a href="https://mp.weixin.qq.com/s/xHxgfsb4rTn77p56GS_bRQ" target="_blank" rel="noopener">2019必学的10大顶级Python库</a></p><p><a href="https://mp.weixin.qq.com/s/DT3lON4_ciEWT4fcxO-TUA" target="_blank" rel="noopener">DeepMind 重磅开源强化学习游戏框架【智能快讯】</a></p><p><a href="https://mp.weixin.qq.com/s/I6on0Q72AD2Qk_a8qhdgNw" target="_blank" rel="noopener">分享几个自用的编程书籍下载网站</a></p><p><a href="https://mp.weixin.qq.com/s/cG7HQCGzhel9JVPPfJ7rNA" target="_blank" rel="noopener">【PPT】Vue.js 团队成员蒋豪群：Vue 高效开发之路</a></p><p><a href="https://mp.weixin.qq.com/s/sjdjVVu6S2LxPsgFxp-sPg" target="_blank" rel="noopener">漫话：如何给女朋友解释什么是撞库、脱库和洗库？</a></p><p><a href="https://mp.weixin.qq.com/s/Y0fNty15w0_Y68EJvHTrAw" target="_blank" rel="noopener">Python并发处理：CSP和协程</a></p><p><a href="https://mp.weixin.qq.com/s/tBD92S6zucCLi1LdqNFMiQ" target="_blank" rel="noopener">手把手教你搭建完美的 Android 搞机/逆向环境</a></p><p><a href="https://mp.weixin.qq.com/s/VlnBKbxJR7Eov2gzEOZALw" target="_blank" rel="noopener">利用 Python 深度学习识别滑动验证码缺口</a></p><p><a href="https://mp.weixin.qq.com/s/4AO742nDAX6z2QTqEwDGGA" target="_blank" rel="noopener">如何用一根网线发起攻击？只能对不起被我攻击的室友了</a></p><p><a href="https://mp.weixin.qq.com/s/VWS0mMA3qRSjEAXlqB5n3g" target="_blank" rel="noopener">Elasticsearch 在互联网公司大量真实的应用案例</a></p><h3 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h3><p><a href="https://mp.weixin.qq.com/s/uBqvZ9t23tGm8h84UyXpNA" target="_blank" rel="noopener">如何设计一款地震高岗一派溪山千古秀的反爬虫？</a></p><p><a href="https://mp.weixin.qq.com/s/2M4T4SuGfuGR9Rx9nzL1qA" target="_blank" rel="noopener">哇靠，这些数据疯狂变化，该怎么爬取？</a></p><h3 id="超实用技巧"><a href="#超实用技巧" class="headerlink" title="超实用技巧"></a>超实用技巧</h3><p><a href="https://mp.weixin.qq.com/s/r1nJ_08SYQdba-_vmhgNKw" target="_blank" rel="noopener">如何制作一本在线的电子书或 Python 文档供其他人远程访问</a></p><p><a href="https://mp.weixin.qq.com/s/dBZLcew0YKt2-MnJmaC68Q" target="_blank" rel="noopener">推荐一款软件！</a></p><p><a href="https://mp.weixin.qq.com/s/vWcomUDh7saDNqUOzb9m0g" target="_blank" rel="noopener">用生动有趣的emoij美化你的commit log</a></p><p><a href="https://mp.weixin.qq.com/s/wZN5uveHt2czTP7mvwRscg" target="_blank" rel="noopener">如何在Gihub上面精准搜索开源项目？</a></p><p><a href="https://mp.weixin.qq.com/s/0nMYhqpYHQ3Tiue7R3eMeA" target="_blank" rel="noopener">110道Python面试真题</a></p><p><a href="https://mp.weixin.qq.com/s/B0b6rqmsGQEUG_53nLU48Q" target="_blank" rel="noopener">Python可视化神器Yellowbrick使用</a></p><p><a href="https://mp.weixin.qq.com/s/xerifcGSwVvfgNLFMyfhNA" target="_blank" rel="noopener">Windows全能终端神器，实在是太棒了！再也不用担心会收到律师函！</a></p><p><a href="https://mp.weixin.qq.com/s/KBxO0lNEfRHtGngfCNuj9A" target="_blank" rel="noopener">多账户的统一登录 实现全过程</a></p><p><a href="https://mp.weixin.qq.com/s/-pazqu03A4ejRvFRCfHoZw" target="_blank" rel="noopener">【超全+实用】常用的46个私密Pandas方法首次公开，全网最新！！！</a></p><p><a href="https://mp.weixin.qq.com/s/TUbIJgE9_qAWbGsPPbcvqQ" target="_blank" rel="noopener">资源 | O’Reilly新书：《生成式深度学习》，近5年最先进GAN一网打全！</a></p><p><a href="https://www.cnblogs.com/gfhh/p/12103640.html" target="_blank" rel="noopener">DRF的面试题</a></p><p><a href="https://mp.weixin.qq.com/s/eQZ1gk8fDKXSNvE8vDttGw" target="_blank" rel="noopener">ElasticSearch 使用 Logstash 从 MySQL 中同步数据</a></p><p><a href="https://mp.weixin.qq.com/s/isa2RVGFlhShWqdn102YaQ" target="_blank" rel="noopener">记一次 Python Web 接口优化</a></p><p><a href="https://mp.weixin.qq.com/s/K0ZVI-6p9za4vk-FNhNr3w" target="_blank" rel="noopener">315道Python面试题，欢迎挑战！</a></p><p><a href="https://mp.weixin.qq.com/s/Sr2LzdIzY8TKnpCUL0BebA" target="_blank" rel="noopener">骚操作！曾经爱过！用 Python 清理收藏夹里已失效的网站</a></p><p><a href="https://mp.weixin.qq.com/s/T49huSGp8hpwAmwqlhSdog" target="_blank" rel="noopener">吐血推荐，B站最强学习资源汇总（数据科学，机器学习，python）</a></p><p><a href="https://mp.weixin.qq.com/s/21wIJ0upl6jDBaIww_GqqQ" target="_blank" rel="noopener">如何从 Windows 切换到 Linux</a></p><p><a href="https://mp.weixin.qq.com/s/3ODv1XNpLguoK4EdoOnPNg" target="_blank" rel="noopener">训练吞吐量提升6倍！飞桨弹性计算推荐系统ElasticCTR 1.0发布</a></p><p><a href="https://mp.weixin.qq.com/s/6SweKabqM3rnVOpmgDAR2A" target="_blank" rel="noopener">Python六酷技巧</a></p><p><a href="https://mp.weixin.qq.com/s/Yz_6jQOjS71cEs-MwhvPqA" target="_blank" rel="noopener">315道Python面试题，欢迎挑战</a></p><p><a href="https://blog.csdn.net/lmz_lmz/article/details/80986106?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-4&utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-4" target="_blank" rel="noopener">DRF第三方继承包</a></p><p><a href="https://blog.csdn.net/weixin_43420337/article/details/100033902#comments" target="_blank" rel="noopener">Django使用蓝鲸技巧</a></p><h3 id="工具技巧"><a href="#工具技巧" class="headerlink" title="工具技巧"></a>工具技巧</h3><p><a href="https://mp.weixin.qq.com/s/nYBiu1ct9WBBODJk8qv-0w" target="_blank" rel="noopener">重磅！首款 Jupyter 官方可视化 Debug 工具，JupyterLab 未来可默认支持 Debug</a></p><p><a href="https://mp.weixin.qq.com/s/VrB5cTYe2J7PgWfb2rEkLg" target="_blank" rel="noopener">Jupyter不为人知的7个超好用功能！</a></p><p><a href="https://mp.weixin.qq.com/s/rikuo_A3lxcoW5cLQGciSA" target="_blank" rel="noopener">5个酷毙的Python神器工具</a></p><p><a href="https://mp.weixin.qq.com/s/rAwMzVKC8AxS1p_zpcnX8g" target="_blank" rel="noopener">GitHub Actions，卧槽！牛批！</a></p><p><a href="https://mp.weixin.qq.com/s/s7wnocXC-DFh4bbX96fCdQ" target="_blank" rel="noopener">决策树原理学习笔记（一）</a></p><p><a href="https://mp.weixin.qq.com/s/MMOWeNhv_zapLOCht-lEug" target="_blank" rel="noopener">130 个相见恨晚的神器网站</a></p><p><a href="https://mp.weixin.qq.com/s/QZhVbezh2PspxUDUKYIbnQ" target="_blank" rel="noopener">我是如何提高工作和研究效率的？分享给大家几个神器</a></p><p><a href="https://mp.weixin.qq.com/s/eB8lE6376WuqgvR2a5lgVg" target="_blank" rel="noopener">十款 Windows 下必装软件，大大增强工作幸福</a></p><p><a href="https://mp.weixin.qq.com/s/MkzwQx1f6NT9OYxCkhOnVQ" target="_blank" rel="noopener">100 多个免费 API 接口分享，调用完全不限次数，以后总用得着</a></p><p><a href="https://mp.weixin.qq.com/s/SlScI7hYRESPT6CoXAGjsQ" target="_blank" rel="noopener">290家公司都在用的任务调度系统，还在Github上开源了</a></p><p><a href="https://mp.weixin.qq.com/s/FJQbX4CRq1pIH9kwHKBRLg" target="_blank" rel="noopener">60个Chrome神器插件大收集：助你快速成为老司机，一键分析网站技术栈</a></p><p><a href="https://mp.weixin.qq.com/s/N_DQ23tJeB7_v9pV25DxVA" target="_blank" rel="noopener">一个应届生拿字节跳动offer的努力</a></p><p><a href="https://mp.weixin.qq.com/s/Tta36pxSIGDvnW_Rb-FkQA" target="_blank" rel="noopener">吊打面试官之消息队列基础</a></p><p><a href="https://mp.weixin.qq.com/s/BJ9ZlVBFXq7qpDhaQfzg0w" target="_blank" rel="noopener">GitHub获3.2W星！史上最全技术面试手册！</a></p><p><a href="https://mp.weixin.qq.com/s/n_bJLrkqaz6aWSNDDfCPqQ" target="_blank" rel="noopener">接私活必备的 10 个开源项目！</a></p><p><a href="https://mp.weixin.qq.com/s/H6PGarCSbPiulcMHGCyBbw" target="_blank" rel="noopener">超50万行代码、GitHub 4200星：腾讯重磅发布全栈机器学习平台Angel 3.0</a></p><p><a href="https://mp.weixin.qq.com/s/kXgo0bTRrMp6gZ4soO28Ew" target="_blank" rel="noopener">GitHub 3W 星，冲击热榜！超实用技术面试手册，看这篇就够了</a></p><p><a href="https://mp.weixin.qq.com/s/HSqZ1PH7zSUKx-2r8FYZ6Q" target="_blank" rel="noopener">如何将Numpy加速700倍？用 CuPy 呀</a></p><p><a href="https://mp.weixin.qq.com/s/9Sow5Q_SCrXhfhcKVYy4Tw" target="_blank" rel="noopener">资料|中文开源书《深度学习》推荐分享</a></p><p><a href="https://mp.weixin.qq.com/s/RVSrqrTHcl-1n0rG9qzMng" target="_blank" rel="noopener">这8个Python 技巧让你的数据分析提升数倍！</a></p><p><a href="https://mp.weixin.qq.com/s/BRQM9lVTYActsMrlHAuG9A" target="_blank" rel="noopener">分享8个强大的黑客技术学习网站</a></p><p><a href="https://mp.weixin.qq.com/s/sbPEhsPWxELI3exYb7rcSg" target="_blank" rel="noopener">收藏！本、硕、博、程序员必备神器</a></p><p><a href="https://mp.weixin.qq.com/s/DMK3gwMKbpsfOrWMxjb5lg" target="_blank" rel="noopener">不到20行代码，用Python做一个智能聊天机器人</a></p><p><a href="https://mp.weixin.qq.com/s/5R3esbIUpjeh76wdxo4fCw" target="_blank" rel="noopener">程序员刷算法题必备神器！不用打开浏览器，就能刷LeetCode</a></p><p><a href="https://mp.weixin.qq.com/s/nS0ps0bHoJWCdIw2FQi6Ow" target="_blank" rel="noopener">如何用 Python 一键搞定 CET 4 最爱考的 5000 个单词？</a></p><p><a href="https://mp.weixin.qq.com/s/bkOPWDqLE-JpE6-1_dIdcQ" target="_blank" rel="noopener">60个相见恨晚的神器工具</a></p><p><a href="https://mp.weixin.qq.com/s/yIZa4rGQ2wVjx2UMff-C3A" target="_blank" rel="noopener">爱了爱了，这个 GitHub 的 Chrome 神仙插件把我整的服服帖帖的</a></p><p><a href="https://mp.weixin.qq.com/s/uzUKZNyejZA664X3dvLpFA" target="_blank" rel="noopener">这5种动态炫酷图，也是用Python画的</a></p><p><a href="https://mp.weixin.qq.com/s/sddkwxWoncBS1KQpk1okAA" target="_blank" rel="noopener">你有哪些deep learning调参经验？</a></p><p><a href="https://mp.weixin.qq.com/s/KmtGrp9dm8lQ5s33BQQHbg" target="_blank" rel="noopener">你是否很想下载这些不能下载的视频，只能傻傻地录屏</a></p><p><a href="https://mp.weixin.qq.com/s/-zeK1EgT3XRY3mgIdvv--w" target="_blank" rel="noopener">整理一份程序员常用的各类工具、技术站点</a></p><h3 id="NLP"><a href="#NLP" class="headerlink" title="NLP"></a>NLP</h3><p><a href="https://mp.weixin.qq.com/s/17u66oVrffUBg6bFjxrBkA" target="_blank" rel="noopener">NLP入门之路及学习方法：从任务实践入手！</a></p><p><a href="https://mp.weixin.qq.com/s/D1721uuwxVvSPTmKopI6cA" target="_blank" rel="noopener">一文读懂最强中文NLP预训练模型ERNIE</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzU3NDgxMzI0Mw==&mid=2247485275&amp;idx=1&amp;sn=58ee12ba88ef4562f183b60f5f565f1c&source=41#wechat_redirect" target="_blank" rel="noopener">最新中文NLP开源工具箱来了！支持6大任务，面向工业应用 | 资源</a></p><p><a href="https://mp.weixin.qq.com/s/sGmzWyhJYgOWsma3T8bBFg" target="_blank" rel="noopener">微软开源项目 NeuronBlocks：像搭积木一样构建 NLP 深度学习模型！</a></p><h3 id="区块链"><a href="#区块链" class="headerlink" title="区块链"></a>区块链</h3><p><a href="https://mp.weixin.qq.com/s/90fT-r8yOgW-HR3k1hCFsA" target="_blank" rel="noopener">怎么向女朋友解释什么叫区块链？</a></p><h3 id="量化投资"><a href="#量化投资" class="headerlink" title="量化投资"></a>量化投资</h3><p><a href="https://mp.weixin.qq.com/s/Q82YzANWDMkKWm5k2XmPkA" target="_blank" rel="noopener">严谨解决5种机器学习算法在预测股价的应用（代码+数据）</a></p><h3 id="网络安全"><a href="#网络安全" class="headerlink" title="网络安全"></a>网络安全</h3><p><a href="https://mp.weixin.qq.com/s/xDMPiBdIukbuP7ZA-ItElA" target="_blank" rel="noopener">这份黑客技术成长秘籍终于开源啦！32.7K星不是白给的！</a></p>]]></content>
      
      
      <categories>
          
          <category> 实用文章存储 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>前端优质文章</title>
      <link href="/2020/04/14/qian-duan-ji-zhu-gong-zhong-hao/"/>
      <url>/2020/04/14/qian-duan-ji-zhu-gong-zhong-hao/</url>
      
        <content type="html"><![CDATA[<p><a href="https://mp.weixin.qq.com/s/CKEn-luXhVFp-gQdL_XQyA" target="_blank" rel="noopener">深入理解 ESLint</a></p><p><a href="https://mp.weixin.qq.com/s/vWUO_JFSQbBjbK14wudkEA" target="_blank" rel="noopener">Vue3 的响应式和以前有什么区别，Proxy 无敌？</a></p><p><a href="https://mp.weixin.qq.com/s/MXlRPhoe_7k8TIahPUo5HQ" target="_blank" rel="noopener">鹅厂前端大佬对于前端学习路线的一些建议（内含自测题）</a></p><p><a href="https://mp.weixin.qq.com/s/T1ndPHGHmeImmin--v-law" target="_blank" rel="noopener">前端应该如何准备数据结构和算法？</a></p><p><a href="https://mp.weixin.qq.com/s/YMSAq14dYPjda0LyUyWjBg" target="_blank" rel="noopener">58 道 Vue 常见面试题集锦，涵盖入门到精通，自测 Vue 掌握程度</a></p><p><a href="https://mp.weixin.qq.com/s/Fyl3SMHjv3ROw9QUBdwutA" target="_blank" rel="noopener">【第1910期】如何设计实现 h5 页面搭建-数据模型</a></p><p><a href="https://mp.weixin.qq.com/s/ysj6NuxO7S_Cm67JPDZICg" target="_blank" rel="noopener">为什么 Vue 中不要用 index 作为 key</a></p><p><a href="https://mp.weixin.qq.com/s/-O26ySveonJEDqbOiPHTPg" target="_blank" rel="noopener">React 函数式组件性能优化指南</a></p><p><a href="https://mp.weixin.qq.com/s/cUvpvxSDa4vKBs_vQm6V6A" target="_blank" rel="noopener">彻底搞懂移动Web开发中的viewport与跨屏适配</a></p><p><a href="https://mp.weixin.qq.com/s/d8b90wcUltEKHq31ygKeIQ" target="_blank" rel="noopener">【适合收藏】让你减少加班的15条高效JS技巧！</a></p><p><a href="https://mp.weixin.qq.com/s/jAWC4HE-n2qFnNwOGEa-Kw" target="_blank" rel="noopener">【第1907期】前端性能优化实践 之 百度App个人主页优化</a></p><p><a href="https://mp.weixin.qq.com/s/jIk9aiHEl2Dw4DbaIdn77Q" target="_blank" rel="noopener">一文了解文件上传全过程（项目中碰到的难点）</a></p><p><a href="https://mp.weixin.qq.com/s/CsUvmRLYJpX1If9Tr0KXrg" target="_blank" rel="noopener">源码速读！一看就会、一写就废的 Promise 实现</a></p><p><a href="https://mp.weixin.qq.com/s/LYtYJUleLs5FOQqfO7rPkg" target="_blank" rel="noopener">写给初中级前端的高级进阶指南（JS、TS、Vue、React、性能、学习规划）</a></p><p><a href="https://mp.weixin.qq.com/s/CKaSQw0nLCXohrjstFoOBQ" target="_blank" rel="noopener">简单几步让你的 JS 写得更漂亮</a></p><p><a href="https://mp.weixin.qq.com/s/-INJOWoX2IhvG7ybHtr0LA" target="_blank" rel="noopener">一文带你全面梳理JS引擎的运行机制</a></p><p><a href="https://mp.weixin.qq.com/s/tJKlUwaVkfIkT6vYbtrO-A" target="_blank" rel="noopener">2 年前端面试心路历程（字节跳动、YY、虎牙、BIGO）</a></p><p><a href="https://mp.weixin.qq.com/s/n9zMvzZZRiXIwIrfCU-CHQ" target="_blank" rel="noopener">【第1903期】深入浅出动态化 SSR 服务（一）：开发工具篇</a></p><p><a href="https://mp.weixin.qq.com/s/g9J4o_2_gLgsEjBLN-ftuQ" target="_blank" rel="noopener">深圳腾讯前端面经分享</a></p><p><a href="https://mp.weixin.qq.com/s/cia8cOVLkYy5i_BLKJ3ehw" target="_blank" rel="noopener">【JS】 200行JS代码，带你实现代码编译器（人人都能学会）</a></p><p><a href="https://mp.weixin.qq.com/s/pfkAzmot9b0Y6EzEzZJ1rA" target="_blank" rel="noopener">从 React Native 到 Flutter，移动跨平台方案的真相</a></p><p><a href="https://mp.weixin.qq.com/s/cRoqPvKHhwrqfto5QH6sWg" target="_blank" rel="noopener">Vue中组件最常见通信的方式</a></p><p><a href="https://mp.weixin.qq.com/s/dl_6kCq2H_TNQSHkjUWGQQ" target="_blank" rel="noopener">5000字解析：前端五种跨平台技术</a></p><p><a href="https://mp.weixin.qq.com/s/ETDqdo3JIcUxbeIlddSq-Q" target="_blank" rel="noopener">你不知道的 Event Loop</a></p><p><a href="https://mp.weixin.qq.com/s/IXqA9-GccvlL5KghPhuASA" target="_blank" rel="noopener">支付宝-支付业务前端组 (核心部门)招聘前端</a></p><p><a href="https://mp.weixin.qq.com/s/fGhcSP-SXz3l0Jklrv1I2w" target="_blank" rel="noopener">「吐血整理」再来一打Webpack面试题</a></p><p><a href="https://mp.weixin.qq.com/s/L7R5rjWk7FRm86QJw20n-g" target="_blank" rel="noopener">Vue这些修饰符帮我节省20%的开发时间</a></p><p><a href="https://mp.weixin.qq.com/s/0p6HhRxrSfEgWrTzZsMncw" target="_blank" rel="noopener">组件演进史：从Mixin到HOC，再到Hook</a></p><p><a href="https://mp.weixin.qq.com/s/A3U3iVpoX4Zh5nVybKTcDg" target="_blank" rel="noopener">从零开始开发一款属于你的VS Code 插件</a></p><p><a href="https://mp.weixin.qq.com/s/5PAirlPygGILopm5Br7w9Q" target="_blank" rel="noopener">一文带你彻底搞懂跨域那些事</a></p><p><a href="https://mp.weixin.qq.com/s/AXp8MN14yCuYkIj0s2AJcA" target="_blank" rel="noopener">美团前端实习面经(大三)</a></p><p><a href="Promise/async/Generator实现原理解析">Promise/async/Generator实现原理解析</a></p><p><a href="https://mp.weixin.qq.com/s/5i8obLgnYHbxKW-JtOBOZg" target="_blank" rel="noopener">CSS实现背景图片右侧定位的5种小技巧</a></p><p><a href="https://mp.weixin.qq.com/s/cO9jbJ2BT1_k5ojxaUdljA" target="_blank" rel="noopener">深度解析！Vue3 &amp; React Hooks 新UI组件原理：Modal 弹窗</a></p><p><a href="https://mp.weixin.qq.com/s/_bdCLq3AHPoqJiHR1F7grA" target="_blank" rel="noopener">express新手入门指南</a></p><p><a href="https://mp.weixin.qq.com/s/1z2wJE9hm7HvQDGRT6R8nA" target="_blank" rel="noopener">关于前端学习路线的一些建议（含面试自测题）</a></p><p><a href="https://mp.weixin.qq.com/s/T8g8uSn6K_5gz2DiPBWk9Q" target="_blank" rel="noopener">【第1892期】GPU加速在前端的应用</a></p><p><a href="https://mp.weixin.qq.com/s/LEMlP-MiCUms4S-He1jMWA" target="_blank" rel="noopener">如何在面试中介绍自己的项目经验？</a></p><p><a href="https://mp.weixin.qq.com/s/xqp8mQhGcVEDOWEFGdswlw" target="_blank" rel="noopener">在阿里我是如何当面试官的</a></p><p><a href="https://mp.weixin.qq.com/s/zJjY76w8X8Mg8PVnbig_LA" target="_blank" rel="noopener">5分钟教你使用console.log发布公司的招聘信息</a></p><p><a href="https://mp.weixin.qq.com/s/_jfA25-daJUaY2uIcSeNDg" target="_blank" rel="noopener">从 JavaScript 发展历史中聊 ECMAScript(ES6-ES11) 新功能</a></p><p><a href="https://mp.weixin.qq.com/s/_t1NMydCSFppFnMwJo8N8w" target="_blank" rel="noopener">所以，V8 引擎到底是如何工作的？</a></p><p><a href="https://mp.weixin.qq.com/s/4DduBGLybMeiqTTl6aiUxA" target="_blank" rel="noopener">2020年需要学习的8个前端关键技能</a></p><p><a href="https://mp.weixin.qq.com/s/sbftgI3pfowea3gUc7L91Q" target="_blank" rel="noopener">前端面试题全面整理-带解析 涵盖CSS、JS、浏览器、Vue、React、移动web、前端性能、算法、Node</a></p><p><a href="https://mp.weixin.qq.com/s/h-8NvRoI1YgVdpe1wnJKLQ" target="_blank" rel="noopener">Vue知识点自检清单(下)</a></p><p><a href="https://mp.weixin.qq.com/s/eK845LJPEADuAydM-UHb7w" target="_blank" rel="noopener">JS 线程与异步的那些事</a></p><p><a href="https://mp.weixin.qq.com/s/zwLl826E1mSwVInnCAC4Yg" target="_blank" rel="noopener">万字总结，29个对象API实战，千万别错过！</a></p><p><a href="https://mp.weixin.qq.com/s/wRObNhhDH57cYAHpclxBKQ" target="_blank" rel="noopener">Vue常见的考点(下)</a></p><p><a href="https://mp.weixin.qq.com/s/pjKzhSi0oamqzVFGd-d7dg" target="_blank" rel="noopener">「面试题」20+Vue面试题整理</a></p><p><a href="https://mp.weixin.qq.com/s/JP7vP9VF8k2IytgqSRFT2w" target="_blank" rel="noopener">什么时候使用 useMemo 和 useCallback</a></p><p><a href="https://mp.weixin.qq.com/s/5C-F3s1hvwPQCpWLlbTQBQ" target="_blank" rel="noopener">一文吃透所有JS原型相关知识点</a></p><p><a href="https://mp.weixin.qq.com/s/HUbWsxL3boxFY0u2JYaYXg" target="_blank" rel="noopener">用好 Git 和 SVN，轻松驾驭版本管理</a></p><p><a href="https://mp.weixin.qq.com/s/t6oGCZ_DEfIlykQD-wCjUg" target="_blank" rel="noopener">看完这篇，你也能把 React Hooks 玩出花</a></p><p><a href="https://mp.weixin.qq.com/s/XcUDjrnaFc-P_WQsNczHwA" target="_blank" rel="noopener">Vue知识点自检清单(上)</a></p><p><a href="https://mp.weixin.qq.com/s/UXPeJtx-mIvCPjJW3__c6g" target="_blank" rel="noopener">手把手教你搞定权限管理，结合Vue实现菜单的动态权限控制！</a></p><p><a href="https://mp.weixin.qq.com/s/57kJ0U3eOc3Ipy_TEw3uUg" target="_blank" rel="noopener">字节跳动 前端校招 一二三面+hr面</a></p><p><a href="https://mp.weixin.qq.com/s/LiN7tJ6RSUYg1JZWd_xaCQ" target="_blank" rel="noopener">一口气刷完45道promise面试题</a></p><p><a href="https://mp.weixin.qq.com/s/CWA5doIFe41UEOedvR1fxQ" target="_blank" rel="noopener">2020年，vue面试遇到的问题（上）</a></p><p><a href="https://mp.weixin.qq.com/s/ErvhfGUZLoBEZFsiH7JB4w" target="_blank" rel="noopener">教你一步步封装 Vue 组件并发布到 npm</a></p><p><a href="https://mp.weixin.qq.com/s/mcQvAXpMF9rNNxwHXHJwWw" target="_blank" rel="noopener">十几家大厂前端实习面经总结</a></p><p><a href="https://mp.weixin.qq.com/s/Nv-XWwMwNmdD7UI4PHPDvw" target="_blank" rel="noopener">Server-X：一款可能提升你十倍工作效率的工具</a></p><p><a href="https://mp.weixin.qq.com/s/6x0_T0eqVN21gXZj2zLL8g" target="_blank" rel="noopener">小程序运行机制</a></p><p><a href="https://mp.weixin.qq.com/s/xCt3kisgD-QNzd4EfjgIFg" target="_blank" rel="noopener">你想逆向我的 js 代码？呵呵，先过了我的反 debug 再说吧！</a></p><p><a href="https://mp.weixin.qq.com/s/YYQmQR8jTsbqUtLvAONIEQ" target="_blank" rel="noopener">愿未来没有 Webpack</a></p><p><a href="https://mp.weixin.qq.com/s/7aBUgDPTUg47N4-JNmGZSA" target="_blank" rel="noopener">缓存有那么多种，分别是干什么的？</a></p><p><a href="https://mp.weixin.qq.com/s/zU1Y9VJKD49U1lLOjtG-GA" target="_blank" rel="noopener">超50万行代码、GitHub 4200星：腾讯重磅发布全栈机器学习平台Angel 3.0</a></p><p><a href="https://mp.weixin.qq.com/s/P7XR1X6QH4ojFcksQO3rrw" target="_blank" rel="noopener">2019 Vue开发指南：你都需要学点啥？</a></p><p><a href="https://mp.weixin.qq.com/s/sgzGT7HDSx4wNbgjCzMXsg" target="_blank" rel="noopener">vue组件间通信六种方式（完整版）</a></p><p><a href="https://mp.weixin.qq.com/s/b5hov_EaznrtGHtwWQyb1A" target="_blank" rel="noopener">【第1626期】JavaScript 究竟是如何工作的？（第一部分）</a></p><p><a href="https://mp.weixin.qq.com/s/ow6CryxVrkeU79GD857d1w" target="_blank" rel="noopener">彻底理解cookie、session、token</a></p><p><a href="https://mp.weixin.qq.com/s/4rPt7T59ifVTxg4dxCF50w" target="_blank" rel="noopener">【第1575期】JavaScript中的算法</a></p><p><a href="https://mp.weixin.qq.com/s/hlwe0Z9Bhwyz2srHGJGigA" target="_blank" rel="noopener">Redux/react-redux/redux中间件设计实现剖析</a></p><p><a href="https://mp.weixin.qq.com/s/-ihRxVHLhqXgOpdTZ8XELQ" target="_blank" rel="noopener">抄笔记：尤雨溪在Vue3.0 Beta直播里聊到了这些…</a></p><p><a href="https://mp.weixin.qq.com/s/wiAA2xlDc4pxnBOHTi-qMg" target="_blank" rel="noopener">Vue源码探秘（十三）（组件注册）</a></p><p><a href="https://mp.weixin.qq.com/s/h6rKfXINQKB0499ZK5beTQ" target="_blank" rel="noopener">【第1922期】从vue-router看前端路由的两种实现</a></p><p><a href="https://mp.weixin.qq.com/s/XLhWEZJ5LF5zkf9JrlPXbQ" target="_blank" rel="noopener">Webpack 新功能 Module Federation 深入解析</a></p><p><a href="https://mp.weixin.qq.com/s/askQxPHeKA-yyNAbwYYTvQ" target="_blank" rel="noopener">大白话理解Vuex</a></p><p><a href="https://mp.weixin.qq.com/s/RoUbsz2OrOCtbYMxVmDjcw" target="_blank" rel="noopener">WebSocket 原理浅析与实现简单聊天</a></p><p><a href="https://mp.weixin.qq.com/s/er5-zl3FKMAyvhx6xui7jQ" target="_blank" rel="noopener">从浏览器缓存淘汰策略和Vue的keep-alive学习LRU算法</a></p><p><a href="https://mp.weixin.qq.com/s/V2yd7orPXVnkrzBCl6_-PQ" target="_blank" rel="noopener">从若干个方向谈一谈前端面试需要准备哪些东西</a></p><p><a href="https://mp.weixin.qq.com/s/2KEqsnW0QWU4bqMI5q_BLg" target="_blank" rel="noopener">前端高级进阶：2020怎样才能更值钱？</a></p><p><a href="https://mp.weixin.qq.com/s/vViJnwy2NlCs99cBObbidg" target="_blank" rel="noopener">花椒前端基于 GitLab CI/CD 的自动化构建、发布实践</a></p><p><a href="https://mp.weixin.qq.com/s/xJJBzpJ94A_Tmo9L7wqstQ" target="_blank" rel="noopener">Chrome Devtools 高级调试指南，让你的开发速度加倍</a></p><p><a href="https://mp.weixin.qq.com/s/6GIuwqE_ZZmCSvL3RQA6JQ" target="_blank" rel="noopener">前端tree组件，10000个树节点，从14.65s到0.49s</a></p><p><a href="https://mp.weixin.qq.com/s/PNGEUDjyachJAW4Zw0xY9w" target="_blank" rel="noopener">12个Vue.js开发技巧和窍门</a></p><p><a href="https://mp.weixin.qq.com/s/d-v7QgmP9aGnQr2nbpfzjQ" target="_blank" rel="noopener">【第1920期】如何监控网页的卡顿？</a></p><p><a href="https://mp.weixin.qq.com/s/f200Q62XL50d0a_DgI6UlA" target="_blank" rel="noopener">webpack的几个常见loader源码浅析，以及动手实现一个md2html-loader</a></p><p><a href="https://mp.weixin.qq.com/s/JOxouBFMwGnJCJ1mWYcGBQ" target="_blank" rel="noopener">从0到1，带你尝鲜Vue3.0</a></p><p><a href="https://mp.weixin.qq.com/s/unB-5HA_RUlV5X_wXiUyvA" target="_blank" rel="noopener">前端新技术</a></p><p><a href="https://mp.weixin.qq.com/s/ykyqb2clrYsWkCvR4k3KYA" target="_blank" rel="noopener">前端高级进阶：使用 docker 高效部署你的前端应用</a></p><p><a href="https://mp.weixin.qq.com/s/P5jtT9tj_iqgWrLR_BF6Ww" target="_blank" rel="noopener">Web前端性能优化原理问题</a></p><p><a href="https://mp.weixin.qq.com/s/WbtLO0ji-i9q3JLdkxQ2DQ" target="_blank" rel="noopener">如何处理浏览器的断网情况？</a></p><p><a href="https://mp.weixin.qq.com/s/r1RjqjfQAIRjCTat1MMUCQ" target="_blank" rel="noopener">Vue源码探秘（十二）（生命周期）</a></p><p><a href="https://mp.weixin.qq.com/s/GZ9WooPVtJZSFABo9tfVRw" target="_blank" rel="noopener">一篇搞定移动端适配</a></p><p><a href="https://mp.weixin.qq.com/s/5qwgZ9aNKFC3naWRUGajmA" target="_blank" rel="noopener">【第1917期】微前端在小米 CRM 系统的实践</a></p><p><a href="https://mp.weixin.qq.com/s/ZSGCQlWPcMzp-o3QOUjdyw" target="_blank" rel="noopener">Web前端性能优化原理问题</a></p><p><a href="https://mp.weixin.qq.com/s/NHodHtsQPMTYpGyaQNxGrw" target="_blank" rel="noopener">JavaScript 诞生的这 20 年来，都发生了什么…</a></p><p><a href="https://mp.weixin.qq.com/s/eHz8wEo7wOQtST5bqlqrqg" target="_blank" rel="noopener">非科班二本厂面试的心路历程和总结（腾讯、头条、阿里、京东）丨 掘金技术征文</a></p><p><a href="https://mp.weixin.qq.com/s/s-hSZkbHjvXZCBzVlj_PUw" target="_blank" rel="noopener">花椒前端基于 Docker 的 SSR 持续开发集成环境实践</a></p><p><a href="https://mp.weixin.qq.com/s/E8MXKfNPn3nkVjGGXNESAA" target="_blank" rel="noopener">H5 直播的疯狂点赞动画是如何实现的？</a></p><p><a href="https://mp.weixin.qq.com/s/Q-VrgN9QhNqZDaRsZ8MENA" target="_blank" rel="noopener">移动端1px问题的几种常见解决方案</a></p><p><a href="https://mp.weixin.qq.com/s/xD2xK8WJ4YIuJOk-kOE2jA" target="_blank" rel="noopener">Vue 的计算属性如何实现缓存？（原理深入揭秘）</a></p><p><a href="https://mp.weixin.qq.com/s/9628_tvhXKkLHYuAQUw1AQ" target="_blank" rel="noopener">花椒前端基于 Docker 的 SSR 持续开发集成环境实践</a></p>]]></content>
      
      
      <categories>
          
          <category> 实用文章存储 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>程序员基础知识优质文章</title>
      <link href="/2020/04/14/cheng-xu-yuan-ji-chu-zhi-shi/"/>
      <url>/2020/04/14/cheng-xu-yuan-ji-chu-zhi-shi/</url>
      
        <content type="html"><![CDATA[<p><a href="https://mp.weixin.qq.com/s/lMCT0QIOqUSuNPw8ftxjYw" target="_blank" rel="noopener">一文看懂：网址，URL，域名，IP地址，DNS，域名解析</a></p><p><a href="https://mp.weixin.qq.com/s/cBiIEw5UXaXOgs9BydXjEQ" target="_blank" rel="noopener">今天就盘计算机网络，跟帅地快速过一遍计算机网络！</a></p><p><a href="https://mp.weixin.qq.com/s/fQzwC_iA0gI8EgmfI-BLpg" target="_blank" rel="noopener">硬核，一文带你彻底理解文件系统</a></p><p><a href="https://mp.weixin.qq.com/s/FyeCch2gMZTcklJBhQjk4A" target="_blank" rel="noopener">HTTPS 的 7 次握手以及 9 倍时延</a></p><p><a href="https://mp.weixin.qq.com/s/w0J2E0uFOnfcUiwpG2-k_Q" target="_blank" rel="noopener">网络常见的 9 大命令，非常实用！</a></p><p><a href="https://mp.weixin.qq.com/s/Bg2fxcxwWai9LaRtwIM2aA" target="_blank" rel="noopener">3-17 牛逼！知道这100 个网6基础知识，成了半个网络高手！</a></p><p><a href="https://mp.weixin.qq.com/s/y46F6IDpKr7ZwHnpYVj1lA" target="_blank" rel="noopener">面试官：浏览器输入URL后发生了什么？</a></p><p><a href="https://mp.weixin.qq.com/s/lOLX_VZhwhBENnchEoLu_A" target="_blank" rel="noopener">【第1885期】基于 React 的可视化编辑平台实践</a></p><p><a href="https://mp.weixin.qq.com/s/dYzhhou5SvVMBCYxa6gULg" target="_blank" rel="noopener">写给大忙人看的操作系统</a></p><p><a href="https://mp.weixin.qq.com/s/YEmGCcp5YTZKJYu8N_gljg" target="_blank" rel="noopener">（附思维导图下载）100 个网络基础知识普及，看完成半个网络高手！</a></p><p><a href="https://mp.weixin.qq.com/s/IdKWxaNkcYireskUsluaXg" target="_blank" rel="noopener">在浏览器输入 URL 回车之后发生了什么？（超详细版）</a></p><p><a href="https://mp.weixin.qq.com/s/WWMxg2SG3jyFqU83Mzgo2w" target="_blank" rel="noopener">如何给女朋友解释为什么12306会用户信息泄露</a></p><p><a href="https://mp.weixin.qq.com/s/RROMAguSYfS9TmT0fxhlgQ" target="_blank" rel="noopener">面试官问了一下三次握手，我甩出这张脑图，他服了！</a></p><p><a href="https://mp.weixin.qq.com/s/NeNuS5ZCca8IDbhNrQZmEA" target="_blank" rel="noopener">一文看懂：网址，URL，域名，IP地址，DNS，域名解析</a></p><p><a href="https://mp.weixin.qq.com/s/DeERrIodO2WUT5ZevOQ3bA" target="_blank" rel="noopener">看完这篇 Session、Cookie、Token，和面试官扯皮就没问题了</a></p><p><a href="https://mp.weixin.qq.com/s/07zloKKMUl-RHN6tWqZIJQ" target="_blank" rel="noopener">探究：一个数据包在网络中到底是怎么游走的？</a></p><p><a href="https://mp.weixin.qq.com/s/0yT4XVmkKGdl_Y2tU9VbUQ" target="_blank" rel="noopener">一文看懂：网址，URL，域名，IP地址，DNS，域名解析</a></p><p><a href="https://mp.weixin.qq.com/s/sjdjVVu6S2LxPsgFxp-sPg" target="_blank" rel="noopener">漫话：如何给女朋友解释什么是撞库、脱库和洗库？</a></p>]]></content>
      
      
      <categories>
          
          <category> 实用文章存储 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 程序员基本知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>axios的封装</title>
      <link href="/2020/03/21/axios-de-feng-zhuang/"/>
      <url>/2020/03/21/axios-de-feng-zhuang/</url>
      
        <content type="html"><![CDATA[<h2 id="axios的封装"><a href="#axios的封装" class="headerlink" title="axios的封装"></a>axios的封装</h2><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">5000</span>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:8000/'</span><span class="token comment" spellcheck="true">// axios.defaults.headers['Content-Type'] = 'application/json'</span><span class="token comment" spellcheck="true">// axios.defaults.headers['Authorization'] = 'JWT '+localStorage.getItem('token')</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token function">fetchGet</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">fetchPost</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">fetchDelete</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      axios<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">fetchPut</span><span class="token punctuation">(</span>url <span class="token punctuation">,</span>params<span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>url <span class="token punctuation">,</span> params <span class="token punctuation">,</span> data<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>以上代码是axios的增删改查，已经封装好了可以直接调用</p><h2 id="调用示例"><a href="#调用示例" class="headerlink" title="调用示例"></a>调用示例</h2><p>index.js是我调用方法的文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200321154729.png" alt=""></p><h3 id="get方法："><a href="#get方法：" class="headerlink" title="get方法："></a>get方法：</h3><h4 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> banner <span class="token operator">=</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">fetchGet</span><span class="token punctuation">(</span><span class="token string">'banner/'</span><span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h4 id="不带请求头的使用方法"><a href="#不带请求头的使用方法" class="headerlink" title="不带请求头的使用方法:"></a>不带请求头的使用方法:</h4><pre class=" language-js"><code class="language-js">    <span class="token function">banner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// console.log(res)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>banner_list <span class="token operator">=</span> res    <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h4 id="带请求头的get方法"><a href="#带请求头的get方法" class="headerlink" title="带请求头的get方法"></a>带请求头的get方法</h4><pre class=" language-js"><code class="language-js"><span class="token function">userInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>        Authorization<span class="token punctuation">:</span> <span class="token string">'JWT '</span> <span class="token operator">+</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="Post方法："><a href="#Post方法：" class="headerlink" title="Post方法："></a>Post方法：</h3><h4 id="调用方法-1"><a href="#调用方法-1" class="headerlink" title="调用方法"></a>调用方法</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> useraddress <span class="token operator">=</span> <span class="token punctuation">(</span>params<span class="token punctuation">,</span>config<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">fetchPost</span><span class="token punctuation">(</span><span class="token string">'address/'</span><span class="token punctuation">,</span>params<span class="token punctuation">,</span>config<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h4 id="不带请求头的写法："><a href="#不带请求头的写法：" class="headerlink" title="不带请求头的写法："></a>不带请求头的写法：</h4><pre class=" language-js"><code class="language-js"><span class="token function">useraddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h4 id="带请求头的使用方法"><a href="#带请求头的使用方法" class="headerlink" title="带请求头的使用方法:"></a>带请求头的使用方法:</h4><pre class=" language-js"><code class="language-js"><span class="token function">useraddress</span><span class="token punctuation">(</span><span class="token punctuation">{</span>你的data数据<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>Authorization<span class="token punctuation">:</span> <span class="token string">'JWT '</span> <span class="token operator">+</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>其余的PUT和Delete方法都是一样的</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue配置移动端和PC端</title>
      <link href="/2020/02/04/vue-pei-zhi-yi-dong-duan-he-pc-duan/"/>
      <url>/2020/02/04/vue-pei-zhi-yi-dong-duan-he-pc-duan/</url>
      
        <content type="html"><![CDATA[<h2 id="Vue分辨移动端还是PC端"><a href="#Vue分辨移动端还是PC端" class="headerlink" title="Vue分辨移动端还是PC端"></a>Vue分辨移动端还是PC端</h2><h3 id="首先在App-vue配置判断请求头"><a href="#首先在App-vue配置判断请求头" class="headerlink" title="首先在App.vue配置判断请求头"></a>首先在<strong>App.vue</strong>配置判断请求头</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200321190919.png" alt=""></p><h3 id="在路由文件route-js上配置好PC和Mobile的路由"><a href="#在路由文件route-js上配置好PC和Mobile的路由" class="headerlink" title="在路由文件route.js上配置好PC和Mobile的路由"></a>在路由文件route.js上配置好PC和Mobile的路由</h3><p><strong>router.js</strong></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200321191013.png" alt=""></p><p>这里拿移动端的来示例</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200321190123.png" alt=""></p><h3 id="配置视图文件"><a href="#配置视图文件" class="headerlink" title="配置视图文件"></a>配置视图文件</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200321190156.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql配置</title>
      <link href="/2020/01/12/mysql/"/>
      <url>/2020/01/12/mysql/</url>
      
        <content type="html"><![CDATA[<h2 id="linux服务器重置mysql命令："><a href="#linux服务器重置mysql命令：" class="headerlink" title="linux服务器重置mysql命令："></a>linux服务器重置mysql命令：</h2><ol><li><p>查看mysql运行状态</p><pre><code>ps -ef | grep -i mysql</code></pre></li><li><p>vi /etc/my.cnf</p></li></ol><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200110172922.png" alt=""></p><p>在这个地方添加</p><pre><code>skip-grant-tables</code></pre><ol start="3"><li>重启mysql服务器</li></ol><pre><code>systemctl restart mysqld.service</code></pre><ol start="4"><li>执行mysql进去服务器</li></ol><pre><code>mysql</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200110173028.png" alt=""></p><ol start="5"><li>重置密码</li></ol><pre><code>update mysql.user set authentication_string=password(&#39;root_password&#39;) where user=&#39;root&#39;;</code></pre><p>root_password替换成你想要的密码</p><ol start="6"><li>vi /etc/my.cnf删除掉刚刚的那一行skip-grant-tables代码</li><li>重启mysql服务器</li></ol><pre><code>systemctl restart mysqld.service</code></pre><h2 id="mysql开启远程连接"><a href="#mysql开启远程连接" class="headerlink" title="mysql开启远程连接"></a>mysql开启远程连接</h2><ol><li>进入到服务器</li></ol><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200110173028.png" alt=""></p><ol start="2"><li>执行命令</li></ol><pre><code>GRANT ALL PRIVILEGES ON *.* TO &#39;username&#39;@&#39;%&#39; IDENTIFIED BY &#39;password&#39; WITH GRANT OPTION;</code></pre><p>username为用户名，password是密码（密码要特殊字符）</p><ol start="3"><li>执行命令</li></ol><pre><code>FLUSH PRIVILEGES;</code></pre><p>就可以开启远程服务了</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>linux服务器安装node环境</title>
      <link href="/2020/01/12/linux-fu-wu-qi-an-zhuang-node/"/>
      <url>/2020/01/12/linux-fu-wu-qi-an-zhuang-node/</url>
      
        <content type="html"><![CDATA[<h3 id="centos7安装node环境"><a href="#centos7安装node环境" class="headerlink" title="centos7安装node环境"></a>centos7安装node环境</h3><ol><li><p>下载源码安装包</p><pre class=" language-shell"><code class="language-shell">   wget https://nodejs.org/dist/v10.13.0/node-v10.13.0-linux-x64.tar.xz</code></pre></li><li><p>解压文件夹</p><pre class=" language-shell"><code class="language-shell"> tar -xvf node-v10.13.0-linux-x64.tar.xz</code></pre></li><li><p>移动文件夹目录</p><pre class=" language-shell"><code class="language-shell"> mv node-v10.13.0-linux-x64 /usr/local/nodejs</code></pre></li><li><p>设置环境变量</p><pre class=" language-shell"><code class="language-shell">vim /etc/profile</code></pre></li></ol><p>   在最后面添加这两行代码</p><pre class=" language-shell"><code class="language-shell">   export NODE_HOME=/usr/local/nodejs   export PATH=$NODE_HOME/bin:$PATH</code></pre><ol start="5"><li><p><code>:wq</code>保存后<code>source /etc/profile</code></p></li><li><p>配置成功，最后添加个cnpm </p><pre class=" language-shell"><code class="language-shell"> npm install -g cnpm --registry=https://registry.npm.taobao.org</code></pre></li></ol>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>redis开启远程连接</title>
      <link href="/2020/01/12/redis-pei-zhi/"/>
      <url>/2020/01/12/redis-pei-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="redis配置远程连接"><a href="#redis配置远程连接" class="headerlink" title="redis配置远程连接"></a>redis配置远程连接</h2><ol><li><p>安装好redis后，进入安装目录</p><pre><code>vim redis.conf</code></pre></li></ol><ol start="2"><li><p>注释掉bind 127.0.0.1</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200110174709.png" alt=""></p><p>然后把这个改成yes</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200110174647.png" alt=""></p><p>把protected-mode 改成no</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200110174744.png" alt=""></p><p>通过文件的位置去重启</p><pre><code>redis-server  /root/redis-4.0.6/redis.conf</code></pre><p>​    然后就看看能不能用密码进去</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200110175424.png" alt=""></p><p>​    如果成功后就可以在windows上进行远程连接了</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>axios</title>
      <link href="/2020/01/04/axios/"/>
      <url>/2020/01/04/axios/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h2><p>axios这个方法十分的简单，都是如如下形式</p><pre class=" language-javascript"><code class="language-javascript"><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>  method<span class="token punctuation">:</span><span class="token string">'get'</span><span class="token punctuation">,</span>  params<span class="token punctuation">:</span><span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>axios默认是get请求，params是get请求附带的参数，如果是post请求的话参数就放在data里面</p><h2 id="axios-all"><a href="#axios-all" class="headerlink" title="axios.all"></a>axios.all</h2><p>这个是如果要两个或者以上的请求都完成后再进行下一步</p><pre class=" language-js"><code class="language-js">axios<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h2 id="axios-spread"><a href="#axios-spread" class="headerlink" title="axios.spread"></a>axios.spread</h2><p>spread是对结果的延展</p><p>这里写一个案例</p><pre class=" language-js"><code class="language-js">axios<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'http://101.200.180.194:8000/goods/'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'http://101.200.180.194:8000/category/'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>如果是如上的写法的话，得到的结果是</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104170932.png" alt=""></p><p>spread的功能就是</p><pre class=" language-js"><code class="language-js">axios<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'http://101.200.180.194:8000/goods/'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'http://101.200.180.194:8000/category/'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">spread</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res1<span class="token punctuation">,</span>res2<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104171348.png" alt=""></p><h2 id="axios全局配置"><a href="#axios全局配置" class="headerlink" title="axios全局配置"></a>axios全局配置</h2><p>比如axios在配置的时候有很多是重复的，比如超时时间、请求头、地址的重复字段如http:127.0.0.1等</p><p>如果都重复写很臃肿，所以可以用default属性</p><pre class=" language-js"><code class="language-js">axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL<span class="token operator">=</span><span class="token string">'http://101.200.180.194:8000/'</span>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>timeout<span class="token operator">=</span><span class="token number">5000</span>axios<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'goods'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'category'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">spread</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res1<span class="token punctuation">,</span>res2<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>这样还是可以请求到结果的</p><h2 id="axios的实例"><a href="#axios的实例" class="headerlink" title="axios的实例"></a>axios的实例</h2><p>这个还是上面的那个全局配置问题，如果项目里面有两个或者以上的不同配置，比如请求头的地址不一样，那么如果不用全局配置写法的话，那么就会很多重复，如果用了全局配置的话，那么剩下的不同配置的文件就会报错</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> instance1 <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  baseURL<span class="token punctuation">:</span><span class="token string">'http://101.200.180.194:8000/'</span><span class="token punctuation">,</span>  timeout<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">instance1</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'goods'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">instance1</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'category'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">const</span> instance2 <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  baseURL<span class="token punctuation">:</span><span class="token string">'http://127.0.0.1/'</span><span class="token punctuation">,</span>  timeout<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token function">instance2</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'person'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这样就可以有两个不同的配置了</p><h2 id="axios的封装"><a href="#axios的封装" class="headerlink" title="axios的封装"></a>axios的封装</h2><p>axios如果是要使用的话要封装在一个包里面，如果使用的是如下的写法的话，那么如果axios不更新了或者是出现了什么大的bug，那么就要一个文件一个文件的修改</p><h3 id="方法1："><a href="#方法1：" class="headerlink" title="方法1："></a>方法1：</h3><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104173614.png" style="zoom:67%;" /><p>如上的写法是可以，而且很常见，比如在uniapp里面的写法什么的…….</p><p>这些请求最好还是封装在一个包里面去调用，如果需要修改了，那么就可以只修改一个地方，就可以修改全局了</p><p>通常用的都是如下的写法：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104174417.png" alt=""></p><p>然后在组件中调用就是</p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>request<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./API"</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'goods'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>err<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="方法2："><a href="#方法2：" class="headerlink" title="方法2："></a>方法2：</h3><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104174828.png" style="zoom:67%;" /><p>组件内的方法：</p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>request<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./API"</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  baseConfig<span class="token punctuation">:</span><span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">failure</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="方法3："><a href="#方法3：" class="headerlink" title="方法3："></a>方法3：</h3><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104175237.png" style="zoom:67%;" /><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>request<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./API"</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'goods'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>因为axios本身就是由promise构造的</p><h3 id="最终写法："><a href="#最终写法：" class="headerlink" title="最终写法："></a>最终写法：</h3><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104175721.png" style="zoom:67%;" /><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>request<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./API"</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span><span class="token string">'goods'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>因为在axios里面的<code>.then</code>、<code>.catch</code>都是多余的，instance的返回值本身就是promise</p><h2 id="axios拦截器"><a href="#axios拦截器" class="headerlink" title="axios拦截器"></a>axios拦截器</h2><p>拦截器有<strong>在请求之前进行拦截、请求之后进行拦截、响应成功之前拦截、响应之后拦截</strong>这四种方法</p><p>请求前拦截和请求后拦截：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104181544.png" style="zoom:67%;" /><p>响应前拦截和响应后拦截：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104181630.png" style="zoom:67%;" /><p>这个用于比如只需要返回res.data的值，就可以在响应前拦截中返回需要的值即可</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vuex</title>
      <link href="/2020/01/01/vuex/"/>
      <url>/2020/01/01/vuex/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="Vuex是什么"><a href="#Vuex是什么" class="headerlink" title="Vuex是什么"></a>Vuex是什么</h2><p><code>Vuex</code>在很多网站讲解都是状态管理工具，这个说白了其实就是如果有很多个组件需要传递变量，可以通过<code>Vuex</code>来存储这些变量，<strong>也就是说Vuex就是存储全局变量的地方</strong></p><p>如果两个组件之间变量状态传递，那么可以通过<code>props</code>传递，如果是有很多个组件或者组件之间没有联系的话，通过<code>props</code>传递就会很麻烦</p><p>这个一般是创建一个文件夹，里面创建一个<code>js</code>文件去填写配置</p><p>如图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200101224536.png" alt=""></p><p>然后在编写文件之后要去<strong>main.js</strong>挂载才能正常使用</p><p>顺带一提，在<strong>main.js</strong>挂载其实本质就是在<strong>main.js</strong>执行</p><pre><code>Vue.prototype.$store = store</code></pre><h2 id="Vue的单一状态树"><a href="#Vue的单一状态树" class="headerlink" title="Vue的单一状态树"></a>Vue的单一状态树</h2><p>Vue单一状态树其实就是个单一数据源，通俗的讲就是所有数据都只有一个数据源提交。</p><p>如果拿生活中的例子就是，按照以前的公积金政策，每个档案的信息都是分布的，个人档案分到个人档案管理中心，社保分在社保局。但是如果要换个城市入户的话，就要在哪个城市每个地方都提交一份档案，最后再去一个地方提交所有信息，如果有一个部门的信息错误就要回去重新提交一份，原本的方法显得十分的低效。如果换成代码的话，那么就是如果状态信息都保存到多个Store对象中，那么之后的维护和管理都是十分的困难的。</p><p>这也就是我们国家正在完善公积金系统，无论是有多少个城市的公积金，都可以在一个城市里面办理，放在state里面也就是说，无论是有多少个仓库信息，都只调用一个state。无论多少个方法属性都只在一个store存放</p><p>也就是说无论有多少个数据，都只建议创建一个store</p><h2 id="Vuex的结构"><a href="#Vuex的结构" class="headerlink" title="Vuex的结构"></a>Vuex的结构</h2><p>一般的话默认是有如下结构的</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200101231128.png" style="zoom:67%;" /><h3 id="state"><a href="#state" class="headerlink" title="state"></a>state</h3><p>这个就是存储全局变量的地方了</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200101231403.png" style="zoom:67%;" /><p>如果在这里定义变量的话，那么如果要调用它的话，那么就要使用到<code>$store.state.变量</code></p><p>调用方法如图所示：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200101232112.png" style="zoom:67%;" /><h3 id="mutations"><a href="#mutations" class="headerlink" title="mutations"></a>mutations</h3><p>这个其实就相当于vue里面的methods方法</p><h4 id="使用-store-state-counter改变值（错误写法）"><a href="#使用-store-state-counter改变值（错误写法）" class="headerlink" title="使用$store.state.counter改变值（错误写法）"></a>使用$store.state.counter改变值（错误写法）</h4><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200101232500.png" alt="官方给出的图" style="zoom:67%;" /><p>这个<code>devtools</code>是官方推出的插件，<strong>只要使用如上图的流程</strong>，使用这个插件可以跟踪到属性的更改</p><p>比如一个案例：要使用<code>vuex</code>的属性去在页面显示加减法，如果使用如下方法的话，那么达到目的是肯定可以的</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200101233545.png" style="zoom:67%;" /><p><code>vuex</code>的变量也可以跟着去修改</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200101233519.png" style="zoom:67%;" /><p>这个方法其实就是<code>state</code>和<code>Vue Components</code>之间互相改变，虽然是可以达到目的，但是这样就无法使用<code>devtools</code>工具去监听数据的改变了</p><p>所以这个时候要使用<code>mutations</code>去改变<code>vuex</code>属性的值</p><h4 id="使用mutations去改变值（正确写法）"><a href="#使用mutations去改变值（正确写法）" class="headerlink" title="使用mutations去改变值（正确写法）"></a>使用mutations去改变值（正确写法）</h4><p>先在Vuex里面定义方法</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200101234657.png" style="zoom:67%;" /><p>然后在组件的使用方法如图</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200101235100.png" style="zoom:67%;" /><p>在组件内使用要使用到<code>this.$store.commit</code>去调用vuex的方法</p><p>此时在<strong>devtools</strong>工具也能监听到属性的改变了</p><h4 id="mutations传入一个参数"><a href="#mutations传入一个参数" class="headerlink" title="mutations传入一个参数"></a>mutations传入一个参数</h4><p>这里拿个案例来说明，这里需要在组件里面传入值的话，那么就可以在mutations里面添加一个形参</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102231831.png" style="zoom:67%;" /><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102232128.png" style="zoom:67%;" /><p>在组件内使用mutations方法的话跟emit方法一样的</p><h4 id="mutations传入多个参数"><a href="#mutations传入多个参数" class="headerlink" title="mutations传入多个参数"></a>mutations传入多个参数</h4><p>传入对象的话方法还是一样的</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102232705.png" style="zoom:67%;" /><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102232735.png" style="zoom:67%;" /><p>在组件的methods传入的值有个专属的名词叫<strong>payload：负载</strong></p><h4 id="mutations的另外一种提交风格"><a href="#mutations的另外一种提交风格" class="headerlink" title="mutations的另外一种提交风格"></a>mutations的另外一种提交风格</h4><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102233351.png" style="zoom:67%;" /><p>但是这种方法传递到vuex的值就不一样了，就不仅仅是一个数字了，而是一个对象，因为这个时候传入过去的就是一个payload对象了</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102233533.png" style="zoom:67%;" /><h4 id="mutations响应规则"><a href="#mutations响应规则" class="headerlink" title="mutations响应规则"></a>mutations响应规则</h4><p>Vuex里面所有的state方法都是响应式的，只要state的数据发生了改变，那么Vue组件就会自动更新</p><p>但是做到响应式有两个前提：</p><ul><li>在store里面定义好所需要的属性</li><li>在state中对象添加属性的时候，使用如下的方式<ul><li>方法1：使用Vue.set(obj,’newProp’,123)</li><li>方法2：用新的对象给旧对象重新赋值</li></ul></li></ul><p>这里拿个案例来说明</p><p>先定义一个新属性</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102234336.png" style="zoom:67%;" /><p>在mutations中添加方法</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102234527.png" style="zoom:67%;" /><p>最后在组件内添加方法</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102234741.png" style="zoom:50%;" /><p>这样子的方法是属于响应式的，这个是每个对象都有一个Dep，一个Dep定义着好多个watcher，Dep来监听属性的变化</p><p>Dep就是个观察者模式，先观看数据有没有变化，如果属性发生了变化，就会通知使用到该属性的地方发生改变</p><p>如果里面修改的不是在state里面定义好的属性</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102235443.png" style="zoom:50%;" /><p>position属性在state里面没有被定义，所以即便是添加了这个属性能在<strong>devtools</strong>工具监听到，也不能提交到响应式系统里面</p><p>所以如果是要添加属性的话，最好是使用<code>Vue.set</code>方法</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102235826.png" style="zoom:67%;" /><p>相对应的，如果是要删除方法就使用<code>Vue.delete</code>方法</p><h3 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h3><p>这个就相当于vue中的计算属性</p><h4 id="只需要一个形参state"><a href="#只需要一个形参state" class="headerlink" title="只需要一个形参state"></a>只需要一个形参state</h4><p>这里做个案例，比如说是要做一个<code>counter</code>的平方</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102214303.png" style="zoom:67%;" /><p>然后在组件中要引用的话，那么就直接使用</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104124900.png" alt=""></p><p><code>getters</code>还可以做一些过滤功能，比如要过滤年龄大于20岁的数据</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102214939.png" style="zoom:67%;" /><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102215037.png" style="zoom:67%;" /><h4 id="有两个形参：state和getters"><a href="#有两个形参：state和getters" class="headerlink" title="有两个形参：state和getters"></a>有两个形参：state和getters</h4><p><code>getters</code>方法是有第二个形参的，第二个形参实际指向的是自己的<code>getters</code>方法</p><p>比如要调用上述<code>more20stu</code>方法的个数</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102225448.png" style="zoom:67%;" /><h4 id="需要在方法中传入值而非定义好的"><a href="#需要在方法中传入值而非定义好的" class="headerlink" title="需要在方法中传入值而非定义好的"></a>需要在方法中传入值而非定义好的</h4><p>如果是需要在组件中传入值，而非在getters里面写死的，那么这个需要在返回值里面定义一个函数，也就是闭包</p><p>如果是需要改变通过组件里面传入数据来筛选大于年龄的范围的话，可以使用如下写法</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102230326.png" style="zoom:67%;" /><p>这个其实是可以简化为箭头函数的写法的</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200102230406.png" style="zoom:67%;" /><h3 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h3><p><code>actions</code>就是异步方法，简单的说就是如果<code>mutations</code>里面有要异步操作的方法，比如网路请求等是异步操作的，官网给出的图是<code>actions</code>异步操作在<code>mutations</code>之前</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200101232500.png" style="zoom:67%;" /><p>如果在<code>mutations</code>直接去执行异步操作的话，因为不确定执行完的时间，所以如果是异步操作需要时间久的话就不会被<strong>devtools</strong>监听到，所以就有了<code>actions</code>方法，<code>mutations</code>会等待<code>actions</code>的操作执行完毕之后再继续往下走。</p><p>其用法如下：</p><h4 id="普通写法"><a href="#普通写法" class="headerlink" title="普通写法"></a>普通写法</h4><p><code>actions</code>里面默认的第一个形参就是<code>context</code></p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104123038.png" style="zoom:67%;" /><p>在<code>actions</code>里面调用<code>mutations</code>里面的方法</p><p>然后在组建中使用<code>dispatch</code>方法调用<code>actions</code>的方法就好了</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104123148.png" style="zoom:67%;" /><h4 id="传递参数"><a href="#传递参数" class="headerlink" title="传递参数"></a>传递参数</h4><p>当然<code>actions</code>也是可以传递参数的，默认的第二个参数名是<code>payload</code></p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104123608.png" style="zoom:67%;" /><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104123639.png" style="zoom:67%;" /><h4 id="获取异步操作成功后的信息"><a href="#获取异步操作成功后的信息" class="headerlink" title="获取异步操作成功后的信息"></a>获取异步操作成功后的信息</h4><p>如果是要获取异步操作成功的信息的话</p><p>使用如下写法也是可以的：</p><h5 id="写法1："><a href="#写法1：" class="headerlink" title="写法1："></a>写法1：</h5><p>Vuex里面的方法：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104125413.png" style="zoom:67%;" /><p>组件中的方法：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104125505.png" style="zoom:67%;" /><p>但是上面的方法有点不好</p><h5 id="写法2："><a href="#写法2：" class="headerlink" title="写法2："></a>写法2：</h5><p>vuex的写法：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104125909.png" style="zoom:67%;" /><p>组件中的写法：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104125952.png" style="zoom:67%;" /><h5 id="方法3（使用promise）："><a href="#方法3（使用promise）：" class="headerlink" title="方法3（使用promise）："></a>方法3（使用promise）：</h5><p>但是方法2的写法不够优雅</p><p>Vuex的写法：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104130901.png" style="zoom:67%;" /><p>组件内的写法：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104130714.png" style="zoom:67%;" /><h3 id="modules"><a href="#modules" class="headerlink" title="modules"></a>modules</h3><p>modules方法就是如果所有的东西都往store里面塞，那么数量多的话就会显得很臃肿，但是因为单一状态树的原因只能创建一个store，所以vuex可以在store里面继续划分模块</p><h4 id="使用modelA里面的state"><a href="#使用modelA里面的state" class="headerlink" title="使用modelA里面的state"></a>使用modelA里面的state</h4><p>使用方法如下：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104132122.png" style="zoom:67%;" /><p>如果是<code>modelA</code>里面有个state属性的话，那么在组件中调用的方法如下：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104132311.png" style="zoom:67%;" /><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104132437.png" style="zoom:67%;" /><p>因为<code>modelA</code>最终会放在<code>store</code>的<code>state</code>里面</p><h4 id="使用modelA里面的mutations"><a href="#使用modelA里面的mutations" class="headerlink" title="使用modelA里面的mutations"></a>使用modelA里面的mutations</h4><p>如果是在modelA里面定义一个方法的话</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104133005.png" style="zoom:67%;" /><p>组件中的方法：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104133247.png" style="zoom:67%;" /><p>这个还是用以前的方法就好了，因为只要名字不是重复的，<code>commit</code>会去从<code>store</code>里面找，如果找不到再去看看<code>models</code>里面有没有这个方法</p><h4 id="modelA里面的getter"><a href="#modelA里面的getter" class="headerlink" title="modelA里面的getter"></a>modelA里面的getter</h4><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104133556.png" style="zoom:67%;" /><p>组件内的写法：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104133815.png" alt=""></p><p>但是如<code>stote</code>的<code>getters</code>的话，是有一个<code>getters</code>形参的，这个形参是可以调用自己的<code>getters</code>方法的</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104134106.png" style="zoom:67%;" /><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104134142.png" alt=""></p><p>如果是想引用<code>store</code>的<code>state</code>属性的话，那么可以引用第三个参数<code>rootState</code></p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104134539.png" style="zoom: 67%;" /><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104134617.png" style="zoom:67%;" /><h4 id="modelA里面的actions"><a href="#modelA里面的actions" class="headerlink" title="modelA里面的actions"></a>modelA里面的actions</h4><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104135150.png" style="zoom:67%;" /><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104135350.png" alt=""></p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><code>modelA</code>里面的所有方法的形参都是指向自己<code>modelA</code>里面的方法的</p><h2 id="Vuex的文件结构"><a href="#Vuex的文件结构" class="headerlink" title="Vuex的文件结构"></a>Vuex的文件结构</h2><p><code>Vuex</code>的文件结构是一般都会把<code>state</code>的参数用对象传进去</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104140640.png" style="zoom:67%;" /><p>然后<code>mutations</code>、<code>actions</code>、<code>getters</code>里面的方法，把方法写在新的一个文件导入即可</p><p>比如<code>mutations</code></p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200104140810.png" style="zoom:67%;" /><p>如果是<code>model</code>里面的方法，就新建一个<code>model</code>文件夹，里面存放<code>store</code>的<code>model</code>方法即可 </p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>v-router详解</title>
      <link href="/2019/12/27/vue-router/"/>
      <url>/2019/12/27/vue-router/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="vue-router的安装"><a href="#vue-router的安装" class="headerlink" title="vue-router的安装"></a>vue-router的安装</h2><p><a href="https://router.vuejs.org/zh/" target="_blank" rel="noopener">vue-router</a>是官方推荐的路由插件，官方的路由管理器。它和 Vue.js 的核心深度集成，让构建单页面应用变得易如反掌</p><p>使用命令</p><pre class=" language-js"><code class="language-js">npm install vue<span class="token operator">-</span>router <span class="token operator">--</span>save</code></pre><h2 id="vue-router的使用"><a href="#vue-router的使用" class="headerlink" title="vue-router的使用"></a>vue-router的使用</h2><h3 id="配置文件解析"><a href="#配置文件解析" class="headerlink" title="配置文件解析"></a>配置文件解析</h3><p>一开始使用脚手架方法安装的代码是这样的</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228130938.png" style="zoom:67%;" /><p>但是实际上可以分为好几个步骤</p><h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228131942.png" style="zoom:67%;" /></h3><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228142155.png" style="zoom:67%;" /><h3 id="vue-router基本使用"><a href="#vue-router基本使用" class="headerlink" title="vue-router基本使用"></a>vue-router基本使用</h3><p>先添加几个子组件</p><p>先要导入子组件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228143705.png" alt=""></p><p>然后在路由里面导入</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228151332.png" style="zoom:67%;" /><p>填写这两个配置<code>（path、components）</code></p><p>最后在<code>App.vue</code>里面配置<code>router-link</code>，并且填写相应的配置即可</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228151414.png" style="zoom:67%;" /><p>最后是需要<code>router-view</code>才可以展示配置的路由</p><p><code>router-link</code>是导入<code>vue-router</code>后注册的全局属性</p><h3 id="redirect重定向"><a href="#redirect重定向" class="headerlink" title="redirect重定向"></a>redirect重定向</h3><p>这个比如打开网页的默认显示界面的路径</p><p>直接配置一个<code>redirect</code>就好了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200101221619.png" alt=""></p><h3 id="vue-router的mode"><a href="#vue-router的mode" class="headerlink" title="vue-router的mode"></a>vue-router的mode</h3><p>在导航栏出现类似这种的情况，地址栏带着个#</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228153917.png" alt=""></p><p>这个是因为默认是哈希模式的</p><p>如果要解决这种情况可以选择 </p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228154435.png" style="zoom:67%;" /><p>然后导航栏的#就消失了</p><p>这个的原因就是项目的配置默认的是哈希模式，但是路由用的是history模式，这个时候就会出现导航栏出现#的问题</p><h2 id="router-link其他属性"><a href="#router-link其他属性" class="headerlink" title="router-link其他属性"></a>router-link其他属性</h2><h3 id="渲染标签"><a href="#渲染标签" class="headerlink" title="渲染标签"></a>渲染标签</h3><p>如上述代码所示，默认<code>router-link</code>渲染出来就是个a标签，如果要改成其他标签类似button之类的，就可以做修改</p><p>方法很简单，只需要加一个tag属性即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228155022.png" alt=""></p><p>这样浏览器渲染出来就是一个button标签了</p><h3 id="跳转方式"><a href="#跳转方式" class="headerlink" title="跳转方式"></a>跳转方式</h3><p>默认跳转方式是类似于小程序的navigate，也就是跳转后可以返回</p><p>如果要修改成replace的话，也就是跳转后不能返回，只需要加入一个replace字段</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228155419.png" alt=""></p><p>此时就没有返回功能了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228155436.png" alt=""></p><h3 id="router-link的活跃状态"><a href="#router-link的活跃状态" class="headerlink" title="router-link的活跃状态"></a>router-link的活跃状态</h3><h4 id="局部修改"><a href="#局部修改" class="headerlink" title="局部修改"></a>局部修改</h4><p>router-link默认点击哪个路由，哪个路由就会变成活跃状态</p><p>如图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228161537.png" alt=""></p><p>活跃的路由默认就会带一个样式</p><p>这个一般用于点击后显示样式等功能</p><p>当然这个名字是可以修改的，修改方式如下图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228160639.png" alt=""></p><p>再添加一个字体变红的样式，效果就会很明显了</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228160748.png" style="zoom:67%;" /><p>效果如下图：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228160835.png" alt=""></p><p>但是这样是有个弊端的，因为每个路由都要加一个<code>active-class=&quot;active&quot;</code>字段，如果要修改的路由很多的话就会显得十分的麻烦</p><p>这里就可以在全局里面修改</p><h4 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h4><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228161141.png" style="zoom:67%;" /><p>先把原来配置的<code>active-class=&quot;active&quot;</code>删掉，只需要添加一个<code>linkActiveClass</code>字段，就可以把默认的全局活跃样式修改了</p><h2 id="其他标签实现跳转功能"><a href="#其他标签实现跳转功能" class="headerlink" title="其他标签实现跳转功能"></a>其他标签实现跳转功能</h2><h3 id="push方法"><a href="#push方法" class="headerlink" title="push方法"></a>push方法</h3><p>之前用的都是使用<code>router-link</code>的方式去实现跳转功能，如果是要实现用其他标签来跳转的话，就要使用事件的方法去跳转</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228163148.png" style="zoom:67%;" /><p><code>$router</code>这个属性是<code>vue-router</code>在所有的组件都添加了的</p><p><code>$router</code>的<code>push</code>方法就是<code>pushSate</code>，也就是这个是可以返回的，如果要不想返回，可以使用<code>replace</code>属性 </p><h3 id="replace方法"><a href="#replace方法" class="headerlink" title="replace方法"></a>replace方法</h3><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228163749.png" style="zoom:67%;" /><h2 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h2><p>当然在实际项目开发中不可能通过写死的路由去跳转，一般都是用于带着参数去跳转的方式开发</p><h3 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h3><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228165734.png" style="zoom:67%;" /><h3 id="在组件上配置参数"><a href="#在组件上配置参数" class="headerlink" title="在组件上配置参数"></a>在组件上配置参数</h3><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228184048.png" style="zoom:67%;" /><p>当然肯定要在跳转过去的页面中要获取传过去的ID</p><h3 id="在新页面获取传递过去的值"><a href="#在新页面获取传递过去的值" class="headerlink" title="在新页面获取传递过去的值"></a>在新页面获取传递过去的值</h3><h4 id="方法1：使用计算属性获取"><a href="#方法1：使用计算属性获取" class="headerlink" title="方法1：使用计算属性获取"></a>方法1：使用计算属性获取</h4><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228184854.png" style="zoom:67%;" /><p><strong>注意这个<code>params</code>后面的那个属性是跟全局路由注册过的一样的名字，也就是<code>path:&#39;/user/:userid&#39;</code></strong></p><h4 id="方法2：直接使用mustach方法获取"><a href="#方法2：直接使用mustach方法获取" class="headerlink" title="方法2：直接使用mustach方法获取"></a>方法2：直接使用mustach方法获取</h4><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228185554.png" style="zoom:67%;" /><h4 id="route和-router的区别"><a href="#route和-router的区别" class="headerlink" title="$route和$router的区别"></a>$route和$router的区别</h4><p><code>$route</code>是获取上个页面的活跃路由</p><p>而<code>$router</code>是在路由注册过的全局<code>router</code>对象</p><p>在这里打印下这两者</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228185646.png" style="zoom:67%;" /><p>打印出来<code>$route</code>的结果如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228190329.png" alt=""></p><p><code>$router</code>的结果如下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228190417.png" alt=""></p><p>由此可以证实上面的结果</p><h2 id="路由的懒加载"><a href="#路由的懒加载" class="headerlink" title="路由的懒加载"></a>路由的懒加载</h2><p>当打包出来的程序，如果打包出来的包十分的大，点开项目界面的时候会出现几秒的空白来加载文件，那么对用户的体验感十分的不好</p><p>所以官方推荐以路由懒加载的形式来编写</p><p>这里先把上面的代码打包，打包后的结果如图所示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228191135.png" alt=""></p><p>第一个配置文件app…..的是业务代码<strong>（即开发者自己编写的代码）</strong></p><p>第二个文件就是对打包的代码做底层支撑的<strong>（即ES6语法的import、export、commentjs等，使之变成对浏览器能够识别的东西）</strong></p><p>第三个文件是第三方代码<strong>（即开发中引用的第三方的东西Vue、Vue-router、axios、Vuex等）</strong></p><p>在项目开发中，也就是要在点击哪个页面的时候，哪个页面就进行加载，这也就是路由的懒加载的思想</p><p>使用路由懒加载只需要重新定义上面导入的方法：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228192459.png" alt=""> </p><p>然后重新打包文件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228192646.png" alt=""></p><p>如图所示，就多了三个打包的文件，现在引用哪个文件就会使用哪个路由的打包文件了</p><h2 id="嵌套子路由"><a href="#嵌套子路由" class="headerlink" title="嵌套子路由"></a>嵌套子路由</h2><p>一般话比如个人中心的地址、个人信息等，在地址栏一般是由User/address、User/person等形式表现出来</p><p>这个时候就要用到子路由了</p><p>在全局路由里面嵌套子路由的方式如下：</p><p>先在全局路由里面在要添加子路由的字段加上children</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228201229.png" style="zoom:67%;" /><p>然后在要添加路由的那个文件里面添加配置</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228201903.png" style="zoom:67%;" /><p>然后就可以添加子路由了</p><h2 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h2><h3 id="使用router-link方式跳转"><a href="#使用router-link方式跳转" class="headerlink" title="使用router-link方式跳转"></a>使用router-link方式跳转</h3><h4 id="配置router-link"><a href="#配置router-link" class="headerlink" title="配置router-link"></a>配置router-link</h4><p>先添加一个子组件Profile</p><p>如果要参数传递的话，只能用对象的方式去传递</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228210106.png" alt=""></p><p>然后在地址栏就会出现参数传递了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228210147.png" alt=""></p><h4 id="接收参数"><a href="#接收参数" class="headerlink" title="接收参数"></a>接收参数</h4><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228210805.png" style="zoom:67%;" /><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228210831.png" style="zoom:67%;" /><h3 id="其他标签去跳转"><a href="#其他标签去跳转" class="headerlink" title="其他标签去跳转"></a>其他标签去跳转</h3><p>如果不是通过router-link去跳转的话，比如使用的是button，那么方法还是使用事件去传递</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228211246.png" style="zoom:67%;" /><h2 id="router和-route的区别"><a href="#router和-route的区别" class="headerlink" title="$router和$route的区别"></a>$router和$route的区别</h2><h3 id="router"><a href="#router" class="headerlink" title="$router"></a>$router</h3><p>这里先在局部打印<code>$router</code>和在<strong>main.js</strong>全局打印<code>$router</code></p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228212224.png" style="zoom:67%;" /><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228212553.png" style="zoom:67%;" /><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228212404.png" style="zoom:67%;" /><p>发现这两者打印的结果是一样的，所以局部打印的<code>this.$router</code>是new Vue传的那个<code>router</code>是同一个东西 </p><p>这里进入源码看看</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228212850.png" style="zoom:67%;" /><p>因为这里实例化了一个类<code>VueRouter</code>，所以后面才可以import导入</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228212957.png" alt=""></p><p>这里的所有方法就是<code>$router</code>可以使用的方法</p><h3 id="route和-router为什么能用"><a href="#route和-router为什么能用" class="headerlink" title="$route和$router为什么能用"></a>$route和$router为什么能用</h3><h4 id="Vue-prototype"><a href="#Vue-prototype" class="headerlink" title="Vue.prototype"></a>Vue.prototype</h4><p>这个route和router为什么能用呢，因为vue-router源码里面注册了全局组件</p><p>每次<code>Vue.use</code>的时候用的其实都是内部的<code>install</code>方法，所以要通过install方法去找最终的源码</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228213741.png" alt=""></p><p>可以使用<code>this.$route</code>和<code>this.$router</code>是因为所有的组件都是继承于Vue类的原型</p><p>这里来证实一下，先在<strong>main.js</strong>定义一个Vue的属性</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228214155.png" style="zoom:67%;" /><p>然后在子组件中调用这个方法</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228214402.png" style="zoom:67%;" /><p>如图所示：是可以使用这个方法的</p><p>如果定义的是一个属性的话也是一样的</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228221718.png" style="zoom:67%;" /><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228221805.png" style="zoom:67%;" /><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228222047.png" alt=""></p><p>两者都可以打印出来</p><h4 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h4><p>再接着看源码</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228215255.png" style="zoom:67%;" /><p>这个<code>object.defineProperty</code></p><p>这个其实是这样的，假如要往一个对象里面添加一个属性</p><p>按照以前的方法就是直接添加就好了</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>    name<span class="token punctuation">:</span><span class="token string">'LY'</span><span class="token punctuation">}</span></code></pre><p>如果是要<code>object.defineProperty</code>的方法就是</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>    name<span class="token punctuation">:</span><span class="token string">'LY'</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//defineProperty的写法</span>object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span></code></pre><p><code>defineProperty</code>这个也就是Vue的响应式实现方法的核心</p><p>所以上面图片的那个代码也就是给<code>Vue.prototype</code>加一个<code>$route</code>,其值为<code>return this._routerRoot._router</code></p><p>而<code>return this._routerRoot._router</code>里面最后的那个<code>_router</code>就是<strong>main.js</strong>里面挂在进去的那个<code>router</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228220023.png" alt=""></p><p>而<code>this._routerRoot</code>呢就是上面的Vue实例传过去的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228220221.png" alt=""></p><p>if下面第一行的<code>this</code>，就是Vue实例，把Vue实例传递给<code>this._routerRoot</code>。</p><p>然后又把<code>this.$options.router</code>赋值给<code>this.__router</code>，这个就相当于给<code>this._routerRoot</code>添加了一个<code>this._router</code>属性，即<code>this._routerRoot._router</code></p><p>也就是说<code>this._routerRoot._router</code>就等于<code>this.$options</code>中的<code>options</code>，而这个<code>options</code>就相当于<strong>main.js</strong>里面传入的<code>router</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228220023.png" alt=""></p><p>然后再使用Vue注册一个全局组件</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228221105.png" alt=""></p><p>所以才可以使用<code>this.$route</code>和<code>this.$router</code></p><p>把上面代码块的object.defineProperty代码翻译过来也就是</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228221338.png" alt=""></p><p>只不过最后的那个<code>_route</code>和是动态的，哪个组件于活跃就把<code>_route</code>赋值给谁，而这个<code>_route</code>永远指向当前活跃的对象</p><p>然后又赋值给Vue的实例，所以才可以在全局使用</p><h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><p>$router是Vue的实例，如果想要导航到不同的URL话，就要使用$router.push等方法，所有方法都在源码定义好了</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228222414.png" style="zoom:67%;" /><p>而$route是当前活跃的路由，可以获取当前的<code>query、params、path</code>等属性</p><h2 id="导航守卫"><a href="#导航守卫" class="headerlink" title="导航守卫"></a>导航守卫</h2><h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228225153.png" style="zoom: 50%;" /><p>官网的这个图的重点就是那几个生命周期</p><p>create就是在组件被创建的时候的回调函数</p><p>mouted就是在组件挂在到dom上面的时候的回调函数，因为vue是先创建组件，然后再把template挂在到dom上面</p><p>updated是界面发生更新的时候的回调函数</p><h3 id="给组件添加标题"><a href="#给组件添加标题" class="headerlink" title="给组件添加标题"></a>给组件添加标题</h3><p>现在创建的每个组件显示的都是模板文件的title</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228224635.png" alt=""></p><p>如果要修改这个标题的话，那么可以使用create去修改</p><p>添加如下字段就可以修改title了</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229010608.png" style="zoom: 67%;" /><p>然后点击About，标题就可以显示成”关于“了</p><p>但是这个方法有个弊端，就是需要在每个子组件都要添加这个代码，这样是十分的繁琐的，所以官方有个方法：<strong>全局前置守卫</strong></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229010921.png" alt=""></p><p>其部分源码如图：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229011142.png" alt=""></p><p>其实这个就是给<code>NavigationGuard</code>起了个别名，也就是括号里面的内容，也就是说传递的参数本身又有三个参数，<code>to</code>、<code>from</code>和<code>next</code> </p><p>在代码中实现也就是</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229011615.png" style="zoom:67%;" /><p><strong>这个next是必须要去调用的，如果不实现beforeEach方法，那么就是默认调用，如果实现了beforeEach方法，那么如果不调用next就不能进行路由跳转</strong></p><h4 id="错误写法"><a href="#错误写法" class="headerlink" title="错误写法"></a>错误写法</h4><p>如果要进行跳转后能改变标题的话</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229011907.png" style="zoom:67%;" /><p>此时的这个<code>to</code>是没有<code>title</code>这个属性的</p><p><code>to</code>的这个源码的类型是<code>route</code>类型</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229012017.png" alt=""></p><p>Route也就是全局路由的配置了</p><p>只要在路由里面添加<code>meta</code>属性就可以调用title属性了</p><p>如下图所示：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229012250.png" style="zoom:67%;" /><p>只要在每个需要修改主题的路由里面添加<code>meta</code>对象的<code>title</code>属性，就可以实现了</p><p>最后再在<code>beforeEach</code>修改字段</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229012504.png" style="zoom:67%;" /><p>但是如上代码有个隐患，就是在子路由的时候的<code>title</code>是<code>undefined</code></p><p>打印一下<code>to</code>属性先看看</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229012800.png" style="zoom:67%;" /><p>别的没有子路由的组件都可以正常显示标题，但是有子路由的组件显示是<code>undefined</code>，子路由根本就没有<code>meta</code>属性，但是每个路由都有一个<code>matched</code>，而里面的属性是大家都共有的，所以这个要使用<code>matched</code>来获取<code>title</code></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229013251.png" alt=""></p><h4 id="正确写法"><a href="#正确写法" class="headerlink" title="正确写法"></a>正确写法</h4><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229013421.png" style="zoom:67%;" /><h2 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a>keep-alive</h2><h3 id="保持上个点击组件的状态"><a href="#保持上个点击组件的状态" class="headerlink" title="保持上个点击组件的状态"></a>保持上个点击组件的状态</h3><p>这个理论上说起来很麻烦，但是实际上就是监听跳转过程，也就是如果我上一次点击的是Home的message界面</p><p>，我点击其他界面后再点击回Home，里面显示的还是message，也就是上一次打开的界面，而不是显示默认跳转的news界面</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191228223535.png" style="zoom:67%;" /><p>也就是避免组件的重新渲染，保留组件的状态</p><p>先在home和about加入create回调方法</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229121226.png" style="zoom:67%;" /><p>create方法只有在组件被创建的时候调用，如果是按照之前的方法的话，那么每次点开组件都会有一个create方法被调用</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229121420.png" alt=""></p><p>如果加上keep-alive后</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229121541.png" alt=""></p><p>那么create方法就只会被调用一次了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229121555.png" alt=""></p><p>这个其实要用到<strong>组件内守卫</strong></p><p>只需要先把原来全局路由的<code>Home</code>下面的<code>redirect</code>去掉，然后添加<code>activated</code><strong>（组件活跃时候的回调函数）</strong></p><p>然后再调用<strong>组件内守卫</strong></p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191229122901.png" style="zoom:67%;" /><p>这样子就可以使用记录上个点击状态的功能了</p><h3 id="补充点"><a href="#补充点" class="headerlink" title="补充点"></a>补充点</h3><p><code>activated</code>和<code>deactivated</code>只有在使用了<code>keep-alive</code>的时候才会被使用</p><h3 id="keep-alive补充点"><a href="#keep-alive补充点" class="headerlink" title="keep-alive补充点"></a>keep-alive补充点</h3><p>keep-alive有两个重要的属性</p><ul><li>include：字符串或正则表达式，只有匹配的组件才会被缓存</li><li>exclude：字符串或正则表达式，任何匹配到的组件都不会被缓存</li></ul><p>这个因为如果是个人中心等会变化的页面就需要被时刻修改</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习随笔</title>
      <link href="/2019/12/22/sui-bi/"/>
      <url>/2019/12/22/sui-bi/</url>
      
        <content type="html"><![CDATA[<h2 id="html5中改变URL和页面不刷新的方法"><a href="#html5中改变URL和页面不刷新的方法" class="headerlink" title="html5中改变URL和页面不刷新的方法"></a>html5中改变URL和页面不刷新的方法</h2><ol><li><p>location.hash = ‘aaa’    这样是全局不刷新的</p></li><li><p>HTML5里面的history模式：history.pushState({},’’,’home’)</p></li><li><p>HTML5的replaceState：history.replaceState({},’’,’ass’)</p></li></ol><h2 id="vue进行第二层for循环数据"><a href="#vue进行第二层for循环数据" class="headerlink" title="vue进行第二层for循环数据"></a>vue进行第二层for循环数据</h2><pre><code> v-if=&quot;this.goods_detail.specification !== undefined &amp;&amp;  this.goods_detail.specification.length &gt; 0 &quot;</code></pre><h2 id="–save-dev和–save的区别"><a href="#–save-dev和–save的区别" class="headerlink" title="–save-dev和–save的区别"></a>–save-dev和–save的区别</h2><p>npm install module：</p><ul><li>会把module包安装到node_modules目录中</li><li>不会修改package.json</li><li>之后运行npm install 命令时，不会自动安装module包</li></ul><p>npm install module –save</p><ul><li>会把module包安装到node_modules目录汇总</li><li>会修改package.json，将模块名和版本号添加到dependencies部分</li><li>之后运行npm install 命令时，会自动安装module包</li><li>在线上环境运行时会将包安装</li></ul><p>npm install module –save-dev</p><ul><li>会把module包安装到node_modules目录汇总</li><li>会修改package.json，将模块名和版本号添加到devDependencies部分</li><li>之后运行npm install 命令时，会自动安装module包</li><li>在线上环境并不会进行安装。</li></ul><p>他们表面上的区别是–save 会把依赖包名称添加到 package.json 文件 dependencies 键下，–save-dev 则添加到 package.json 文件 devDependencies 键下.<br>dependencies是运行时依赖，devDependencies是开发时的依赖。即devDependencies 下列出的模块，是我们开发时用的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200520083708.png" alt=""></p><h2 id="npm的版本问题"><a href="#npm的版本问题" class="headerlink" title="npm的版本问题"></a>npm的版本问题</h2><p><del>会匹配最近的小版本依赖包，比如</del>1.2.3会匹配所有1.2.x版本，但是不包括1.3.0 ^会匹配最新的大版本依赖包，比如^1.2.3会匹配所有1.x.x的包，包括1.3.0，但是不包括2.0.0</p>]]></content>
      
      
      <categories>
          
          <category> 日常总结 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>插槽slot</title>
      <link href="/2019/12/21/cha-cao/"/>
      <url>/2019/12/21/cha-cao/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="插槽的使用"><a href="#插槽的使用" class="headerlink" title="插槽的使用"></a>插槽的使用</h2><p>插槽就像我们日常生活中的U盘什么的接口，可以使用来个性化定制。拿京东的导航栏为例：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221153120.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221153148.png" alt=""></p><p>类似这类网站，遇到这种大面积重复的部分肯定不是每个页面都是重写的，肯定是有复用的形式。</p><p>拿下面的代码来说：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cpn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        我是子组件    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span><span class="token punctuation">{</span>      message<span class="token punctuation">:</span><span class="token string">'hello'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span><span class="token punctuation">{</span>      cpn<span class="token punctuation">:</span><span class="token punctuation">{</span>        template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>如果我要在第一个<code>cpn</code>里面添加一个<code>button</code>，第二个<code>cpn</code>里面添加一个<code>span</code>，那么如果在子组件<code>template</code>里面添加的话就会导致每个<code>cpn</code>都添加了，所以这个时候就要用到插槽。</p><p>插槽可以帮助个性化定制，其使用方式如下：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>span<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>h1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>h2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>h3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cpn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        我是子组件        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span><span class="token punctuation">{</span>      message<span class="token punctuation">:</span><span class="token string">'hello'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span><span class="token punctuation">{</span>      cpn<span class="token punctuation">:</span><span class="token punctuation">{</span>        template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>运行效果如图：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221153650.png" style="zoom:50%;" /><p>每个子组件都可以自定义要的组件</p><h2 id="插槽的默认值"><a href="#插槽的默认值" class="headerlink" title="插槽的默认值"></a>插槽的默认值</h2><p>此外插槽还可以添加默认值</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cpn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        我是子组件        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>默认slot插槽组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span><span class="token punctuation">{</span>      message<span class="token punctuation">:</span><span class="token string">'hello'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    components<span class="token punctuation">:</span><span class="token punctuation">{</span>      cpn<span class="token punctuation">:</span><span class="token punctuation">{</span>        template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221154051.png" style="zoom:67%;" /><h2 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h2><p>这个还是拿京东的导航条来说明</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221153120.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221153148.png" alt=""></p><p>这个导航条三个部分就有三个插槽，也就是上面的方法不适用的，要确定每个插槽要添加什么内容，所以就有具名插槽</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>left<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>左边<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>center<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>中间<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>right<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>右边<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>>                123            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>                    isShow<span class="token punctuation">:</span><span class="token boolean">true</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                components<span class="token punctuation">:</span><span class="token punctuation">{</span>                    cpn<span class="token punctuation">:</span><span class="token punctuation">{</span>                        template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>                        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">return</span><span class="token punctuation">{</span>                                isShow<span class="token punctuation">:</span><span class="token boolean">false</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>设置了一个<code>isShow</code>属性来判断组件的作用域，结果如图：</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221155437.png" style="zoom: 50%;" /><p>也就是说是可以显示的，这个的插槽的作用域是当前模板里面的，如上代码的组件是在app模板里面的，所以使用的是父组件的属性，也就是<code>isShow=true</code></p><p>如果是子组件template里面编写的作用域的话，如下代码所示：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>isShow<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>                123                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isShow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>button<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>                    isShow<span class="token punctuation">:</span><span class="token boolean">true</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                components<span class="token punctuation">:</span><span class="token punctuation">{</span>                    cpn<span class="token punctuation">:</span><span class="token punctuation">{</span>                        template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>                        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">return</span><span class="token punctuation">{</span>                                isShow<span class="token punctuation">:</span><span class="token boolean">false</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>在子组件<code>template</code>里面编写一个<code>button</code>，这个<code>button</code>引用的就是它当前作用域的值，也就是<code>isShow=&#39;false&#39;</code></p><p>用官方文档的话说就是：<strong>父模板的组件都会在父级作用域内编译，子组件模板的所有东西都会在子集作用域内编译</strong></p><h2 id="作用域插槽"><a href="#作用域插槽" class="headerlink" title="作用域插槽"></a>作用域插槽</h2><p>作用域插槽这个官方文档说的也不是特别清楚，实际上的作用如下：</p><p>在子组件定义了一堆数据，然后在父组件显示：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in planguage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                            {{item}}                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    message<span class="token punctuation">:</span> <span class="token string">'hello'</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                components<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    cpn<span class="token punctuation">:</span> <span class="token punctuation">{</span>                        template<span class="token punctuation">:</span> <span class="token string">'#cpn'</span><span class="token punctuation">,</span>                        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token keyword">return</span> <span class="token punctuation">{</span>                                planguage<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'JavaScript'</span><span class="token punctuation">,</span> <span class="token string">'java'</span><span class="token punctuation">,</span> <span class="token string">'php'</span><span class="token punctuation">,</span> <span class="token string">'c#'</span><span class="token punctuation">,</span> <span class="token string">'c++'</span><span class="token punctuation">,</span> <span class="token string">'Python'</span><span class="token punctuation">]</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221160736.png" style="zoom:50%;" /><p>假如此时有一个需求，要求数据是子组件的，但是排布的样式由父组件决定。</p><p>也就是父组件要获取子组件的属性，然后父组件再用自己的方式打印出来。</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--                2.把子组件的属性打印出来--></span><span class="token comment" spellcheck="true">&lt;!--                这个是V2.5.*的版本中，必须要用template包裹起来，往后的版本是没有的，为了兼容要使用template版本--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slot<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--                3..把要遍历的属性打印出来--></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in slot.abc<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{item}}-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--                1. 这里获取子组件的属性--></span><span class="token comment" spellcheck="true">&lt;!--                这个：abc名字是随便取的，如果要自定义名字的话后面也修改名字就好了--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">:abc</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>planguage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in planguage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                            {{item}}                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    message<span class="token punctuation">:</span> <span class="token string">'hello'</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                components<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    cpn<span class="token punctuation">:</span> <span class="token punctuation">{</span>                        template<span class="token punctuation">:</span> <span class="token string">'#cpn'</span><span class="token punctuation">,</span>                        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token keyword">return</span> <span class="token punctuation">{</span>                                planguage<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'JavaScript'</span><span class="token punctuation">,</span> <span class="token string">'java'</span><span class="token punctuation">,</span> <span class="token string">'php'</span><span class="token punctuation">,</span> <span class="token string">'c#'</span><span class="token punctuation">,</span> <span class="token string">'c++'</span><span class="token punctuation">,</span> <span class="token string">'Python'</span><span class="token punctuation">]</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>运行结果如图：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191221161423.png" alt=""></p><p>就可以使用自己的方式去排布了</p><p>子组件的slot的值是可以自定定义的，改成什么后面也就引用什么，template里面的<code>slot-scope=&quot;slot&quot;</code>这个是固定的，一定要这样写，<code>template</code>是<code>vue</code>的2.5.*版本中一定要使用template包裹起来，不然会报错，这个是为了兼容才这样写</p><p>整体而言的流程如下：</p><ol><li>子组件的slot引用子组件的属性</li><li>父组件使用<template slot-scope="slot"></template>去调用，注意这个的<code>slot-scope=&quot;slot&quot;</code>是固定格式</li><li>在<template slot-scope="slot"></template>里面<code>v-for</code>调用要遍历的属性</li></ol>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>v-model详解</title>
      <link href="/2019/12/20/v-model-xiang-jie/"/>
      <url>/2019/12/20/v-model-xiang-jie/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="v-model的使用"><a href="#v-model的使用" class="headerlink" title="v-model的使用"></a>v-model的使用</h2><p>v-model一般用在input的场景上，mustache语法只能从vue渲染到页面上，而v-model实现了一个双向绑定，在修改input的值的时候也可以修改data的值</p><p>简单的使用如下：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 也就是双向绑定 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>                {{message}}            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>在input修改的时候，h2的值也会改变</p><h2 id="v-model的原理"><a href="#v-model的原理" class="headerlink" title="v-model的原理"></a>v-model的原理</h2><h3 id="第一步：绑定input的value"><a href="#第一步：绑定input的value" class="headerlink" title="第一步：绑定input的value"></a>第一步：绑定input的value</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 1.v-bind:value绑定，但是这个方法不能再输入框里面修改外部也改变 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>                {{message}}            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>先可以通过控制台用app.message去修改值</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191220113018.png" alt=""></p><h3 id="第2步：监听用户的输入"><a href="#第2步：监听用户的输入" class="headerlink" title="第2步：监听用户的输入"></a>第2步：监听用户的输入</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 1.v-bind:value绑定，但是这个方法不能再输入框里面修改外部也改变 --></span>            <span class="token comment" spellcheck="true">&lt;!-- &lt;input type="text" :value="message" /> --></span>            <span class="token comment" spellcheck="true">&lt;!-- 2.可以用input方法去绑定输入事件，然后把输入事件的值绑定到message那里就可以完成双向绑定了，            所以我们要先获取输入框的value值(即通过event事件去获取)，然后再在methods那里把新的值赋值给message即可 --></span>            <span class="token comment" spellcheck="true">&lt;!-- &lt;input type="text" :value="message" @input="inputmessage" /> --></span>            <span class="token comment" spellcheck="true">&lt;!-- 总结：v-model原理就是使用v-bind绑定一个value属性，然后使用v-on绑定一个input事件 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inputmessage<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            {{message}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                methods<span class="token punctuation">:</span><span class="token punctuation">{</span>                    <span class="token function">inputmessage</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token operator">=</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>总体而言就是：</p><ol><li>使用v-bind绑定input里面的值value</li><li>使用v-on绑定input的事件</li></ol><h2 id="v-model结合其他类型使用"><a href="#v-model结合其他类型使用" class="headerlink" title="v-model结合其他类型使用"></a>v-model结合其他类型使用</h2><p>v-model还可用于其他场景，这里列举几个案例</p><h3 id="v-model结合radio使用"><a href="#v-model结合radio使用" class="headerlink" title="v-model结合radio使用"></a>v-model结合radio使用</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>male<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>male<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>男<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>男            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>female<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>female<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>女<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>女            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{sex}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    sex<span class="token punctuation">:</span><span class="token string">'还没选择性别'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="v-model结合checkbox使用"><a href="#v-model结合checkbox使用" class="headerlink" title="v-model结合checkbox使用"></a>v-model结合checkbox使用</h3><p>CheckBox分为单选框和多选框</p><h4 id="单选框"><a href="#单选框" class="headerlink" title="单选框"></a>单选框</h4><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 单选框 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>agree<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>agree<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isAgree<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>同意协议            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>你选择的是{{isAgree}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">:disabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>!isAgree<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>下一步<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    isAgree<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h4 id="多选框"><a href="#多选框" class="headerlink" title="多选框"></a>多选框</h4><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 多选框 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>唱<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hobbies<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>唱            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>跳<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hobbies<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>跳            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rap<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hobbies<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>rap            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>music<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hobbies<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>music            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>你的爱好是{{hobbies}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    hobbies<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="选择框的使用"><a href="#选择框的使用" class="headerlink" title="选择框的使用"></a>选择框的使用</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 单选 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>abc<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fruit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>苹果<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>苹果<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>香蕉<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>香蕉<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>榴莲<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>榴莲<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>葡萄<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>葡萄<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{fruit}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 多选 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>abc<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fruits<span class="token punctuation">"</span></span> <span class="token attr-name">multiple</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>苹果<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>苹果<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>香蕉<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>香蕉<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>榴莲<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>榴莲<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>葡萄<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>葡萄<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{fruits}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>                    fruit<span class="token punctuation">:</span><span class="token string">'香蕉'</span><span class="token punctuation">,</span>                    fruits<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h2 id="v-model修饰符"><a href="#v-model修饰符" class="headerlink" title="v-model修饰符"></a>v-model修饰符</h2><h4 id="懒加载（v-model-lazy）"><a href="#懒加载（v-model-lazy）" class="headerlink" title="懒加载（v-model.lazy）"></a>懒加载（v-model.lazy）</h4><p>懒加载也就是敲了回车的时候值才会被绑定</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 不是实时绑定了，在敲回车的时候才去绑定message的值，lazy修饰符只会在失去焦点和回车的时候才会去绑定 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model.lazy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>            {{message}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="v-model-number"><a href="#v-model-number" class="headerlink" title="v-model.number"></a>v-model.number</h3><p>input输入框输入的值，默认都是string类型，v-model-number可以把string类型转换为number类型</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 输入框默认输入的就是String类型 --></span>            <span class="token comment" spellcheck="true">&lt;!-- &lt;input type="number" v-model="age" /> --></span>            <span class="token comment" spellcheck="true">&lt;!-- 所以要修改成为number类型才可以 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>number<span class="token punctuation">"</span></span> <span class="token attr-name">v-model.number</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{age}}-{{typeof age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>                    age<span class="token punctuation">:</span><span class="token string">''</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="v-model-trim修饰符"><a href="#v-model-trim修饰符" class="headerlink" title="v-model trim修饰符"></a>v-model trim修饰符</h3><p>trim去除两边的空格</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- 也就是双向绑定 --></span><span class="token comment" spellcheck="true">&lt;!--            &lt;input type="text" v-model="name" />--></span>            <span class="token comment" spellcheck="true">&lt;!-- 默认是不开启去除两边空格的，无论在输入框的左边还是右边输入空格都会显示在console.log --></span>            <span class="token comment" spellcheck="true">&lt;!-- 使用trim修饰符就可以免去空格了 --></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model.trim</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            {{name}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">,</span>                    name<span class="token punctuation">:</span><span class="token string">''</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue组件化的使用</title>
      <link href="/2019/12/20/vue-zhong-de-zu-jian-hua/"/>
      <url>/2019/12/20/vue-zhong-de-zu-jian-hua/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="组件化的最基本使用"><a href="#组件化的最基本使用" class="headerlink" title="组件化的最基本使用"></a>组件化的最基本使用</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 以下这种方法在Vue2.X是看不到了，基本上都是使用语法糖去写 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">//1.创建组件</span>            <span class="token keyword">const</span> cpnC <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                template<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`                &lt;div>                    &lt;h2>我是标题&lt;/h2>                    &lt;p>我是内容hhhhhhhhh&lt;/p>                &lt;/div>`</span></span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//2.注册组件（全局组件）</span>            Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'my-cpn'</span><span class="token punctuation">,</span>cpnC<span class="token punctuation">)</span>            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>组件化的最基本使用的步骤就是：</p><ol><li>创建组件</li><li>注册组件</li><li>使用组件</li></ol><p>现在Vue的版本的源码已经发布到3.0了，等正式发布还需要一段时间，以前老版本使用的是上面代码的写法，但是实际上使用的方法还是如上代码的写法，只是写法更简单了而已</p><h2 id="全局组件和局部组件"><a href="#全局组件和局部组件" class="headerlink" title="全局组件和局部组件"></a>全局组件和局部组件</h2><h3 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h3><p>如上代码的写法是用全局组件去注册的，也就是所有组件都可用，如下代码所示：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 以下这种方法在Vue2.X是看不到了，基本上都是使用语法糖去写 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app2<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">//1.创建组件</span>            <span class="token keyword">const</span> cpnC <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                template<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`                &lt;div>                    &lt;h2>我是标题&lt;/h2>                    &lt;p>我是内容hhhhhhhhh&lt;/p>                &lt;/div>`</span></span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//2.注册组件</span>            Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'my-cpn'</span><span class="token punctuation">,</span>cpnC<span class="token punctuation">)</span>            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">const</span> app2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app2'</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>通过控制台一看，即使是在app里面注册的，在app2都还是可以用的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191220160539.png" alt=""></p><h3 id="局部组件"><a href="#局部组件" class="headerlink" title="局部组件"></a>局部组件</h3><p>如果要使用局部组件的话，那么就要在app里面注册一个局部组件</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 以下这种方法在Vue2.X是看不到了，基本上都是使用语法糖去写 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app2<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">//1.创建组件</span>            <span class="token keyword">const</span> cpnC <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                template<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`&lt;div>                    &lt;h2>我是标题&lt;/h2>                    &lt;p>我是内容hhhhhhhhh&lt;/p>                &lt;/div>`</span></span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//2.注册组件(这个是全局组件，也就是意味着能在多个Vue的实例化下使用)</span>            <span class="token comment" spellcheck="true">// Vue.component('cpn',cpnC)</span>            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                components<span class="token punctuation">:</span><span class="token punctuation">{</span>                    cpn <span class="token punctuation">:</span> cpnC                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">const</span> app2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app2'</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191220160725.png" alt=""></p><h2 id="父子组件的使用"><a href="#父子组件的使用" class="headerlink" title="父子组件的使用"></a>父子组件的使用</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 以下这种方法在Vue2.X是看不到了，基本上都是使用语法糖去写 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">// 创建组件1:子组件</span>            <span class="token keyword">const</span> cpnC1 <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                template<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`&lt;div>                    &lt;h2>我是标题1&lt;/h2>                    &lt;p>我是内容11111111&lt;/p>                &lt;/div>`</span></span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">// 创建组件2:父组件</span>            <span class="token keyword">const</span> cpnC2 <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                template<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`&lt;div>                    &lt;h2>我是标题2&lt;/h2>                    &lt;p>我是内容222222222&lt;/p>                    &lt;cpn1>&lt;/cpn1>                &lt;/div>`</span></span>                <span class="token punctuation">,</span>                components<span class="token punctuation">:</span><span class="token punctuation">{</span>                    cpn1<span class="token punctuation">:</span>cpnC1                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//root组件</span>            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                components<span class="token punctuation">:</span><span class="token punctuation">{</span>                    cpn <span class="token punctuation">:</span> cpnC2                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191220161941.png" style="zoom:50%;" /><p>这个其实在使用过程中，子组件就已经被编译好了，因为在编译cpn2的时候发现有个cpn1，如果在局部组件发现没有cpn1，那么就去全局组件里面找</p><h2 id="组件注册的语法糖写法"><a href="#组件注册的语法糖写法" class="headerlink" title="组件注册的语法糖写法"></a>组件注册的语法糖写法</h2><h3 id="全局注册的语法糖写法"><a href="#全局注册的语法糖写法" class="headerlink" title="全局注册的语法糖写法"></a>全局注册的语法糖写法</h3><p>可以用Vue新版本的语法糖写法， 省去extend的步骤来去注册组件</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">// const cpnC = Vue.extend()</span>            <span class="token comment" spellcheck="true">// 1.注册全局组件的语法糖</span>            Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'cpn'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>                template<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`&lt;div>                    &lt;h2>我是标题&lt;/h2>                    &lt;p>我是内容hhhhhhhhh&lt;/p>                &lt;/div>`</span></span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><h3 id="局部组件注册的语法糖"><a href="#局部组件注册的语法糖" class="headerlink" title="局部组件注册的语法糖"></a>局部组件注册的语法糖</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn2</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token comment" spellcheck="true">// 注册局部组件的语法糖</span>                components<span class="token punctuation">:</span><span class="token punctuation">{</span>                    <span class="token string">'cpn2'</span><span class="token punctuation">:</span><span class="token punctuation">{</span>                        template<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`&lt;div>&lt;h2>标题2&lt;/h2>&lt;/div>`</span></span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><h2 id="组件模板的分离写法"><a href="#组件模板的分离写法" class="headerlink" title="组件模板的分离写法"></a>组件模板的分离写法</h2><p>上面代码看起来就很乱，在js里面添加html的代码看起来十分的不美观，这里介绍把html代码分离出去的写法</p><h3 id="方法1：把代码写到script里面"><a href="#方法1：把代码写到script里面" class="headerlink" title="方法1：把代码写到script里面"></a>方法1：把代码写到script里面</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn1</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 写法1，使用script --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/x-template<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn1<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token operator">&lt;</span>div<span class="token operator">></span>                <span class="token operator">&lt;</span>h2<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'cpn1'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>                template<span class="token punctuation">:</span><span class="token string">'#cpn1'</span><span class="token punctuation">,</span>                <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span><span class="token punctuation">{</span>                        title<span class="token punctuation">:</span><span class="token string">'abc'</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="方法2：写到template里面"><a href="#方法2：写到template里面" class="headerlink" title="方法2：写到template里面"></a>方法2：写到template里面</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn2</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- template标签 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn2<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>我是方法二的标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'cpn2'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>                template<span class="token punctuation">:</span><span class="token string">'#cpn2'</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h2 id="组件数据存放的问题"><a href="#组件数据存放的问题" class="headerlink" title="组件数据存放的问题"></a>组件数据存放的问题</h2><p>上面代码都是写死的，如果每个组件都需要有自己的值的话就需要在注册的时候添加自己的data值</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'cpn'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>                template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>                <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span><span class="token punctuation">{</span>                        title<span class="token punctuation">:</span><span class="token string">'abc'</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>这里的data不能是个对象类型，不然会报错，如下错误代码所示：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>cpn<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'cpn'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>                template<span class="token punctuation">:</span><span class="token string">'#cpn'</span><span class="token punctuation">,</span>                <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    title<span class="token punctuation">:</span><span class="token string">'abc'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>![image-20191220164939991](C:\Users\LY\Pictures\Camera Roll\image-20191220164939991.png)</p><p>因为如果直接这样写</p><pre><code>data(){}</code></pre><p>这样不明摆着就是一个ES6语法来写的增强函数吗，所以这个要添加个返回值才可以</p><h3 id="为什么data必须设计成一个函数"><a href="#为什么data必须设计成一个函数" class="headerlink" title="为什么data必须设计成一个函数"></a>为什么data必须设计成一个函数</h3><p>详情看：<a href="https://www.bilibili.com/video/av59594689?p=57" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?p=57</a></p><p>这里拿个加减法的变量来演示</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 1. 那么问题就来了，那么多个组件，理论上来说应该是公用一个counter对象，但是一个选择的加减，另外的两个都不变 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpn</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpn</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cpn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>当前计数：{{counter}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>add<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sub<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'cpn'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                template<span class="token punctuation">:</span> <span class="token string">'#cpn'</span><span class="token punctuation">,</span>                <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// 2.问题就在这,每次调用一个对象的时候,都会调用一个data函数,每次调用的时候都会给他一个新的值</span>                    <span class="token keyword">return</span> <span class="token punctuation">{</span>                        counter<span class="token punctuation">:</span> <span class="token number">0</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'add被执行'</span><span class="token punctuation">)</span>                        <span class="token keyword">this</span><span class="token punctuation">.</span>counter<span class="token operator">++</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"减法被执行"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token keyword">this</span><span class="token punctuation">.</span>counter<span class="token operator">--</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>这里的代码是有个返回值的，如果没有返回值的话，那么每个count+1的时候。每个count都+1了，因为他们作用域是同一个，而return的话，每次都有一个新的对象返回</p><p>如代码所示：</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>            <span class="token keyword">const</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>                name<span class="token punctuation">:</span><span class="token string">'LY'</span><span class="token punctuation">,</span>                age<span class="token punctuation">:</span><span class="token number">21</span>            <span class="token punctuation">}</span>            <span class="token keyword">function</span> <span class="token function">abc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> obj            <span class="token punctuation">}</span>            <span class="token keyword">let</span> obj1<span class="token operator">=</span><span class="token function">abc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">let</span> obj2<span class="token operator">=</span><span class="token function">abc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">let</span> obj3<span class="token operator">=</span><span class="token function">abc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            obj1<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'LL'</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj3<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>每个实例化后的值的返回值都是一样的，如果obj1修改了其中的一个属性，那么全部obj2和obj3的属性都会发生修改，因为他们的作用域是一样的。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为什么要使用computed</title>
      <link href="/2019/12/19/computed/"/>
      <url>/2019/12/19/computed/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="计算属性的基本使用"><a href="#计算属性的基本使用" class="headerlink" title="计算属性的基本使用"></a>计算属性的基本使用</h2><p>计算属性在我们要拼接属性的时候可以用到，比如要拼接两个姓氏和名字</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            {{fullName}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    name<span class="token punctuation">:</span><span class="token string">'ly'</span><span class="token punctuation">,</span>                    age<span class="token punctuation">:</span><span class="token number">21</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                computed<span class="token punctuation">:</span><span class="token punctuation">{</span>                    fullName<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">' 空格 '</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>age                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>虽然说methods方法也可以，但是如果用methods方法的话要在里面加个括号，比如</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            {{getfullname()}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    name<span class="token punctuation">:</span><span class="token string">'ly'</span><span class="token punctuation">,</span>                    age<span class="token punctuation">:</span><span class="token number">21</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                methods<span class="token punctuation">:</span><span class="token punctuation">{</span>                    getfullname<span class="token punctuation">:</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">' 空格 '</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>age                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>但是这样就要使用到括号，我们想要一个属性结果但是显示的是一个函数这样就会显得…（emmm强行解释一波）</p><p>此外计算属性computed还可以用在计算类的情景上面</p><h2 id="计算属性的复杂应用"><a href="#计算属性的复杂应用" class="headerlink" title="计算属性的复杂应用"></a>计算属性的复杂应用</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{totalprice}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    books<span class="token punctuation">:</span><span class="token punctuation">[</span>                        <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'book1'</span><span class="token punctuation">,</span>price<span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                        <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'book2'</span><span class="token punctuation">,</span>price<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                        <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'book3'</span><span class="token punctuation">,</span>price<span class="token punctuation">:</span><span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                        <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'book4'</span><span class="token punctuation">,</span>price<span class="token punctuation">:</span><span class="token number">400</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                    <span class="token punctuation">]</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                computed<span class="token punctuation">:</span><span class="token punctuation">{</span>                    totalprice<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">let</span> res<span class="token operator">=</span><span class="token number">0</span>                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>books<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            res <span class="token operator">+</span><span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>books<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>price                        <span class="token punctuation">}</span>                        <span class="token keyword">return</span> res                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>如代码所示，通常用在这个方面的情景上，因为计算属性是有缓存的，计算一次之后vue就会把它缓存，第二次使用就可以调用缓存来使用了，这个在下面有说</p><h2 id="计算属性computed的本质"><a href="#计算属性computed的本质" class="headerlink" title="计算属性computed的本质"></a>计算属性computed的本质</h2><p>computed的一般使用方法是</p><pre><code>fullname(){}</code></pre><p>这个其实只是计算属性的简写</p><p>他的本质是有一个set和一个get方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191219150354.png" alt=""></p><p>因为一般只用到一个get方法，所以就简写成</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191219150450.png" alt=""></p><p>如果一定要使用set方法也可以的，比如在控制台或者其他需要修改计算属性的时候就可以调用到set方法</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    {{fullname}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>        data<span class="token punctuation">:</span><span class="token punctuation">{</span>            firname<span class="token punctuation">:</span><span class="token string">'lly'</span><span class="token punctuation">,</span>            lastname<span class="token punctuation">:</span><span class="token string">'yyl'</span><span class="token punctuation">,</span>            message<span class="token punctuation">:</span><span class="token string">'hello'</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        computed<span class="token punctuation">:</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 1. 就是因为一般是没有set方法的,所以默认是只读操作get的,等同于如下代码</span>            <span class="token comment" spellcheck="true">// fullname:function(){</span>            <span class="token comment" spellcheck="true">//     return this.firname+' '+ this.lastname</span>            <span class="token comment" spellcheck="true">// }</span>            <span class="token comment" spellcheck="true">//2.计算属性共有两个方法</span>            <span class="token comment" spellcheck="true">// fullname:{</span>            <span class="token comment" spellcheck="true">//     set(){</span>            <span class="token comment" spellcheck="true">//         //而默认只要实现get方法就好了，set方法是不需要实现的，也不想别人有一个set方法</span>            <span class="token comment" spellcheck="true">//     },</span>            <span class="token comment" spellcheck="true">//     get(){</span>            <span class="token comment" spellcheck="true">//         //默认使用的就是get方法，所以浏览器显示的是abc</span>            <span class="token comment" spellcheck="true">//         return this.firname+' '+ this.lastname</span>            <span class="token comment" spellcheck="true">//     }</span>            <span class="token comment" spellcheck="true">// }</span>            <span class="token comment" spellcheck="true">//3.而不要set方法也不会被报错</span>            <span class="token comment" spellcheck="true">// fullname:{</span>            <span class="token comment" spellcheck="true">//     get(){</span>            <span class="token comment" spellcheck="true">//         //默认使用的就是get方法，所以浏览器显示的是abc</span>            <span class="token comment" spellcheck="true">//         return this.firname+' '+ this.lastname</span>            <span class="token comment" spellcheck="true">//     }</span>            <span class="token comment" spellcheck="true">// }</span>            <span class="token comment" spellcheck="true">//4.所以最终版是可以这样的，fullname:function就是get方法</span>            <span class="token comment" spellcheck="true">// fullname:function(){</span>            <span class="token comment" spellcheck="true">//     return this.firname+' '+ this.lastname</span>            <span class="token comment" spellcheck="true">// }</span>            <span class="token comment" spellcheck="true">//5.如果实在是要使用set方法的话，也是可以实现的</span>            <span class="token comment" spellcheck="true">//然后在浏览器的控制台实现app.fullname = 'abc'</span>            <span class="token comment" spellcheck="true">//就可以打印---set方法实现--，但是这个一般要用的话都是要加入一个变量来保存变量来改变值的，如第六点所示</span>            <span class="token comment" spellcheck="true">// fullname:{</span>            <span class="token comment" spellcheck="true">//     set(){</span>            <span class="token comment" spellcheck="true">//         console.log('---set方法实现--')</span>            <span class="token comment" spellcheck="true">//     },</span>            <span class="token comment" spellcheck="true">//     get(){</span>            <span class="token comment" spellcheck="true">//         //默认使用的就是get方法，所以浏览器显示的是abc</span>            <span class="token comment" spellcheck="true">//         return this.firname+' '+ this.lastname</span>            <span class="token comment" spellcheck="true">//     }</span>            <span class="token comment" spellcheck="true">// }</span>            <span class="token comment" spellcheck="true">//6.使用新的值去代替原来的值</span>            fullname<span class="token punctuation">:</span><span class="token punctuation">{</span>                <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">const</span> names <span class="token operator">=</span> newValue<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>firname <span class="token operator">=</span> names<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>lastname <span class="token operator">=</span> names<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">//默认使用的就是get方法，所以浏览器显示的是abc</span>                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firname<span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastname                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>这里我直接用控制台去修改变量</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191219151013.png" alt=""></p><p>控制台调用app.fullname(我的计算属性名字就可以调用到set方法</p><h2 id="计算属性computed的缓存"><a href="#计算属性computed的缓存" class="headerlink" title="计算属性computed的缓存"></a>计算属性computed的缓存</h2><p>虽然很多地方methods方法也可以同样实现，但是我们一般使用的都是computed方法，因为computed方法有缓存，如果要计算的值是一样的话vue会添加到缓存里面，第二次调用就会直接去调用缓存，而不用去第二次计算</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--&amp;lt;!&amp;ndash;            方法1：直接拼接字符串(语法过于繁琐)&amp;ndash;&amp;gt;--></span><span class="token comment" spellcheck="true">&lt;!--            &lt;h2>{{firname}} {{lastname}}&lt;/h2>--></span><span class="token comment" spellcheck="true">&lt;!--&amp;lt;!&amp;ndash;            方法2：使用methods方法调用(于情不通，要显示的是属性，但是这个是方法,而且是每次调用都要初始化)&amp;ndash;&amp;gt;--></span><span class="token comment" spellcheck="true">&lt;!--            &lt;h2>{{getfullname()}}&lt;/h2>--></span><span class="token comment" spellcheck="true">&lt;!--&amp;lt;!&amp;ndash;            方法3:使用computed方法调用&amp;ndash;&amp;gt;--></span><span class="token comment" spellcheck="true">&lt;!--            &lt;h2>{{fullname}}&lt;/h2>--></span>            <span class="token comment" spellcheck="true">&lt;!-- 计算方法只被调用一次，剩下的都是靠缓存区编写 --></span>            {{getfullname()}}            {{getfullname()}}            {{getfullname()}}            {{fullname}}            {{fullname}}            {{fullname}}<span class="token comment" spellcheck="true">&lt;!--            方法每次都要调用，但是计算属性只调用一次--></span><span class="token comment" spellcheck="true">&lt;!--            所以理所当然计算属性的性能更高，这里虽然看不出来，但是如果是methods方法有很多for方法，那么如果每次都要调用一次的话性能就很低了--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span><span class="token punctuation">{</span>                    firname<span class="token punctuation">:</span><span class="token string">'lly'</span><span class="token punctuation">,</span>                    lastname<span class="token punctuation">:</span><span class="token string">'yyl'</span><span class="token punctuation">,</span>                    message<span class="token punctuation">:</span><span class="token string">'hello'</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                methods<span class="token punctuation">:</span><span class="token punctuation">{</span>                    getfullname<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'方法属性调用'</span><span class="token punctuation">)</span>                        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firname<span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastname                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                computed<span class="token punctuation">:</span><span class="token punctuation">{</span>                    fullname<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'计算方法调用'</span><span class="token punctuation">)</span>                        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firname<span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastname                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>如上面代码所示，控制台的打印出来的结果是</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191219152147.png" alt=""></p><p>只要fullname的firname和lastname两个属性的值不变，那么就只调用一次</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>v-for里面的:key作用</title>
      <link href="/2019/12/19/v-for-de-key/"/>
      <url>/2019/12/19/v-for-de-key/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="性能优化问题"><a href="#性能优化问题" class="headerlink" title="性能优化问题"></a>性能优化问题</h2><p>v-for里面有个key属性，这里拿个案例来说明</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- app.movie.splice(2,0,'异度空间')  --></span>            <span class="token comment" spellcheck="true">&lt;!-- 默认的插入算法是如果要在第二个插入新的值，就把新的值的ID改成2，第三个原来的ID改为原来的第二个值，依次替换下去，效率极低 --></span>            <span class="token comment" spellcheck="true">&lt;!-- 使用diff算法效率才是最高的，也就是在第二个插入的数据他的ID是7，时间复杂度就是O(1) --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>                <span class="token comment" spellcheck="true">&lt;!-- key里面数据一定要保证唯一性，要与值一一对应 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    {{item}}                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    cindex<span class="token punctuation">:</span> <span class="token number">0</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>splice(2,0,’异度空间’)的意思就是从下标为2后面插入异度空间</p><p>Vue渲染页面是通过一个虚拟DOM间接去去渲染页面的，大概的结构图如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191219220248.png" alt=""></p><p><strong>中间的就是虚拟DOM，如果要从下标2开始直接插入的话，那么从第二个开始的下标就会发生改变，新插入的值变成下标3，剩下的下标依次往下重新排序，这样的时间复杂度极大。</strong></p><p>最理想的排序应该是新插入的值以新的下标去排序，如图：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191219220526.png" alt=""></p><p>这样时间复杂度就为1，这个可以通过<code>diff</code>算法来实现这个目的，在代码中实现也就是要在每个for循环里面添加一个<code>:key</code>，这个值要为遍历循环的值，比如代码所示：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- app.movie.splice(2,0,'异度空间')  --></span>            <span class="token comment" spellcheck="true">&lt;!-- 默认的插入算法是如果要在第二个插入新的值，就把新的值的ID改成2，第三个原来的ID改为原来的第二个值，依次替换下去，效率极低 --></span>            <span class="token comment" spellcheck="true">&lt;!-- 使用diff算法效率才是最高的，也就是在第二个插入的数据他的ID是7，时间复杂度就是O(1) --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>                <span class="token comment" spellcheck="true">&lt;!-- key里面数据一定要保证唯一性，要与值一一对应 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    {{item}}                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    cindex<span class="token punctuation">:</span> <span class="token number">0</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><code>:key</code>里面的值要跟双括号里面的值一样，因为遍历的是item，所以<code>:key</code>的值也应该为item。这样就可以使用<code>diff</code>算法来优化代码了</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue数组中的响应式</title>
      <link href="/2019/12/19/shu-zu-zhong-de-xiang-ying-shi/"/>
      <url>/2019/12/19/shu-zu-zhong-de-xiang-ying-shi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="有响应式的方法"><a href="#有响应式的方法" class="headerlink" title="有响应式的方法"></a>有响应式的方法</h2><p>Vue里面并不是所有修改值都有一个响应式</p><p>这里先介绍有响应式的方法：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>                    {{item}}                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                按钮            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    cindex<span class="token punctuation">:</span> <span class="token number">0</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                methods<span class="token punctuation">:</span><span class="token punctuation">{</span>                    <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="push方法"><a href="#push方法" class="headerlink" title="push方法"></a>push方法</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>                    {{item}}                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                按钮            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    cindex<span class="token punctuation">:</span> <span class="token number">0</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                methods<span class="token punctuation">:</span><span class="token punctuation">{</span>                    <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">// 1.push方法:是有响应式的</span>                        <span class="token keyword">this</span><span class="token punctuation">.</span>movie<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'异度空间'</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="pop方法-删除数组中的最后一个元素"><a href="#pop方法-删除数组中的最后一个元素" class="headerlink" title="pop方法(删除数组中的最后一个元素)"></a>pop方法(删除数组中的最后一个元素)</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>            {{item}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        按钮    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 1.push方法:是有响应式的</span>        <span class="token comment" spellcheck="true">// this.movie.push('异度空间')</span>        <span class="token comment" spellcheck="true">// 2.通过索引修改数组的元素</span>        <span class="token comment" spellcheck="true">// 使用app.movie查看发现没有响应,所以直接修改索引是没有发生响应的</span>        <span class="token comment" spellcheck="true">// this.movie[0]='英雄本色';</span>        <span class="token comment" spellcheck="true">//pop有响应式</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>movie<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>pop方法也是有响应式的</p><h3 id="shift方法-删除数组中的第一个元素"><a href="#shift方法-删除数组中的第一个元素" class="headerlink" title="shift方法(删除数组中的第一个元素)"></a>shift方法(删除数组中的第一个元素)</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>            {{item}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        按钮    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 1.push方法:是有响应式的</span>        <span class="token comment" spellcheck="true">// this.movie.push('异度空间')</span>        <span class="token comment" spellcheck="true">// 2.通过索引修改数组的元素</span>        <span class="token comment" spellcheck="true">// 使用app.movie查看发现没有响应,所以直接修改索引是没有发生响应的</span>        <span class="token comment" spellcheck="true">// this.movie[0]='英雄本色';</span>        <span class="token comment" spellcheck="true">//pop有响应式</span>        <span class="token comment" spellcheck="true">// this.movie.pop()</span>        <span class="token comment" spellcheck="true">//shift有响应式</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>movie<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="unshift方法-在数组第一个元素添加数据"><a href="#unshift方法-在数组第一个元素添加数据" class="headerlink" title="unshift方法(在数组第一个元素添加数据)"></a>unshift方法(在数组第一个元素添加数据)</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>            {{item}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        按钮    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 1.push方法:是有响应式的</span>        <span class="token comment" spellcheck="true">// this.movie.push('异度空间')</span>        <span class="token comment" spellcheck="true">// 2.通过索引修改数组的元素</span>        <span class="token comment" spellcheck="true">// 使用app.movie查看发现没有响应,所以直接修改索引是没有发生响应的</span>        <span class="token comment" spellcheck="true">// this.movie[0]='英雄本色';</span>        <span class="token comment" spellcheck="true">//pop有响应式</span>        <span class="token comment" spellcheck="true">// this.movie.pop()</span>        <span class="token comment" spellcheck="true">//shift有响应式</span>        <span class="token comment" spellcheck="true">// this.movie.shift()</span>        <span class="token comment" spellcheck="true">//unshift有响应式</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>movie<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token string">'枪王'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="spilt方法"><a href="#spilt方法" class="headerlink" title="spilt方法"></a>spilt方法</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>            {{item}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        按钮    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 1.push方法:是有响应式的</span>        <span class="token comment" spellcheck="true">// this.movie.push('异度空间')</span>        <span class="token comment" spellcheck="true">// 2.通过索引修改数组的元素</span>        <span class="token comment" spellcheck="true">// 使用app.movie查看发现没有响应,所以直接修改索引是没有发生响应的</span>        <span class="token comment" spellcheck="true">// this.movie[0]='英雄本色';</span>        <span class="token comment" spellcheck="true">//pop有响应式</span>        <span class="token comment" spellcheck="true">// this.movie.pop()</span>        <span class="token comment" spellcheck="true">//shift有响应式</span>        <span class="token comment" spellcheck="true">// this.movie.shift()</span>        <span class="token comment" spellcheck="true">//unshift有响应式</span>        <span class="token comment" spellcheck="true">// this.movie.unshift('枪王')</span>        <span class="token comment" spellcheck="true">//spilt有响应式</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>movie<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'家有喜事'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>spilt方法也肯定是有响应式的，具体方法可以看源码</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191219234049.png" alt=""></p><p>…items就是可以接受多个参数的意思，类似于python中的不定长参数</p><h3 id="sort和reverse方法都是响应式的"><a href="#sort和reverse方法都是响应式的" class="headerlink" title="sort和reverse方法都是响应式的"></a>sort和reverse方法都是响应式的</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>            {{item}}        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        按钮    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>      movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>      <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 1.push方法:是有响应式的</span>        <span class="token comment" spellcheck="true">// this.movie.push('异度空间')</span>        <span class="token comment" spellcheck="true">// 2.通过索引修改数组的元素</span>        <span class="token comment" spellcheck="true">// 使用app.movie查看发现没有响应,所以直接修改索引是没有发生响应的</span>        <span class="token comment" spellcheck="true">// this.movie[0]='英雄本色';</span>        <span class="token comment" spellcheck="true">//pop有响应式</span>        <span class="token comment" spellcheck="true">// this.movie.pop()</span>        <span class="token comment" spellcheck="true">//shift有响应式</span>        <span class="token comment" spellcheck="true">// this.movie.shift()</span>        <span class="token comment" spellcheck="true">//unshift有响应式</span>        <span class="token comment" spellcheck="true">// this.movie.unshift('枪王')</span>        <span class="token comment" spellcheck="true">//spilt有响应式</span>        <span class="token comment" spellcheck="true">// this.movie.splice(1,0,'家有喜事')</span>        <span class="token comment" spellcheck="true">//sort和reverse方法</span>        <span class="token comment" spellcheck="true">// this.movie.sort()</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>movie<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="如果要用到修改索引的方式去修改值，只能使用spilt或者是Vue的方法来改变"><a href="#如果要用到修改索引的方式去修改值，只能使用spilt或者是Vue的方法来改变" class="headerlink" title="如果要用到修改索引的方式去修改值，只能使用spilt或者是Vue的方法来改变"></a>如果要用到修改索引的方式去修改值，只能使用spilt或者是Vue的方法来改变</h3><h3 id="Vue的方式"><a href="#Vue的方式" class="headerlink" title="Vue的方式"></a>Vue的方式</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>                    {{item}}                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                按钮            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    cindex<span class="token punctuation">:</span> <span class="token number">0</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                methods<span class="token punctuation">:</span><span class="token punctuation">{</span>                    <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">// 1.push方法:是有响应式的</span>                        <span class="token comment" spellcheck="true">// this.movie.push('异度空间')</span>                        <span class="token comment" spellcheck="true">// 2.通过索引修改数组的元素</span>                        <span class="token comment" spellcheck="true">// 使用app.movie查看发现没有响应,所以直接修改索引是没有发生响应的</span>                        <span class="token comment" spellcheck="true">// this.movie[0]='英雄本色'</span>                        <span class="token comment" spellcheck="true">//pop有响应式</span>                        <span class="token comment" spellcheck="true">// this.movie.pop()</span>                        <span class="token comment" spellcheck="true">//shift有响应式</span>                        <span class="token comment" spellcheck="true">// this.movie.shift()</span>                        <span class="token comment" spellcheck="true">//unshift有响应式</span>                        <span class="token comment" spellcheck="true">// this.movie.unshift('枪王')</span>                        <span class="token comment" spellcheck="true">//sort和reverse都是响应式的</span>                        <span class="token comment" spellcheck="true">// Vue的方式改变</span>                        Vue<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>movie<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'英雄本色'</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="spilt的方式"><a href="#spilt的方式" class="headerlink" title="spilt的方式"></a>spilt的方式</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>                    {{item}}                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                按钮            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    cindex<span class="token punctuation">:</span> <span class="token number">0</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                methods<span class="token punctuation">:</span><span class="token punctuation">{</span>                    <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">// 1.push方法:是有响应式的</span>                        <span class="token comment" spellcheck="true">// this.movie.push('异度空间')</span>                        <span class="token comment" spellcheck="true">// 2.通过索引修改数组的元素</span>                        <span class="token comment" spellcheck="true">// 使用app.movie查看发现没有响应,所以直接修改索引是没有发生响应的</span>                        <span class="token comment" spellcheck="true">// this.movie[0]='英雄本色'</span>                        <span class="token comment" spellcheck="true">//pop有响应式</span>                        <span class="token comment" spellcheck="true">// this.movie.pop()</span>                        <span class="token comment" spellcheck="true">//shift有响应式</span>                        <span class="token comment" spellcheck="true">// this.movie.shift()</span>                        <span class="token comment" spellcheck="true">//unshift有响应式</span>                        <span class="token comment" spellcheck="true">// this.movie.unshift('枪王')</span>                        <span class="token comment" spellcheck="true">//sort和reverse都是响应式的</span>                        <span class="token comment" spellcheck="true">// Vue的方式改变</span>                        <span class="token comment" spellcheck="true">// Vue.set(this.movie,0,'英雄本色')</span>                        <span class="token keyword">this</span><span class="token punctuation">.</span>movile<span class="token punctuation">.</span><span class="token function">spilt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'枪王'</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h2 id="没有响应式的方法"><a href="#没有响应式的方法" class="headerlink" title="没有响应式的方法"></a>没有响应式的方法</h2><h3 id="通过索引修改数组元素"><a href="#通过索引修改数组元素" class="headerlink" title="通过索引修改数组元素"></a>通过索引修改数组元素</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in movie<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>                    {{item}}                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnclick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                按钮            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../js/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>                data<span class="token punctuation">:</span> <span class="token punctuation">{</span>                    movie<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'霸王别姬'</span><span class="token punctuation">,</span> <span class="token string">'阿飞正传'</span><span class="token punctuation">,</span> <span class="token string">'胭脂扣'</span><span class="token punctuation">,</span> <span class="token string">'英雄本色'</span><span class="token punctuation">,</span> <span class="token string">'新上海滩'</span><span class="token punctuation">,</span> <span class="token string">'东邪西毒'</span><span class="token punctuation">,</span> <span class="token string">'倩女幽魂'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    cindex<span class="token punctuation">:</span> <span class="token number">0</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                methods<span class="token punctuation">:</span><span class="token punctuation">{</span>                    <span class="token function">btnclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">// 1.push方法:是有响应式的</span>                        <span class="token comment" spellcheck="true">// this.movie.push('异度空间')</span>                        <span class="token comment" spellcheck="true">// 2.通过索引修改数组的元素</span>                        <span class="token comment" spellcheck="true">// 使用app.movie查看发现没有响应,所以直接修改索引是没有发生响应的</span>                        <span class="token keyword">this</span><span class="token punctuation">.</span>movie<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'英雄本色'</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>这个方法修改的话是没有响应式的,因为Vue的内部没有这个方法</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>runtime-compiler和runtime-only区别</title>
      <link href="/2019/11/12/runtime-only-and-runtime-compiler/"/>
      <url>/2019/11/12/runtime-only-and-runtime-compiler/</url>
      
        <content type="html"><![CDATA[<blockquote><p>在使用Vue cli2创建项目的时候，会出现选择runtime-compiler和runtime-only的选项，这里我介绍这两者的区别</p></blockquote><blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="runtime-compiler和runtime-only的区别"><a href="#runtime-compiler和runtime-only的区别" class="headerlink" title="runtime-compiler和runtime-only的区别"></a>runtime-compiler和runtime-only的区别</h2><p>两者的区别主要是在<code>main.js</code>里面</p><p><strong>runtime-compiler</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment" spellcheck="true">/* eslint-disable no-new */</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span><span class="token punctuation">,</span>  template<span class="token punctuation">:</span> <span class="token string">'&lt;App/>'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><strong>runtime-only</strong></p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  render<span class="token punctuation">:</span> h <span class="token operator">=</span><span class="token operator">></span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>  <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//箭头函数的本质</span>    <span class="token comment" spellcheck="true">// render:function(createElement){</span>    <span class="token comment" spellcheck="true">//   return createElement(App)</span>    <span class="token comment" spellcheck="true">// }</span>    <span class="token comment" spellcheck="true">//使用ES6语法的本质</span>    <span class="token comment" spellcheck="true">//render:h=>{</span>    <span class="token comment" spellcheck="true">//    return h(App)</span>    <span class="token comment" spellcheck="true">//      }</span><span class="token punctuation">)</span></code></pre><p>一个是使用了render箭头函数，一个是使用正常的组件注册写法</p><p>他们两个的使用的性能也是不同的</p><h2 id="两者性能区别"><a href="#两者性能区别" class="headerlink" title="两者性能区别"></a>两者性能区别</h2><p>在<strong>runtime-compiler</strong>里面运行流程如下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191112101329.png" alt=""></p><p>在template传递给Vue的时候，先在vm.options.template里面做一个保存，然后parse(解析)成一个ast（abstract syntax tree抽象语法数），然后再compile（编译）成一个render函数，最后再翻译成一个virtual dom（虚拟dom），最后再把虚拟dom树渲染成为一个真正的界面</p><p>整体来说，<strong>runtime-compiler</strong>的流程就是：<strong>template -&gt; ast -&gt; render -&gt;vdom -&gt;UI</strong></p><p>而在runtime-only中，他的流程只是render-&gt;vdom</p><p>所以runtime-only使用更少的代码去实现同样的功能，所以runtime-only性能更高</p><h2 id="runtime-only代码解析"><a href="#runtime-only代码解析" class="headerlink" title="runtime-only代码解析"></a>runtime-only代码解析</h2><p>在<strong>runtime-compiler</strong>中，使用的是正常的组件化注册</p><p>而在上面我所说的，<strong>runtime-only</strong>没有经历过template这个流程，也就是说template没有用，其原理如下：</p><p>render函数内部实现的原理是这样的</p><pre class=" language-js"><code class="language-js">  render<span class="token punctuation">:</span> h <span class="token operator">=</span><span class="token operator">></span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">//可以写成下面的写法</span>  <span class="token comment" spellcheck="true">//render函数内部实现原理</span>  render<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>createElement<span class="token punctuation">,</span><span class="token punctuation">{</span>标签的属性<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'标签的内容，比如&lt;h2>hello world&lt;/h2>里面的hello world'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'标签'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span></code></pre><p>我们可以随便使用<strong>runtime-only</strong>的main.js修改一下</p><h3 id="方法1（使用createElement注册组件）"><a href="#方法1（使用createElement注册组件）" class="headerlink" title="方法1（使用createElement注册组件）:"></a>方法1（使用createElement注册组件）:</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment" spellcheck="true">/* eslint-disable no-new */</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// render: h => h(App)</span>  <span class="token comment" spellcheck="true">//render->vdom</span>  <span class="token comment" spellcheck="true">//所以这个性能更高</span>  <span class="token comment" spellcheck="true">// 方法1</span>   render<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>createElement<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span><span class="token string">'box'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'hello world'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191112110149.png" style="zoom:50%;" /><h3 id="方法2（在里面再添加一个createElement注册组件）："><a href="#方法2（在里面再添加一个createElement注册组件）：" class="headerlink" title="方法2（在里面再添加一个createElement注册组件）："></a>方法2（在里面再添加一个createElement注册组件）：</h3><p>下面是在里面再去注册一个button组件</p><pre class=" language-js"><code class="language-js">  render<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>createElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>      <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'box'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'hello world'</span><span class="token punctuation">,</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'按钮'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191112110204.png" style="zoom:50%;" /><p>方法2就是在里面再嵌套一层createElement函数</p><h3 id="方法3（使用组件化注册）："><a href="#方法3（使用组件化注册）：" class="headerlink" title="方法3（使用组件化注册）："></a>方法3（使用组件化注册）：</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment" spellcheck="true">/* eslint-disable no-new */</span><span class="token keyword">const</span> cpn <span class="token operator">=</span> <span class="token punctuation">{</span>  template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`&lt;div>{{message}}&lt;/div>`</span></span><span class="token punctuation">,</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      message<span class="token punctuation">:</span> <span class="token string">'我是组件message'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// render: h => h(App)</span>  <span class="token comment" spellcheck="true">//render->vdom</span>  <span class="token comment" spellcheck="true">//所以这个性能更高</span>    <span class="token comment" spellcheck="true">// 方法3：使用组件去传入值</span>    render<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>createElement<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span>cpn<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这个代码运行要在webpack.base.conf里面修改配置</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191112110219.png" style="zoom:50%;" /><h3 id="方法4（使用App的组件去注册）："><a href="#方法4（使用App的组件去注册）：" class="headerlink" title="方法4（使用App的组件去注册）："></a>方法4（使用App的组件去注册）：</h3><p>这个是使用创建项目自带App.vue的hello world的界面，直接导入这个界面的模板</p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment" spellcheck="true">/* eslint-disable no-new */</span><span class="token comment" spellcheck="true">// const cpn = {</span><span class="token comment" spellcheck="true">//   template: `&lt;div>{{message}}&lt;/div>`,</span><span class="token comment" spellcheck="true">//   data() {</span><span class="token comment" spellcheck="true">//     return {</span><span class="token comment" spellcheck="true">//       message: '我是组件message'</span><span class="token comment" spellcheck="true">//     }</span><span class="token comment" spellcheck="true">//   }</span><span class="token comment" spellcheck="true">// }</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// render: h => h(App)</span>  <span class="token comment" spellcheck="true">//render->vdom</span>  <span class="token comment" spellcheck="true">//所以这个性能更高</span>    render<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>createElement<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>运行得出的结果是</p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191112110240.png" style="zoom:50%;" /><p>而runtime-only的流程只有：render-&gt;vdom，花更少的代码去运行同样的结果，所以runtime-only的性能会更高</p><p>runtime-only省去了template和ast这两部分，因为到render的时候，template组件什么的都已经渲染成为render函数了，使用代码测试一下</p><pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token comment" spellcheck="true">/* eslint-disable no-new */</span><span class="token comment" spellcheck="true">// const cpn = {</span><span class="token comment" spellcheck="true">//   template: `&lt;div>{{message}}&lt;/div>`,</span><span class="token comment" spellcheck="true">//   data() {</span><span class="token comment" spellcheck="true">//     return {</span><span class="token comment" spellcheck="true">//       message: '我是组件message'</span><span class="token comment" spellcheck="true">//     }</span><span class="token comment" spellcheck="true">//   }</span><span class="token comment" spellcheck="true">// }</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// render: h => h(App)</span>  <span class="token comment" spellcheck="true">//render->vdom</span>  <span class="token comment" spellcheck="true">//所以这个性能更高</span>    render<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>createElement<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191112110300.png" alt=""></p><p>在控制台打印出来的已经没有template这个函数了，这部分解析的是由vue-template-compiler帮我们解析好了</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript高阶函数</title>
      <link href="/2019/11/05/js-de-gao-jie-han-shu/"/>
      <url>/2019/11/05/js-de-gao-jie-han-shu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>如果我们要实现如下三个需求的话，我们可能写出的代码如下：</p><p><strong>需求1.去除所有小于100的数字</strong></p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">// 1.需求去除所有小于100的数字</span>            <span class="token keyword">const</span> nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">222</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span>            <span class="token keyword">let</span> number<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> n <span class="token keyword">of</span> nums<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    number<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><strong>需求2.将所有n&lt;100的数乘2</strong></p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">// 1.需求去除所有小于100的数字</span>            <span class="token keyword">const</span> nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">222</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span>            <span class="token keyword">let</span> number<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> n <span class="token keyword">of</span> nums<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    number<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//2.将所有n&lt;100的数*2</span>            <span class="token keyword">let</span> numbers2<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> n <span class="token keyword">of</span> number<span class="token punctuation">)</span><span class="token punctuation">{</span>                numbers2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>n<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numbers2<span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><strong>需求3.将所有的numbers的数字相加,得到最终的而结果</strong></p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">// 1.需求去除所有小于100的数字</span>            <span class="token keyword">const</span> nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">222</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span>            <span class="token keyword">let</span> number<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> n <span class="token keyword">of</span> nums<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    number<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//2.将所有n&lt;100的数*2</span>            <span class="token keyword">let</span> numbers2<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> n <span class="token keyword">of</span> number<span class="token punctuation">)</span><span class="token punctuation">{</span>                numbers2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>n<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numbers2<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//3.将所有的numbers的数字相加,得到最终的而结果</span>            <span class="token keyword">let</span> totalnum<span class="token operator">=</span><span class="token number">0</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> n <span class="token keyword">of</span> numbers2<span class="token punctuation">)</span><span class="token punctuation">{</span>                totalnum<span class="token operator">+</span><span class="token operator">=</span>n            <span class="token punctuation">}</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>totalnum<span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>上面三个写法简直就是应付外行boss的最佳选择</p><p>测试：没Bug呀</p><p>产品：功能实现了啊</p><p>考核：代码提交足行</p><p>队友：太简洁易读了</p><p>但是我们还是不能这样写，因为要写的代码太多了，如果不想被批还是得写精一点<del>~</del>所以我们对于上述情况有如下三个高阶函数的写法。这个其实跟python的很像，python也有这三个高阶函数并且还多了一个sorted函数，所以说语言其实都是互通的</p><h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><p>对于上面的<strong>第一个需求：去除所有小于100的数字</strong>，我们可以使用如下的写法</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">222</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span>            <span class="token comment" spellcheck="true">//filter函数是每一次传入的数字都会经历一次回调</span>            <span class="token comment" spellcheck="true">//filter中的回调函数有一个要求:每一次都必须返回一个boolean值,即true和false</span>            <span class="token comment" spellcheck="true">//true:当是true的时候,函数会把这次回调的n值返回到一个新的数组中</span>            <span class="token comment" spellcheck="true">//false:当是false的时候,函数会过滤掉这次的n</span>            <span class="token keyword">let</span> numbers<span class="token operator">=</span>nums<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//使用如下写法就可以使得n&lt;100的为true,然后加入新的数组</span>                <span class="token keyword">return</span> n <span class="token operator">&lt;</span><span class="token number">100</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>代码更为简洁</p><h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>对于上面的<strong>第二个需求：将所有n&lt;100的数乘2</strong></p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">222</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span>            <span class="token comment" spellcheck="true">//filter函数是每一次传入的数字都会经历一次回调</span>            <span class="token comment" spellcheck="true">//filter中的回调函数有一个要求:每一次都必须返回一个boolean值,即true和false</span>            <span class="token comment" spellcheck="true">//true:当是true的时候,函数会把这次回调的n值返回到一个新的数组中</span>            <span class="token comment" spellcheck="true">//false:当是false的时候,函数会过滤掉这次的n</span>            <span class="token keyword">let</span> numbers<span class="token operator">=</span>nums<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//使用如下写法就可以使得n&lt;100的为true,然后加入新的数组</span>                <span class="token keyword">return</span> n <span class="token operator">&lt;</span><span class="token number">100</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//map函数的使用</span>            <span class="token comment" spellcheck="true">//对于上面filter得到的结果 10 20 40 50 ,把每一次得到的结果都乘2</span>            <span class="token keyword">let</span> numbers<span class="token operator">=</span>numbers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> n<span class="token operator">*</span><span class="token number">2</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h2 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h2><p>reduce函数比前两个较为复杂</p><p>这个reduce可以有多种写法，在JS中如果写两个函数的话后面的函数会覆盖前面的函数，而可以写很多种写法是因为他用的是TypeScript</p><p>使用reduce来重写<strong>第三个需求：将所有的numbers的数字相加,得到最终的而结果</strong></p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">222</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span>            <span class="token comment" spellcheck="true">//filter函数是每一次传入的数字都会经历一次回调</span>            <span class="token comment" spellcheck="true">//filter中的回调函数有一个要求:每一次都必须返回一个boolean值,即true和false</span>            <span class="token comment" spellcheck="true">//true:当是true的时候,函数会把这次回调的n值返回到一个新的数组中</span>            <span class="token comment" spellcheck="true">//false:当是false的时候,函数会过滤掉这次的n</span>            <span class="token keyword">let</span> numbers<span class="token operator">=</span>nums<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//使用如下写法就可以使得n&lt;100的为true,然后加入新的数组</span>                <span class="token keyword">return</span> n <span class="token operator">&lt;</span><span class="token number">100</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//map函数的使用</span>            <span class="token comment" spellcheck="true">//对于上面filter得到的结果 10 20 40 50 ,把每一次得到的结果都乘2</span>            <span class="token keyword">let</span> numbers2<span class="token operator">=</span>numbers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> n<span class="token operator">*</span><span class="token number">2</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numbers2<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//reduce函数的使用</span>            <span class="token comment" spellcheck="true">//reduce函数的作用就是对数组中所有的函数进行汇总</span>            <span class="token comment" spellcheck="true">//上一次返回的值是20,40,80,100</span>            <span class="token comment" spellcheck="true">//末尾的0是初始值</span>            <span class="token keyword">var</span> total<span class="token operator">=</span>numbers2<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prevalue<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> prevalue<span class="token operator">+</span>n            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">// 第一次返回的值是 prevalue 0 + 20</span>            <span class="token comment" spellcheck="true">// 第二次返回的值是 pervalue 20 +40</span>            <span class="token comment" spellcheck="true">// 第三次返回的值是 pervalue 60 +80</span>            <span class="token comment" spellcheck="true">// 第四次返回的值是 prevalue 140+100</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h2 id="总和代码"><a href="#总和代码" class="headerlink" title="总和代码"></a>总和代码</h2><p>上面三个代码看起来都不怎么高逼格，但是合在一起写就很能装逼了</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">const</span> nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">222</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span>            <span class="token keyword">let</span> total <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> n<span class="token operator">&lt;</span><span class="token number">100</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> n<span class="token operator">*</span><span class="token number">2</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prevalue<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> prevalue<span class="token operator">+</span>n            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">//或者这样</span>            <span class="token comment" spellcheck="true">//let total = nums.filter(n=> n&lt;100).map(n=>n*2).reduce((pre,n)=>pre+n);</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 前端面试题 </tag>
            
            <tag> ES6语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>const语法</title>
      <link href="/2019/11/04/const-yu-fa/"/>
      <url>/2019/11/04/const-yu-fa/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="const定义常量"><a href="#const定义常量" class="headerlink" title="const定义常量"></a>const定义常量</h2><p>const在C和C++等语言都有定义，意为定义常量，在ES6语法中也是如此</p><p>const定义的常量之后就不可在被更改，而且在定义的时候必须定义它的值，不然会报错</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//错误写法</span><span class="token keyword">const</span> demo<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Uncaught SyntaxError: Missing initializer in const declaration</span></code></pre><p>const只是定义指向的对象不可再被更改，但是他内部的属性还是可以改变的</p><pre class=" language-js"><code class="language-js">    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>        name <span class="token punctuation">:</span> <span class="token string">"LY"</span><span class="token punctuation">,</span>        age <span class="token punctuation">:</span> <span class="token number">21</span>    <span class="token punctuation">}</span>    obj<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span></code></pre><h2 id="const的属性增强写法"><a href="#const的属性增强写法" class="headerlink" title="const的属性增强写法"></a>const的属性增强写法</h2><h3 id="属性增强写法"><a href="#属性增强写法" class="headerlink" title="属性增强写法"></a>属性增强写法</h3><p>以下拿ES5的语法来比较</p><pre class=" language-js"><code class="language-js">    <span class="token keyword">const</span> name<span class="token operator">=</span><span class="token string">"LY"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> age<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> height<span class="token operator">=</span><span class="token number">175</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>        name<span class="token punctuation">:</span>name<span class="token punctuation">,</span>        age<span class="token punctuation">:</span>age<span class="token punctuation">,</span>        height<span class="token punctuation">:</span>height    <span class="token punctuation">}</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span></code></pre><p>ES6语法：</p><pre class=" language-js"><code class="language-js">    <span class="token keyword">const</span> name<span class="token operator">=</span><span class="token string">"LY"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> age<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> height<span class="token operator">=</span><span class="token number">175</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>        name<span class="token punctuation">,</span>        age<span class="token punctuation">,</span>        height    <span class="token punctuation">}</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span></code></pre><h3 id="函数增强写法"><a href="#函数增强写法" class="headerlink" title="函数增强写法"></a>函数增强写法</h3><p>ES5</p><pre class=" language-js"><code class="language-js">    <span class="token keyword">const</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>        run<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我在跑'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span></code></pre><p>ES6</p><pre class=" language-javascript"><code class="language-javascript">    <span class="token keyword">const</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>        <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我在跑'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ES6语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>let和var的对比</title>
      <link href="/2019/11/04/let-he-var/"/>
      <url>/2019/11/04/let-he-var/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下皆是由<a href="https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853" target="_blank" rel="noopener">https://www.bilibili.com/video/av59594689?from=search&amp;seid=2169751232721048853</a></p><p>视频中的老师操作代码和讲义总结而成</p></blockquote><h2 id="var的缺陷"><a href="#var的缺陷" class="headerlink" title="var的缺陷"></a>var的缺陷</h2><p>JS的创始人也说过var定义变量的有很多的缺陷，var本身是没有作用域的，下面拿个案例来说明</p><h3 id="var在-中的块级作用域"><a href="#var在-中的块级作用域" class="headerlink" title="var在{}中的块级作用域"></a>var在{}中的块级作用域</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">// {}中的作用域</span>            <span class="token punctuation">{</span>                <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'LY'</span><span class="token punctuation">;</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>在{}内部定义的变量，在外部也能使用</p><h3 id="var在if中的作用域"><a href="#var在if中的作用域" class="headerlink" title="var在if中的作用域"></a>var在if中的作用域</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">var</span> func<span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'why'</span><span class="token punctuation">;</span>                func<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//变量是可以随时改变的,十分的不安全</span>                name <span class="token operator">=</span> <span class="token string">'LY'</span>                <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>            <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>var在if内部定义的变量在外部也能声明</p><h3 id="var在for里面的作用域"><a href="#var在for里面的作用域" class="headerlink" title="var在for里面的作用域"></a>var在for里面的作用域</h3><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token comment" spellcheck="true">//以下代码无论点击什么按钮都会显示"第五个按钮被点击"</span>            <span class="token keyword">var</span> btns<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>btns<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                btns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第'</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">'个按钮被点击'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="ES5中对于for循环作用域的解决办法：闭包"><a href="#ES5中对于for循环作用域的解决办法：闭包" class="headerlink" title="ES5中对于for循环作用域的解决办法：闭包"></a>ES5中对于for循环作用域的解决办法：闭包</h3><p>对于for循环没有作用域的问题我们可以通过闭包的办法来解决</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>按钮5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">            <span class="token keyword">var</span> btns<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>btns<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">{</span>                    btns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第'</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">'个按钮被点击'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>            <span class="token punctuation">}</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>其原理如下：</p><pre class=" language-js"><code class="language-js">    <span class="token comment" spellcheck="true">//i=0;</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//使用var的话每次定义都是在内部定义的，在for循环5次之后传下来的值是i=5，所以每次点击按钮都是5，因为var没有作用域，其实在内部和外部定义都没区别，每次循环i的值都会被改变</span>        <span class="token comment" spellcheck="true">//console.log（）里面想使用i的时候都会用到for循环改变后的i</span>        <span class="token comment" spellcheck="true">//i=0;</span>        btns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第'</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">'个按钮被点击'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//使用闭包的情况下</span>    <span class="token comment" spellcheck="true">//这个情况就简单了，因为function有自己的作用域 ，每次使用的时候只用属于自己的i，外部for循环的i怎么改变都不会改变到内部的i变量了</span>    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">{</span>        btns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第'</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">'个按钮被点击'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></code></pre><p>var定义变量其实是在{}内部定义的    </p><p>但是闭包写出来真的对整体代码而言很别扭……</p><h2 id="使用let来定义"><a href="#使用let来定义" class="headerlink" title="使用let来定义"></a>使用let来定义</h2><p>使用let来定义的话就不会出现上面的问题，因为let有块级作用域</p><pre class=" language-js"><code class="language-js">    <span class="token keyword">const</span> btns<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>btns<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        btns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第'</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">'个按钮被点击'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span></code></pre><p>ES5里面要定义函数来定义作用域，而ES6里面let可以定义自己的块级作用域</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ES6语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker基本概念（翻译）</title>
      <link href="/2019/11/01/docker-gai-nian/"/>
      <url>/2019/11/01/docker-gai-nian/</url>
      
        <content type="html"><![CDATA[<blockquote><p>参考博客：</p><p><a href="https://docker_practice.gitee.io/zh-cn/" target="_blank" rel="noopener">文档地址</a> </p><p><a href="https://juejin.im/post/5b260ec26fb9a00e8e4b031a" target="_blank" rel="noopener">大神博客</a> </p><p><a href="https://www.cnblogs.com/JulyShine/p/10415758.html" target="_blank" rel="noopener">通俗的讲解Docker</a> </p><p> <a href="https://www.cnblogs.com/misswangxing/p/10669444.html" target="_blank" rel="noopener">很通俗的解释</a> </p><p><a href="https://blog.csdn.net/qq_29301417/article/details/75640893" target="_blank" rel="noopener">https://blog.csdn.net/qq_29301417/article/details/75640893</a> </p><p><a href="https://blog.csdn.net/mythinker2/article/details/87701222" target="_blank" rel="noopener">https://blog.csdn.net/mythinker2/article/details/87701222</a> </p><p><a href="https://blog.csdn.net/qq_36330643/article/details/77160101" target="_blank" rel="noopener">https://blog.csdn.net/qq_36330643/article/details/77160101</a> </p><p><a href="https://www.cnblogs.com/yangmingxianshen/p/10129262.html" target="_blank" rel="noopener">https://www.cnblogs.com/yangmingxianshen/p/10129262.html</a> </p><p><a href="https://www.jianshu.com/p/7fd1a9655213" target="_blank" rel="noopener">https://www.jianshu.com/p/7fd1a9655213</a> </p></blockquote><h2 id="镜像-image"><a href="#镜像-image" class="headerlink" title="镜像(image)"></a>镜像(image)</h2><h3 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a>Docker镜像</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Docker镜像就像是虚拟机里面的镜像，是一个<strong>只读</strong>的模板，我们都知道，操作系统分为内核和用户空间。对于 Linux 而言，内核启动后，会挂载 <code>root</code> 文件系统为其提供用户空间支持。而 Docker 镜像（Image），就相当于是一个 <code>root</code> 文件系统。比如官方镜像 <code>ubuntu:18.04</code> 就包含了完整的一套 Ubuntu 18.04 最小系统的 <code>root</code> 文件系统。Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变 </p><h3 id="分层存储"><a href="#分层存储" class="headerlink" title="分层存储"></a>分层存储</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;因为 镜像包含了操作系统完整的 <code>root</code> 文件系统，其体积还是很巨大的，所以引入了 <code>Unios FS</code> 技术，将其设计为分层存储的架构。所以镜像不是那种 <code>ISO</code> 打包文件，镜像是一个虚拟的概念，它是由一组文件系统构成，或者说多层文件系统联合构成。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;镜像在构建时，是一层层构建，上一层是下一层的基础，每一层构建结束就不会在被修改，后一层任何修改只会作用在当前层。例如删除上一层文件，不会真的删除该文件，而是会标记删除然后隐藏起来，最终运行容器的时候不会被看见，但是会一直跟随镜像。因此构建镜像时需要小心，不要添加不需要的东西，任何额外的东西都要在本层构建完之前清除。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;分层存储使镜像的定制和复用变得容易，可以用之前做好的镜像作为基础层，然后添加新的层，定制自己所需要的东西，构建新的镜像。</p><h3 id="创建镜像"><a href="#创建镜像" class="headerlink" title="创建镜像"></a>创建镜像</h3><p>创建镜像有两种方法：</p><p>（1） 基于已有镜像的容器创建。主要是利用docker commit命令。</p><p>（2） 基于dockerfile创建。</p><p>首先按照dockerfile的格式，编写好dockerfile文件，之后通过docker build命令来创建镜像。docker build会读取制定的dockerfile，由docker服务器来创建镜像</p><h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><h3 id="概念"><a href="#概念" class="headerlink" title="　概念"></a>　概念</h3><p>镜像（Image）和容器（Conatiner）的关系就像是面向对象的类和实例一样，镜像是静态的定义，容器是镜像运行的实体，容器可以被创建，启动，停止，删除，暂停等。容器的实质是进程，但是又和宿主的进程不同，容器有自己的独立命名空间，因此容器拥有自己 root 文件系统，自己的网络配置，自己的进程空间，甚至自己的用户 ID 空间。容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立于宿主的系统下操作一样。所以好多初学者都会把容器和虚拟机搞混。容器同样和镜像一样使用分层存储，以镜像为基础层，在上面创建了一个容器存储层，是为了容器运行时读写准备的。注意，在容器被删除后，容器存储层保存的任何信息都不会保存，它和容器的生命周期一样，所以任何需要保存的数据 Docker 建议保存在数据卷（Volumes）或者宿主机目录中，这样数据不会随着容器的消失而消失。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>总的来说：</p><p> 可以把容器看做是一个简易版的 Linux 环境（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的应用程序。 </p><p> 镜像自身是自读的，容器从镜像启动的时候，docker会在镜像的最上层创建一个可写文件层，镜像本身保持不变 </p><h2 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h2><p>　　镜像构建完成后，可以很容易的在当前宿主机上运行，但是，如果需要在其它服务器上使用这个镜像，我们就需要一个集中的存储、分发镜像的服务，Docker Registry 就是这样的服务。</p><p>一个 Docker Registry 可以有多个 仓库（Repository），每个仓库可以含多个标签（Tag），每个标签都是一个镜像。</p><p>　　最初我没有搞懂 Docker Registry 和 仓库（Repository），简单来说就是 Docker Registry 是注册服务器，用于管理镜像仓库，起到服务器的作用，仓库（Repository）就是存储镜像，起到存储镜像的作用。默认的 Docker Registry 就是 Docker Hub，通过配置也可以选择华为云、阿里云、腾讯云等服务商，他们都拥有很多高质量的镜像。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191102165834.png" alt=""> </p><p>这个如果你使用过git和github就很容易理解Docker的仓库概念。Docker 仓库的概念跟Git 类似，注册服务器可以理解为 GitHub 这样的托管服务。</p><p>Docker 仓库是用来包含镜像的位置，Docker提供一个注册服务器（Register）来保存多个仓库，每个仓库又可以包含多个具备不同tag的镜像。Docker运行中使用的默认仓库是 Docker Hub 公共仓库。</p><p>仓库支持的操作类似git，当用户创建了自己的镜像之后就可以使用 push 命令将它上传到公有或者私有仓库，这样下次在另外一台机器上使用这个镜像时候，只需要从仓库上 pull 下来就可以了。.</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python高阶函数</title>
      <link href="/2019/11/01/gao-jie-han-shu/"/>
      <url>/2019/11/01/gao-jie-han-shu/</url>
      
        <content type="html"><![CDATA[<h2 id="filter-函数"><a href="#filter-函数" class="headerlink" title="filter()函数"></a>filter()函数</h2><p><strong>简单的说就是过滤函数</strong></p><p>filter()是python内置的高阶函数，filter()函数接收一个函数 f 和一list，这个函数 f 的作用是对每个元素进行判断，返回 True或 False，filter()根据判断结果自动过滤掉不符合条件的元素，返回由符合条件元素组成的新list。</p><pre class=" language-python"><code class="language-python"> filter<span class="token punctuation">(</span>function <span class="token operator">or</span> None<span class="token punctuation">,</span> sequence<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> list<span class="token punctuation">,</span> tuple<span class="token punctuation">,</span> <span class="token operator">or</span> string</code></pre><ul><li>function:接受一个参数，返回布尔值True或False</li><li>sequence:序列可以是str，tuple，list</li></ul><p>filter函数会对序列参数sequence中的每个元素调用function函数，最后返回的结果包含调用结果为<strong>True</strong>的元素。</p><p>返回值的类型和参数sequence的类型相同</p><p>这里拿个案例说明这个函数</p><pre class=" language-python"><code class="language-python">filter<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#在python中，非0为True</span><span class="token comment" spellcheck="true">#1作为x，1%2=1为True。</span><span class="token comment" spellcheck="true">#2作为x,2%2=0为Fasle。</span><span class="token comment" spellcheck="true">#3作为x，3%2=1为True</span><span class="token comment" spellcheck="true">#4作为x,4%2=0为Fasle</span>filter<span class="token punctuation">(</span>None<span class="token punctuation">,</span> <span class="token string">"she"</span><span class="token punctuation">)</span><span class="token string">'she'</span></code></pre><p>其他案例如下</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#例如，要从一个list [1, 4, 6, 7, 9, 12, 17]中删除偶数，保留奇数，首先，要编写一个判断奇数的函数：</span><span class="token keyword">def</span> <span class="token function">is_odd</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span>filter<span class="token punctuation">(</span>is_odd<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#结果[1, 7, 9, 17]</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#删除空字符串</span><span class="token keyword">def</span> <span class="token function">is_not_empty</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> s <span class="token operator">and</span> len<span class="token punctuation">(</span>s<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span>filter<span class="token punctuation">(</span>is_not_empty<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">,</span> None<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'str'</span><span class="token punctuation">,</span> <span class="token string">'  '</span><span class="token punctuation">,</span> <span class="token string">'END'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#结果['test', 'str', 'END']</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#返回1-100的所有的平方根为整数的数</span><span class="token keyword">import</span> math<span class="token keyword">def</span> <span class="token function">is_sqr</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    r <span class="token operator">=</span> int<span class="token punctuation">(</span>math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> r<span class="token operator">*</span>r<span class="token operator">==</span>x<span class="token keyword">print</span> filter<span class="token punctuation">(</span>is_sqr<span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>&emsp;</p><h2 id="map-函数"><a href="#map-函数" class="headerlink" title="map()函数"></a>map()函数</h2><p><strong>map函数会根据提供的函数对指定序列做映射</strong></p><p><strong>map()函数是python内置的高阶函数，可以把一个 list 转换为另一个 list，只需要传入转换函数</strong></p><pre class=" language-python"><code class="language-python">map<span class="token punctuation">(</span>function<span class="token punctuation">,</span> sequence<span class="token punctuation">[</span><span class="token punctuation">,</span> sequence<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> list</code></pre><ul><li>function:是一个函数</li><li>sequence:是一个或多个序列,取决于function需要几个参数</li><li>返回值是一个list</li></ul><p>案例如下：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#函数需要一个参数</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token operator">*</span>x<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#这里就是把1作为x，然后拿x平方</span><span class="token comment" spellcheck="true">#2作为x，然后拿x去平方</span><span class="token comment" spellcheck="true">#3作为x，然后拿3去平方。</span><span class="token comment" spellcheck="true">#所以结果为:[1, 4, 9]</span><span class="token comment" spellcheck="true">#函数需要两个参数</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x<span class="token operator">+</span>y<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#取出1和4，然后拿1和4相加。</span><span class="token comment" spellcheck="true">#取出2和5，然后拿2和5相加。</span><span class="token comment" spellcheck="true">#取出3和6，然后拿3和6相加。</span><span class="token comment" spellcheck="true">#结果为:[5, 7, 9]</span><span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span> x<span class="token punctuation">,</span> y <span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token keyword">return</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>l1 <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">]</span>  l2 <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'Sun'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">,</span> <span class="token string">'W'</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'S'</span> <span class="token punctuation">]</span>l3 <span class="token operator">=</span> map<span class="token punctuation">(</span> f1<span class="token punctuation">,</span> l1<span class="token punctuation">,</span> l2 <span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>l3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#结果为:[(0, 'Sun'), (1, 'M'), (2, 'T'), (3, 'W'), (4, 'T'), (5, 'F'), (6, 'S')]</span></code></pre><p>其余案例如下：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#把[1, 2, 3, 4, 5, 6, 7, 8, 9]每个都平方</span><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> x<span class="token operator">*</span>x<span class="token keyword">print</span> map<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#把首字母大写，其余的小写</span><span class="token keyword">def</span> <span class="token function">format_name</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span> map<span class="token punctuation">(</span>format_name<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'adam'</span><span class="token punctuation">,</span> <span class="token string">'LISA'</span><span class="token punctuation">,</span> <span class="token string">'barT'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><pre><code>[&#39;Adam&#39;, &#39;Lisa&#39;, &#39;Bart&#39;]</code></pre><p>&emsp;</p><h2 id="reduce-函数"><a href="#reduce-函数" class="headerlink" title="reduce()函数"></a>reduce()函数</h2><p><strong>reduce是一个累积函数</strong></p><p>reduce()函数是python的一个高阶计算函数，会对list的里面的每个元素不断的调用，方法和map函数类似，但是reduce接入的参数可以为两个或者三个</p><pre class=" language-python"><code class="language-python">reduce<span class="token punctuation">(</span>function<span class="token punctuation">,</span> sequence<span class="token punctuation">[</span><span class="token punctuation">,</span> initial<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> value</code></pre><ul><li>function:该函数有两个参数</li><li>sequence:序列可以是str，tuple，list</li><li>initial:固定初始值</li></ul><p>reduce依次从sequence中取一个元素，和上一次调用function的结果做参数再次调用function。 第一次调用function时，如果提供initial参数，会以sequence中的第一个元素和initial 作为参数调用function，否则会以序列sequence中的前两个元素做参数调用function。 注意function函数不能为None。</p><p>案例如下：</p><pre class=" language-python"><code class="language-python">reduce<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x<span class="token operator">+</span>y<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#10</span><span class="token comment" spellcheck="true">#1作为x，2作为y，x+y=1+2=3，然后把得出的3赋值给x，把列表的3赋值给y，3+3=6，然后把6赋值给x，4赋值给y，x+y=10，得出最后结果为10</span>reduce<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x<span class="token operator">+</span>y<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#15</span><span class="token comment" spellcheck="true">#这里多加个5的意思是把5作为初始值x</span><span class="token comment" spellcheck="true">#5作为x，从列表中取1作为y,5+1=6，6作为x，x作为y，6+2=8，8作为x，3组我诶y，8+3=11，11作为x，4作为y，11+4=15,得出最后的结果为15</span>reduce<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x<span class="token operator">+</span>y<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'aa'</span><span class="token punctuation">,</span> <span class="token string">'bb'</span><span class="token punctuation">,</span> <span class="token string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'dd'</span><span class="token punctuation">)</span><span class="token string">'ddaabbcc'</span><span class="token comment" spellcheck="true">#原理和上面的一样</span></code></pre><p>其余案例如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> x <span class="token operator">+</span> yreduce<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><pre><code>结果为25过程如下：先计算头两个元素：f(1, 3)，结果为4；再把结果和第3个元素计算：f(4, 5)，结果为9；再把结果和第4个元素计算：f(9, 7)，结果为16；再把结果和第5个元素计算：f(16, 9)，结果为25；由于没有更多的元素了，计算结束，返回结果25。</code></pre><p>&emsp;</p><h2 id="sorted-函数"><a href="#sorted-函数" class="headerlink" title="sorted()函数"></a>sorted()函数</h2><p><strong>sorted是一个搜索函数</strong></p><pre class=" language-python"><code class="language-python">sorted<span class="token punctuation">(</span>iterable<span class="token punctuation">,</span> cmp<span class="token operator">=</span>None<span class="token punctuation">,</span> key<span class="token operator">=</span>None<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span> new sorted list</code></pre><p><strong>sorted()</strong>函数是python的一个高阶函数，可以接受函数来实现自定义排序，<strong>sorted()</strong>函数与<strong>sort</strong>函数是有一定区别的，比如</p><pre class=" language-python"><code class="language-python">a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'bob'</span><span class="token punctuation">,</span> <span class="token string">'about'</span><span class="token punctuation">,</span> <span class="token string">'Zoo'</span><span class="token punctuation">,</span> <span class="token string">'Credit'</span><span class="token punctuation">]</span>a<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#['Credit', 'Zoo', 'about', 'bob']</span><span class="token comment" spellcheck="true">#此时需要忽略大小写sort函数是不足以完成的</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#使用sorted函数</span><span class="token keyword">def</span> <span class="token function">cmp_ignore_case</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">:</span>    u1 <span class="token operator">=</span> s1<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>    u2 <span class="token operator">=</span> s2<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> u1 <span class="token operator">&lt;</span> u2<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token keyword">if</span> u1 <span class="token operator">></span> u2<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token keyword">print</span> sorted<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bob'</span><span class="token punctuation">,</span> <span class="token string">'about'</span><span class="token punctuation">,</span> <span class="token string">'Zoo'</span><span class="token punctuation">,</span> <span class="token string">'Credit'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cmp_ignore_case<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#['about', 'bob', 'Credit', 'Zoo']</span></code></pre><p>sorted()函数也可以对数字进行排序，<strong>如果 x 应该排在 y 的前面，返回 -1，如果 x 应该排在 y 的后面，返回 1。如果 x 和 y 相等，返回 0</strong></p><p>假如要实现数字的倒序排序</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">reversed_cmp</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> x <span class="token operator">></span> y<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token keyword">if</span> x <span class="token operator">&lt;</span> y<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token number">0</span>sorted<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reversed_cmp<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#[36, 21, 12, 9, 5]</span></code></pre><p>假如要实现字符串的ASCII大小排序</p><pre class=" language-python"><code class="language-python">sorted<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bob'</span><span class="token punctuation">,</span> <span class="token string">'about'</span><span class="token punctuation">,</span> <span class="token string">'Zoo'</span><span class="token punctuation">,</span> <span class="token string">'Credit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#['Credit', 'Zoo', 'about', 'bob']</span></code></pre><p>但是一般的排序的话使用sort足够了，除非要自定义排序才用sorted</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Restframework之编写API文档</title>
      <link href="/2019/10/31/restframework-bian-xie-api-wen-dang/"/>
      <url>/2019/10/31/restframework-bian-xie-api-wen-dang/</url>
      
        <content type="html"><![CDATA[<h2 id="概要文档"><a href="#概要文档" class="headerlink" title="概要文档"></a>概要文档</h2><p><code>Restframework</code>有一个显示概要文档的功能，根据文档显示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031180132.png" alt=""></p><p>根据文档的说明，我就直接修改路由了</p><p><strong>urls.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url<span class="token punctuation">,</span>include<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin<span class="token keyword">from</span> Book<span class="token punctuation">.</span>views <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>routers <span class="token keyword">import</span> DefaultRouter<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>schemas <span class="token keyword">import</span> get_schema_viewrouter <span class="token operator">=</span> DefaultRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>router<span class="token punctuation">.</span>register<span class="token punctuation">(</span>r<span class="token string">'Book'</span><span class="token punctuation">,</span>BookViewSet<span class="token punctuation">)</span>router<span class="token punctuation">.</span>register<span class="token punctuation">(</span>r<span class="token string">'Publish'</span><span class="token punctuation">,</span>PublishViewSet<span class="token punctuation">)</span>schema_view <span class="token operator">=</span> get_schema_view<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'Pastebin API'</span><span class="token punctuation">)</span>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    url<span class="token punctuation">(</span>r<span class="token string">'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^'</span><span class="token punctuation">,</span>include<span class="token punctuation">(</span>router<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span><span class="token string">'^schema/$'</span><span class="token punctuation">,</span> schema_view<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span></code></pre><p>根据文档的说明，直接执行是可以的，但是我这里还是出了一些问题，比如：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191101095757.png" alt=""></p><p>这个问题谷歌搜索后的最佳答案是这样的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191101140649.png" alt=""></p><p>emmm……虽然说知道了这个是什么原因也没啥用，我们直接升级一下<code>Django</code>和<code>Restframework</code>的版本就好了，新一点的版本没有这个bug</p><p>比如<code>Django2.0</code>和<code>Restframework3.7.7</code>及以上的版本不会出现这个问题</p><p>我更新了下版本，按照原来的配置，是可以运行的，如图概要文档已经生成</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191101095810.png" alt=""></p><h2 id="API文档"><a href="#API文档" class="headerlink" title="API文档"></a>API文档</h2><p><code>Restframework</code>自带一个<code>API</code>总和的说明文档，我们只需导入一个包和配置路由就可以直接使用</p><p><strong>urls.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>documentation <span class="token keyword">import</span> include_docs_urls<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    url<span class="token punctuation">(</span>r<span class="token string">'^docs/'</span><span class="token punctuation">,</span>include_docs_urls<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"图书管理系统"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>然后我们直接访问 <a href="http://127.0.0.1:8000/docs/" target="_blank" rel="noopener">http://127.0.0.1:8000/docs/</a> 就可以看到我们的文档已经做好了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191101100700.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> Restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Restframework之视图集</title>
      <link href="/2019/10/31/restframework-shi-tu-ji/"/>
      <url>/2019/10/31/restframework-shi-tu-ji/</url>
      
        <content type="html"><![CDATA[<blockquote><p>视图集这个其实用不用意义不大，文档中做了一个亲切的比喻，就像编写视图函数的时候是使用函数的形式去编写还是通过类视图的形式去编写一样，主要还是为了减少代码</p></blockquote><h2 id="视图集"><a href="#视图集" class="headerlink" title="视图集"></a>视图集</h2><p>视图集的主要作用就是减少代码，就像我刚刚的代码，很多重复的，如图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031164554.png" alt=""></p><p>要写多少个字段就要重复多少个<code>queryset</code>、<code>serializer_class</code>和<code>permissions_classes</code>字段</p><p>视图集的主要作用就是对重复的代码做一个整合</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031164925.png" alt=""></p><p>依照文档所说，只需要定义一个<code>ViewSets</code>就可以有<code>Book_list</code>和<code>Book_Detail</code>两个字段的功能</p><p><strong>views.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># class Book_list(generics.ListCreateAPIView):</span><span class="token comment" spellcheck="true">#     queryset = Book.objects.all()</span><span class="token comment" spellcheck="true">#     serializer_class = Bookserializer</span><span class="token comment" spellcheck="true">#     permission_classes = (permissions.IsAuthenticatedOrReadOnly,)</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># class Book_Detail(generics.RetrieveUpdateDestroyAPIView):</span><span class="token comment" spellcheck="true">#     queryset = Book.objects.all()</span><span class="token comment" spellcheck="true">#     serializer_class = Bookserializer</span><span class="token comment" spellcheck="true">#     permission_classes = (permissions.IsAuthenticatedOrReadOnly, )</span><span class="token comment" spellcheck="true">#上面注释的代码都可以直接删了~~~</span><span class="token keyword">class</span> <span class="token class-name">BookViewSet</span><span class="token punctuation">(</span>viewsets<span class="token punctuation">.</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Bookserializer    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">,</span><span class="token punctuation">)</span></code></pre><p>然后需要在<code>urls.py</code>里面修改成视图集的字段，要改动的地方有点多，所以我直接丢出代码了</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin<span class="token keyword">from</span> Book<span class="token punctuation">.</span>views <span class="token keyword">import</span> <span class="token operator">*</span>book_list <span class="token operator">=</span> BookViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>    <span class="token string">'post'</span><span class="token punctuation">:</span> <span class="token string">'create'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>book_detail <span class="token operator">=</span> BookViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'retrieve'</span><span class="token punctuation">,</span>    <span class="token string">'put'</span><span class="token punctuation">:</span> <span class="token string">'update'</span><span class="token punctuation">,</span>    <span class="token string">'patch'</span><span class="token punctuation">:</span> <span class="token string">'partial_update'</span><span class="token punctuation">,</span>    <span class="token string">'delete'</span><span class="token punctuation">:</span> <span class="token string">'destroy'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    url<span class="token punctuation">(</span>r<span class="token string">'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^$'</span><span class="token punctuation">,</span>api_root<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">#Publish的API</span>    url<span class="token punctuation">(</span>r<span class="token string">'^publish/$'</span><span class="token punctuation">,</span>Publish_list<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'publish-list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^publish/(?P&lt;pk>[0-9]+)/$'</span><span class="token punctuation">,</span>PublisherDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'publish-detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">#Book的API</span>    <span class="token comment" spellcheck="true"># url(r'^Book/$', Book_list.as_view(),name='Book-list'),</span>    <span class="token comment" spellcheck="true"># url(r'^Book/(?P&lt;pk>[0-9]+)/$', Book_Detail.as_view(),name='Book-detail'),</span>    <span class="token comment" spellcheck="true"># 使用BookViewSet(视图集)的API</span>    url<span class="token punctuation">(</span>r<span class="token string">'^Book/$'</span><span class="token punctuation">,</span> book_list<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'Book-list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^Book/(?P&lt;pk>[0-9]+)/$'</span><span class="token punctuation">,</span> book_detail<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'Book-detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span></code></pre><p>但是看看这个<code>urls.py</code>代码，在<code>views</code>里面减少了我们要的代码量，却在<code>urls</code>里面增加了我们的代码量<del>~</del>所以接下来要引入路由器的概念</p><h2 id="路由器"><a href="#路由器" class="headerlink" title="路由器"></a>路由器</h2><p>使用视图集一般我们都会配套使用路由器</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031171940.png" alt=""></p><p>依照官网的说法，我们要实例化一个<code>DefaultRouter</code>类</p><p><strong>urls.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url<span class="token punctuation">,</span>include<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin<span class="token keyword">from</span> Book<span class="token punctuation">.</span>views <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>routers <span class="token keyword">import</span> DefaultRouterrouter <span class="token operator">=</span> DefaultRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>router<span class="token punctuation">.</span>register<span class="token punctuation">(</span>r<span class="token string">'Book'</span><span class="token punctuation">,</span>BookViewSet<span class="token punctuation">)</span>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    url<span class="token punctuation">(</span>r<span class="token string">'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^'</span><span class="token punctuation">,</span>include<span class="token punctuation">(</span>router<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">#这里的API先注释，因为api_root里面的publish没有使用视图集注册</span>    <span class="token comment" spellcheck="true"># url(r'^API/$',api_root),</span>    <span class="token comment" spellcheck="true">#Publish的API</span>    url<span class="token punctuation">(</span>r<span class="token string">'^publish/$'</span><span class="token punctuation">,</span>Publish_list<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'publish-list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^publish/(?P&lt;pk>[0-9]+)/$'</span><span class="token punctuation">,</span>PublisherDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'publish-detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">#Book的API</span>    <span class="token comment" spellcheck="true"># url(r'^Book/$', Book_list.as_view(),name='Book-list'),</span>    <span class="token comment" spellcheck="true"># url(r'^Book/(?P&lt;pk>[0-9]+)/$', Book_Detail.as_view(),name='Book-detail'),</span>    <span class="token comment" spellcheck="true"># 使用BookViewSet(视图集)的API</span>    <span class="token comment" spellcheck="true"># url(r'^Book/$', book_list,name='Book-list'),</span>    <span class="token comment" spellcheck="true"># url(r'^Book/(?P&lt;pk>[0-9]+)/$', book_detail,name='Book-detail'),</span><span class="token punctuation">]</span></code></pre><p>运行试试</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031174926.png" alt=""></p><p>也是可以运行的</p><p>然后再把剩下的那个<code>publish</code>也去使用视图集的方式注册一下</p><p><strong>views.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">BookViewSet</span><span class="token punctuation">(</span>viewsets<span class="token punctuation">.</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Bookserializer    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">PublishViewSet</span><span class="token punctuation">(</span>viewsets<span class="token punctuation">.</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>    queryset <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Publishserializer    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">,</span><span class="token punctuation">)</span>@api_view<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">api_root</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> format<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token string">'publish'</span><span class="token punctuation">:</span> reverse<span class="token punctuation">(</span><span class="token string">'publish-list'</span><span class="token punctuation">,</span> request<span class="token operator">=</span>request<span class="token punctuation">,</span> format<span class="token operator">=</span>format<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'Book'</span><span class="token punctuation">:</span> reverse<span class="token punctuation">(</span><span class="token string">'Book-list'</span><span class="token punctuation">,</span> request<span class="token operator">=</span>request<span class="token punctuation">,</span> format<span class="token operator">=</span>format<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><strong>urls.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url<span class="token punctuation">,</span>include<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin<span class="token keyword">from</span> Book<span class="token punctuation">.</span>views <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>routers <span class="token keyword">import</span> DefaultRouterrouter <span class="token operator">=</span> DefaultRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>router<span class="token punctuation">.</span>register<span class="token punctuation">(</span>r<span class="token string">'Book'</span><span class="token punctuation">,</span>BookViewSet<span class="token punctuation">)</span>router<span class="token punctuation">.</span>register<span class="token punctuation">(</span>r<span class="token string">'Publish'</span><span class="token punctuation">,</span>PublishViewSet<span class="token punctuation">)</span>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    url<span class="token punctuation">(</span>r<span class="token string">'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^'</span><span class="token punctuation">,</span>include<span class="token punctuation">(</span>router<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span></code></pre><p>然后再运行一下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031175129.png" alt=""></p><p>都是完全可以运行的，用最少的代码去运行了同样的功能</p><p>但是你要是问我选哪种，我肯定不会用视图集，因为遇到没有读过文档的人，碰到这段代码绝对是看不懂的，而且出了Bug还不好找</p><p>最终还是要根据自己的情况去选择使用视图还是视图集</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> Restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Restframework之超链接API</title>
      <link href="/2019/10/31/restframework-chao-lian-jie-api/"/>
      <url>/2019/10/31/restframework-chao-lian-jie-api/</url>
      
        <content type="html"><![CDATA[<h2 id="演示前配置"><a href="#演示前配置" class="headerlink" title="演示前配置"></a>演示前配置</h2><p>拿外键的例子来说，<code>Book</code>的外键是<code>Publish</code>，点击<code>Book</code>的超链接<code>API</code>就可以访问到外键的<code>Publish</code></p><p>为了方便演示，我这里我就创建一个新的表<code>Book</code>，添加一个<code>model</code>字段</p><p><strong>models.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>    title<span class="token operator">=</span>models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"图书名称"</span><span class="token punctuation">,</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    publish<span class="token operator">=</span>models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token string">"Publish"</span><span class="token punctuation">,</span>on_delete<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>title    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>        verbose_name<span class="token operator">=</span><span class="token string">"书籍"</span>        verbose_name_plural<span class="token operator">=</span>verbose_name</code></pre><p>修改完<code>model</code>字段要<code>makemigrations</code>-&gt;<code>migrate</code></p><p>然后添加一个新的序列化文件</p><p><strong>serializer.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Publish<span class="token punctuation">,</span>Book<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token class-name">Bookserializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#通过publish这个外键去找到publish这个表的name，把原本的那个显示的数字改成出版社的名字</span>    publish<span class="token operator">=</span>serializers<span class="token punctuation">.</span>StringRelatedField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">"publish.name"</span><span class="token punctuation">)</span>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>        model <span class="token operator">=</span> Book        fields <span class="token operator">=</span> <span class="token punctuation">(</span>            <span class="token string">"id"</span><span class="token punctuation">,</span>            <span class="token string">"title"</span><span class="token punctuation">,</span>            <span class="token string">"publish"</span>        <span class="token punctuation">)</span></code></pre><p>接下来要编写视图views文件</p><p><strong>views.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Publish<span class="token punctuation">,</span>Book<span class="token keyword">from</span> <span class="token punctuation">.</span>serializers <span class="token keyword">import</span> Publishserializer<span class="token punctuation">,</span>Bookserializer<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token class-name">Book_list</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Bookserializer    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Book_Detail</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveUpdateDestroyAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Bookserializer    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">,</span> <span class="token punctuation">)</span></code></pre><p>最后要编写路由方</p><p><strong>urls.py</strong></p><pre class=" language-python"><code class="language-python">urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    url<span class="token punctuation">(</span>r<span class="token string">'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">#Publish的API</span>    url<span class="token punctuation">(</span>r<span class="token string">'^publish/$'</span><span class="token punctuation">,</span>Publish_list<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^publish/(?P&lt;pk>[0-9]+)/$'</span><span class="token punctuation">,</span>PublisherDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">#Book的API</span>    url<span class="token punctuation">(</span>r<span class="token string">'^Book/$'</span><span class="token punctuation">,</span> Book_list<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^Book/(?P&lt;pk>[0-9]+)/$'</span><span class="token punctuation">,</span> Book_Detail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span></code></pre><p>运行项目可以看到项目运行成功，且post请求等都可以运行</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031160320.png" alt=""></p><p>这篇博客讲的就是要把publish外键字段的弄一个超链接，点击可以查看这个出版社的所有字段</p><p>即点击这上那个字段都可以跳转到出版社的API情况</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031160635.png" alt=""></p><h2 id="配置超链接"><a href="#配置超链接" class="headerlink" title="配置超链接"></a>配置超链接</h2><p>配置超链接十分的简单，只需要序列化字段的类修改为<code>HyperlinkedModelSerializer</code>和删掉刚刚配置的<code>publish=serializers.StringRelatedField(source=&quot;publish.name&quot;)</code></p><p><strong>serializers.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Bookserializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>HyperlinkedModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>        model <span class="token operator">=</span> Book        fields <span class="token operator">=</span> <span class="token punctuation">(</span>            <span class="token string">"id"</span><span class="token punctuation">,</span>            <span class="token string">"title"</span><span class="token punctuation">,</span>            <span class="token string">"publish"</span>        <span class="token punctuation">)</span></code></pre><p><strong>urls.py</strong></p><p><strong>这里一定要编写name配置，因为如果不配置就不能反向查找到API</strong></p><pre class=" language-python"><code class="language-python">urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    url<span class="token punctuation">(</span>r<span class="token string">'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^$'</span><span class="token punctuation">,</span>api_root<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">#Publish的API</span>    url<span class="token punctuation">(</span>r<span class="token string">'^publish/$'</span><span class="token punctuation">,</span>Publish_list<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'publish-list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^publish/(?P&lt;pk>[0-9]+)/$'</span><span class="token punctuation">,</span>PublisherDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'publish-detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">#Book的API</span>    url<span class="token punctuation">(</span>r<span class="token string">'^Book/$'</span><span class="token punctuation">,</span> Book_list<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'Book-list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^Book/(?P&lt;pk>[0-9]+)/$'</span><span class="token punctuation">,</span> Book_Detail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'Book-detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span></code></pre><p>配置完运行项目，可以看到已经配置好了超链接</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031161638.png" alt=""></p><h2 id="显示所有可用的API"><a href="#显示所有可用的API" class="headerlink" title="显示所有可用的API"></a>显示所有可用的API</h2><p>我们需要一个路由，打开可以显示所有可用的API</p><p>文档有这个方法的详细说明</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031162611.png" alt=""></p><p>依照文档的意思就是要在视图文件里面添加这个字段</p><p><strong>views.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> api_view<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>reverse <span class="token keyword">import</span> reverse<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>@api_view<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">api_root</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> format<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token string">'publish'</span><span class="token punctuation">:</span> reverse<span class="token punctuation">(</span><span class="token string">'publish-list'</span><span class="token punctuation">,</span> request<span class="token operator">=</span>request<span class="token punctuation">,</span> format<span class="token operator">=</span>format<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'Book'</span><span class="token punctuation">:</span> reverse<span class="token punctuation">(</span><span class="token string">'Book-list'</span><span class="token punctuation">,</span> request<span class="token operator">=</span>request<span class="token punctuation">,</span> format<span class="token operator">=</span>format<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>然后我们配置一下路由</p><p><strong>urls.py</strong></p><pre class=" language-python"><code class="language-python">    <span class="token comment" spellcheck="true">#api_root的路由</span>    url<span class="token punctuation">(</span>r<span class="token string">'^$'</span><span class="token punctuation">,</span>api_root<span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>运行项目，可见运行成功</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031162837.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> Restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Restframework之权限设置</title>
      <link href="/2019/10/31/restframework-shen-fen-yan-zheng/"/>
      <url>/2019/10/31/restframework-shen-fen-yan-zheng/</url>
      
        <content type="html"><![CDATA[<h2 id="第一步：增加显示操作人"><a href="#第一步：增加显示操作人" class="headerlink" title="第一步：增加显示操作人"></a>第一步：增加显示操作人</h2><p>查看<code>API</code>的这个界面默认是要登陆的，因为我上面我使用了<code>admin</code>账号去登陆，所以i才可以显示这个页面</p><p>但是默认的是所有账号登陆进去都可以对<code>API</code>进行增删改查，这个完全不符合逻辑。正常的逻辑是谁创建的才能谁去改，没有身份验证进去的只能读取操作。 </p><p>如图，是我去数据库把我的<code>session</code>信息删掉之后再查看API的结果</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191031103421125.png" alt=""></p><p>依照官网的文档演示步骤，要先在<code>model</code>创建一个外键字段</p><pre class=" language-python"><code class="language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token class-name">Publish</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>    name<span class="token operator">=</span>models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"出版社名称"</span><span class="token punctuation">,</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    address<span class="token operator">=</span>models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"地址"</span><span class="token punctuation">)</span>    operator <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token string">'auth.User'</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>因为添加了一个字段，所以要进行数据库的迁移：<code>makemigrations</code> -&gt; <code>migrate</code></p><p>这里因为添加了一个字段，而之前的字段没有这个字段的默认值，所以会出现错误，要把默认值赋值为1即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191031104219944.png" alt=""></p><p>使用如上操作之后在数据库就已经生成了新的<code>operator</code>字段了，所以接下来要对序列化的文件也添加这个字段</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Publishserializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>        model<span class="token operator">=</span>Publish        fields<span class="token operator">=</span><span class="token punctuation">(</span>            <span class="token string">"id"</span><span class="token punctuation">,</span>            <span class="token string">"name"</span><span class="token punctuation">,</span>            <span class="token string">"address"</span><span class="token punctuation">,</span>            <span class="token string">"operator"</span>        <span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>再登陆<code>admin</code>账号查看<code>API</code>得到的结果应该如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191031104640419.png" alt=""></p><p>这个得到的<code>operator</code>的结果都为<code>1</code>是当然没问题的，<code>ID</code>为<code>1</code>就是代表<code>admin</code>账号，但是我们要显示的是这个<code>ID</code>的用户名</p><p>所以我们要在序列化文件里面添加字段：<code>operator=serializers.ReadOnlyField(source=&quot;operator.username&quot;)</code></p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Publishserializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>    operator<span class="token operator">=</span>serializers<span class="token punctuation">.</span>ReadOnlyField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">"operator.username"</span><span class="token punctuation">)</span>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>        model<span class="token operator">=</span>Publish        fields<span class="token operator">=</span><span class="token punctuation">(</span>            <span class="token string">"id"</span><span class="token punctuation">,</span>            <span class="token string">"name"</span><span class="token punctuation">,</span>            <span class="token string">"address"</span><span class="token punctuation">,</span>            <span class="token string">"operator"</span>        <span class="token punctuation">)</span></code></pre><h2 id="第二步：权限设置"><a href="#第二步：权限设置" class="headerlink" title="第二步：权限设置"></a>第二步：权限设置</h2><p>关于权限设置在官网都有详细的说明</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191031105427042.png" alt="权限说明文档"></p><p>依照文档的说法，我们要在视图文件里面添加一个字段，使得未登录的用户只具有读取权限，登录的用户才具有读写权限：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> permissions<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token class-name">Publish_list</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    queryset <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Publishserializer    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">PublisherDetail</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveUpdateDestroyAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    queryset <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Publishserializer    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">,</span><span class="token punctuation">)</span></code></pre><p>去演示一下，会发现未登录用户只有读取权限，登陆的用户才有写权限</p><p>这个<code>permissions</code>字段有好几种，在文档的API的权限设置详细文档里面有说明</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191031110534344.png" alt="权限设置详细文档"></p><p>在这里因为我要设置的是谁录入的<code>API</code>谁才具有读写权限，所以这里我要用的是<a href="http://www.sinodocs.cn/tutorial/4-authentication-and-permissions.html#object-level-permissions" target="_blank" rel="noopener">对象级别权限</a></p><p>如图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191031111206500.png" alt=""></p><p>依照文档的说法，我们要新建一个<code>permissions.py</code>文件</p><p><strong>permissions.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> permissions<span class="token keyword">class</span> <span class="token class-name">IsOwnerOrReadOnly</span><span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>BasePermission<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    自定义权限只允许对象的权限来去编辑他    """</span>    <span class="token keyword">def</span> <span class="token function">has_object_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 读取权限允许任何请求</span>        <span class="token comment" spellcheck="true"># 所以我们总是允许Get，HEAD和OPTIONS请求</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token keyword">in</span> permissions<span class="token punctuation">.</span>SAFE_METHODS<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token comment" spellcheck="true"># 只有该出版社的所有者才允许去读写</span>        <span class="token keyword">return</span> obj<span class="token punctuation">.</span>operator <span class="token operator">==</span> request<span class="token punctuation">.</span>user</code></pre><p>然后再去视图函数里面继承<code>permissions</code>的这个类</p><p> 之后我们再去创建一个管理员账号<code>admin2</code>看看能不能修改<code>admin</code>的API</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191121111047.png" alt="随便找的图"></p><p>哦吼，大功告成</p><h2 id="第三步：新建保存operator值的方法"><a href="#第三步：新建保存operator值的方法" class="headerlink" title="第三步：新建保存operator值的方法"></a>第三步：新建保存operator值的方法</h2><p>还有最后的一个问题，假如我们新建一个用户，就拿刚刚创建的<code>admin2</code>来说，我创建一个新的<code>API</code>数据，但是我的<code>operator</code>的<code>ID</code>是没有的。</p><p>我之前创建的<code>admin</code>账号是我模型迁移之前设置了默认的值<code>1</code>，但是我新创建的<code>admin2</code>没有<code>operator</code>的值，所以我们还要创建一个类方法去编写</p><p>我通俗的将不太好懂，这个原理如下：</p><p>使用<code>post</code>去创建一个新的<code>API</code>的时候是通过序列化去添加的，而我的序列化代码如下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20191031113938.png" alt=""></p><p>序列化没有自己的<code>save</code>方法，默认存储方法是在<code>ModelSerializer</code>里面的，也就是在<code>Model</code>里面保存，但是我新建的用户<code>admin2</code>添加一个字段，他的<code>operator_id</code>都不知道去哪里找，如果使用<code>admin2</code>去添加<code>API</code>数据的话，会出现如下情况：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191031114249204.png" alt=""></p><p>对于这种情况，文档的说明如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031114508.png" alt=""></p><p>即是让我们在视图文件创建一个<code>.perform_create</code>方法</p><p><strong>views.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Publish_list</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    queryset <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Publishserializer    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">,</span>IsOwnerOrReadOnly<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">perform_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>        serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span>operator<span class="token operator">=</span>self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span></code></pre><p>好了现在再去试一下使用admin2去post请求</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191031114833.png" alt=""></p><p>完美，搞定</p><h2 id="留坑"><a href="#留坑" class="headerlink" title="留坑"></a>留坑</h2><p>项目开发可能更多用到的是token验证，所以这里留个坑，到时候我做个项目案例回来填</p><p>在项目开发中，实际上用到的是比如购物车结算，没有登录的用户是无法进行结算的，所以一般要使用json.token去编写</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> Restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Restframework之类视图的编写</title>
      <link href="/2019/10/30/restframework-lei-shi-tu-bian-xie/"/>
      <url>/2019/10/30/restframework-lei-shi-tu-bian-xie/</url>
      
        <content type="html"><![CDATA[<h2 id="Restframework请求和响应"><a href="#Restframework请求和响应" class="headerlink" title="Restframework请求和响应"></a>Restframework请求和响应</h2><p><code>Restframework</code>扩展了<code>Django</code>默认的 <code>Request</code> 对象，提供了更加的灵活解析，除此之外<code>Restframework</code>还引入了一个 <code>Response响应对象</code>和<code>状态码</code>，如翻译文档截图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030161355293.png" alt="请求响应说明文档"></p><p>状态码呢，平常我们得到的结果404什么的我们都知道是找不到界面的意思了，但是<code>Restframework</code>在返回状态码的基础上还给我们返回一个说明</p><h2 id="Restframework编写-API视图"><a href="#Restframework编写-API视图" class="headerlink" title="Restframework编写 API视图"></a>Restframework编写 API视图</h2><h3 id="函数式编写API视图"><a href="#函数式编写API视图" class="headerlink" title="函数式编写API视图"></a>函数式编写API视图</h3><p><code>Restframework</code>的视图分为函数视图和类视图，这里我就直接用类视图来演示了，因为我开发<code>view视图</code>函数的时候都是用继承<code>from django.views.generic.base import View</code>来开发的，关于通过使用 <code>@api_view 装饰器</code>来对<code>API视图</code>进行开发官网有较明确的说明</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030162340135.png" alt="函数编写方法说明文档"></p><h3 id="类的方法来编写API视图"><a href="#类的方法来编写API视图" class="headerlink" title="类的方法来编写API视图"></a>类的方法来编写API视图</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030163246255.png" alt="类方法说明文档"></p><p>官网有详细说明的案例，这里我就直接编写视图代码了</p><p><strong>views.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Publish<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView<span class="token keyword">from</span> <span class="token punctuation">.</span>serializers <span class="token keyword">import</span> Publishserializer<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> Http404<span class="token keyword">class</span> <span class="token class-name">Publish_list</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""        列出所有的出版社或者创建一个新的出版社    """</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> format<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>        publish <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>        serializer <span class="token operator">=</span> Publishserializer<span class="token punctuation">(</span>publish<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> format<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>        serializer <span class="token operator">=</span> Publishserializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_201_CREATED<span class="token punctuation">)</span>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>errors<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_400_BAD_REQUEST<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">PublisherDetail</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    具体的出版社的查看、修改和删除视图    """</span>    <span class="token keyword">def</span> <span class="token function">get_object</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span>        <span class="token keyword">except</span> Publish<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>            <span class="token keyword">raise</span> Http404    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">,</span> format<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>        publish <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span>pk<span class="token punctuation">)</span>        serializer <span class="token operator">=</span> Publishserializer<span class="token punctuation">(</span>publish<span class="token punctuation">)</span>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">,</span> format<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>        publish <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span>pk<span class="token punctuation">)</span>        serializer <span class="token operator">=</span> Publishserializer<span class="token punctuation">(</span>publish<span class="token punctuation">,</span> data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>errors<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_400_BAD_REQUEST<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">,</span> format<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>        publish <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span>pk<span class="token punctuation">)</span>        publish<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_204_NO_CONTENT<span class="token punctuation">)</span></code></pre><p>然后去编写路由</p><p><strong>urls.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin<span class="token keyword">from</span> Book<span class="token punctuation">.</span>views <span class="token keyword">import</span> Publish_list<span class="token punctuation">,</span>PublisherDetailurlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    url<span class="token punctuation">(</span>r<span class="token string">'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^publish/$'</span><span class="token punctuation">,</span>Publish_list<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^publish/(?P&lt;pk>[0-9]+)/$'</span><span class="token punctuation">,</span>PublisherDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><p>配置完成，直接去访问地址</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030170643572.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030170732515.png" alt=""></p><h2 id="对类方法编写API视图进行优化"><a href="#对类方法编写API视图进行优化" class="headerlink" title="对类方法编写API视图进行优化"></a>对类方法编写API视图进行优化</h2><h3 id="mixins类说明"><a href="#mixins类说明" class="headerlink" title="mixins类说明"></a>mixins类说明</h3><p>对上面我演示的案例来说，单单只有一个类方法来编写，就要使用到<code>get_object</code>、<code>put</code>、<code>delete</code>、<code>post</code>等方法，如果有很多个API方法，就要使用到很多个重复的方法，所以<code>Restframework</code>整合了这些方法成为一个类，把重复的方法都整合起来，我们只需要修改表就可以了，这样就可以大大的<strong>减少代码量</strong>了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030171934693.png" alt="整合的方法"></p><p>来，让我们康康<code>mixins</code>的源码</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030174711526.png" alt="部分源码"></p><p>根据源码所示，<code>model</code>的表名要赋值给<code>queryset</code>，序列化后的字段要赋值给<code>serializer_class</code>，不然就会报错</p><p><code>mixins</code>类里面封装了很多的方法，我们需要用到什么方法的时候就继承里面的哪个方法即可</p><h3 id="使用mixins重写view方法"><a href="#使用mixins重写view方法" class="headerlink" title="使用mixins重写view方法"></a>使用mixins重写view方法</h3><p><strong>views.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Publish<span class="token keyword">from</span> <span class="token punctuation">.</span>serializers <span class="token keyword">import</span> Publishserializer<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> mixins<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> generics<span class="token keyword">class</span> <span class="token class-name">Publish_list</span><span class="token punctuation">(</span>mixins<span class="token punctuation">.</span>ListModelMixin<span class="token punctuation">,</span> mixins<span class="token punctuation">.</span>CreateModelMixin<span class="token punctuation">,</span> generics<span class="token punctuation">.</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""        列出所有的出版社或者创建一个新的出版社        """</span>    queryset <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Publishserializer    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>list<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>create<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">PublisherDetail</span><span class="token punctuation">(</span>mixins<span class="token punctuation">.</span>RetrieveModelMixin<span class="token punctuation">,</span>                      mixins<span class="token punctuation">.</span>UpdateModelMixin<span class="token punctuation">,</span>                      mixins<span class="token punctuation">.</span>DestroyModelMixin<span class="token punctuation">,</span>                      generics<span class="token punctuation">.</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    具体的出版社的查看、修改和删除视图    """</span>    queryset <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Publishserializer    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>retrieve<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>update<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></code></pre><p>拿修改后的代码跟原来的一比，代码的逻辑少了很多，<code>queryset</code>和<code>serializer_class</code>是<code>mixins</code>里面定义好的字段，所以我们把值赋值给这两个字段即可</p><p>再访问 <a href="http://127.0.0.1:8000/publish/" target="_blank" rel="noopener">http://127.0.0.1:8000/publish/</a> 试试</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030174023961.png" alt="使用mixins重写后访问"></p><p>依然没有任何问题</p><h2 id="mixins之再优化"><a href="#mixins之再优化" class="headerlink" title="mixins之再优化"></a>mixins之再优化</h2><p>在上述的mixins方法中已经帮我们整合了大部分的方法，已经减少了我们原本的大部分代码，但是还是有优化的地方</p><p>我们每次要调用很多个mixins方法的时候，一次要继承三四个类，看起来十分不美观</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030175530143.png" alt=""></p><p>你想到的Restframework早就想到了，而且还帮你做出了优化</p><p>我拿截图的这两个代码来说明，我们一次要继承四个类，所以我们可以直接去继承一个整合类来代替四个类</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Publish_list</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""        列出所有的出版社或者创建一个新的出版社    """</span>    queryset <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Publishserializer<span class="token keyword">class</span> <span class="token class-name">PublisherDetail</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveUpdateDestroyAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    具体的出版社的查看、修改和删除视图    """</span>    queryset <span class="token operator">=</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> Publishserializer</code></pre><p>这个整合的代码的名称很简便易懂，让我们康康源码</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030175816419.png" alt=""></p><p>哦吼，里面的代码不就是我们刚刚写的吗，直接帮我们把要重复的代码又整合一遍，把原本要十几行代码整合到了两行，我们直接写字段就好了</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> Restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Restframework之入门</title>
      <link href="/2019/10/29/restframework-ru-men/"/>
      <url>/2019/10/29/restframework-ru-men/</url>
      
        <content type="html"><![CDATA[<blockquote><p>官方文档（英文）： <a href="https://www.django-rest-framework.org/" target="_blank" rel="noopener">https://www.django-rest-framework.org/</a> </p><p>官方文档（翻译）： <a href="http://www.sinodocs.cn/" target="_blank" rel="noopener">http://www.sinodocs.cn/</a> </p><p>官网文档（未翻译全）（推荐）： <a href="https://q1mi.github.io/Django-REST-framework-documentation/" target="_blank" rel="noopener">https://q1mi.github.io/Django-REST-framework-documentation/</a> </p><p>参考文档： <a href="https://www.cnblogs.com/chenxuming/articles/9370009.html#_label2" target="_blank" rel="noopener">https://www.cnblogs.com/chenxuming/articles/9370009.html#_label2</a> </p></blockquote><blockquote><p>restful系列博客是在学习51cto的课程和在观看完官方文章之后的学习总结，自己重新做了一个案例来说明</p></blockquote><h2 id="Django-Restframework是什么"><a href="#Django-Restframework是什么" class="headerlink" title="Django Restframework是什么"></a>Django Restframework是什么</h2><p><code>Django Restframework</code>是<code>Django</code>中可以 帮助我们快速的开发符合<code>RESTful</code>规范的接口的框架 ，<code>RESTful</code>是如今开发基本都会采用的规范</p><h3 id="Restful规范"><a href="#Restful规范" class="headerlink" title="Restful规范"></a>Restful规范</h3><ul><li>GET（SELECT）：查询; 从服务器取出资源（一项或多项）。</li><li>POST（CREATE）：新增; 在服务器新建一个资源。</li><li>PUT（UPDATE）：覆盖,全部更新 ; 在服务器更新资源（客户端提供改变后的完整资源）。</li><li>PATCH（UPDATE）：更新;  在服务器更新资源（客户端提供改变的属性）。</li><li>DELETE（DELETE）：删除; 从服务器删除资源。</li><li>HEAD：获取资源的元数据。</li><li>OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。</li></ul><h3 id="Restframework作用"><a href="#Restframework作用" class="headerlink" title="Restframework作用"></a>Restframework作用</h3><ul><li><p>路由</p><ul><li><p>可以通过<code>as_view</code>传参数,根据请求方式的不同执行响应的方法</p></li><li><p>可以在url中设置一个结尾类似于.json的数据形式</p></li></ul></li><li><p>视图</p><ul><li>帮助开发者提供了一些类,并在类提供了很多的方法供我们使用 </li></ul></li><li><p>版本控制</p><ul><li>在url中设置version参数,用户请求传入参数时,在<code>request.version</code>中获取版本,根据版本的不同做不同的处理 </li></ul></li><li><p>认证</p><ul><li>写一个类并注册到认证类,在类的authticate方法中编写认证逻辑<ul><li>认证成功(user,auth)</li><li>rase AuthticateFaild(..)</li><li>None 继续</li></ul></li></ul></li><li><p>权限</p><ul><li>写一个类并注册的权限类,在类的<code>has_permission</code>方法中写权限逻辑 </li></ul></li><li><p>频率限制 </p><ul><li>写一个类并注册的权限类,在类的<code>allow_requset/wait</code> 方法中写权限逻辑 <ul><li>匿名</li><li>用户</li><li>返回为<code>True</code>或者<code>False</code>，<code>False</code>就要执行<code>wait</code>方法</li></ul></li></ul></li><li><p>解析器</p><ul><li>根据ContentType请求头,选择不同的解析器对请求体中的数据进行解析.<ul><li><code>Content-Type : url-formedo</code></li><li><code>Content-Type :application/json</code></li></ul></li></ul></li><li><p>分页</p><ul><li>对从数据库中取到的数据进行分页处理. SQL—&gt; limit offset<ul><li>根据页码:<a href="http://www.luffycity.com/api/v1/student/?page=1&amp;size=10" target="_blank" rel="noopener">http://www.luffycity.com/api/v1/student/?page=1&amp;size=10</a></li><li>根据索引:<a href="http://www.luffycity.com/api/v1/student/?offset=60(游标位置)&amp;limit=10" target="_blank" rel="noopener">http://www.luffycity.com/api/v1/student/?offset=60(游标位置)&amp;limit=10</a></li><li>根据加密:</li></ul></li></ul></li><li><p>序列化</p><ul><li>对<code>queryset</code>序列化以及对请求数据格式校验 </li></ul></li><li><p>渲染器 </p><ul><li>根据url中传入的后缀,决定在数据如何渲染到页面上</li></ul></li></ul><p>&emsp;</p><p><strong>…….简单的总结就是，<code>Django Restframework</code>可以帮助你前后端分离开发，后台人员通过<code>Restframework</code>来开发<code>API</code>接口，前端人员写前端的页面（不论是PC还是移动端），到时候整合直接使用后端人员的接口就可以完成整个项目的开发</strong></p><p>&emsp;</p><p>接下来我从把<code>model</code>的数据转换为json格式来引入<code>Restframework</code>的概念</p><h2 id="model数据转换为json形式"><a href="#model数据转换为json形式" class="headerlink" title="model数据转换为json形式"></a>model数据转换为json形式</h2><p>在开始演示之前，要先配置好Django的基本配置：编写好model、setting配置、从model插入数据、view视图配置等操作，这里我一一演示一遍</p><h3 id="演示前配置"><a href="#演示前配置" class="headerlink" title="演示前配置"></a>演示前配置</h3><p>先创建一个空文件夹，然后创建项目，如我下图所示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030104429158.png" alt="创建项目"></p><p>然后使用<code>pycharm</code>打开项目，配置好数据库、插入<code>Book</code>(我拿来演示的app)到<code>INSTALLED_APPS</code>，以下是我的配置</p><h4 id="setting-py"><a href="#setting-py" class="headerlink" title="setting.py"></a>setting.py</h4><pre class=" language-python"><code class="language-python">INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'django.contrib.admin'</span><span class="token punctuation">,</span>    <span class="token string">'django.contrib.auth'</span><span class="token punctuation">,</span>    <span class="token string">'django.contrib.contenttypes'</span><span class="token punctuation">,</span>    <span class="token string">'django.contrib.sessions'</span><span class="token punctuation">,</span>    <span class="token string">'django.contrib.messages'</span><span class="token punctuation">,</span>    <span class="token string">'django.contrib.staticfiles'</span><span class="token punctuation">,</span>    <span class="token string">'Book'</span><span class="token punctuation">,</span>    <span class="token string">'rest_framework'</span><span class="token punctuation">,</span><span class="token punctuation">]</span>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'DEFAULT_PERMISSION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token string">'rest_framework.permissions.IsAdminUser'</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">'PAGE_SIZE'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'restful_demo'</span><span class="token punctuation">,</span>        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>        <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>        <span class="token string">'PORT'</span><span class="token punctuation">:</span> <span class="token string">'3306'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="根目录-init-文件"><a href="#根目录-init-文件" class="headerlink" title="根目录__init__文件"></a>根目录<code>__init__</code>文件</h4><p>在我的<code>restful_test(项目根目录)</code>文件夹里面的的<code>__init__.py</code>文件，因为是python3版本， 所以要配置一下mysql</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pymysqlpymysql<span class="token punctuation">.</span>install_as_MySQLdb<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="创建model模型字段"><a href="#创建model模型字段" class="headerlink" title="创建model模型字段"></a>创建model模型字段</h4><p>在我创建的Book文件夹里面的model.py添加我要演示的字段</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Publish</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>    name<span class="token operator">=</span>models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"出版社名称"</span><span class="token punctuation">,</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    address<span class="token operator">=</span>models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"地址"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>        verbose_name<span class="token operator">=</span><span class="token string">"出版社"</span>        verbose_name_plural<span class="token operator">=</span>verbose_name</code></pre><p>然后对生成迁移文件和写入数据库</p><p><code>python manage.py makemigrations</code>-&gt;<code>python manage.py migrate</code></p><h4 id="创建管理员为model添加数据"><a href="#创建管理员为model添加数据" class="headerlink" title="创建管理员为model添加数据"></a>创建管理员为model添加数据</h4><p> <code>python manage.py createsuperuser</code>创建好管理员的用户名和密码</p><p>然后在<code>admin.py</code>里面注册Book</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Publish<span class="token comment" spellcheck="true"># Register your models here.</span>admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Publish<span class="token punctuation">)</span></code></pre><p>这里我添加好了三条数据</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030111244863.png" alt="Book数据"></p><p>以上你要用<code>Django shell</code>添加也行</p><p>到这里演示前的准备都已经配置好了，接下来的都是配置<code>view</code>视图方法</p><h3 id="方法一：使用字典的方式转换为json"><a href="#方法一：使用字典的方式转换为json" class="headerlink" title="方法一：使用字典的方式转换为json"></a>方法一：使用字典的方式转换为json</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>generic<span class="token punctuation">.</span>base <span class="token keyword">import</span> View<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Publish<span class="token keyword">import</span> json<span class="token comment" spellcheck="true"># Create your views here.</span><span class="token keyword">class</span> <span class="token class-name">Publish_list</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>        queryset<span class="token operator">=</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>        data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> queryset<span class="token punctuation">:</span>            p_tmp<span class="token operator">=</span><span class="token punctuation">{</span>                <span class="token string">"name"</span><span class="token punctuation">:</span>i<span class="token punctuation">.</span>name<span class="token punctuation">,</span>                <span class="token string">"address"</span><span class="token punctuation">:</span>i<span class="token punctuation">.</span>address            <span class="token punctuation">}</span>            data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>p_tmp<span class="token punctuation">)</span>        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>content_type<span class="token operator">=</span><span class="token string">"application/json"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span></code></pre><p>然后配置一下路由</p><pre class=" language-python"><code class="language-python">urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    url<span class="token punctuation">(</span>r<span class="token string">'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>    url<span class="token punctuation">(</span>r<span class="token string">'^publish/'</span><span class="token punctuation">,</span>Publish_list<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><p>访问 <a href="http://127.0.0.1:8000/publish/" target="_blank" rel="noopener">http://127.0.0.1:8000/publish/</a> </p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030112748744.png" alt=""></p><p>可以看到model的数据已经转换为json格式了</p><h3 id="方法二：使用Django自带的model-to-dict方法"><a href="#方法二：使用Django自带的model-to-dict方法" class="headerlink" title="方法二：使用Django自带的model_to_dict方法"></a>方法二：使用Django自带的model_to_dict方法</h3><p>方法二其实是对方法一进行优化，Django默认自带了一个model_to_dict方法，可以帮助我们把model转换为一个字典</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>generic<span class="token punctuation">.</span>base <span class="token keyword">import</span> View<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Publish<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms<span class="token punctuation">.</span>models <span class="token keyword">import</span> model_to_dict<span class="token keyword">import</span> json<span class="token comment" spellcheck="true"># Create your views here.</span><span class="token keyword">class</span> <span class="token class-name">Publish_list</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>        queryset<span class="token operator">=</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>        data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> queryset<span class="token punctuation">:</span>            data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>model_to_dict<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>content_type<span class="token operator">=</span><span class="token string">"application/json"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030115622712.png" alt=""></p><p>方法二得出的结果还是一毛一样的</p><h3 id="方法三：使用Django自带的序列化转换成json"><a href="#方法三：使用Django自带的序列化转换成json" class="headerlink" title="方法三：使用Django自带的序列化转换成json"></a>方法三：使用Django自带的序列化转换成json</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>generic<span class="token punctuation">.</span>base <span class="token keyword">import</span> View<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Publish<span class="token keyword">from</span> django<span class="token punctuation">.</span>core <span class="token keyword">import</span> serializers<span class="token comment" spellcheck="true"># Create your views here.</span><span class="token keyword">class</span> <span class="token class-name">Publish_list</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>        queryset<span class="token operator">=</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>        data<span class="token operator">=</span>serializers<span class="token punctuation">.</span>serialize<span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">,</span>queryset<span class="token punctuation">)</span>        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>data<span class="token punctuation">,</span>content_type<span class="token operator">=</span><span class="token string">"application/json"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030120017403.png" alt=""></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这个跟方法一和方法二的结果多了一个<code>model</code>和<code>pk</code>字段，但是方法三比其他两个方法更为简洁，更少的代码也更容易理解</p><p>如果单单只要提供信息的话使用方法三是完全足够的，从<code>model</code>读取信息转换为<code>json</code>格式方法三完全可以胜任。开发不仅仅只是把<code>model</code>转换为<code>API</code>，还要把<code>API</code>转换成<code>model</code>里面的数据</p><h2 id="Restframework的使用"><a href="#Restframework的使用" class="headerlink" title="Restframework的使用"></a>Restframework的使用</h2><h3 id="初识：自定义序列化的类"><a href="#初识：自定义序列化的类" class="headerlink" title="初识：自定义序列化的类"></a>初识：自定义序列化的类</h3><p><code>Restframework</code>的用法是跟<code>Django</code>的<code>form</code>表单的用法很相似</p><p>要先在创建一个<code>serializers</code>文件，这个文件里面存储序列化的字段</p><p> <strong>serializers .py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers<span class="token keyword">class</span> <span class="token class-name">Publishserializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>    id<span class="token operator">=</span>serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    name<span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>    address<span class="token operator">=</span>serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">)</span></code></pre><p>以上字段已经完成了字段的序列化，在前面说的跟form表单验证的方法一样，也有个验证的方法，如果直接把字段序列化进去就会造成不安全的问题，如翻译文档所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030142657094.png" alt="翻译文档"></p><p>所以我们要重写一个<code>create</code>和<code>update</code>方法</p><p> <strong>serializers .py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Publish<span class="token keyword">class</span> <span class="token class-name">Publishserializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>    id<span class="token operator">=</span>serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    name<span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>    address<span class="token operator">=</span>serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">#这里不用管validated_data是什么，只需要按照官网的方法所示，返回**validated_data就可以保证序列化的字段经过验证</span>        <span class="token keyword">return</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>        instance<span class="token punctuation">.</span>name<span class="token operator">=</span>validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span>instance<span class="token punctuation">.</span>name<span class="token punctuation">)</span>        instance<span class="token punctuation">.</span>address<span class="token operator">=</span>validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">,</span>instance<span class="token punctuation">.</span>address<span class="token punctuation">)</span>        instance<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> instance</code></pre><p>然后我们使用<code>Django shell</code>测试一下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030143656397.png" alt=""></p><p>其中的<code>is_vaild</code>方法都跟<code>form</code>表单使用方法一样，然后再刷新网页看看数据</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030143900759.png" alt=""></p><p>如图所示，就增加了我刚刚写的数据</p><h3 id="使用：在view里面添加序列化方法"><a href="#使用：在view里面添加序列化方法" class="headerlink" title="使用：在view里面添加序列化方法"></a>使用：在view里面添加序列化方法</h3><p><strong>views.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>generic<span class="token punctuation">.</span>base <span class="token keyword">import</span> View<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Publish<span class="token keyword">from</span> django<span class="token punctuation">.</span>core <span class="token keyword">import</span> serializers<span class="token keyword">from</span> <span class="token punctuation">.</span>serializers <span class="token keyword">import</span> Publishserializer<span class="token keyword">import</span> json<span class="token comment" spellcheck="true"># Create your views here.</span><span class="token keyword">class</span> <span class="token class-name">Publish_list</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>        queryset<span class="token operator">=</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>        serializer<span class="token operator">=</span>Publishserializer<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span>many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#many=True就是多个对象，要去遍历出来</span>        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>content_type<span class="token operator">=</span><span class="token string">"application/json"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span></code></pre><h3 id="优化：继承model的字段"><a href="#优化：继承model的字段" class="headerlink" title="优化：继承model的字段"></a>优化：继承model的字段</h3><p>跟<code>form</code>一样，<code>form</code>可以继承<code>model</code>的字段，<code>serializers</code> 当然也可以，已经在<code>model</code>里面创建的字段，当然没有必要重新写一遍了，所以现在要改写一下<code>serializers .py</code>的代码</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Publish<span class="token keyword">class</span> <span class="token class-name">Publishserializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>        model<span class="token operator">=</span>Publish        fields<span class="token operator">=</span><span class="token punctuation">(</span>            <span class="token string">"id"</span><span class="token punctuation">,</span>            <span class="token string">"name"</span><span class="token punctuation">,</span>            <span class="token string">"address"</span>        <span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">#这里不用管validated_data是什么，只需要按照官网的方法所示，返回**validated_data就可以保证序列化的字段经过验证</span>        <span class="token keyword">return</span> Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>        instance<span class="token punctuation">.</span>name<span class="token operator">=</span>validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span>instance<span class="token punctuation">.</span>name<span class="token punctuation">)</span>        instance<span class="token punctuation">.</span>address<span class="token operator">=</span>validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">,</span>instance<span class="token punctuation">.</span>address<span class="token punctuation">)</span>        instance<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> instance</code></pre><p>其余配置不变，输入配置好的路由地址 <a href="http://127.0.0.1:8000/publish/" target="_blank" rel="noopener">http://127.0.0.1:8000/publish/</a> ，依然可以访问到同样的数据</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/image-20191030145827519.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> Restful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx反向代理</title>
      <link href="/2019/10/24/nginx-fan-xiang-dai-li/"/>
      <url>/2019/10/24/nginx-fan-xiang-dai-li/</url>
      
        <content type="html"><![CDATA[<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><blockquote><p>本文使用Nginx来模拟第三方云平台的运行，通过Nginx来去调用内网的接口，从而实现保护内网的真实IP又可以提供对外访问的服务的目的</p></blockquote><h2 id="架构思路"><a href="#架构思路" class="headerlink" title="架构思路"></a>架构思路</h2><p>音乐、电影、书籍信息接口都是部署在服务器1里面，来模拟在内网的接口</p><p><code>Nginx</code>作为中间件来模拟第三方的云服务器端，小程序等APP调用的时候是直接去调用<code>Nginx</code>服务器，而不是直接去调用内网的接口，达到一种隐藏内网的地址而又可以间接去调用内网的接口</p><p>我的第一个模拟内网的服务器IP是<a href="http://39.106.12.6/" target="_blank" rel="noopener">39.106.12.6</a>，第二个模拟云平台的服务器IP是<a href="http://47.93.184.113/" target="_blank" rel="noopener">47.93.184.113</a></p><p>下面我拿个<code>Django API</code>提供对外调用来模拟内网的接口，拿小程序去对接口的出来的结果进行增删改查</p><h2 id="Nginx架构图"><a href="#Nginx架构图" class="headerlink" title="Nginx架构图"></a>Nginx架构图</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/Nginx/1571905522931.png" alt="架构图"></p><h2 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h2><p>以下三个是我在服务器1里面写的Django的查询API，是我通过Nginx去访问的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/Nginx/1571903983358.png" alt="音乐信息"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/Nginx/1571903998646.png" alt="书籍信息"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/Nginx/1571904033699.png" alt="电影信息"></p><p>如果我直接访问我的内网API则会被拒绝，如图所示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/Nginx/1571904490645.png" alt="直接访问服务器1"></p><p>因为我在Nginx配置了只允许<a href="http://47.93.184.113/" target="_blank" rel="noopener">47.93.184.113</a>访问，其余IP访问都会报403错误，只有我指定的Nginx服务器IP才能 访问内网的接口，如图所示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/Nginx/1571904572264.png" alt="使用Nginx间接访问内网"></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/Nginx/1571906670097.png" alt="小程序去调用Nginx的IP"></p><p>使用小程序等移动端APP也一样，直接去调用Nginx服务器的IP就可以调用内网的API</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>使用Nginx作为中间件可以免去多余的第三方服务，而且还可以借助Nginx去实现多余的功能，比如负载均衡，反爬虫等</p><p>如果使用云平台和第三方的服务商进行内网穿透，会导致访问服务的速度变慢，而使用Nginx一步就可以达到原有的功能而且还更方便</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>梯子的安装和使用</title>
      <link href="/2019/10/23/ti-zi/"/>
      <url>/2019/10/23/ti-zi/</url>
      
        <content type="html"><![CDATA[<h2 id="ubuntu的SSR部署和使用"><a href="#ubuntu的SSR部署和使用" class="headerlink" title="ubuntu的SSR部署和使用"></a>ubuntu的SSR部署和使用</h2><blockquote><p>参考博客：</p><p><a href="http://www.pianshen.com/article/3905142094/" target="_blank" rel="noopener">http://www.pianshen.com/article/3905142094/</a></p><p><a href="https://blog.csdn.net/weixin_38313047/article/details/85125082" target="_blank" rel="noopener">https://blog.csdn.net/weixin_38313047/article/details/85125082</a></p><p>为防止搭建梯子的步骤老被封，所以我先在这里记下来先</p></blockquote><h3 id="ubuntu-16-04-SSR-server"><a href="#ubuntu-16-04-SSR-server" class="headerlink" title="ubuntu 16.04 SSR server"></a>ubuntu 16.04 SSR server</h3><pre class=" language-shell"><code class="language-shell">执行   wget -N --no-check-certificate https://softs.fun/Bash/ssr.sh&& chmod +x ssr.sh && bash ssr.sh</code></pre><pre class=" language-shell"><code class="language-shell">备用地址 wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/ssr.sh&& chmod +x ssr.sh && bash ssr.sh</code></pre><p>复制上面的主用下载地址的两句代码到VPS服务器里，然后按回车：</p><p><img src="http://www.pianshen.com/images/134/50e5294828574e98d34bbd5b8cd3c3c6.png" alt=""></p><p>如上图出现管理界面后，输入数字1来安装SSR服务端。如果输入1后不能进入下一步，那么请退出xshell，重新连接vps服务器，然后输入快捷管理命令<code>bash ssr.sh</code> 再尝试。</p><p><img src="http://www.pianshen.com/images/599/b185eb0bdfedf0844f92395dc4789367.png" alt=""></p><p>根据上图提示，依次输入自己想设置的端口和密码 (密码建议用复杂点的字母组合，图中的密码只是作为演示用)，回车键用于确认</p><p><img src="http://www.pianshen.com/images/439/71697a1c4e40688acc478f7c51ad4057.png" alt=""></p><p>如上图，选择想设置的加密方式，比如10，按回车键确认</p><p>接下来是选择协议插件，如下图：</p><p><img src="http://www.pianshen.com/images/327/905393912f4b3434d5ff1c35ef5703c7.png" alt=""></p><p><img src="http://www.pianshen.com/images/636/95a50a86dd77c38f19ab14777d71938c.png" alt=""></p><p>选择并确认后，会出现上图的界面，提示你是否选择兼容原版，这里的原版指的是SS客户端，可以根据需求进行选择，原则上不推荐使用SS客户端，演示选择n</p><p>之后进行混淆插件的设置，如下面</p><p><img src="http://www.pianshen.com/images/674/a482a79487143fc289b3565ee59af8ba.png" alt=""></p><p>进行混淆插件的设置后，会依次提示你对设备数、单线程限速和端口总限速进行设置，默认值是不进行限制，个人使用的话，选择默认即可，即直接敲回车键。</p><p><img src="http://www.pianshen.com/images/790/a24e01a5174862459f839ea89e475066.png" alt=""></p><p>之后代码就正式自动部署了，到下图所示的位置，提示你下载文件，输入：y</p><p><img src="http://www.pianshen.com/images/240/1adca9c2c219546409e1e78ee08cd3b0.png" alt=""></p><p>耐心等待一会，出现下面的界面即部署完成：</p><p><img src="http://www.pianshen.com/images/471/64e2bda4d56988fa4e12c60c849004f7.png" alt=""></p><p><img src="http://www.pianshen.com/images/165/b85b52b9e6cc56153e70af8ff8afa1b5.png" alt=""></p><p>根据上图就可以看到自己设置的SSR账号信息，包括IP、端口、密码、加密方式、协议插件、混淆插件。如果之后想修改账号信息，直接输入快捷管理命令：<code>bash ssr.sh</code> 进入管理界面，选择相应的数字来进行一键修改。例如：</p><pre><code>bash ssr.sh</code></pre><p><img src="http://www.pianshen.com/images/527/fc1e1e88e19ca0ba00491cb59a46574f.png" alt=""></p><p><img src="http://www.pianshen.com/images/224/4a1c8f15f11d234641051c4381ccecb8.png" alt=""></p><hr><h3 id="一键加速VPS服务器"><a href="#一键加速VPS服务器" class="headerlink" title="一键加速VPS服务器"></a>一键加速VPS服务器</h3><p>加速教程为谷歌BBR加速教程，谷歌BBR加速和破解版锐速加速教程，两者只能成功装一个，都仅支持KVM框架的vps服务器，vultr的服务器都是KVM框架。如果你购买的不是vultr的服务器，那么你需要搞清楚你买的vps服务器是否是KVM框架的，很重要。</p><p>按照第二步的步骤，重新连接服务器ip，登录成功后，在命令栏里粘贴以下代码：</p><p>【谷歌BBR加速教程】</p><pre class=" language-shell"><code class="language-shell">yum -y install wgetwget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.shchmod +x bbr.sh./bbr.sh</code></pre><p>把上面整个代码复制后粘贴进去，不动的时候按回车，然后耐心等待，最后重启vps服务器即可。该方法是开机自动启动，部署一次就可以了。</p><p>如图：</p><p><img src="http://www.pianshen.com/images/790/0bd96843ea97aa895b034f2a02cc671e.png" alt=""></p><p>出现上面这个图按回车</p><p><img src="http://www.pianshen.com/images/740/41b774e68b723af7fd624bc41589b764.png" alt=""></p><p>最后输入y重启服务器或者手动输入代码：reboot</p><h2 id="Centos的SSR部署和使用"><a href="#Centos的SSR部署和使用" class="headerlink" title="Centos的SSR部署和使用"></a>Centos的SSR部署和使用</h2><blockquote><p>本文转载于：<a href="https://www.stackcc.com/2019/04/04/ssrstep/" target="_blank" rel="noopener">https://www.stackcc.com/2019/04/04/ssrstep/</a></p><p>本文只做部分解释说明，为防止梯子教程被封所以先来这里记着</p></blockquote><h3 id="Centos的SSR安装方法"><a href="#Centos的SSR安装方法" class="headerlink" title="Centos的SSR安装方法"></a>Centos的SSR安装方法</h3><p>开始前先执行以下命令,检查理服务器系统版本,不支持CentOS8!!!(显示7就是CentOS 7,显示8就是CentOS 8),用Vultr的同学要手动选择CentOS 7系统,不然默认CentOS 8….</p><pre class=" language-shell"><code class="language-shell">rpm -q centos-release|cut -d- -f3</code></pre><p>进入服务器后，就可以运行SSR代码了，这里推荐秋水逸冰大大的（原文网址<a href="https://shadowsocks.be/9.html），当然也可以用其他的，网上代码很多" target="_blank" rel="noopener">https://shadowsocks.be/9.html），当然也可以用其他的，网上代码很多</a></p><p>依次运行以下3条命令(输入一条回车一次)：</p><pre class=" language-javascript"><code class="language-javascript">wget <span class="token operator">--</span>no<span class="token operator">-</span>check<span class="token operator">-</span>certificate https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>teddysun<span class="token operator">/</span>shadowsocks_install<span class="token operator">/</span>master<span class="token operator">/</span>shadowsocksR<span class="token punctuation">.</span>shchmod <span class="token operator">+</span>x shadowsocksR<span class="token punctuation">.</span>sh<span class="token punctuation">.</span><span class="token operator">/</span>shadowsocksR<span class="token punctuation">.</span>sh <span class="token number">2</span><span class="token operator">></span><span class="token operator">&amp;</span><span class="token number">1</span> <span class="token operator">|</span> tee shadowsocksR<span class="token punctuation">.</span>log</code></pre><hr><p>如提示:</p><pre class=" language-shell"><code class="language-shell">wget :com.m.and not found</code></pre><p>请执行下面命令后再执行 秋水逸冰的一键脚本就行了。</p><pre class=" language-shell"><code class="language-shell">yum install wget -y</code></pre><p>如提示:</p><pre class=" language-shell"><code class="language-shell">[Error] libsodium install failed.</code></pre><p>百分之一亿是因为你用的是CentOS 8,换CentOS 7 试试 o(´^｀)o</p><hr><p>运行后，会提示你设置端口（port）和密码（password），加密方式,协议,混淆,端口设为80</p><p>提示<code>Please enter password for ShadowsocksR:</code>设置SSR连接密码：自己设定（如不设定，默认为 teddysun.com）<img src="http://oss.stackcc.com/blog/20181231160302.png" alt=""></p><p>提示<code>Please enter a port for ShadowsocksR [1-65535]设置</code>你的服务器端口：自己设定（如不设定，默认从 9000-19999 之间随机生成）<img src="http://oss.stackcc.com/blog/20181231160423.png" alt=""></p><p>提示<code>Please select stream cipher for ShadowsocksR:</code>设置加密方式,输入序号回车选择：自己设定(建议<code>chacha20</code>)（如不设定，Python 和 libev 版默认为 <code>aes-256-gcm</code>，R 和 Go 版默认为 <code>aes-256-cfb</code>）<img src="http://oss.stackcc.com/blog/20181231155203.png" alt=""></p><p>提示<code>Please select protocol for ShadowsocksR:</code>输入序号回车选择协议（protocol）：自己设定（如不设定，默认为 origin）<img src="http://oss.stackcc.com/blog/20181231155214.png" alt=""></p><p>提示 <code>Please select obfs for ShadowsocksR:</code>输入序号回车选择混淆方式obfs,(免流请选择2:http_simple)（如不设定，默认为 plain）（仅限 ShadowsocksR 版）</p><p><img src="http://oss.stackcc.com/blog/20181231155226.png" alt=""></p><p>设置后直接回车，让代码自己运行，大概几分钟后运行结束，这时会出现红色字体的配置信息，请务必牢记，最好截图保存，以免遗忘</p><p><img src="http://oss.stackcc.com/blog/0181231162021.png" alt=""></p><p>备注：脚本默认创建单用户配置文件，如需配置多用户，请手动修改相应的配置文件后重启即可。</p><p>本脚本安装完成后即已后台启动，且开机自动启动。</p><hr><p><strong>注意:Vultr最新CentOS7需要开放端口或者关闭防火墙才能连接!!!!!!</strong></p><hr><p>停止防火墙请执行[回车]:</p><pre class=" language-shell"><code class="language-shell">systemctl stop firewalld</code></pre><p>重启防火墙[回车]:</p><pre class=" language-shell"><code class="language-shell">firewall-cmd --reload</code></pre><p>查看防火墙状态[回车] <code>not running</code>  表示已关闭:</p><pre class=" language-shell"><code class="language-shell">firewall-cmd --reload</code></pre><hr><p><strong>防火墙其他高级设置,如单独开放端口等,可以参考以下文章:</strong></p><p><a href="https://www.cnblogs.com/yyxq/p/10551274.html" target="_blank" rel="noopener">Centos7 防火墙 firewalld 实用操作（https://www.cnblogs.com/yyxq/p/10551274.html）</a></p><h3 id="SSR其他命令"><a href="#SSR其他命令" class="headerlink" title="SSR其他命令"></a>SSR其他命令</h3><p><strong>卸载方法：</strong>使用 root 用户登录，运行以下命令：</p><pre class=" language-shell"><code class="language-shell">./shadowsocksR.sh uninstall</code></pre><p><strong>查看进程是否启动：</strong>运行：</p><pre class=" language-shell"><code class="language-shell">/etc/init.d/shadowsocks status</code></pre><p><strong>使用命令：</strong></p><blockquote><p>启动：<code>/etc/init.d/shadowsocks start</code><br>停止：<code>/etc/init.d/shadowsocks stop</code><br>重启：<code>/etc/init.d/shadowsocks restart</code><br>状态：<code>/etc/init.d/shadowsocks status</code><br>配置文件路径：<code>/etc/shadowsocks.json</code><br>日志文件路径：<code>/var/log/shadowsocks.log</code><br>代码安装目录：<code>/usr/local/shadowsocks</code></p></blockquote><h3 id="Centos下的锐速安装方法"><a href="#Centos下的锐速安装方法" class="headerlink" title="Centos下的锐速安装方法"></a>Centos下的锐速安装方法</h3><blockquote><p>本篇转载于：<a href="https://www.stackcc.com/2019/01/04/centos67ruisu/" target="_blank" rel="noopener">https://www.stackcc.com/2019/01/04/centos67ruisu/</a></p><p>本文只做部分解释说明，为防止梯子教程被封所以先来这里记着</p></blockquote><h4 id="一、注意事项"><a href="#一、注意事项" class="headerlink" title="一、注意事项"></a>一、注意事项</h4><p>1、安装锐速需降级系统内核，而安装 Google BBR 则需升级系统内核，故两者不能同时安装。</p><p>2、安装锐速需降级系统内核，有可能造成系统不稳定，故不建议将其应用在重要的生产环境中。</p><p>3、本教程只支持 CentOS6 x64 及 CentOS7 x64 系统，不支持任何 Debian &amp; Ubuntu 系统！</p><h4 id="二、判断系统类型"><a href="#二、判断系统类型" class="headerlink" title="二、判断系统类型"></a>二、判断系统类型</h4><p>连接服务器，按照下图提示，我们首先复制命令：</p><pre class=" language-shell"><code class="language-shell">uname -r</code></pre><p>然后回到 Xshell 软件，鼠标右键选择粘贴，回车继续。</p><p><img src="https://static.vultrcn.com/wp-content/uploads/2018/03/centos-serverspeeder-2.png" alt="CentOS6/7 专用破解版锐速一键安装脚本"></p><p>回车后输出当前系统内核版本。主要分三种情况：</p><hr><p>1、结果以 2 开头，例如 <code>2.6.32-696.18.7.el6.x86_64</code>。</p><p>这种输出结果说明我们的服务器为 CentOS6 x64 系统，大家直接查看第三步进行锐速安装即可。</p><hr><p>2、结果以 3 开头，例如 <code>3.10.0-693.11.6.el7.x86_64</code>。</p><p>这种输出结果说明我们的服务器为 CentOS7 x64 系统，大家直接查看第四步进行锐速安装即可。</p><hr><p>3、结果以 4 开头，例如 <code>4.12.10-1.el7.elrepo.x86_64</code>。</p><p>这种输出结果说明我们的服务器已经安装 Google BBR 拥塞控制算法，此时已经无法继续安装锐速。</p><hr><h4 id="三、CentOS6-x64-系统安装锐速"><a href="#三、CentOS6-x64-系统安装锐速" class="headerlink" title="三、CentOS6 x64 系统安装锐速"></a>三、CentOS6 x64 系统安装锐速</h4><p>若第二步中确定服务器为 CentOS6 x64 系统则看这一步。</p><p>按照下图提示，我们继续复制下列命令：</p><pre class=" language-shell"><code class="language-shell">wget --no-check-certificate -O appex.sh https://raw.githubusercontent.com/0oVicero0/serverSpeeder_Install/master/appex.sh && bash appex.sh install '2.6.32-642.el6.x86_64'</code></pre><p>然后回到 Xshell 软件，鼠标右键选择粘贴，回车继续。</p><p><img src="https://static.vultrcn.com/wp-content/uploads/2018/03/centos6-serverspeeder01-3.png" alt="CentOS6/7 专用破解版锐速一键安装脚本"></p><p>回车后系统会自动下载脚本并执行。按照下图提示，我们直接回车继续即可。</p><p><img src="https://static.vultrcn.com/wp-content/uploads/2018/03/centos6-serverspeeder02-2.png" alt="CentOS6/7 专用破解版锐速一键安装脚本"></p><p>回车继续后系统会自动安装锐速，同时会先后要求我们设置锐速的三项信息。按照下图提示，我们每次都直接回车继续即可。</p><p><img src="https://static.vultrcn.com/wp-content/uploads/2018/03/centos6-serverspeeder03-2.png" alt="CentOS6/7 专用破解版锐速一键安装脚本"></p><p>设置完三项信息完成后，系统会完成锐速安装并输出锐速的运行状态。按照下图提示，当出现红框内信息时说明锐速已完成安装并开机自启动。</p><p><img src="https://static.vultrcn.com/wp-content/uploads/2018/03/centos6-serverspeeder04-2.png" alt="CentOS6/7 专用破解版锐速一键安装脚本"></p><h4 id="四、CentOS7-x64-系统安装锐速"><a href="#四、CentOS7-x64-系统安装锐速" class="headerlink" title="四、CentOS7 x64 系统安装锐速"></a>四、CentOS7 x64 系统安装锐速</h4><p>若第二步中确定服务器为 CentOS7 x64 系统则看这一步。</p><p>按照下图提示，我们继续复制下列命令：</p><pre class=" language-shell"><code class="language-shell">wget --no-check-certificate -O rskernel.sh https://raw.githubusercontent.com/uxh/shadowsocks_bash/master/rskernel.sh && bash rskernel.sh</code></pre><p>然后回到 Xshell 软件，鼠标右键选择粘贴，回车继续。</p><p>&emsp;</p><p>回车后系统会自动下载脚本并执行更换内核命令。按照下图提示，我们可以看到当前系统确实为 CentOS7，等待内核更换完毕后系统会自动重启并断开连接。</p><p>&emsp;</p><p>系统重启后，Xshell 软件会断开连接。等待 3~5 分钟服务器即可重启完毕，我们重新连接服务器，按照下图提示，我们继续复制命令：</p><pre class=" language-shell"><code class="language-shell">yum install net-tools -y && wget --no-check-certificate -O appex.sh https://raw.githubusercontent.com/0oVicero0/serverSpeeder_Install/master/appex.sh && bash appex.sh install</code></pre><p>然后回到 Xshell 软件，鼠标右键选择粘贴，回车继续。</p><p><img src="https://static.vultrcn.com/wp-content/uploads/2018/03/centos7-serverspeeder03-2.png" alt="CentOS6/7 专用破解版锐速一键安装脚本"></p><p>回车后系统会自动下载脚本并执行。按照下图提示，我们直接回车继续即可。</p><p><img src="https://static.vultrcn.com/wp-content/uploads/2018/03/centos6-serverspeeder02-2.png" alt="CentOS6/7 专用破解版锐速一键安装脚本"></p><p>回车继续后系统会自动安装锐速，同时会先后要求我们设置锐速的三项信息。按照下图提示，我们每次都直接回车继续即可。</p><p><img src="https://static.vultrcn.com/wp-content/uploads/2018/03/centos7-serverspeeder05.png" alt="CentOS6/7 专用破解版锐速一键安装脚本"></p><p>设置完三项信息完成后，系统会完成锐速安装并输出锐速的运行状态。按照下图提示，当出现红框内信息时说明锐速已完成安装并开机自启动。</p><p><img src="https://static.vultrcn.com/wp-content/uploads/2018/03/centos6-serverspeeder04-2.png" alt="CentOS6/7 专用破解版锐速一键安装脚本"></p><p>安装教程就是这些，大家有不清楚的可以留言提问。</p><h4 id="五-锐速常用命令"><a href="#五-锐速常用命令" class="headerlink" title="五.锐速常用命令"></a>五.锐速常用命令</h4><pre class=" language-shell"><code class="language-shell">启动：/serverspeeder/bin/serverSpeeder.sh start停止：/serverspeeder/bin/serverSpeeder.sh stop状态：service serverSpeeder status检查是否有appex0模块：lsmod</code></pre><h2 id="Centos的SS部署和使用"><a href="#Centos的SS部署和使用" class="headerlink" title="Centos的SS部署和使用"></a>Centos的SS部署和使用</h2><blockquote><p>参考博客：<a href="https://blog.51cto.com/14184268/2424093" target="_blank" rel="noopener">https://blog.51cto.com/14184268/2424093</a></p></blockquote><h3 id="SS安装"><a href="#SS安装" class="headerlink" title="SS安装"></a>SS安装</h3><p>在购买到国外的服务器后，直接黏贴这条命令就可以安装了</p><pre class=" language-shell"><code class="language-shell">wget --no-check-certificate https://freed.ga/github/shadowsocksR.sh; bash shadowsocksR.sh</code></pre><p>如果出现<code>wget :command not found</code>错误，那么就是你的软件没升级好，使用如下命令进行升级</p><pre class=" language-shell"><code class="language-shell">yum install wget -y </code></pre><p>&emsp;</p><h3 id="锐速支持"><a href="#锐速支持" class="headerlink" title="锐速支持"></a>锐速支持</h3><p>当然一般直接使用SS的话网速是很慢的，要用goole的BBR加速或者是锐速加速，这里我介绍锐速的加速方法</p><h4 id="更换内核"><a href="#更换内核" class="headerlink" title="更换内核"></a>更换内核</h4><p>安装锐速前一般要更换内核，使用如下命令更换内核：</p><pre class=" language-shell"><code class="language-shell">wget -N --no-check-certificate https://freed.ga/kernel/ruisu.sh && bash ruisu.sh</code></pre><h4 id="安装锐速"><a href="#安装锐速" class="headerlink" title="安装锐速"></a>安装锐速</h4><p>输入完命令之后服务器会自动重启，等到1-3分钟重新连接。连接后执行下面的命令</p><pre class=" language-shell"><code class="language-shell">wget -N --no-check-certificate https://github.com/91yun/serverspeeder/raw/master/serverspeeder.sh && bash serverspeeder.sh</code></pre><p>如果上面的命令不成功就执行如下备用命令</p><pre class=" language-shell"><code class="language-shell">wget -N --no-check-certificate https://raw.githubusercontent.com/91yun/serverspeeder/master/serverspeeder-all.sh && bash serverspeeder-all.sh</code></pre><p>然后就大功告成了，可以安心上goole去搜索资料了</p><h3 id="BBR支持"><a href="#BBR支持" class="headerlink" title="BBR支持"></a>BBR支持</h3><blockquote><p>参考博客：<a href="https://www.cnblogs.com/deen-/p/7223376.html" target="_blank" rel="noopener">https://www.cnblogs.com/deen-/p/7223376.html</a></p></blockquote><p>有些服务器是默认自带了BBR加速方法的，内核版本不能再使用锐速加速，如果不能安装锐速也可以使用下BBR，两个加速的速度也差不多，所以这里总结下BBR加速方法</p><h4 id="更换内核-1"><a href="#更换内核-1" class="headerlink" title="更换内核"></a>更换内核</h4><p><strong>首先我们要知道，添加BBR加速支持的最关键的一点是升级我们Linux的内核，只有内核支持这个加速算法，才能使用BBR，步骤如下（按顺序输入命令行即可）</strong></p><ul><li>内核应该是3.x，先升级成4.9或者4.12最新的，支持BBR<ol><li>rpm –import <a href="https://www.elrepo.org/RPM-GPG-KEY-elrepo.org" target="_blank" rel="noopener">https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</a></li><li>rpm -Uvh <a href="http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm" target="_blank" rel="noopener">http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</a></li><li>yum –enablerepo=elrepo-kernel install kernel-ml -y</li></ol></li><li>此时内核已经安装好，但是还要设置开机默认启动的那个内核，我按照教程里面的方法设置，可是并没有成功，于是自己百度了如何设置默认启动内核，可参考链接</li></ul><blockquote><p><a href="http://www.cnblogs.com/niyeshiyoumo/p/6762193.html" target="_blank" rel="noopener">http://www.cnblogs.com/niyeshiyoumo/p/6762193.html</a></p></blockquote><p>照着这篇文章里面的命令，我们的步骤依次是：</p><ol><li>查看可用内核 ： cat /boot/grub2/grub.cfg |grep menuentry</li><li>设置为4.9 以上支持的内核 ：grub2-set-default ‘CentOS Linux (4.12.3-1.el7.elrepo.x86_64) 7 (Core)’</li><li>设置成功则： reboot 重启，接下来就是安装BBR了</li></ol><h4 id="安装BBR"><a href="#安装BBR" class="headerlink" title="安装BBR"></a>安装BBR</h4><ol><li>uname -r 查看内核是否已经支持</li><li>echo ‘net.core.default_qdisc=fq’ | sudo tee -a /etc/sysctl.conf</li><li>echo ‘net.ipv4.tcp_congestion_control=bbr’ | sudo tee -a /etc/sysctl.conf</li><li>sysctl -p</li><li>sysctl net.ipv4.tcp_available_congestion_control</li><li>sysctl -n net.ipv4.tcp_congestion_control</li><li>lsmod | grep bbr</li></ol><p>最后提示bbr则安装成功</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>docker的安装</title>
      <link href="/2019/10/22/docker-de-an-zhuang/"/>
      <url>/2019/10/22/docker-de-an-zhuang/</url>
      
        <content type="html"><![CDATA[<h2 id="docker是什么"><a href="#docker是什么" class="headerlink" title="docker是什么"></a>docker是什么</h2><blockquote><p>参考文章地址： <a href="https://yeasy.gitbooks.io/docker_practice/introduction/what.html" target="_blank" rel="noopener">https://yeasy.gitbooks.io/docker_practice/introduction/what.html</a> </p><p>docker下载地址：<a href="https://hub.docker.com/?overlay=onboarding" target="_blank" rel="noopener">https://hub.docker.com/?overlay=onboarding</a></p></blockquote><blockquote><p>本篇博客是使用windows系统下的安装的，linux安装更为简单</p></blockquote><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>docker</code>相当于一个容器，里面封装了你开发的环境和应用。打个比方来说，我写了一个<code>python</code>项目，但是如果我直接把这个项目放到<code>github</code>上，很多人可能下载下来部署十分的麻烦，甚至可能出现运行不了的情况，最好的方法就是使用我开发的环境去部署这个项目，这个方法是直接而且是最方便的，而<code>docker</code>就帮助了我们实现了这个步骤。我直接打包我的项目环境和应用，直接给你们，你们就可以直接去运行，而且<code>docker</code>是一个沙箱环境，每个不同的应用之间不会有任何的影响。这样就不会出现在我的电脑上可以运行怎么在你的电脑上就出问题的场景了。</p><p>&emsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;旧版本的<code>docker</code>是基于<code>linux</code>系统的<a href="https://linuxcontainers.org/lxc/introduction/" target="_blank" rel="noopener">LXC</a>来实现的，在1.1以后使用自行开发的 <a href="https://github.com/docker/libcontainer" target="_blank" rel="noopener">libcontainer</a> 开发的。<code>docker</code>虽然跟虚拟机的使用目的很相似，但是跟虚拟机有很大的不同。<code>docker</code>和虚拟机本质上都是在虚拟环境上运行，但是<code>docker</code>对比与<code>虚拟机</code>更为轻量。<code>docker</code>是一种操作系统级别的虚拟化技术，能更快的启动、占用更少的内存去运行，你可能要花五分钟去运行一个<code>虚拟机</code>，如果使用的是<code>docker</code>估计也就几秒就事，其他更多的优势随便百度搜索一下都有一大堆详细的说明，这里我就不再更多的赘述。</p><p>&emsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最重要的一点就是不会再出现这个代码在我的环境没问题，怎么到你的电脑就怎样怎样的，使用<code>docker</code>可以解决大部分开发的问题，总之….总之用他就对了，而且docker社区很丰富，就拿阿里云来说，很多人都把自己部署好的环境放到云平台上供人下载。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191025115438.png" alt=""></p><h2 id="docker的安装"><a href="#docker的安装" class="headerlink" title="docker的安装"></a>docker的安装</h2><p>如果你的电脑是<code>win10</code>，那我不建议去下载<code>toolbox</code>版，因为<code>win10</code>自带了<code>Hyper-v</code>的虚拟化，而<code>toolbox</code>版本是通过<code>VirtualBox</code>来建立<code>linux</code>虚拟机，<code>docker</code>下载地址为<a href="https://hub.docker.com/?overlay=onboarding" target="_blank" rel="noopener">https://hub.docker.com/?overlay=onboarding</a></p><p>我试过很多个下载链接地址，但是下载后要么是不能更改下载路径，要么就是一直显示登陆中，唯有这个是最正确的，所以推荐使用这个下载</p><p>下载之后的界面应该是这样的</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191101160002.png" alt=""></p><p>接着最好就是修改存储的路径，不然到时候拉取镜像的时候C盘会炸</p><h2 id="修改默认镜像存储路径"><a href="#修改默认镜像存储路径" class="headerlink" title="修改默认镜像存储路径"></a>修改默认镜像存储路径</h2><p>直接从docker setting里面修改路径即可</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191101160618.png" alt=""></p><p>直接修改disk image location就可以修改镜像存储路径</p><p>如果这个方法还是不管用，那么看以下的三个博客，有很详细的解释</p><blockquote><p> <a href="https://cloud.tencent.com/developer/article/1147265" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1147265</a> </p><p> <a href="https://www.jianshu.com/p/f0738420a3ee" target="_blank" rel="noopener">https://www.jianshu.com/p/f0738420a3ee</a> </p><p> <a href="https://www.cnblogs.com/brock0624/p/9792203.html" target="_blank" rel="noopener">https://www.cnblogs.com/brock0624/p/9792203.html</a> </p></blockquote><h2 id="镜像加速"><a href="#镜像加速" class="headerlink" title="镜像加速"></a>镜像加速</h2><p>docker默认的镜像拉取是从国外的网站上拉的，所以会很慢，我们可以使用国内的镜像去拉取，可以从阿里云去申请一个独有的镜像加速方式： <a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a> </p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191101161320.png" alt=""></p><p>然后把镜像地址填写到这个框框里面就行了</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>装饰器</title>
      <link href="/2019/10/19/zhuang-shi-qi/"/>
      <url>/2019/10/19/zhuang-shi-qi/</url>
      
        <content type="html"><![CDATA[<h2 id="装饰器的概念"><a href="#装饰器的概念" class="headerlink" title="装饰器的概念"></a>装饰器的概念</h2><p>装饰器从理论上讲，就是它可以在让其他函数在不需要做任何代码的变动的前提下增加额外的功能</p><p>这里拿个案例来讲：</p><p>开发公司原本是每个部门都调用同样的一个底层函数，后来要在使用函数前加上一个权限验证代码</p><p>很多人一开始可能都是这样想的</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--检查权限--'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    check<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    check<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">f3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    check<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">f4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    check<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">pass</span></code></pre><p>但这种代码违背了<strong>开放封闭原则</strong>，虽然在这个原则是用的面向对象开发，但是也适用于函数式编程，简单来说，<strong>它规定已经实现的功能代码不允许被修改</strong>，但可以被扩展，这个也就是<strong>单例模式</strong>，在不改变别人使用的情况下，在内部写好增加的功能，即：</p><ul><li>封闭：已实现的功能代码块</li><li>开放：对扩展开发</li></ul><p>如果将开放封闭原则应用在上述需求中，那么就不允许在函数 f1 、f2、f3、f4的内部进行修改代码</p><p>根据之前学过的闭包，可以把函数的引用封装进check()函数里面，然后再次调用闭包函数就可以实现每个函数使用前都加上inner函数，代码如下</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--检查权限--'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> inner<span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span>f1<span class="token operator">=</span>check<span class="token punctuation">(</span>f1<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#将f1函数传入check函数里面，然后再去调用</span>f1<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>但是这个代码有很大的问题，也违反了开放封闭原则，就是每个部门都要加上这一行代码<code>f1=check(f1)</code></p><p>所以下面介绍python的特殊写法，也叫做语法糖</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--检查权限--'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> inner@check<span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span>f1<span class="token punctuation">(</span><span class="token punctuation">)</span> </code></pre><p>@check就代替了f1=check(f1)这行代码，这样每个部门都可以像原来的写法那样调用而且又可以加入检察权限函数了</p><h2 id="两个装饰器"><a href="#两个装饰器" class="headerlink" title="两个装饰器"></a>两个装饰器</h2><p>假如有两个装饰器，他</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">makebold</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--test1--'</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">wrapped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--1--'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">'&lt;b>'</span><span class="token operator">+</span>fn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'&lt;/b>'</span>    <span class="token keyword">return</span> wrapped<span class="token keyword">def</span> <span class="token function">makeitalic</span><span class="token punctuation">(</span>fn1<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--test2--'</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">wrapped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--2--'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">'&lt;i>'</span><span class="token operator">+</span>fn1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'&lt;/i>'</span>    <span class="token keyword">return</span> wrapped@makebold@makeitalic<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">'hello world 3'</span>res<span class="token operator">=</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span></code></pre><pre><code>--test2----test1----1----2--test&lt;b&gt;&lt;i&gt;hello world 3&lt;/i&gt;&lt;/b&gt;</code></pre><p><strong>两个装饰器的运行顺序是这样的：python解释器从上往下执行，执行到@makebold，然后返回值还是一个装饰器，然后接着@makeitalic执行,然后makeitalic返回才是一个函数，所以这个顺序是倒着执行的，是test()–&gt;makeitalic()–&gt;makebold()</strong>，调用的时候是从上往下调用，装饰器执行是从下往上执行</p><h2 id="装饰器的执行时间"><a href="#装饰器的执行时间" class="headerlink" title="装饰器的执行时间"></a>装饰器的执行时间</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--执行--'</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--检查权限--'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> inner@check<span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token comment" spellcheck="true">#输出 --执行--</span></code></pre><p>从上述代码看出，在执行到@check这一行的时候，就已经执行check函数里面的内容了，而不是要等到f1()的时候再去调用</p><h2 id="装饰器对有参数函数进行装饰"><a href="#装饰器对有参数函数进行装饰" class="headerlink" title="装饰器对有参数函数进行装饰"></a>装饰器对有参数函数进行装饰</h2><p>假如在调用函数的时候需要加入参数，就必须在定义的闭包函数里面也要加入对应的形参，不然会无法调用</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--执行--'</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>         func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>    <span class="token keyword">return</span> inner@check<span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a是%d,b是%d,c是%d'</span><span class="token operator">%</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>f1<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">)</span></code></pre><h2 id="带返回值的装饰器"><a href="#带返回值的装饰器" class="headerlink" title="带返回值的装饰器"></a>带返回值的装饰器</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>function<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        ret<span class="token operator">=</span>function<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> ret    <span class="token keyword">return</span> inner@func<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--test--'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">'23333'</span>ret<span class="token operator">=</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'返回值是%s'</span><span class="token operator">%</span>ret<span class="token punctuation">)</span></code></pre><pre><code>--test--返回值是23333</code></pre><p>定义返回值也要在闭包函数里面添加相对应的返回值</p><h2 id="有参数的装饰器"><a href="#有参数的装饰器" class="headerlink" title="有参数的装饰器"></a>有参数的装饰器</h2><p>在开发中会出现一个外部变量，如@装饰器名字(‘变量’)的形式，此时就需要多一个闭包函数</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">func_args</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>function<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> arg<span class="token operator">==</span><span class="token string">'2333'</span><span class="token punctuation">:</span>                function<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">pass</span>        <span class="token keyword">return</span> inner    <span class="token keyword">return</span> func@func_args<span class="token punctuation">(</span><span class="token string">'2333'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--test--'</span><span class="token punctuation">)</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#结果 --test--</span></code></pre><p>这样就可以想对什么进行装饰就对什么进行装饰了</p><h2 id="用类当做装饰器进行装饰"><a href="#用类当做装饰器进行装饰" class="headerlink" title="用类当做装饰器进行装饰"></a>用类当做装饰器进行装饰</h2><p>在讲这个之前要懂一个方法</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span>t<span class="token operator">=</span>Test<span class="token punctuation">(</span><span class="token punctuation">)</span>t<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>这样直接调用的话会导致<code>TypeError: &#39;Test&#39; object is not callable</code>错误，所以要在类中声明<code>__call__</code>方法</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--test--'</span><span class="token punctuation">)</span>    <span class="token keyword">pass</span>t<span class="token operator">=</span>Test<span class="token punctuation">(</span><span class="token punctuation">)</span>t<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#--test--</span></code></pre><p>这样子就可以运行了</p><p>使用类装饰器的形式是这样子的</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'初始化'</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'函数的名字为%s'</span><span class="token operator">%</span>func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>__func<span class="token operator">=</span>func    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--装饰器的功能--'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>__func@Test<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--test--'</span><span class="token punctuation">)</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>collections模块</title>
      <link href="/2019/10/18/collections-mo-kuai/"/>
      <url>/2019/10/18/collections-mo-kuai/</url>
      
        <content type="html"><![CDATA[<h2 id="ChainMap"><a href="#ChainMap" class="headerlink" title="ChainMap"></a>ChainMap</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> ChainMapuser_dict1<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">}</span>user_dict2<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"c"</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">"d"</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">}</span>new_dict<span class="token operator">=</span>ChainMap<span class="token punctuation">(</span>user_dict1<span class="token punctuation">,</span>user_dict2<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>new_dict<span class="token punctuation">)</span><span class="token keyword">for</span> key <span class="token punctuation">,</span>values <span class="token keyword">in</span> new_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>values<span class="token punctuation">)</span></code></pre><p>就是合并两个字典</p><p>&emsp;</p><h2 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h2><p>Counter是一个统计数量的方法，方法比defaultdict来实现要简单的多</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> CounterUsers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">]</span>user<span class="token operator">=</span>Counter<span class="token punctuation">(</span>Users<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span></code></pre><p>甚至可以直接选择出前几个排名的方法</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> CounterUsers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">]</span>user<span class="token operator">=</span>Counter<span class="token punctuation">(</span>Users<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>这些方法要自己从头实现是非常的麻烦的，这个是使用了堆的数据结构，比自己用遍历的方法实现性能是高很多的 </p><p>&emsp;</p><h2 id="defaultdict"><a href="#defaultdict" class="headerlink" title="defaultdict"></a>defaultdict</h2><p>如果要对一个列表的数进行统计</p><pre class=" language-python"><code class="language-python">userdict<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span>Users<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'LY'</span><span class="token punctuation">,</span><span class="token string">'LY'</span><span class="token punctuation">,</span><span class="token string">'LY1'</span><span class="token punctuation">,</span><span class="token string">'LY1'</span><span class="token punctuation">,</span><span class="token string">'LY2'</span><span class="token punctuation">,</span><span class="token string">'LY2'</span><span class="token punctuation">]</span><span class="token keyword">for</span> user <span class="token keyword">in</span> Users<span class="token punctuation">:</span>    <span class="token keyword">if</span> user <span class="token operator">not</span> <span class="token keyword">in</span> userdict<span class="token punctuation">:</span>        userdict<span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        userdict<span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>userdict<span class="token punctuation">)</span></code></pre><p>这样写可以，但是如果逻辑一多，代码可读性就差</p><pre class=" language-python"><code class="language-python">userdict<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span>Users<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'LY'</span><span class="token punctuation">,</span><span class="token string">'LY'</span><span class="token punctuation">,</span><span class="token string">'LY1'</span><span class="token punctuation">,</span><span class="token string">'LY1'</span><span class="token punctuation">,</span><span class="token string">'LY2'</span><span class="token punctuation">,</span><span class="token string">'LY2'</span><span class="token punctuation">]</span><span class="token keyword">for</span> user <span class="token keyword">in</span> Users<span class="token punctuation">:</span>    userdict<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>user<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>    userdict<span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>userdict<span class="token punctuation">)</span></code></pre><p>这里的setdefault代码比上面的少，性能还比第一个高，因为少了一次判断</p><p>如果使用defaultdict的方法会更好 </p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdictUsers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'LY'</span><span class="token punctuation">,</span><span class="token string">'LY'</span><span class="token punctuation">,</span><span class="token string">'LY1'</span><span class="token punctuation">,</span><span class="token string">'LY1'</span><span class="token punctuation">,</span><span class="token string">'LY2'</span><span class="token punctuation">,</span><span class="token string">'LY2'</span><span class="token punctuation">]</span>default_dict <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token keyword">for</span> user <span class="token keyword">in</span> Users<span class="token punctuation">:</span>    default_dict<span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>default_dict<span class="token punctuation">)</span></code></pre><p>如果没有赋值就看defaultdict传入的可调用对象，如果是整数就为0，如果为字符串就为空，而不是抛出异常</p><p>当然这个方法的默认值是可以改变的，但不是直接传一个变量进去，而是定义一个函数，函数的返回值是调用默认对象组合的数组</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>        <span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>        <span class="token string">"nums"</span><span class="token punctuation">:</span><span class="token number">0</span>    <span class="token punctuation">}</span>default_dict<span class="token operator">=</span>defaultdict<span class="token punctuation">(</span>test<span class="token punctuation">)</span>default_dict<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span></code></pre><p>&emsp;</p><h2 id="dqeue双端队列"><a href="#dqeue双端队列" class="headerlink" title="dqeue双端队列"></a>dqeue双端队列</h2><p>以前我们数据结构都可能append等方法，而双端队列就是两边都可以进行的操作</p><pre><code>from collections import dequeuserlist=deque([&quot;LY&quot;,&quot;LY2&quot;])userlist.appendleft(&quot;1&quot;)print(userlist)</code></pre><p>&emsp;</p><h2 id="namedtuple"><a href="#namedtuple" class="headerlink" title="namedtuple"></a>namedtuple</h2><p>在类中，可以有如下形式</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name<span class="token operator">=</span>name        self<span class="token punctuation">.</span>age<span class="token operator">=</span>ageuser <span class="token operator">=</span> User<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'ly'</span><span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>age<span class="token punctuation">)</span></code></pre><p>可以用<code>.属性名</code>的形式表示出来，字面意思清晰明了</p><p>在namedtuple中，也可以定义一个类的形式</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtupleUser<span class="token operator">=</span>namedtuple<span class="token punctuation">(</span><span class="token string">"User"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>user<span class="token operator">=</span>User<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"ly"</span><span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span>user<span class="token punctuation">.</span>age<span class="token punctuation">)</span></code></pre><p>两者形式是差不多完全一样的，那么区别是什么呢</p><p>在类中，定义一个类需要耗费的内存相对于namedtuple是比较大的，class会内置很多对象，而namedtuple就单单只是一个存储数据的数据结构</p><p>其余的方法可以直接看源码来找方法</p><p>&emsp;</p><h2 id="OrderDict"><a href="#OrderDict" class="headerlink" title="OrderDict"></a>OrderDict</h2><p>在python3中，使用dict和OrderDict结果是一样的，顺序都为自己添加时候的顺序</p><p>而在python2中，使用dict添加的顺序是排序好的，而OrderDict才是自己添加的</p><pre><code>from collections import OrderedDictuser_dict = OrderedDict()user_dict[&quot;b&quot;]=&quot;test1&quot;user_dict[&quot;a&quot;]=&quot;test2&quot;user_dict[&quot;c&quot;]=&quot;test3&quot;print(user_dict)</code></pre><p>其余方法都在源码中有说明</p><p>&emsp;</p><h2 id="补充：为什么tuple会比list好"><a href="#补充：为什么tuple会比list好" class="headerlink" title="补充：为什么tuple会比list好"></a>补充：为什么tuple会比list好</h2><p><strong>性能优化</strong></p><p>元素全为不可变对象的时候，编译出来的pyc，也就是python的字节码是很确定的，所以加载的速度要比一般的快</p><p><strong>线程安全</strong></p><p>可以作为dict的key，因为元组是可哈希对象</p><p><strong>拆包特性</strong></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>enumerate函数</title>
      <link href="/2019/10/18/enumerate/"/>
      <url>/2019/10/18/enumerate/</url>
      
        <content type="html"><![CDATA[<h2 id="enumerate-函数"><a href="#enumerate-函数" class="headerlink" title="enumerate() 函数"></a>enumerate() 函数</h2><p><strong>enumerate() 函数</strong>可以使得列表添加索引</p><p>比如</p><pre class=" language-python"><code class="language-python"> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Adam'</span><span class="token punctuation">,</span> <span class="token string">'Lisa'</span><span class="token punctuation">,</span> <span class="token string">'Bart'</span><span class="token punctuation">,</span> <span class="token string">'Paul'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> index<span class="token punctuation">,</span> name <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">print</span> index<span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> name<span class="token comment" spellcheck="true">#0 - Adam</span><span class="token comment" spellcheck="true">#1 - Lisa</span><span class="token comment" spellcheck="true">#2 - Bart</span><span class="token comment" spellcheck="true">#3 - Paul</span></code></pre><p>这个函数实际上原理是把<strong>[‘Adam’, ‘Lisa’, ‘Bart’, ‘Paul’]</strong>转换成了<strong>[(0, ‘Adam’), (1, ‘Lisa’), (2, ‘Bart’), (3, ‘Paul’)]</strong></p><p>每一次迭代都是一个元组</p><pre class=" language-python"><code class="language-python"><span class="token keyword">for</span> t <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>    index <span class="token operator">=</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    name <span class="token operator">=</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">print</span> index<span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> name</code></pre><p>所以就可以简写为</p><pre class=" language-python"><code class="language-python"><span class="token keyword">for</span> index<span class="token punctuation">,</span> name <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span> index<span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> name</code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python匿名函数</title>
      <link href="/2019/10/18/ni-ming-han-shu/"/>
      <url>/2019/10/18/ni-ming-han-shu/</url>
      
        <content type="html"><![CDATA[<h2 id="匿名函数概念"><a href="#匿名函数概念" class="headerlink" title="匿名函数概念"></a>匿名函数概念</h2><p>有些时候我们使用函数的时候不一定要显示的定义函数，可以直接传输匿名函数来定义</p><p>案例：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#计算所有数的平方</span><span class="token keyword">print</span><span class="token punctuation">(</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#[1, 4, 9, 16, 25, 36, 49, 64, 81]</span></code></pre><p>上面的这个匿名函数实际上是</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> x <span class="token operator">*</span> x</code></pre><p><strong>关键字lambda 表示匿名函数，冒号前面的 x 表示函数参数。</strong></p><p><strong>匿名函数有个限制，就是只能有一个表达式，不写return，返回值就是该表达式的结果。</strong></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#假如要对字典的名字进行排序，一般的sort函数是无法完成这个任务的，此时就可以用到匿名函数</span>a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"ly"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"aa"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"zz"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">}</span><span class="token punctuation">]</span>a<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#[{'name': 'aa', 'age': 22}, {'name': 'ly', 'age': 21}, {'name': 'zz', 'age': 19}]</span><span class="token comment" spellcheck="true">#第一个x是遍历列表的三个字典，第二个x是把字典里面的'name'这个变量取出来，所以相当于key='name'</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#倒叙排序列表</span>sorted<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> <span class="token operator">-</span>cmp<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#[9, 5, 3, 1, 0]</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#把数值转换为正数</span>myabs <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token operator">-</span>x <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">else</span> x myabs<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#1</span>myabs<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#1</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#比如要简化filter()的示例代码</span><span class="token comment" spellcheck="true">#def is_not_empty(s):</span><span class="token comment" spellcheck="true">#    return s and len(s.strip()) > 0</span><span class="token comment" spellcheck="true">#filter(is_not_empty, ['test', None, '', 'str', '  ', #'END'])</span><span class="token keyword">print</span> filter<span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s <span class="token operator">and</span> len<span class="token punctuation">(</span>s<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">,</span> None<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'str'</span><span class="token punctuation">,</span> <span class="token string">'  '</span><span class="token punctuation">,</span> <span class="token string">'END'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#结果</span><span class="token comment" spellcheck="true">#['test', 'str', 'END']</span></code></pre><h2 id="匿名函数小应用"><a href="#匿名函数小应用" class="headerlink" title="匿名函数小应用"></a>匿名函数小应用</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>    result<span class="token operator">=</span>func<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>    <span class="token keyword">return</span> resultnum<span class="token operator">=</span>test<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span>x<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#3</span></code></pre><p>这样就可以自定义想要实现的函数了</p><h2 id="匿名函数面试题"><a href="#匿名函数面试题" class="headerlink" title="匿名函数面试题"></a>匿名函数面试题</h2><p><strong>只用一行代码就对字典的age进行排序</strong></p><p><code>a=[{&quot;name&quot;:&quot;ly&quot;,&quot;age&quot;:21},{&quot;name&quot;:&quot;aa&quot;,&quot;age&quot;:22},{&quot;name&quot;:&quot;zz&quot;,&quot;age&quot;:19}]</code></p><p>答案：</p><pre class=" language-python"><code class="language-python">a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"ly"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"aa"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"zz"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">}</span><span class="token punctuation">]</span>a<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></code></pre><p><strong>对字典 d={‘a’:27，‘f’:42，‘w’:12，‘u’:37} 中的 value 值进行排序？</strong></p><p>答案：</p><pre class=" language-python"><code class="language-python">sorted<span class="token punctuation">(</span>d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>，key <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </code></pre><blockquote><p>这里留个坑，等我到时候拿更多的面试题来详细讲解匿名函数</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深拷贝和浅拷贝</title>
      <link href="/2019/10/18/shen-kao-bei-he-qian-kao-bei/"/>
      <url>/2019/10/18/shen-kao-bei-he-qian-kao-bei/</url>
      
        <content type="html"><![CDATA[<h2 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h2><ul><li>浅拷贝是对于一个对象的顶层拷贝</li></ul><p>通俗的理解是：拷贝了引用，并没有拷贝内容</p><pre class=" language-python"><code class="language-python">a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">]</span>b<span class="token operator">=</span>a<span class="token keyword">print</span><span class="token punctuation">(</span>id<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>id<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#92188584</span><span class="token comment" spellcheck="true">#92188584</span></code></pre><p>这里就是b只拷贝了a的引用，而不是直接拷贝那个值</p><h2 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> copya<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">]</span>c<span class="token operator">=</span>copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#[11,22,33]</span><span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#[11,22,33]</span><span class="token keyword">print</span><span class="token punctuation">(</span>id<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#87652792</span><span class="token keyword">print</span><span class="token punctuation">(</span>id<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#87206488</span></code></pre><p>两者只是拷贝了值，而不是拷贝引用，c开辟了自己的一个内存空间，但是值和a一样</p><h2 id="copy-copy"><a href="#copy-copy" class="headerlink" title="copy.copy"></a>copy.copy</h2><p><strong>copy.copy在面对可变类型和不可变类型是不同的</strong></p><h3 id="copy-copy面对不可变类型"><a href="#copy-copy面对不可变类型" class="headerlink" title="copy.copy面对不可变类型"></a>copy.copy面对不可变类型</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> copya<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">]</span>b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">]</span>c<span class="token operator">=</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c1为'</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span>e<span class="token operator">=</span>copy<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'e1为'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>a<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c2为'</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'e2为'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span></code></pre><pre><code>c1为 [[11, 22, 33], [44, 55, 66]]e1为 [[11, 22, 33], [44, 55, 66]]c2为 [[11, 22, 33, 77], [44, 55, 66]]e2为 [[11, 22, 33, 77], [44, 55, 66]]9318524893185248</code></pre><p>copy.copy面对一个不可变类型，直接就是一个浅拷贝</p><h3 id="copy-copy面对可变类型"><a href="#copy-copy面对可变类型" class="headerlink" title="copy.copy面对可变类型"></a>copy.copy面对可变类型</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> copya<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">]</span>b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">]</span>c<span class="token operator">=</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c1为'</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span>e<span class="token operator">=</span>copy<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'e1为'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>a<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c2为'</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'e2为'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>id<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>id<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><pre><code>c1为 [[11, 22, 33], [44, 55, 66]]e1为 [[11, 22, 33], [44, 55, 66]]c2为 [[11, 22, 33, 77], [44, 55, 66]]e2为 [[11, 22, 33, 77], [44, 55, 66]]8359084083590880</code></pre><p><strong>虽然值是相同的，但是c和e两个内存是不同的。c是把a和b引用组合成一个元组，而e copy了c的引用，就像一个递归一样，e copy了c，c引用了a和b，所以最后也是同样的引用了a和b，所以a和b变化的时候e同样也会变化</strong></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python面试题 </tag>
            
            <tag> python语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python闭包</title>
      <link href="/2019/10/18/bi-bao/"/>
      <url>/2019/10/18/bi-bao/</url>
      
        <content type="html"><![CDATA[<h2 id="闭包定义"><a href="#闭包定义" class="headerlink" title="闭包定义"></a>闭包定义</h2><p><strong>闭包的作用通俗的来说就是强调，闭包可以用来在一个函数与一组“私有”变量之间创建关联关系。在给定函数被多次调用的过程中，这些私有变量能够保持其持久性</strong></p><p>闭包的基本形式如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">demoA</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--1--'</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">demoB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        使用demoA的变量    <span class="token keyword">return</span> demoB<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">demoA</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--1--'</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">demoB</span><span class="token punctuation">(</span>number2<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--2--'</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'demoA形参是'</span><span class="token punctuation">,</span>number<span class="token punctuation">,</span><span class="token string">'demoB传入的形参是'</span><span class="token punctuation">,</span>number2<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--3--'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> demoBres<span class="token operator">=</span>demoA<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>res<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span></code></pre><pre><code>--1----3----2--demoA形参是 100 demoB传入的形参是 200</code></pre><p>从上面的案例看出，在调用完demoA的时候，并没有把demoA销毁，返回值保存了demoB的引用，所以demoB里面还保存着demoA传入的变量</p><p>这里再拿个案例来说明，拿一个数学的二元函数来打比方<code>y=ax^2+b</code>,假如a和b是确定变量，只需要调x的参数，就可以使用闭包的方法</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">line_conf</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">line</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> a<span class="token operator">*</span>x <span class="token operator">+</span> b    <span class="token keyword">return</span> lineline1 <span class="token operator">=</span> line_conf<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>line2 <span class="token operator">=</span> line_conf<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>line1<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>line2<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>如果拿函数定义的方法来解决的话，就要不断的输入3个参数，这样显得更麻烦，所以闭包在一定程度上提高了代码复用率</p><h2 id="闭包弊端"><a href="#闭包弊端" class="headerlink" title="闭包弊端"></a>闭包弊端</h2><pre><code>1.闭包似优化了变量，原来需要类对象完成的工作，闭包也可以完成2.由于闭包引用了外部函数的局部变量，则外部函数的局部变量没有及时释放，会导致内存消耗很大，在一定程度上会影响性能</code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis和RabbitMQ作为消息队列的对比</title>
      <link href="/2019/10/15/redis-yu-rabbitmq/"/>
      <url>/2019/10/15/redis-yu-rabbitmq/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  这篇博客是属于一个总结，我在天天生鲜这个项目用到了消息中间件，所以就查阅了这方面的知识，对网上大部分的博客做一个总结</p><p>参考文章：</p><p><a href="https://blog.csdn.net/fengxiaolu311/article/details/82904217" target="_blank" rel="noopener">https://blog.csdn.net/fengxiaolu311/article/details/82904217</a></p><p><a href="https://blog.csdn.net/qq_42253147/article/details/93327939" target="_blank" rel="noopener">https://blog.csdn.net/qq_42253147/article/details/93327939</a></p><p><a href="https://blog.csdn.net/dd18709200301/article/details/79077839" target="_blank" rel="noopener">https://blog.csdn.net/dd18709200301/article/details/79077839</a></p></blockquote><h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><p>RabbitMQ是一个专门的AMQP协议队列，用于在分布式系统中存储转发消息，在易用性、扩展性、高可用性等方面表现不俗，他的优势就在于提供可靠的队列服务，使得不同的应用可以通过同一个协议去共享数据，并且可做到异步。</p><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>Redis众所周知是一个内存级别的数据库，通过键值对的方式才存储数据，但虽然Redis本身是一个数据库，但是Redis本身是支持MQ（Message Queue，即消息队列）的，而且MQ的一些常用功能使用Redis也能实现，如果要求没那么高的话使用Redis作为中间件是一个不错的选择，完全可以当做一个轻量级的队列服务来使用。</p><h2 id="两者间具体的对比"><a href="#两者间具体的对比" class="headerlink" title="两者间具体的对比"></a>两者间具体的对比</h2><h3 id="可靠性"><a href="#可靠性" class="headerlink" title="可靠性"></a>可靠性</h3><p>Redis：</p><ol><li>没有相应的机制保证消息的可靠消费，如果发布者发布一条消息，而没有对应的订阅者的话，这条消息将丢失，不会存在内存中；</li><li>如果订阅者消费失败，消息丢失，这个时候就需要开发者手动处理；</li></ol><p>RabbitMQ：</p><ol><li>具有消息消费确认机制，如果发布一条消息，还没有消费者消费该队列，那么这条消息将一直存放在队列中，直到有消费者消费了该条消息，以此可以保证消息的可靠消费；</li><li>即使消费者消费失败，也会自动使消息体返回原队列，同时可全程持久化，保证消息体被正确消费；</li></ol><p>&emsp;</p><h3 id="可靠发布"><a href="#可靠发布" class="headerlink" title="可靠发布"></a>可靠发布</h3><p>Redis：Redis是不提供这方面的服务的，需要开发者自行实现；</p><p>RabbitMQ：具有发布确认功能，保证消息被发布到服务器；</p><p>&emsp;</p><h3 id="持久性"><a href="#持久性" class="headerlink" title="持久性"></a>持久性</h3><p>Redis：Redis的持久化是针对于整个redis缓存的内容，它有RDB和AOF两种持久化方式，可以将整个redis实例持久化到磁盘，以此来做数据备份，防止异常情况下导致数据丢失；</p><p>RabbitMQ：队列，每一条消息，都可以选择是否持久化；</p><p>&emsp;</p><h3 id="队列监控"><a href="#队列监控" class="headerlink" title="队列监控"></a>队列监控</h3><p>Redis：不提供，需自行实现；</p><p>RabbitMQ：后台可以监控所有创建的队列的所有信息（内存，磁盘，消费者，生产者，速率等），良好的后台管理平台可以方面我们更好的使用；</p><p>&emsp;</p><h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>RabbitMQ：RabbitMQ队列可以被多个消费者同时监控消费，但是每一条消息只能被消费一次，由于RabbitMQ的消费确认机制，因此它能够根据消费者的消费能力而调整它的负载；</p><p>Redis：Redis发布订阅模式，一个队列可以被多个消费者同时订阅，当有消息到达时，会将该消息依次发送给每个订阅者，她是一种消息的广播形式，redis本身不做消费者的负载均衡，因此消费效率存在瓶颈；</p><p>&emsp;</p><h3 id="高可用性"><a href="#高可用性" class="headerlink" title="高可用性"></a>高可用性</h3><p>Redis：采用主从模式，读写分离，但是故障转移还没有非常完善的官方解决方案；</p><p>RabbitMQ：集群采用磁盘、内存节点，任意单点故障都不会影响整个队列的操作；</p><p>&emsp;</p><h3 id="流量控制"><a href="#流量控制" class="headerlink" title="流量控制"></a>流量控制</h3><p>Redis：不提供，需自行实现；</p><p>RabbitMQ：服务器过载的情况，对生产者速率会进行限制，保证服务可靠性；</p><p>&emsp;</p><h3 id="实时性"><a href="#实时性" class="headerlink" title="实时性"></a>实时性</h3><p>Redis：Redis是一个高效的缓存服务器，所有数据都保存在内存当中，所以它具备更高的实时性；</p><p>&emsp;</p><h3 id="出入队性能"><a href="#出入队性能" class="headerlink" title="出入队性能"></a>出入队性能</h3><p>对于RabbitMQ和Redis的入队和出队操作，各执行100万次，每10万次记录一次执行时间。测试数据分为128Bytes、512Bytes、1K和10K四个不同大小的数据。</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cDovL2ltYWdlcy5jbml0YmxvZy5jb20vaS80NTI2NzEvMjAxNDA3LzAyMTQ0ODM5MzI0ODU3OC5wbmc" alt=""></p><p>实验表明：入队时，当数据比较小时Redis的性能要高于RabbitMQ，而如果数据大小超过了10K，Redis则慢的无法忍受；出队时，无论数据大小，Redis都表现出非常好的性能，而RabbitMQ的出队性能则远低于Redis。</p><p>&emsp;</p><h2 id="两者的应用场景"><a href="#两者的应用场景" class="headerlink" title="两者的应用场景"></a>两者的应用场景</h2><p>Redis：轻量级，高并发，延迟敏感，即时数据分析、秒杀计数器、缓存等</p><p>RabbitMQ：重量级，高并发，异步批量数据异步处理、并行任务串行化，高负载任务的负载均衡等</p><blockquote><p>这篇博客的内容待继续完善，现在这里主要是总结了网上的经验，等我完全熟悉这两个数据库的时候我会拿案例来说明</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 日常总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>天天生鲜项目总结（二）</title>
      <link href="/2019/10/14/tian-tian-sheng-xian-zong-jie-er/"/>
      <url>/2019/10/14/tian-tian-sheng-xian-zong-jie-er/</url>
      
        <content type="html"><![CDATA[<h2 id="使用Redis作为Django的缓存来存储用户登录状态"><a href="#使用Redis作为Django的缓存来存储用户登录状态" class="headerlink" title="使用Redis作为Django的缓存来存储用户登录状态"></a>使用Redis作为Django的缓存来存储用户登录状态</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通常网站用的都是session和cookie作为记录用户信息的存储，Django默认是把session存储在数据库中，每一次用户使用网站，都要从数据库从读取session，但是直接读取数据库的速度是比较慢的。其次，网站如果每次用户访问都是从数据库进行读取，那么对服务器的压力也是不小的。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在小网站可以这样子做，如果大型网站人流量一大，每一个人访问网站都会对数据库进行一次读取，对服务器是个不小的压力，而如果使用Redis作为缓存存储数据就不会出现这类问题。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Django使用Redis作为缓存的使用手册如下：<a href="https://django-redis-chs.readthedocs.io/zh_CN/latest/" target="_blank" rel="noopener">https://django-redis-chs.readthedocs.io/zh_CN/latest/</a>，这里只简述使用方法:</p><p>安装Django-redis</p><pre class=" language-python"><code class="language-python">pip install django<span class="token operator">-</span>redis</code></pre><p>然后在setting文件里面添加配置项</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#Django的缓存配置</span>CACHES <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"default"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token string">"BACKEND"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.cache.RedisCache"</span><span class="token punctuation">,</span>        <span class="token string">"LOCATION"</span><span class="token punctuation">:</span> <span class="token string">"redis://127.0.0.1:6379/9"</span><span class="token punctuation">,</span>        <span class="token string">"OPTIONS"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>            <span class="token string">"CLIENT_CLASS"</span><span class="token punctuation">:</span> <span class="token string">"django_redis.client.DefaultClient"</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>&emsp;</p><p>其次Django默认的存储方式有如下三种：</p><ol><li><p>存储在数据库中，如下设置可以写，也可以不写，这是默认存储方式</p><pre class=" language-python"><code class="language-python">SESSION_ENGINE<span class="token operator">=</span><span class="token string">'django.contrib.sessions.backends.db'</span></code></pre><p>Django默认的存储方式就是在数据中存储，所以在<code>setting</code>字段里面有个</p><pre class=" language-python"><code class="language-python">INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token string">'django.contrib.sessions'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span></code></pre><p>在使用命令<code>migrate</code>和<code>makemigrations</code>后在数据库就会生成一个django_session字段，如图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571198881213.png" alt=""></p></li><li><p>存储在缓存中：存储在本机内存中，如果丢失则不能找回，比数据库的方式读写更快</p><pre class=" language-python"><code class="language-python">SESSION_ENGINE<span class="token operator">=</span><span class="token string">'django.contrib.sessions.backends.cache'</span></code></pre></li><li><p>混合存储：优先从本机内存中存取，如果没有则从数据库中存取。</p><pre class=" language-python"><code class="language-python"> SESSION_ENGINE<span class="token operator">=</span><span class="token string">'django.contrib.sessions.backends.cached_db'</span></code></pre></li></ol><p>&emsp;</p><p>项目需要的是把redis缓存替换默认方法，依照官方文档的方法：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571199075048.png" alt=""></p><p>在setting里面添加如下两个字段：</p><pre class=" language-python"><code class="language-python">SESSION_ENGINE <span class="token operator">=</span> <span class="token string">"django.contrib.sessions.backends.cache"</span>SESSION_CACHE_ALIAS <span class="token operator">=</span> <span class="token string">"default"</span></code></pre><p>这样就可以完成使用Redis来存储session了</p><p>&emsp;</p><h2 id="个人中心页面登陆限制"><a href="#个人中心页面登陆限制" class="headerlink" title="个人中心页面登陆限制"></a>个人中心页面登陆限制</h2><p>按照逻辑来说，个人中心的信息在没登录的时候即使输入了URL地址也是直接跳转到登陆信息的，当登陆完成之后再返回登陆之前访问的页面。本项目就按照这个逻辑去写。</p><p>Django有一套验证系统，可以记录用户访问前的地址和可以让登陆后再返回之前访问的地址</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571214022489.png" alt=""></p><p>上述验证方法有两个方法可以实现：</p><h3 id="方法一：在路由里面添加"><a href="#方法一：在路由里面添加" class="headerlink" title="方法一：在路由里面添加"></a>方法一：在路由里面添加</h3><p>在每个单独的包的路由里面设置一个<code>login_required</code>，如图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571214344034.png" alt=""></p><p>配置完之后，紧接着要在setting里面添加你的登陆地址，当访问个人中心页面自动跳转到登陆页面</p><pre class=" language-python"><code class="language-python">LOGIN_URL <span class="token operator">=</span> <span class="token string">'/login'</span></code></pre><p>重启项目，输入地址栏访问个人中心查看</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571215011716.png" alt=""></p><p>最重要的一步来了，就是表单继续提交的时候会发现情况不对，返回的还是首页页面，这个原因是因为form表单action提交的还是原来的地址，这里注意要删掉action字段，因为form表单如果不加上action就是提交到url地址的那栏，也就是<code>127.0.0.1:8000/user/login?next=/user/</code>，这个时候我们就要去修改登陆的方法类，也就是post请求要修改一下</p><p>这是我原来的代码：</p><pre class=" language-python"><code class="language-python">login<span class="token punctuation">(</span>request<span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment" spellcheck="true">#在登陆成功之后跳转到首页</span><span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'goods:index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><code>127.0.0.1:8000/user/login?next=/user/</code>这个地址一看就是get方法请求的，我们直接在Request里面获取即可</p><pre class=" language-python"><code class="language-python">login<span class="token punctuation">(</span>request<span class="token punctuation">,</span>user<span class="token punctuation">)</span>next_url<span class="token operator">=</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">,</span>reverse<span class="token punctuation">(</span><span class="token string">'goods:index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#如果拿不到next，就默认赋值为goods:index，也就是默认跳转到首页</span>response<span class="token operator">=</span>redirect<span class="token punctuation">(</span>next_url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">return</span> response<span class="token comment" spellcheck="true">#这里我修改了下我的写法，原理是一样的，都是跳转到要响应的页面</span></code></pre><p>经过上述配置，就可以完成开头所说的逻辑了</p><p>&emsp;</p><h3 id="方法二：使用LoginRequiredMixin类"><a href="#方法二：使用LoginRequiredMixin类" class="headerlink" title="方法二：使用LoginRequiredMixin类"></a>方法二：使用LoginRequiredMixin类</h3><p>在方法一里面，虽然是可以完成逻辑上的方法，但是这样未免很麻烦，每需要一个要限制登陆的页面，都要在路由里面添加限制，一两个无所谓，但是如果很多歌页面都需要限制登陆那未免就显得十分的麻烦。对于这种情况，我们应该封装在一个类里面做而不是在路由里面写。详细实现方法如下：</p><p>&emsp;</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571216461437.png" alt="官方文档"></p><p>官方文档写的也是十分的详细，虽然是全英文<del>~</del>整体而言方法是定义一个类，在类里面进行判断即可</p><p>对于这种对于全局都有作用的函数我封装到一个<code>utils</code>的文件夹里，并且取名为<code>Mixin.py</code></p><p>我们自定义一个类，类名我取名为<code>LoginRequiredMixin</code></p><p>先点击ctrl+as_view()查看类的实现方法</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571216810096.png" alt=""></p><p>这个方法我看了看，使用的是类方法来执行的</p><p>不管他，我直接copy过来</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> login_required<span class="token keyword">class</span> <span class="token class-name">LoginRequiredMixin</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    @classmethod    <span class="token keyword">def</span> <span class="token function">as_view</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">**</span>initkwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></code></pre><p>然后继承父类的方法，完整的代码如下</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> login_required<span class="token keyword">class</span> <span class="token class-name">LoginRequiredMixin</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    @classmethod    <span class="token keyword">def</span> <span class="token function">as_view</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">**</span>initkwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        view <span class="token operator">=</span> super<span class="token punctuation">(</span>LoginRequiredMixin<span class="token punctuation">,</span> cls<span class="token punctuation">)</span><span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token operator">**</span>initkwargs<span class="token punctuation">)</span>        <span class="token keyword">return</span> login_required<span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#这样我就可以定义一个是否需要被限制登陆的类了</span></code></pre><p>然后在定义个人中心、订单、地址的类方法中继承这个方法即可，详情如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">UserInfoView</span><span class="token punctuation">(</span>LoginRequiredMixin<span class="token punctuation">,</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token class-name">UserOrderView</span><span class="token punctuation">(</span>LoginRequiredMixin<span class="token punctuation">,</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token class-name">UserAddressView</span><span class="token punctuation">(</span>LoginRequiredMixin<span class="token punctuation">,</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span></code></pre><p>这样就可以实现更为简便的方法了</p><p>这个方法的原理还是跟方法一一模一样的，<code>return login_required(view)</code>还是在view外面包装了一个<code>login_required</code>，只是这样写会没那么乱</p><p>&emsp;</p><h2 id="添加用户历史浏览记录"><a href="#添加用户历史浏览记录" class="headerlink" title="添加用户历史浏览记录"></a>添加用户历史浏览记录</h2><p>添加用户历史浏览记录我这里使用的是<code>hash</code>数据结构存储。依照逻辑来说，能记录用户浏览记录肯定是要先登录的，所以要先对用户判断是否登陆，具体代码如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">if</span> user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span><span class="token comment" spellcheck="true"># 用户已经登录</span>conn <span class="token operator">=</span> get_redis_connection<span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">)</span>cart_key <span class="token operator">=</span> <span class="token string">'cart_%d'</span> <span class="token operator">%</span> user<span class="token punctuation">.</span>id<span class="token comment" spellcheck="true"># 获取用户购物车中的商品条目数</span>cart_count <span class="token operator">=</span> conn<span class="token punctuation">.</span>hlen<span class="token punctuation">(</span>cart_key<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># hlen hash中的数目</span>context<span class="token punctuation">.</span>update<span class="token punctuation">(</span>cart_count<span class="token operator">=</span>cart_count<span class="token punctuation">)</span></code></pre><h2 id="显示历史浏览记录"><a href="#显示历史浏览记录" class="headerlink" title="显示历史浏览记录"></a>显示历史浏览记录</h2><p>每次访问商品详情页的时候，都会使用Redis的list数据结构去保存用户浏览信息，在获取浏览记录的时候 使用<code>lrange key start stop</code>就可以自定义取多少条数据，假如要取A1的所有数据：<code>lrange A1 0 -1</code></p><p>根据Django-redis的官方文档显示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571232502432.png" alt=""></p><p>这里面的<code>default</code>就是之前配置的字段，如图所示</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571232579990.png" alt=""></p><p>在连接redis数据库之后，在数据字段里面显示前五个商品信息</p><pre class=" language-python"><code class="language-python">con<span class="token operator">=</span>get_redis_connection<span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">)</span>history_key<span class="token operator">=</span><span class="token string">'history_%d'</span><span class="token operator">%</span>user<span class="token punctuation">.</span>idsku_ids<span class="token operator">=</span>con<span class="token punctuation">.</span>lrange<span class="token punctuation">(</span>history_key<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>goods_li<span class="token operator">=</span>GoodSKU<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>id__in<span class="token operator">=</span>sku_ids<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#使用两层列表的原因是因为输入[2,1,3]，在mysql得出的结果顺序依然为1，2，3，所以只能用两层循环去遍历</span>goods_res<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> a_id <span class="token keyword">in</span> sku_ids<span class="token punctuation">:</span>    <span class="token keyword">for</span> goods <span class="token keyword">in</span> goods_li<span class="token punctuation">:</span>        <span class="token keyword">if</span> a_id<span class="token operator">==</span>goods<span class="token punctuation">.</span>id<span class="token punctuation">:</span>            goods_res<span class="token punctuation">.</span>append<span class="token punctuation">(</span>goods<span class="token punctuation">)</span></code></pre><h2 id="后台自定义使用FastDFS存储资源"><a href="#后台自定义使用FastDFS存储资源" class="headerlink" title="后台自定义使用FastDFS存储资源"></a>后台自定义使用FastDFS存储资源</h2><p>Django默认保存资源是保存在Media_root指定目录下方，现在我这个项目要改成FastDFS服务器上，所以这里要修改文件的默认存储路径，这里还是直接查看Django文档</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571232579990.png" alt=""></p><p>也就是说Django保存文件使用的是<code>FileSystemStorage</code>这个类，其中save方法实现了保存</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571233304579.png" alt=""></p><p>但是我们不能直接去修改源码，所以Django内置好了一套给我们自己去定义的存储类，我们只需要去继承<code>FileSystemStorage</code>的父类<code>Storage</code>就可以，继承<code>Storage</code>还必须要实现save和open方法，这里保存图片只需要实现save方法即可</p><p>同样我自定义存储类的方法卸载一个单独的文件夹下，这里我定义在utils里面的FastDFS文件夹下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571235260232.png" alt=""></p><p>里面的蓝色的<code>storage</code>就是自定义的文件，<code>client.conf</code>是我FasDFS的配置文件，基本上的功能，上传图片资源的模块我都已经写好了，直接修改自己的服务器IP就可以经行第二次开发</p><h2 id="页面资源静态化"><a href="#页面资源静态化" class="headerlink" title="页面资源静态化"></a>页面资源静态化</h2><p>在网站中，无论用户是否登陆都显示同一个页面，而如果人流量访问的越多，每个人访问都从数据库调用一遍就是一个非常伤服务器的操作，所以要把网站的常用页面给静态化。这里用的还是Celery去异步操作，具体的操作代码上的注释写的很详细，我这里只讲解我对这个问题的解决方案。</p><p>&emsp;</p><p>Django默认的后台<code>admin</code>是有一个<code>save_model</code>方法，也就是新增或更新数据时会自动调用，而我这个项目使用的是<code>xadmin</code>，不能直接调用<code>admin</code>的方法，依照网上博客的方法也不行，又不能去改写源代码，所以我想了个办法：在每次<code>return</code>返回给<code>index.html</code>数据的前，我都会先写一个缓存，这个缓存保存了返回给前端的数据，如果第二次访问的时候发现缓存改变了就给异步发送请求重新加载静态页面，如果没有改变就只进行一次对比之后返回静态页面，关键代码如下：</p><pre class=" language-python"><code class="language-python"> context <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'types'</span><span class="token punctuation">:</span> types<span class="token punctuation">,</span>            <span class="token string">'index_banner'</span><span class="token punctuation">:</span> index_banner<span class="token punctuation">,</span>            <span class="token string">'promotion_banner'</span><span class="token punctuation">:</span> promotion_banner<span class="token punctuation">,</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> context <span class="token keyword">is</span> None<span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># 设置缓存数据,缓存的名字，内容，过期的时间</span>            cache<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'index_page_data'</span><span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> context<span class="token operator">!=</span>cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'index_html_data'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            generate_static_index_html<span class="token punctuation">.</span>delay<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><p>分页这个其实官方文档说的比较清楚了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571237664233.png" alt=""></p><p>初次之外还有一个方法，在github上start也有几百了，地址如下：<a href="https://github.com/jamespacileo/django-pure-pagination" target="_blank" rel="noopener">https://github.com/jamespacileo/django-pure-pagination</a></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571237740809.png" alt=""></p><p>这个功能也是比较完善的，还具备前一页后一页的功能，最重要的是还带有省略号的功能，而且使用起来也挺简单的，不过这里因为我的图片资源本来就少，用不着折腾这个所以就没用</p><h2 id="商品搜索"><a href="#商品搜索" class="headerlink" title="商品搜索"></a>商品搜索</h2><p>在商品搜索功能上，Django有一个全文检索框架<code>haystack</code>，开发者可以通过全文检索框架去使用搜索引擎,<code>haystack</code>支持whoosh、solr、Xapian、Elasticsearch四种全文检索引擎</p><h3 id="配置项"><a href="#配置项" class="headerlink" title="配置项"></a>配置项</h3><p>首先先安装<code>haystack</code></p><pre class=" language-python"><code class="language-python">pip install django<span class="token operator">-</span>haystack<span class="token comment" spellcheck="true">#你要用哪个搜索引擎就下载哪个，我这里用的是whoosh</span>pip install whoosh</code></pre><p>然后在setting的INSTALLED_APPS添加<code>haystack</code>，紧接着要在setting里面添加如下字段：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 全文检索框架配置</span>HAYSTACK_CONNECTIONS <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true"># 使用whoosh引擎</span>        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'haystack.backends.whoosh_backend.WhooshEngine'</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 索引文件路径</span>        <span class="token string">'PATH'</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'whoosh_index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># 当添加、修改、删除数据时，自动生成索引</span>HAYSTACK_SIGNAL_PROCESSOR <span class="token operator">=</span> <span class="token string">'haystack.signals.RealtimeSignalProcessor'</span></code></pre><h3 id="配置索引文件"><a href="#配置索引文件" class="headerlink" title="配置索引文件"></a>配置索引文件</h3><p>在你需要被检索的包里面新建一个<code>search_indexes.py</code>文件，里面需要你配置的只有三个地方，代码如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> datetime<span class="token keyword">from</span> haystack <span class="token keyword">import</span> indexes<span class="token comment" spellcheck="true">#第一个地方，导入你的模型类</span><span class="token keyword">from</span> goods<span class="token punctuation">.</span>models <span class="token keyword">import</span> GoodsSKU<span class="token comment" spellcheck="true">#第二个地方：索引类的格式名：模型类+Index</span><span class="token keyword">class</span> <span class="token class-name">GoodsSKUIndex</span><span class="token punctuation">(</span>indexes<span class="token punctuation">.</span>SearchIndex<span class="token punctuation">,</span> indexes<span class="token punctuation">.</span>Indexable<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#索引字段document=True指定根据表的哪些字段简历索引文件制定在一个文件中</span>    text <span class="token operator">=</span> indexes<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>document<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> use_template<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># author = indexes.CharField(model_attr='user')</span>    <span class="token comment" spellcheck="true"># pub_date = indexes.DateTimeField(model_attr='pub_date')</span><span class="token comment" spellcheck="true">#第三个地方：返回你的模型类</span>    <span class="token keyword">def</span> <span class="token function">get_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> GoodsSKU    <span class="token comment" spellcheck="true"># 建立索引数据</span>    <span class="token keyword">def</span> <span class="token function">index_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> using<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>get_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#返回所有数据就是对所有的数据进行索引</span></code></pre><p>配置完上面的字段后，需要自定义需要被检索的字段，格式为<code>模型类名的小写_text.txt</code>，比如我的是<code>GoodsSKU</code>，格式就为<code>goodssku_text.txt</code>,这个文件建立的地方是有要求的，比如我这里的形式如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571240232653.png" alt=""></p><p>search和indexes是固定的，goods是你的应用名字就是什么名字。<code>goodssku_text.txt</code>里面填写你要索引的字段，我的如下</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 指定根据表中的哪些字段建立索引数据</span><span class="token punctuation">{</span><span class="token punctuation">{</span> object<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span>  <span class="token comment" spellcheck="true"># 根据商品的名称建立索引</span><span class="token punctuation">{</span><span class="token punctuation">{</span> object<span class="token punctuation">.</span>desc <span class="token punctuation">}</span><span class="token punctuation">}</span>  <span class="token comment" spellcheck="true"># 根据商品的简介建立索引</span><span class="token punctuation">{</span><span class="token punctuation">{</span> object<span class="token punctuation">.</span>goods<span class="token punctuation">.</span>detail <span class="token punctuation">}</span><span class="token punctuation">}</span>  <span class="token comment" spellcheck="true"># 根据商品的详情建立索引</span></code></pre><p>然后使用python shell命令<code>python manage.py rebuild_index</code>就可以生成你的索引文件</p><h3 id="搜索的页面"><a href="#搜索的页面" class="headerlink" title="搜索的页面"></a>搜索的页面</h3><p>搜索地址框搜索出来的页面也是单独设定的，首先搜索框的action的地址应该改为<code>&lt;form method=&#39;get&#39; action=&#39;/search&#39;&gt;</code></p><p>这里的action写什么，url地址那里就写什么，我的是search，所以url地址就是search</p><p>然后在全局的url地址那里添加<code>url(&#39;search/&#39;, include(&#39;haystack.urls&#39;)),  # 全文检索框架</code></p><p>最后要写一个搜索后出现的页面，搜索的页面要在indexes文件夹下，新建的搜索页面名字为<code>search.html</code>,里面关键展示部分的数据如下：</p><pre class=" language-python"><code class="language-python">搜索的关键字： <span class="token punctuation">{</span><span class="token punctuation">{</span> query <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">></span>当前页的Page对象： <span class="token punctuation">{</span><span class="token punctuation">{</span> page <span class="token punctuation">}</span><span class="token punctuation">}</span>  <span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span>ul<span class="token operator">></span>    <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> page <span class="token operator">%</span><span class="token punctuation">}</span>        <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>object <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>分页Paginator对象<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> paginator <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">></span></code></pre><p>自己去定义一个搜索后的页面，显示部分改成如上关键词就可以了</p><h3 id="使用jieba进行分词处理"><a href="#使用jieba进行分词处理" class="headerlink" title="使用jieba进行分词处理"></a>使用jieba进行分词处理</h3><p>我们汉语向来都是博大精深，不像英语一个单词就是一个意思，所以我们可以使用jieba包去对搜索的文字进行分词处理</p><p>首先先安装jieba分词</p><pre class=" language-python"><code class="language-python">pip install jieba</code></pre><p>然后去找haystack的源码目录</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1571242333996.png" alt=""></p><p>创建一个<code>ChineseAnalyzer.py</code>文件，输入以下代码：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> jieba<span class="token keyword">from</span> whoosh<span class="token punctuation">.</span>analysis <span class="token keyword">import</span> Tokenizer<span class="token punctuation">,</span> Token<span class="token keyword">class</span> <span class="token class-name">ChineseTokenizer</span><span class="token punctuation">(</span>Tokenizer<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> positions<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> chars<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>                 keeporiginal<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> removestops<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                 start_pos<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> start_char<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        t <span class="token operator">=</span> Token<span class="token punctuation">(</span>positions<span class="token punctuation">,</span> chars<span class="token punctuation">,</span> removestops<span class="token operator">=</span>removestops<span class="token punctuation">,</span> mode<span class="token operator">=</span>mode<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        seglist <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>value<span class="token punctuation">,</span> cut_all<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> w <span class="token keyword">in</span> seglist<span class="token punctuation">:</span>            t<span class="token punctuation">.</span>original <span class="token operator">=</span> t<span class="token punctuation">.</span>text <span class="token operator">=</span> w            t<span class="token punctuation">.</span>boost <span class="token operator">=</span> <span class="token number">1.0</span>            <span class="token keyword">if</span> positions<span class="token punctuation">:</span>                t<span class="token punctuation">.</span>pos <span class="token operator">=</span> start_pos <span class="token operator">+</span> value<span class="token punctuation">.</span>find<span class="token punctuation">(</span>w<span class="token punctuation">)</span>            <span class="token keyword">if</span> chars<span class="token punctuation">:</span>                t<span class="token punctuation">.</span>startchar <span class="token operator">=</span> start_char <span class="token operator">+</span> value<span class="token punctuation">.</span>find<span class="token punctuation">(</span>w<span class="token punctuation">)</span>                t<span class="token punctuation">.</span>endchar <span class="token operator">=</span> start_char <span class="token operator">+</span> value<span class="token punctuation">.</span>find<span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">+</span> len<span class="token punctuation">(</span>w<span class="token punctuation">)</span>            <span class="token keyword">yield</span> t<span class="token keyword">def</span> <span class="token function">ChineseAnalyzer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> ChineseTokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>这个代码其实就是对搜索框输入的字符串进行jieba分词处理</p><p>然后复制<code>whoosh_backend.py</code>文件为<code>whoose_cn_backend.py</code>，因为最好不要去修改源码</p><p>在新的文件<code>whoose_cn_backend.py</code>修改一些字段：</p><pre><code>#第一处要导入刚刚的jieba分词的包from .ChineseAnalyzer import ChineseAnalyzer第164行改成 TEXT(stored=True, analyzer=ChineseAnalyzer()</code></pre><p>最后修改setting的<code>&#39;ENGINE&#39;: &#39;haystack.backends.whoosh_backend.WhooshEngine&#39;</code>改为<code>&#39;ENGINE&#39;:&#39;haystack.backends.whoosh_cn_backend.WhooshEngine&#39;</code></p><p>最后执行python shell命令`python manage.py rebuild_index重新生成索引文件就可以jieba分词搜索了</p><h2 id="订单并发"><a href="#订单并发" class="headerlink" title="订单并发"></a>订单并发</h2><p>在Django的订单页面，处理订单的高并发处理有两种方法，一种叫悲观锁，另一种叫乐观锁</p><h3 id="悲观锁"><a href="#悲观锁" class="headerlink" title="悲观锁"></a>悲观锁</h3><p>当查询某条记录时，即让数据库为该记录加锁，锁住记录后别人无法操作，使用类似如下语法</p><pre class=" language-python"><code class="language-python">select stock <span class="token keyword">from</span> tb_sku where id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">for</span> update<span class="token punctuation">;</span>SKU<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>select_for_update<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></code></pre><p>这个跟多线程的互斥锁原理十分的相像</p><h3 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h3><p>乐观锁不是锁，只是在修改数据库库存的时候跟修改前的数据做对比，判断修改时的库存是不是跟之前查询的库存一样，连续判断两次，如果不一样就不执行这个操作，一样就执行更改</p><h3 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h3><p>这个其实不止有如上两个方法的，比如还有延迟队列、Redis集群来设计，但是单单对于Django来说这两个方法也足够应付了</p>]]></content>
      
      
      <categories>
          
          <category> 项目总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>天天生鲜项目总结（一）</title>
      <link href="/2019/10/14/tian-tian-sheng-xian-zong-jie-yi/"/>
      <url>/2019/10/14/tian-tian-sheng-xian-zong-jie-yi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;做天天生鲜项目的时候使用了太多的技术，很多不会的我参考了很多的博客才做出来，这里记录这个项目的常用技术点，以便于我开发第二个系统</p></blockquote><h2 id="使用Django内置的方法发送邮件"><a href="#使用Django内置的方法发送邮件" class="headerlink" title="使用Django内置的方法发送邮件"></a>使用Django内置的方法发送邮件</h2><p>首先先在setting.py文件里面配置你的邮件服务器，邮件服务器在QQ邮箱、网易163邮箱可以免费注册。</p><p>将SMTP服务器的配置信息放到setting.py文件里面，配置信息如以下格式：</p><pre class=" language-python"><code class="language-python">EMAIL_HOST <span class="token operator">=</span> <span class="token string">"smtp.qq.com"</span>EMAIL_PORT <span class="token operator">=</span> <span class="token number">25</span>EMAIL_HOST_USER <span class="token operator">=</span> <span class="token string">"373005226@qq.com"</span>EMAIL_HOST_PASSWORD <span class="token operator">=</span> <span class="token string">"***************"</span>EMAIL_USE_TLS<span class="token operator">=</span> <span class="token boolean">False</span>EMAIL_FROM <span class="token operator">=</span> <span class="token string">"373005226@qq.com"</span></code></pre><p>然后在需要发送邮件的方法内导入需要的包就可以使用Django内置的发送邮件函数了</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#导入setting刚刚配置的文件</span><span class="token keyword">from</span> dailyfreshshop<span class="token punctuation">.</span>settings <span class="token keyword">import</span> SECRET_KEY<span class="token punctuation">,</span>EMAIL_FROM<span class="token comment" spellcheck="true">#使用Django内置的发送方法</span><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mail <span class="token keyword">import</span> send_mailemail_title <span class="token operator">=</span> <span class="token string">"天天生鲜注册激活链接"</span>email_body <span class="token operator">=</span> <span class="token string">''</span>sender <span class="token operator">=</span> EMAIL_FROMreceiver <span class="token operator">=</span> <span class="token punctuation">[</span>email<span class="token punctuation">]</span>html_message <span class="token operator">=</span> <span class="token string">"&lt;h1>%s，欢迎您注册天天生鲜商城，请点击下面的连接激活你的账号&lt;/h1>"</span> \<span class="token string">"&lt;a href='http://127.0.0.1:8000/active/%s'>http://127.0.0.1:8000/active/%s&lt;/a>"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>    username<span class="token punctuation">,</span> token<span class="token punctuation">,</span> token<span class="token punctuation">)</span>send_mail<span class="token punctuation">(</span>email_title<span class="token punctuation">,</span> email_body<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> receiver<span class="token punctuation">,</span> html_message<span class="token operator">=</span>html_message<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#发送函数的参数</span><span class="token comment" spellcheck="true">#第一个参数email_title是标题</span><span class="token comment" spellcheck="true">#第二个参数email_body是内容，但是这个内容只能是字符串，如果再html_message写了这里就可以不写</span><span class="token comment" spellcheck="true">#第三个参数sender是setting配置好的SMTP服务器内容</span><span class="token comment" spellcheck="true">#第四个参数receiver是要发送的人的邮箱账号</span><span class="token comment" spellcheck="true">#第五个参数html_message=html_message，这个是如果你的内容共有html标签的话可以解析成html内容</span></code></pre><h2 id="邮箱注册，用户信息加密"><a href="#邮箱注册，用户信息加密" class="headerlink" title="邮箱注册，用户信息加密"></a>邮箱注册，用户信息加密</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在发送邮件注册验证码的时候，为了防止有心人注册之后使用发送过来的激活码调整激活码中用户的ID，不停地输入修改后的激活码就会给服务器带来压力，所以在发送邮箱激活码的时候一定要加密，并且设置时间</p><p>&emsp;</p><p>使用文档：<a href="https://itsdangerous.readthedocs.io/en/1.1.x/" target="_blank" rel="noopener">https://itsdangerous.readthedocs.io/en/1.1.x/</a></p><p>安装加密库：</p><pre><code>pip install -U itsdangerous</code></pre><p>&emsp;</p><p>打开python shell模拟使用方法：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> itsdangerous <span class="token keyword">import</span> TimedJSONWebSignatureSerializer <span class="token keyword">as</span> Serializer<span class="token operator">>></span><span class="token operator">></span> serializer<span class="token operator">=</span>Serializer<span class="token punctuation">(</span><span class="token string">'secretkey'</span><span class="token punctuation">,</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> info<span class="token operator">=</span><span class="token string">"123"</span><span class="token operator">>></span><span class="token operator">></span> res<span class="token operator">=</span>serializer<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> resb<span class="token string">'eyJhbGciOiJIUzUxMiIsImlhdCI6MTU3MTA0MDYyNCwiZXhwIjoxNTcxMDQ0MjI0fQ.IjEyMyI.jvwwArkwJP0sBMDyO8ydqIndyd1EqvrvsHAYah4sMqWhR4PFvaoQJ3rpybXmJMjbX4GTHNf1Fw_cCCFfuaixpQ'</span><span class="token operator">>></span><span class="token operator">></span> serializer<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token string">'123'</span><span class="token operator">>></span><span class="token operator">></span><span class="token string">"------------------把过期时间设置成2秒-------------------------"</span><span class="token operator">>></span><span class="token operator">></span> serializer<span class="token operator">=</span>Serializer<span class="token punctuation">(</span><span class="token string">'secretkey'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> info2<span class="token operator">=</span><span class="token string">"123"</span><span class="token operator">>></span><span class="token operator">></span> res<span class="token operator">=</span>serializer<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>info2<span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> resb<span class="token string">'eyJhbGciOiJIUzUxMiIsImlhdCI6MTU3MTA0MDc2NiwiZXhwIjoxNTcxMDQwNzY4fQ.IjEyMyI.ePHmZzoJN1bPNhfI-QOM22ZcqUXjdYLuReDSd2AMu3Sgn1zCwcWTjTSTZq5ZD97WnzVou8J65qgb2fRh_Elpgg'</span><span class="token operator">>></span><span class="token operator">></span> 两秒后<span class="token operator">>></span><span class="token operator">></span> serializer<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">)</span>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>  File <span class="token string">"C:\Users\LY\Envs\dailyfresh\lib\site-packages\itsdangerous\jws.py"</span><span class="token punctuation">,</span> line <span class="token number">205</span><span class="token punctuation">,</span> <span class="token keyword">in</span> loads    date_signed<span class="token operator">=</span>self<span class="token punctuation">.</span>get_issue_date<span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span>itsdangerous<span class="token punctuation">.</span>exc<span class="token punctuation">.</span>SignatureExpired<span class="token punctuation">:</span> Signature expired</code></pre><p>以如上的测试依据，添加代码</p><p><strong>注册发送邮箱激活码的类：</strong></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#邮箱的激活码是由用户的ID去加密而成的</span>serializer <span class="token operator">=</span> Serializer<span class="token punctuation">(</span>SECRET_KEY<span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'confirm'</span><span class="token punctuation">:</span>user<span class="token punctuation">.</span>id<span class="token punctuation">}</span>token<span class="token operator">=</span>serializer<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>info<span class="token punctuation">)</span>token <span class="token operator">=</span> token<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span></code></pre><p>&emsp;</p><p><strong>激活验证码的类</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">AciveUserView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">,</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>        serializer <span class="token operator">=</span> Serializer<span class="token punctuation">(</span>SECRET_KEY<span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            info<span class="token operator">=</span>serializer<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>token<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">#获取info的用户id</span>            user_id<span class="token operator">=</span>info<span class="token punctuation">[</span><span class="token string">'confirm'</span><span class="token punctuation">]</span>            <span class="token comment" spellcheck="true">#根据id来获取用户信息</span>            user<span class="token operator">=</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>id<span class="token operator">=</span>user_id<span class="token punctuation">)</span>            user<span class="token punctuation">.</span>is_active<span class="token operator">=</span><span class="token number">1</span>            user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> SignatureExpired <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token comment" spellcheck="true">#激活链接过期了</span>            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'激活链接过期，请重新提交'</span><span class="token punctuation">)</span></code></pre><p>这样就可以保证每一次发送的激活码都唯一，这样就保证了激活码的安全性</p><h2 id="异步方式"><a href="#异步方式" class="headerlink" title="异步方式"></a>异步方式</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/3.png" alt="Celery流程图"></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; broker可以选择RabbitMQ和Redis作为消息中间人去处理耗时任务，RabbitMQ是生产环境中最佳的选择，使用文档如下：<a href="http://docs.celeryproject.org/en/latest/getting-started/brokers/rabbitmq.html#broker-rabbitmq" target="_blank" rel="noopener">http://docs.celeryproject.org/en/latest/getting-started/brokers/rabbitmq.html#broker-rabbitmq</a>，Redis也是一款功能完备的broker选项，虽然整体而言是肯定不如RabbitMQ的，但它本身支持MQ功能，RabbitMQ有的Redis也能基本上实现，所以完全可以当做一个轻量级的队列服务来使用。关于Redis和RabbitMQ之间的比较可以看我这篇博客：</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在网站设计中，邮件发送等操作还算是比较耗时的，如果发送邮件和完成跳转是同步进行的话，要等邮件发送完成再跳转到指定页面，停顿的那几秒就会给用户带来很不好的体验，所以异步耗时操作最好是交给异步方法去执行。这个项目我拿的是redis作为中间件来执行</p><h2 id="异步发送邮件"><a href="#异步发送邮件" class="headerlink" title="异步发送邮件"></a>异步发送邮件</h2><p>第一步当然是redis服务器能够正常启动啦，我的redis服务器是部署到本地的</p><p>第二步是把需要异步操作的任务封装成函数，然后把原来同步操作的步骤使用异步的函数代替</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mail <span class="token keyword">import</span> send_mail<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings<span class="token keyword">from</span> celery <span class="token keyword">import</span> Celery<span class="token comment" spellcheck="true">#--------------这一段是异步任务执行端必须加入以下代码--------------------</span><span class="token keyword">import</span> os<span class="token keyword">import</span> djangoos<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'DJANGO_SETTINGS_MODULE'</span><span class="token punctuation">,</span> <span class="token string">'dailyfreshshop.settings'</span><span class="token punctuation">)</span>django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#------------------------------------------------------------------</span><span class="token comment" spellcheck="true">#celery_tasks是我存放异步任务的文件夹</span>app <span class="token operator">=</span> Celery<span class="token punctuation">(</span><span class="token string">'celery_tasks.tasks'</span><span class="token punctuation">,</span> broker<span class="token operator">=</span><span class="token string">'redis://127.0.0.1/8'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#必须加上装饰器才可以变成异步任务</span>@app<span class="token punctuation">.</span>task<span class="token keyword">def</span> <span class="token function">send_register_active_email</span><span class="token punctuation">(</span>to_email<span class="token punctuation">,</span> username<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""发送激活邮件"""</span>    <span class="token comment" spellcheck="true"># 组织邮件信息</span>    subject <span class="token operator">=</span> <span class="token string">'天天生鲜欢迎信息'</span>    message <span class="token operator">=</span> <span class="token string">''</span>    sender <span class="token operator">=</span> settings<span class="token punctuation">.</span>EMAIL_FROM  <span class="token comment" spellcheck="true"># 发送人</span>    receiver <span class="token operator">=</span> <span class="token punctuation">[</span>to_email<span class="token punctuation">]</span>    html_message <span class="token operator">=</span> <span class="token string">'&lt;h1>%s, 欢迎您成为天天生鲜注册会员&lt;/h1>请点击下面链接激活您的账户&lt;br/>&lt;a href="http://127.0.0.1:8000/user/active/%s">http://127.0.0.1:8000/user/active/%s&lt;/a>'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>username<span class="token punctuation">,</span> token<span class="token punctuation">,</span> token<span class="token punctuation">)</span>    send_mail<span class="token punctuation">(</span>subject<span class="token punctuation">,</span> message<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> receiver<span class="token punctuation">,</span> html_message<span class="token operator">=</span>html_message<span class="token punctuation">)</span></code></pre><p>&emsp;</p><p>最后需要执行命令</p><p>windows端：</p><pre class=" language-python"><code class="language-python">celery <span class="token operator">-</span>A celery_tasks<span class="token punctuation">.</span>tasks worker <span class="token operator">-</span>l info <span class="token operator">-</span>P eventlet</code></pre><p>Linux端：</p><pre><code>celery -A celery_tasks.tasks worker -l info</code></pre><p>看到ready就表示异步任务已经就绪啦，等待发送异步请求。而在原来的需要同步发送邮件的地方只需要改成异步函数的代码即可</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> celery_tasks<span class="token punctuation">.</span>tasks <span class="token keyword">import</span> send_register_active_email<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'registerUsername'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        password1 <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'registerPassword'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        password2 <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'registerPasswords'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        email <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'registeremail'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> password1 <span class="token operator">==</span> password2<span class="token punctuation">:</span>            password <span class="token operator">=</span> password1        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'register.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">"两次密码不一致，请重新填写"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token operator">not</span> all<span class="token punctuation">(</span><span class="token punctuation">[</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> email<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># all可以自动验证数据是否完整</span>            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'register.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'errormsg'</span><span class="token punctuation">:</span> <span class="token string">'数据不完整，请重新填写'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>        register_form <span class="token operator">=</span> RegisterForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>        <span class="token keyword">if</span> register_form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>email<span class="token operator">=</span>email<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">"register.html"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"register_form"</span><span class="token punctuation">:</span> register_form<span class="token punctuation">,</span> <span class="token string">"email_msg"</span><span class="token punctuation">:</span> <span class="token string">"邮箱已注册"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">"register.html"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"register_form"</span><span class="token punctuation">:</span> register_form<span class="token punctuation">,</span> <span class="token string">"user_msg"</span><span class="token punctuation">:</span> <span class="token string">"用户名已存在"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>            user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span>username<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">)</span>            user<span class="token punctuation">.</span>is_active <span class="token operator">=</span> <span class="token boolean">False</span>            user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">#加密用户的id发送链接</span>            serializer <span class="token operator">=</span> Serializer<span class="token punctuation">(</span>SECRET_KEY<span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>            info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'confirm'</span><span class="token punctuation">:</span>user<span class="token punctuation">.</span>id<span class="token punctuation">}</span>            token<span class="token operator">=</span>serializer<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>info<span class="token punctuation">)</span>            token <span class="token operator">=</span> token<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># email_title = "天天生鲜注册激活链接"</span>            <span class="token comment" spellcheck="true"># email_body = ''</span>            <span class="token comment" spellcheck="true"># sender = EMAIL_FROM</span>            <span class="token comment" spellcheck="true"># receiver = [email]</span>            <span class="token comment" spellcheck="true"># html_message = "&lt;h1>%s，欢迎您注册天天生鲜商城，请点击下面的连接激活你的账号&lt;/h1>" \</span>            <span class="token comment" spellcheck="true">#                "&lt;a href='http://127.0.0.1:8000/active/%s'>http://127.0.0.1:8000/active/%s&lt;/a>" % (</span>            <span class="token comment" spellcheck="true">#                    username, token, token)</span>            <span class="token comment" spellcheck="true"># send_mail(email_title, email_body, sender, receiver, html_message=html_message)</span>            <span class="token comment" spellcheck="true">#---------------------------------------------------------</span>            send_register_active_email<span class="token punctuation">.</span>delay<span class="token punctuation">(</span>email<span class="token punctuation">,</span> username<span class="token punctuation">,</span> token<span class="token punctuation">)</span>            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'邮箱验证码已经发送到您的邮箱，请点击连接激活'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'register.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'表单不准确'</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h2 id="Django注册登录表单验证"><a href="#Django注册登录表单验证" class="headerlink" title="Django注册登录表单验证"></a>Django注册登录表单验证</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Django有一套自己的表单验证方法，所以在注册登录等提交表单的操作时，可以在进行数据操作前使用表单验证一遍先，然后注册登录Django都有自己内置的方法，比如验证用户名密码不用我们自己去重写登陆逻辑，只需要<code>authenticate</code>内填上账号密码的参数就可以登陆。登陆方法也不用我们去写cookie等方法，直接一个login调用即可， 这里我拿项目的案例来说明</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 新建一个froms.py文件</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#要添加以下两个包</span><span class="token keyword">from</span> django <span class="token keyword">import</span> forms<span class="token keyword">from</span> captcha<span class="token punctuation">.</span>fields <span class="token keyword">import</span> CaptchaField<span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    这里的两个字段必须跟前台input定义的name相同    """</span>    username<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    password<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">RegisterForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    这里对注册的表单进行验证和生成验证码，验证码的方法captcha已经写好了    验证码会在前台生成一个hidden的input框，后台会生成一长串的字符串，然后联合查询验证码的正确与否    """</span>    registerUsername<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>min_length<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>    registerPassword<span class="token operator">=</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>    registeremail<span class="token operator">=</span>forms<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>               <span class="token comment" spellcheck="true">#使用forms.EmailField会对邮箱进行正则表达式的匹配，就不用开发者自己来写了</span>    captcha <span class="token operator">=</span> CaptchaField<span class="token punctuation">(</span>error_messages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"invalid"</span><span class="token punctuation">:</span><span class="token string">"验证码错误"</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>类只需要继承<code>forms.Form</code>就可以定义表单验证系统了。<code>Form</code>内部自定义了表单验证的错误信息和验证系统，<code>EmailField</code>如果你的邮箱格式不对也会返回一个错误。<code>captcha</code>是验证码字段，<code>CaptchaField(error_messages={&quot;invalid&quot;:&quot;&quot;})</code>是可以自定义文件错误</p><p>&emsp;</p><p>在进行数据库操作的时候可以先进行数据的验证，案例如下：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#注册逻辑</span><span class="token keyword">class</span> <span class="token class-name">RegisterView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>        register_form<span class="token operator">=</span>RegisterForm<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'register.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'register_form'</span><span class="token punctuation">:</span>register_form<span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'registerUsername'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        password1 <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'registerPassword'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        password2 <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'registerPasswords'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        email <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'registeremail'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> password1 <span class="token operator">==</span> password2<span class="token punctuation">:</span>            password <span class="token operator">=</span> password1            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'register.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">"两次密码不一致，请重新填写"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token operator">not</span> all<span class="token punctuation">(</span><span class="token punctuation">[</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> email<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># all可以自动验证数据是否完整</span>                <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'register.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'errormsg'</span><span class="token punctuation">:</span> <span class="token string">'数据不完整，请重新填写'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">#重点在这里，从这里定义我刚刚写的form表单验证</span>            register_form <span class="token operator">=</span> RegisterForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>            <span class="token keyword">if</span> register_form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>email<span class="token operator">=</span>email<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">"register.html"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"register_form"</span><span class="token punctuation">:</span> register_form<span class="token punctuation">,</span> <span class="token string">"email_msg"</span><span class="token punctuation">:</span> <span class="token string">"邮箱已注册"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">"register.html"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"register_form"</span><span class="token punctuation">:</span> register_form<span class="token punctuation">,</span> <span class="token string">"user_msg"</span><span class="token punctuation">:</span> <span class="token string">"用户名已存在"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>                user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span>username<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">)</span>                user<span class="token punctuation">.</span>is_active <span class="token operator">=</span> <span class="token boolean">False</span>                user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">#加密用户的id发送链接</span>                serializer <span class="token operator">=</span> Serializer<span class="token punctuation">(</span>SECRET_KEY<span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>                info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'confirm'</span><span class="token punctuation">:</span>user<span class="token punctuation">.</span>id<span class="token punctuation">}</span>                token<span class="token operator">=</span>serializer<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>info<span class="token punctuation">)</span>                token <span class="token operator">=</span> token<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>                send_register_active_email<span class="token punctuation">.</span>delay<span class="token punctuation">(</span>email<span class="token punctuation">,</span> username<span class="token punctuation">,</span> token<span class="token punctuation">)</span>                <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'邮箱验证码已经发送到您的邮箱，请点击连接激活'</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'register.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'表单不准确'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#登陆逻辑</span><span class="token keyword">class</span> <span class="token class-name">LoginView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">'username'</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>COOKIES<span class="token punctuation">:</span>            username<span class="token operator">=</span>request<span class="token punctuation">.</span>COOKIES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>            checked<span class="token operator">=</span><span class="token string">'checked'</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            username<span class="token operator">=</span><span class="token string">''</span>            checked<span class="token operator">=</span><span class="token string">''</span>        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'login.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'username'</span><span class="token punctuation">:</span>username<span class="token punctuation">,</span><span class="token string">'checked'</span><span class="token punctuation">:</span>checked<span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>        username<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>        password<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token operator">not</span> all<span class="token punctuation">(</span><span class="token punctuation">[</span>username<span class="token punctuation">,</span>password<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'login.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'errormsg'</span><span class="token punctuation">:</span> <span class="token string">'数据不完整，请重新填写'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>        login_form<span class="token operator">=</span>LoginForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>        <span class="token keyword">if</span> login_form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            user<span class="token operator">=</span>authenticate<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span>password<span class="token operator">=</span>password<span class="token punctuation">)</span>            <span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>                <span class="token keyword">if</span> user<span class="token punctuation">.</span>is_active<span class="token punctuation">:</span>                    login<span class="token punctuation">(</span>request<span class="token punctuation">,</span>user<span class="token punctuation">)</span>       <span class="token comment" spellcheck="true">#login方法是Django后台自定义的登陆方法，内置了cookie和session的方法</span>                    <span class="token comment" spellcheck="true">#默认登陆后跳转到首页</span>                    next_url<span class="token operator">=</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">,</span>reverse<span class="token punctuation">(</span><span class="token string">'goods:index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    response<span class="token operator">=</span>redirect<span class="token punctuation">(</span>next_url<span class="token punctuation">)</span>                    <span class="token comment" spellcheck="true">#判断是否记住用户名</span>                    remember<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'remember'</span><span class="token punctuation">)</span>                    <span class="token keyword">if</span> remember <span class="token operator">==</span> <span class="token string">"on"</span><span class="token punctuation">:</span>                        response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span>username<span class="token punctuation">,</span>max_age<span class="token operator">=</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">3600</span><span class="token punctuation">)</span>                    <span class="token keyword">else</span><span class="token punctuation">:</span>                        response<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span> response                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">"login.html"</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"email_msg"</span><span class="token punctuation">:</span><span class="token string">"你的邮箱未激活"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'login.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"user_msg"</span><span class="token punctuation">:</span><span class="token string">"用户名或密码错误"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">"login.html"</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"login_form"</span><span class="token punctuation">:</span>login_form<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>&emsp;</p><p>在写前端的时候，在定义好的表单错误样式里，写上这么一条语句</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>register-password<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input-material {% if register_form.errors.registerPassword %}error{% endif %}<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span>           <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>registerPassword<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>请输入密码<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>invalid-feedback<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        密码必须在6~10位之间    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>register-passwords<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input-material {% if register_form.errors.registerPassword %}error{% endif %}<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span>           <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>registerPasswords<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>确认密码<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>invalid-feedback<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        两次密码必须相同 且在6~10位之间    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>register-email<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input-material {% if register_form.errors.registeremail %}error{% endif %}<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span>           <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>registeremail<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>邮箱<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>login-username-error<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>is-invalid invalid-feedback<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name">         <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ email_msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>invalid-feedback<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        邮箱格式不正确    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group captcha1 {% if register_form.errors.captcha %} error {% endif %}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    {{ register_form.captcha }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>前端案例上的<code>register_form.errors</code>是刚刚forms定义好的字段，如果提交后字段错误，就会返回错误信息<code>registerPassword</code> 是<code>erros</code>遍历出来的错误信息中</p>]]></content>
      
      
      <categories>
          
          <category> 项目总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redis初步认识</title>
      <link href="/2019/10/13/redis1/"/>
      <url>/2019/10/13/redis1/</url>
      
        <content type="html"><![CDATA[<h2 id="Redis的五大数据结构"><a href="#Redis的五大数据结构" class="headerlink" title="Redis的五大数据结构"></a>Redis的五大数据结构</h2><ul><li>String</li><li>hash</li><li>list</li><li>set</li><li>zset</li></ul><h2 id="Redis的特性"><a href="#Redis的特性" class="headerlink" title="Redis的特性"></a>Redis的特性</h2><ol><li>速度快：因为redis是保存在内存当中的</li><li>持久化：Redis的数据保存在内存中，一般的保存在内存中突然断电内存就会丢失，所以redis在保存数据的时候会异步的保存在硬盘中</li><li>支持多种数据结构：Redis支持(字符串、列表、哈希、集合、有序集合)这五种数据结构，在新版本中也支持BitMaps(位图，使用很小的内存来实现高效的存储)、HyperLoglog(超小内存唯一计数，即使用12K)、GEO(地理信息定位 )这三种衍生的数据结构</li><li>支持多种语言：基本上现在的主流语言都是支持redis的</li><li>功能丰富：支持发布订阅、Lua脚本、事物，pipeline(提高客服端的并发效率)</li><li>简单性：Redis不依赖任何外部库和使用的是单线程模型</li><li>主从复制：主服务器的数据可以同步到从服务器上，给高可用和分布式提供了一个很好的基础</li><li>高可用、分布式：Redis单单靠主从复制是不能进行高可用分布式的，所以Redis2.8版本提供了Redis-Sentinel来支持高可用，Redis3.0版本提供了Redis-Cluster来支持分布式</li></ol><h2 id="Redis的应用场景"><a href="#Redis的应用场景" class="headerlink" title="Redis的应用场景"></a>Redis的应用场景</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Redis应用场景十分的广泛，缓存(比如在网站中可以使用Redis缓存来代替session和cookie)、计数器(比如微博的转发、评论数)、消息队列(比如Celery和redis结合来使用异步任务)、排行榜、实时系统(垃圾邮件过滤功能)、社交系统(比如youtube那些社交网站的共同关注数、粉丝数)等，大多数企业都使用了Redis</p><h2 id="Redis的常用命令"><a href="#Redis的常用命令" class="headerlink" title="Redis的常用命令"></a>Redis的常用命令</h2><ul><li><code>keys</code>：这个一般不在生产环境中使用，其一是因为key是一个很重的命令，时间复杂度为O(n)如果有上万个键值对一下子遍历出来会很慢，这个可以在不在生产环境中使用的从节点使用比较重的命令，不会对生产环境产生危害即可<ul><li><code>keys *</code>：查看所有的键</li><li><code>keys [pattern]</code>：keys支持正则表达式，比如<code>keys he*</code>,就可以选择出所有he开头的key</li></ul></li><li><code>dbsize</code>：计算keys的总数，这个是可以在生产环境中使用的，因为这个不是遍历所有的表，而是内置的一个计数器，所以时间复杂度是O(1)</li><li><code>exists keys</code>：判断一个key是否存在，存在返回1，不存在返回0</li><li><code>del key</code>：删除制定的key-value，成功删除返回1，不成功返回0</li><li><code>expire key seconds</code>：(设置过期时间)，一般用于网站记录用户缓存，seconds就是秒数，seconds为30就是30秒后过期<ul><li><code>ttl key</code>：查看key的过期时间，返回值为-2代表key不存在了，-1表示没有过期时间</li><li><code>persist key</code>：去除key过期时间</li></ul></li><li><code>type key</code>：查看key的数据类型</li><li><code>select number</code>：选择使用第number个数据库</li><li><code>info</code>：查看客户端的所有信息</li></ul><table><thead><tr><th>命令</th><th>时间复杂度</th></tr></thead><tbody><tr><td>keys</td><td>O(n)</td></tr><tr><td>dbsize</td><td>O(1)</td></tr><tr><td>exists keys</td><td>O(1)</td></tr><tr><td>del key</td><td>O(1)</td></tr><tr><td>expire key seconds</td><td>O(1)</td></tr><tr><td>type key</td><td>O(1)</td></tr></tbody></table><h2 id="Redis的数据结构和内部编码"><a href="#Redis的数据结构和内部编码" class="headerlink" title="Redis的数据结构和内部编码"></a>Redis的数据结构和内部编码</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1.png" alt=""></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;每一个数据结构都有自己的内部编码，在开发过程中，如果一些元素比较小的时候可以通过空间换时间的操作，这些得看开发中的具体要求和操作来定制</p><h2 id="Redis-的单线程操作"><a href="#Redis-的单线程操作" class="headerlink" title="Redis 的单线程操作"></a>Redis 的单线程操作</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Redis的单线程就像一个队列，每一个瞬间只能执行一个命令，所以在开发中，一定要注意不要轻易使用很长时间的命令，不然后面的命令都会阻塞在那</p><p>Redis单线程还这么快的原因跟node.js部分很像，快的原因如下</p><ul><li>Redis采用的是纯内存的存储，内存的存储是非常的快的(这个是主要的原因)</li><li>非阻塞IO</li><li>避免了线程的切换和竞态的消耗</li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis五大数据结构的介绍及基本命令使用</title>
      <link href="/2019/10/13/redis2/"/>
      <url>/2019/10/13/redis2/</url>
      
        <content type="html"><![CDATA[<h2 id="String-字符串"><a href="#String-字符串" class="headerlink" title="String(字符串)"></a>String(字符串)</h2><h3 id="String的限制"><a href="#String的限制" class="headerlink" title="String的限制"></a>String的限制</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String类型可以存储任何形式的字符串，比如整型，数字，二进制数据，json对象等，但是在有一个内存大小限制，最大只能存储512M</p><h3 id="字符串的API"><a href="#字符串的API" class="headerlink" title="字符串的API"></a>字符串的API</h3><ul><li>赋值：<ul><li>set ：<code>set key value</code>，加键值对，无论key是否存在都设置</li><li>setnx ：<code>setnx key value</code>，key不存在才添加键值对</li><li>set  xx：<code>set key value xx</code>，key存在才设置键值对</li><li>mset ：<code>mset key1 value1 key2 value2</code>，设置多个键值对，时间复杂度为O(n)</li><li>getset ：<code>getset key newvalue</code>，添加新的值并且返回老的值</li><li>append ：<code>append key value</code>，将value追加到旧的value</li><li>setrange ：<code>setrange key index value</code>，设置指定下标所有对应的值，比如hello的值为world，setrange hello 0 L就是得到Lorld</li></ul></li><li>查询：<ul><li>get ：<code>get key</code>，获取键值对</li><li>mget ：<code>mget key1 key2</code>，批量获取key，原子操作，时间复杂度为O(n)</li><li>strlen ：<code>strlen key</code>，返回字符串的长度(中文一个字占两个字符)</li><li>getrange ：<code>getrange key start end</code>，获取字符串指定下标的所有值，比如hello的值为world，getrange hello 0 2就是得到wor</li></ul></li><li>删除：<ul><li>del：<code>del key</code>，删除键值对</li></ul></li><li>自增：<ul><li>incr ：<code>incr key</code>，key自增1，如果key不存在，自增后get(key)=1</li><li>incrby ：<code>incrby key</code>，key自增k，如果key不存在，自增后get(key)=k</li><li>incrbyfloat ：<code>incrbyfloat key</code>，是浮点数的自增操作</li></ul></li><li>自减：<ul><li>decrby ：<code>decrby key</code>，key自减k，如果key不存在，自增后get(key)=-k</li><li>decr ：<code>decr key</code>，key自减1，如果key不存在，自增后get(key)=-1</li></ul></li></ul><h3 id="String的使用场景"><a href="#String的使用场景" class="headerlink" title="String的使用场景"></a>String的使用场景</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String一般适用于缓存（网站记录用户登录状态、视频缓存等）、计数器（比如每次观看视频，次数就+1，而且因为redis是单线程的，计数器是完全不会出错的），分布式锁等等</p><h2 id="hash-哈希"><a href="#hash-哈希" class="headerlink" title="hash(哈希)"></a>hash(哈希)</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash其实还是一个key-value结构，但是跟String有不同，hash类似于mysql的一个表的结构数据，每一个key都有一个field和value，field不能相同。就相当于key是mysql的一个表，filed是一个字段，value是值</p><h3 id="哈希的API"><a href="#哈希的API" class="headerlink" title="哈希的API"></a>哈希的API</h3><ul><li>赋值：<ul><li>hset：哈希赋值，比如hset user:1:info age 23</li><li>hmset ：<code>hmset key1 vaule 1 key2 value2</code>批量设置一批key和value</li><li>hsetnx ：<code>hsetnx key field value</code>设置hash key对应field的value（如果存在就设置失败）</li></ul></li><li>查询：<ul><li>hget：哈希取值，比如hget user:1:info age</li><li>hgetall：获取所有的属性和值，比如hgetall user:1:info，时间复杂度O(n)</li><li>hvals：<code>hvals key</code>返回hash key对应所有的field的value，比如hvals user:1:info，时间复杂度O(n)</li><li>hkeys ：<code>hkeys key</code>：返回hash key对应所有的field，时间复杂度O(n)</li><li>hexists ：<code>hexists key field</code>：判断 hash key是否存在field，比如hlen user:1:info name</li><li>hlen：<code>hlen key</code>：获取hash key field数量，比如hlen user:1:info</li><li>hmget ：<code>hmget key field1 field2</code>：批量获取key一批的field值</li></ul></li><li>删除：<ul><li>hdel：删除哈希的值，比如hdel user:1:info</li></ul></li><li>自增：<ul><li>hincrby ：<code>hincrby key field intCounter</code>hash key对应的field的value自增intCounter</li><li>hincrbyfloat ：<code>hincrbyfloat key field floatCounter</code>增加浮点数</li></ul></li></ul><h2 id="list-列表"><a href="#list-列表" class="headerlink" title="list(列表)"></a>list(列表)</h2><p>list是有序的列表，可以接受重复值</p><h3 id="列表的API"><a href="#列表的API" class="headerlink" title="列表的API"></a>列表的API</h3><ul><li>覆盖值：<ul><li>lset：<code>lset key index newValue</code>设置列表索引值为newValue</li></ul></li><li>插入值：<ul><li>lpush：从左端插入值</li><li>rpush：从右端插入值，如rpushlistkey c b a，就是从右边插入c b a</li><li>linsert：<code>linsert key before|after value newValue</code>，时间复杂度O(n)</li></ul></li><li>弹出值：<ul><li>rpop：从右端弹出值</li><li>lpop：从左端弹出值</li></ul></li><li>删除：<ul><li>lrem：<code>lrem key count value</code>根据count来删除所有value相等的项，时间复杂度为O(n)<ul><li>count&gt;0，从左到右，删除最多的count个value相等的项</li><li>count&lt;0，从右到左，删除最多的Math.abs(count)个value相等的项</li><li>count=0，删除所有的value相等的项</li></ul></li><li>ltrim：<code>ltrim key start end</code>，时间复杂度为O(n)，即只保留下标start到end的，时间复杂度为O(n)</li></ul></li><li>查询：<ul><li>lrange：<code>lrange key start end(包含end)</code>，这是一个查询的API，只查询start到end的，负号就是从右边开始，时间复杂度为O(n)</li><li>lindex：<code>lindex key index</code>获取列表指定索引的value，时间复杂度为O(n)</li><li>llen：<code>llen key</code>获取列表的长度</li></ul></li><li>阻塞版：b就是阻塞，比如一个空队列的话使用lpop会立刻弹出，但是使用blpop就会等待有值再弹出<ul><li>blpop：<code>blpop key timeout</code>，timeout是阻塞超时时间，=0代表永不阻塞</li><li>brpop：<code>brpop key timeout</code>，timeout是阻塞超时时间，=0代表永不阻塞</li></ul></li></ul><h2 id="set-集合"><a href="#set-集合" class="headerlink" title="set(集合)"></a>set(集合)</h2><h3 id="集合特征"><a href="#集合特征" class="headerlink" title="集合特征"></a>集合特征</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;集合是一个<strong>无序和无重复元素</strong>的的，还可以使用<strong>集合操作</strong>，集合就相当于我们高中学的数学的那个集合，两个集合可以交、并、补操作，同时集合是无序和不能重复的</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;集合的value是由field和value组成</p><h3 id="集合的API"><a href="#集合的API" class="headerlink" title="集合的API"></a>集合的API</h3><ul><li>添加：<ul><li>sadd：<code>sadd key element1 [element2]</code>向集合添加element，如果element已存在就添加失败，返回结果为0</li></ul></li><li>删除：<ul><li>srem：<code>srem key element</code>将集合key中的element删掉</li><li>spop：<code>spop key [count]</code>随机弹出集合的随机count个元素，如果没填就默认是1，改变原有的集合</li></ul></li><li>查询<ul><li>scard：<code>scard key</code>返回集合元素的数量</li><li>sismember：<code>SISMEMBER KEY VALUE</code> 计算元素是否在集合当中，是就返回1，不存在返回0</li><li>srandmember：<code>srandmember count</code> 返回集合中随便count 个元素，如果count没填就默认为1，不改变原有的集合</li><li>smembers：<code>smembers key [count]</code> 取出集合中所有的元素</li></ul></li><li>集合间的操作：<ul><li>sdiff：也就是数学集合中的差集  <code>sdiff key1 key2</code> </li><li>sinter：数学中的交集 <code>sinter key1 key2</code></li><li>sunion：数学中的并集 <code>sunion key1 key2</code></li></ul></li><li>保存集合操作的结果：<ul><li>sdiffstore：<code>sdiffstore newValue key1 key2</code>,保存key1和key2的差集结果在newValue中</li><li>sinterstore：<code>sinterstore newValue key1 key2</code>,保存key1和key2的交集结果在newValue中</li><li>sunionstore：<code>sunionstore newValue key1 key2</code>,保存key1和key2的并集结果在newValue中</li></ul></li></ul><h2 id="sorted-set-有序集合"><a href="#sorted-set-有序集合" class="headerlink" title="sorted set(有序集合)"></a>sorted set(有序集合)</h2><h3 id="有序集合特征"><a href="#有序集合特征" class="headerlink" title="有序集合特征"></a>有序集合特征</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;有序集合是无重复元素的、有序，有序集合的的value是由element和score共同组成，有序集合所有的API都是z开头</p><p>有序集合的score可以重复，element不可以重复</p><h3 id="zset跟list和set的区别"><a href="#zset跟list和set的区别" class="headerlink" title="zset跟list和set的区别"></a>zset跟list和set的区别</h3><table><thead><tr><th>集合(set)</th><th>有序集合(zset)</th></tr></thead><tbody><tr><td>无重复元素</td><td>无重复元素</td></tr><tr><td>无序</td><td>有序</td></tr><tr><td>value是由element组成</td><td>value由score+element组成</td></tr></tbody></table><table><thead><tr><th>列表(list)</th><th>有序集合(zset)</th></tr></thead><tbody><tr><td>可以有重复元素</td><td>无重复元素</td></tr><tr><td>有序</td><td>有序</td></tr><tr><td>value是由element组成</td><td>value由score+element组成</td></tr></tbody></table><h3 id="有序集合API"><a href="#有序集合API" class="headerlink" title="有序集合API"></a>有序集合API</h3><ul><li>zadd：<code>zadd key score element(可以是多个)</code>O(logN)</li><li>zrem：<code>zrem key element</code> 删除元素(可以是多个)</li><li>zscore：<code>zscore key element</code>查询分数</li><li>zincrby：<code>zincrby key increScore element</code>，给key增加increScore 分数</li><li>zcard：<code>zcard key</code>返回元素总个数</li><li>zrank：</li><li>zrange：<code>zrange key start end [withscore]</code>，返回指定范围内的排名数，时间复杂度为O(log(n)+m)</li><li>zrangebyscore：<code>zrangebyscore key minScore maxScore [withscore]</code>，返回指定范围的分数段，时间复杂度为O(log(n)+m)</li><li>zcount：<code>zcount key minScore maxScore</code>，返回指定分数范围内的个数</li><li>zremrangebyrank：<code>zremrangebyrank key start end</code>，删除指定排名内的升序元素，时间复杂度为O(log(n)+m)</li><li>zrevrank：从高到低的排名</li><li>zrevrange：</li><li>zrevrangebyscore</li><li>zunionstore：</li><li>zinterstore：</li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>死磕爬虫之scrapy下载中间件使用和配置</title>
      <link href="/2019/10/11/scrapy4/"/>
      <url>/2019/10/11/scrapy4/</url>
      
        <content type="html"><![CDATA[<blockquote><p> scrapy在请求网站的时候必须经过这个下载中间件</p><p>一些网站反爬虫措施做的比较严谨的时候，如果你并发过高就会封你ip等反爬虫操作，这个时候就可以使用一些代理、随机请求头来躲避这些反爬虫措施</p></blockquote><h2 id="常见的反爬虫策略"><a href="#常见的反爬虫策略" class="headerlink" title="常见的反爬虫策略"></a>常见的反爬虫策略</h2><ul><li><p>动态设置User-Agent（随机切换User-Agent，模拟不同用户的浏览器信息）</p></li><li><p>禁用Cookies（也就是不启用cookies middleware，不向Server发送cookies，有些网站通过cookie的使用发现爬虫行为）</p><ul><li>可以通过<code>COOKIES_ENABLED</code> 控制 CookiesMiddleware 开启或关闭</li></ul></li><li><p>设置延迟下载（防止访问过于频繁，设置为 2秒 或更高）</p></li><li><p>Google Cache 和 Baidu Cache：如果可能的话，使用谷歌/百度等搜索引擎服务器页面缓存获取页面数据。</p></li><li><p>使用IP地址池：VPN和代理IP，现在大部分网站都是根据IP来ban的。</p></li><li><p>使用 <a href="https://scrapinghub.com/crawlera" target="_blank" rel="noopener">Crawlera</a>（专用于爬虫的代理组件），正确配置和设置下载中间件后，项目所有的request都是通过crawlera发出（也就是爬虫代理商，直接使用他们给你的账号密码就可以不停地切换IP来反爬虫）</p><pre class=" language-python"><code class="language-python">  DOWNLOADER_MIDDLEWARES <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token string">'scrapy_crawlera.CrawleraMiddleware'</span><span class="token punctuation">:</span> <span class="token number">600</span>  <span class="token punctuation">}</span>  CRAWLERA_ENABLED <span class="token operator">=</span> <span class="token boolean">True</span>  CRAWLERA_USER <span class="token operator">=</span> <span class="token string">'注册/购买的UserKey'</span>  CRAWLERA_PASS <span class="token operator">=</span> <span class="token string">'注册/购买的Password'</span></code></pre></li></ul><h2 id="设置下载中间件（Downloader-Middlewares）"><a href="#设置下载中间件（Downloader-Middlewares）" class="headerlink" title="设置下载中间件（Downloader Middlewares）"></a>设置下载中间件（Downloader Middlewares）</h2><p>下载中间件是处于引擎(crawler.engine)和下载器(crawler.engine.download())之间的一层组件，可以有多个下载中间件被加载运行。</p><ol><li>当引擎传递请求给下载器的过程中，下载中间件可以对请求进行处理 （例如增加http header信息，增加proxy信息等）；</li><li>在下载器完成http请求，传递响应给引擎的过程中， 下载中间件可以对响应进行处理（例如进行gzip的解压等）</li></ol><p>要激活下载器中间件组件，将其加入到 DOWNLOADER_MIDDLEWARES 设置中。 该设置是一个字典(dict)，键为中间件类的路径，值为其中间件的顺序(order)。</p><h2 id="下载中间件字段"><a href="#下载中间件字段" class="headerlink" title="下载中间件字段"></a>下载中间件字段</h2><h3 id="process-request-self-request-spider"><a href="#process-request-self-request-spider" class="headerlink" title="process_request(self, request, spider)"></a>process_request(self, request, spider)</h3><ul><li><p>当每个request通过下载中间件时，该方法被调用。</p></li><li><p>process_request() 必须返回以下其中之一：一个 None 、一个 Response 对象、一个 Request 对象或 raise IgnoreRequest:</p><ul><li>如果其返回 None ，Scrapy将继续处理该request，执行其他的中间件的相应方法，直到合适的下载器处理函数(download handler)被调用， 该request被执行(其response被下载)。</li><li>如果其返回 Response 对象，Scrapy将不会调用 任何 其他的 process_request() 或 process_exception() 方法，或相应地下载函数； 其将返回该response。 已安装的中间件的 process_response() 方法则会在每个response返回时被调用。</li><li>如果其返回 Request 对象，Scrapy则停止调用 process_request方法并重新调度返回的request。当新返回的request被执行后， 相应地中间件链将会根据下载的response被调用。</li><li>如果其raise一个 IgnoreRequest 异常，则安装的下载中间件的 process_exception() 方法会被调用。如果没有任何一个方法处理该异常， 则request的errback(Request.errback)方法会被调用。如果没有代码处理抛出的异常， 则该异常被忽略且不记录(不同于其他异常那样)。</li></ul></li><li><p>参数:</p><ul><li><p><code>request (Request 对象)</code> – 处理的request</p></li><li><p><code>spider (Spider 对象)</code> – 该request对应的spider</p></li></ul></li></ul><h3 id="process-response-self-request-response-spider"><a href="#process-response-self-request-response-spider" class="headerlink" title="process_response(self, request, response, spider)"></a>process_response(self, request, response, spider)</h3><p>当下载器完成http请求，传递响应给引擎的时候调用</p><ul><li>process_request() 必须返回以下其中之一: 返回一个 Response 对象、 返回一个 Request 对象或raise一个 IgnoreRequest 异常。<ul><li>如果其返回一个 Response (可以与传入的response相同，也可以是全新的对象)， 该response会被在链中的其他中间件的 process_response() 方法处理。</li><li>如果其返回一个 Request 对象，则中间件链停止， 返回的request会被重新调度下载。处理类似于 process_request() 返回request所做的那样。</li><li>如果其抛出一个 IgnoreRequest 异常，则调用request的errback(Request.errback)。 如果没有代码处理抛出的异常，则该异常被忽略且不记录(不同于其他异常那样)。</li></ul></li><li>参数:<ul><li><code>request (Request 对象)</code> – response所对应的request</li><li><code>response (Response 对象)</code> – 被处理的response</li><li><code>spider (Spider 对象)</code> – response所对应的spider</li></ul></li></ul><h2 id="编写中间件字段"><a href="#编写中间件字段" class="headerlink" title="编写中间件字段"></a>编写中间件字段</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;首先先设置你的UserAgent和PROXIES的数据，可以在setting里面设置，也可以在中间件里面设置，但是setting直接导入就好了更方便，在类里面设置还得用个self。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;比如我的setting.py文件</p><pre class=" language-python"><code class="language-python">USER_AGENTS <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0)'</span><span class="token punctuation">,</span>    <span class="token string">'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.2)'</span><span class="token punctuation">,</span>    <span class="token string">'Opera/9.27 (Windows NT 5.2; U; zh-cn)'</span><span class="token punctuation">,</span>    <span class="token string">'Opera/8.0 (Macintosh; PPC Mac OS X; U; en)'</span><span class="token punctuation">,</span>    <span class="token string">'Mozilla/5.0 (Macintosh; PPC Mac OS X; U; en) Opera 8.0'</span><span class="token punctuation">,</span>    <span class="token string">'Mozilla/5.0 (Linux; U; Android 4.0.3; zh-cn; M032 Build/IML74K) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30'</span><span class="token punctuation">,</span>    <span class="token string">'Mozilla/5.0 (Windows; U; Windows NT 5.2) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/0.2.149.27 Safari/525.13'</span><span class="token punctuation">]</span>PROXIES <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span><span class="token string">"ip_port"</span><span class="token punctuation">:</span> <span class="token string">"IP地址:端口号"</span><span class="token punctuation">,</span> <span class="token string">"user_passwd"</span><span class="token punctuation">:</span> <span class="token string">"账号:密码"</span><span class="token punctuation">}</span>           <span class="token comment" spellcheck="true"># {"ip_prot" :"121.42.140.113:16816", "user_passwd" : ""}</span>           <span class="token comment" spellcheck="true"># {"ip_prot" :"121.42.140.113:16816", "user_passwd" : ""}</span>           <span class="token comment" spellcheck="true"># {"ip_prot" :"121.42.140.113:16816", "user_passwd" : ""}</span>           <span class="token punctuation">]</span></code></pre><p>然后编写中间件字段：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> random<span class="token keyword">import</span> base64<span class="token keyword">from</span> ZLzhaoping<span class="token punctuation">.</span>settings <span class="token keyword">import</span> USER_AGENTS<span class="token keyword">from</span> ZLzhaoping<span class="token punctuation">.</span>settings <span class="token keyword">import</span> PROXIES<span class="token comment" spellcheck="true"># 随机的User-Agent</span><span class="token keyword">class</span> <span class="token class-name">RandomUserAgent</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        useragent <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>USER_AGENTS<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#print useragent</span>        request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span> useragent<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">RandomProxy</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        proxy <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>PROXIES<span class="token punctuation">)</span>        <span class="token keyword">if</span> proxy<span class="token punctuation">[</span><span class="token string">'user_passwd'</span><span class="token punctuation">]</span> <span class="token keyword">is</span> None<span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># 没有代理账户验证的代理使用方式</span>            request<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'proxy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> proxy<span class="token punctuation">[</span><span class="token string">'ip_port'</span><span class="token punctuation">]</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># 对账户密码进行base64编码转换</span>            base64_userpasswd <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>proxy<span class="token punctuation">[</span><span class="token string">'user_passwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 对应到代理服务器的信令格式里</span>            request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Proxy-Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Basic '</span> <span class="token operator">+</span> base64_userpasswd            request<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'proxy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> proxy<span class="token punctuation">[</span><span class="token string">'ip_port'</span><span class="token punctuation">]</span></code></pre><p>HTTP代理登陆的时候是要使用登陆验证的，原因如下：</p><blockquote><p>为什么HTTP代理要使用base64编码：</p><p>HTTP代理的原理很简单，就是通过HTTP协议与代理服务器建立连接，协议信令中包含要连接到的远程主机的IP和端口号，如果有需要身份验证的话还需要加上授权信息，服务器收到信令后首先进行身份验证，通过后便与远程主机建立连接，连接成功之后会返回给客户端200，表示验证通过，就这么简单，下面是具体的信令格式：</p></blockquote><pre class=" language-python"><code class="language-python">CONNECT <span class="token number">59.64</span><span class="token punctuation">.</span><span class="token number">128.198</span><span class="token punctuation">:</span><span class="token number">21</span> HTTP<span class="token operator">/</span><span class="token number">1.1</span>Host<span class="token punctuation">:</span> <span class="token number">59.64</span><span class="token punctuation">.</span><span class="token number">128.198</span><span class="token punctuation">:</span><span class="token number">21</span>Proxy<span class="token operator">-</span>Authorization<span class="token punctuation">:</span> Basic bGV2I1TU5OTIzUser<span class="token operator">-</span>Agent<span class="token punctuation">:</span> OpenFetion</code></pre><blockquote><p>其中<code>Proxy-Authorization</code>是身份验证信息，Basic后面的字符串是用户名和密码组合后进行base64编码的结果，也就是对username:password进行base64编码。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scrapy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>软件测试之常用模型</title>
      <link href="/2019/10/11/ruan-jian-ce-shi/"/>
      <url>/2019/10/11/ruan-jian-ce-shi/</url>
      
        <content type="html"><![CDATA[<h2 id="软件测试分类总览"><a href="#软件测试分类总览" class="headerlink" title="软件测试分类总览"></a>软件测试分类总览</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570813998688.png" alt="软件测试分类图"></p><p>单元测试：集中编码和单元测试中，大多数时候用来开发自测、自我校验的一个手段</p><p>冒烟测试：在后续需求中，对主要流程进行测试</p><p>集成测试：模块与模块之间的测试</p><p>系统测试：通过测试用例的执行来完成过程</p><p>α测试：α测试就是让用户、开发人员、测试人员共同参与的测试</p><p>β测试：β测试就是交给最终用户测试 ，简明而言就是游戏内测</p><p>……</p><h2 id="软件测试常用模型"><a href="#软件测试常用模型" class="headerlink" title="软件测试常用模型"></a>软件测试常用模型</h2><h3 id="V模型"><a href="#V模型" class="headerlink" title="V模型"></a>V模型</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;众所周知，瀑布模型的软件生命周期是分为：<strong>计划、分析、设计、编码、测试和维护6个阶段</strong>，瀑布模型的缺点就是早期的错误只能到后期的测试阶段才能知道。V模型就是对瀑布模型做了个改进，在软件开发的生命周期里，软件开发和测试活动同时进行，这样机会极大的减少Bug的几率。</p><p>​        <img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570853745995.png" alt="V模型过程"></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V模型最大的价值就是标明了测试过程中分开了很多个级别，同时也描述了开发过程阶段和测试阶段的对应关系：<strong>单元测试以详细设计为参考、集成测试以概要设计为参考、系统测试以需求分析为参考、到客户的验收测试以用户需求为参考</strong>，一一对应的关系十分明确，但是还是有局限性：<strong>测试还是在编码阶段的最后一个活动，比如需求分析的错误还是要到系统测试才能发现，有十分大的滞后性</strong>，所以这就产生了一个新的模型：<strong>W模型</strong></p><h3 id="W模型"><a href="#W模型" class="headerlink" title="W模型"></a>W模型</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对于V模型而言，W模型更为科学，W模型是V模型的一个发展，强调测试的过程伴随着整个开发周期，测试的对象也不仅仅只是程序，需求、功能、设计也同样需要测试，测试和开发也就是变成了同步执行，有利于尽早的发现问题，对于那种高性能、高风险的互联网软件、或者难以进行模块化的大型软件，使用V模型就有一定的困难和风险了，需要更强调迭代的开发模型和敏捷开发模型，这个时候使用W模型就会更好一些。</p><p>&emsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;W模型就是从V模型演化而来，相对于V模型，W模型增加了软件各开发阶段中应同步进行的验证和确认活动，W模型明确了测试和开发的并行关系，测试与开发同步进行更利于发现问题和降低风险。</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570854774951.png" alt="W模型过程"></p><p>图中一条线是软件开发研发线，一条是测试线</p><p>&emsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;W模型自身也具有局限性：<strong>W模型和V模型一样，都把软件开发的周期当做一个串行的活动，没有办法支持迭代</strong>，后来针对于V模型和W模型的局限性开发了一个H模型</p><h3 id="H模型"><a href="#H模型" class="headerlink" title="H模型"></a>H模型</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H模型中，真正的测试级别中不存在严格的次序关系，各阶段之间可以反复的触发、迭代、增量。H模型把测试活动完全独立出来，贯穿于整个产品的周期里，和其他流程是并发执行的。H模型的特点就是只要测试条件成立，就可以马上开始测试，也就是软件测试是一个独立的流程</p><h3 id="X模型"><a href="#X模型" class="headerlink" title="X模型"></a>X模型</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570855415109.png" alt="X模型过程"></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X模型就是把一个程序分为多个片段，左边是针对于一个单独的程序片段进行互相分离的编码和测试，后面进行频繁的集成和交接，最终集成为一个可以执行的程序，然后再进行测试。这样就对一个程序进行反复的迭代。</p><p>&emsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X模型也是唯一一个定位了探索性测试的测试模型，是一种特殊的类型的测试：前面进行了各个程序片段的单独测试，到集成测试的时候，更多依赖于没有事先计划的特殊类型的测试方式，让有经验的人可以发现更多的软件错误，X模型也就是对测试人员要求比较高的一个模型方式，可迭代、可集成。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X模型对测试人员要求比较高，就目前而言，用的最多的可能是W模型的一个变换、或者是W和H的一个结合，测试的内容以W模型为准，测试的周期方法进度以H模型作为一个指导的，X模型更多时候是对于最终测试或熟练性测试的一个模板</p>]]></content>
      
      
      <categories>
          
          <category> 软件测试 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>死磕爬虫之scrapy模拟登陆的方法</title>
      <link href="/2019/10/10/scrapy3/"/>
      <url>/2019/10/10/scrapy3/</url>
      
        <content type="html"><![CDATA[<blockquote><p> 以下三个策略以人人网作为案例来描述</p></blockquote><h2 id="策略一：使用保存的cookie登陆（100-成功）"><a href="#策略一：使用保存的cookie登陆（100-成功）" class="headerlink" title="策略一：使用保存的cookie登陆（100%成功）"></a>策略一：使用保存的cookie登陆（100%成功）</h2><h3 id="登陆后查看自己的cookie信息"><a href="#登陆后查看自己的cookie信息" class="headerlink" title="登陆后查看自己的cookie信息"></a>登陆后查看自己的cookie信息</h3><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570770626349.png" alt="cookie信息"></p><h3 id="重写Spider类的start-requests方法"><a href="#重写Spider类的start-requests方法" class="headerlink" title="重写Spider类的start_requests方法"></a>重写Spider类的start_requests方法</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;因为所有的爬虫类都是继承于Spider的，所以重写start_requests方法可以适用于所有的爬虫类</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最重要记得要把setting.py的COOKIES_ENABLED开启起来</p><p>&emsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我的setting.py文件关键配置如下：</p><pre class=" language-python"><code class="language-python">COOKIES_ENABLED <span class="token operator">=</span> <span class="token boolean">True</span>DEFAULT_REQUEST_HEADERS <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span><span class="token punctuation">,</span>  <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36'</span><span class="token punctuation">,</span><span class="token punctuation">}</span>ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span></code></pre><p>然后使用命令创建一个新的爬虫文件(renren.py)</p><h3 id="编写爬虫字段"><a href="#编写爬虫字段" class="headerlink" title="编写爬虫字段"></a>编写爬虫字段</h3><p>renren.py</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">RenrenSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'renren'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.renren.com/972451360/newsfeed/photo'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.renren.com/972451360/newsfeed/photo/'</span><span class="token punctuation">]</span>    cookies <span class="token operator">=</span><span class="token punctuation">{</span>    <span class="token string">"JSESSIONID"</span><span class="token punctuation">:</span> <span class="token string">"abc6L9jo347Dw9fWUf52w"</span><span class="token punctuation">,</span>    <span class="token string">"anonymid"</span> <span class="token punctuation">:</span> <span class="token string">"k1lmx3wm-pdg03r"</span><span class="token punctuation">,</span>    <span class="token string">"_r01_"</span> <span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>    <span class="token string">"depovince"</span> <span class="token punctuation">:</span> <span class="token string">"GW"</span><span class="token punctuation">,</span>    <span class="token string">"springskin"</span> <span class="token punctuation">:</span> <span class="token string">"set"</span><span class="token punctuation">,</span>    <span class="token string">"jebe_key"</span> <span class="token punctuation">:</span> <span class="token string">"09e48352-6a6a-490c-a137-d78928ffe419%7C18edbeb77a97f6145ca4db5e06940ded%7C1570768484510%7C1%7C1570768487369"</span><span class="token punctuation">,</span>    <span class="token string">"t"</span> <span class="token punctuation">:</span> <span class="token string">"7e803da6e1d3c6ce4421d9adc13a20390"</span><span class="token punctuation">,</span>    <span class="token string">"societyguester"</span> <span class="token punctuation">:</span> <span class="token string">"7e803da6e1d3c6ce4421d9adc13a20390"</span><span class="token punctuation">,</span>    <span class="token string">"id"</span> <span class="token punctuation">:</span> <span class="token string">"972451360"</span><span class="token punctuation">,</span>    <span class="token string">"xnsid"</span> <span class="token punctuation">:</span> <span class="token string">"46d5aac1cccccccc"</span><span class="token punctuation">,</span>    <span class="token string">"loginfrom"</span> <span class="token punctuation">:</span> <span class="token string">"null"</span>    <span class="token punctuation">}</span>    <span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> url <span class="token keyword">in</span> self<span class="token punctuation">.</span>start_urls<span class="token punctuation">:</span>            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>FormRequest<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cookies<span class="token operator">=</span>self<span class="token punctuation">.</span>cookies<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_page<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">parse_page</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"deng.html"</span><span class="token punctuation">,</span> <span class="token string">"wb+"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> filename<span class="token punctuation">:</span>            filename<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span></code></pre><p>爬取得到的结果如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570776253453.png" alt=""></p><p>这个方法虽然麻烦，但是肯定是可以成功的</p><h2 id="策略二：使用post请求来模拟登陆"><a href="#策略二：使用post请求来模拟登陆" class="headerlink" title="策略二：使用post请求来模拟登陆"></a>策略二：使用post请求来模拟登陆</h2><h3 id="找到表单登陆请求地址"><a href="#找到表单登陆请求地址" class="headerlink" title="找到表单登陆请求地址"></a>找到表单登陆请求地址</h3><p>如果使用post请求的话就一定要找到人人网登陆表单的请求地址，人人网的请求地址如图所示：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570769345282.png" alt="人人网表单"></p><p>得到的地址就为’<a href="http://www.renren.com/PLogin.do&#39;" target="_blank" rel="noopener">http://www.renren.com/PLogin.do&#39;</a></p><h3 id="编写爬虫字段-1"><a href="#编写爬虫字段-1" class="headerlink" title="编写爬虫字段"></a>编写爬虫字段</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">RenrenSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'renren'</span>    <span class="token comment" spellcheck="true"># allowed_domains = ['http://www.renren.com/972451360/newsfeed/photo']</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.renren.com/972451360/newsfeed/photo/'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        url <span class="token operator">=</span> <span class="token string">'http://www.renren.com/PLogin.do'</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">""</span>        <span class="token punctuation">}</span>        request <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>FormRequest<span class="token punctuation">(</span>url<span class="token punctuation">,</span> formdata<span class="token operator">=</span>data<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_page<span class="token punctuation">)</span>        <span class="token keyword">yield</span> request    <span class="token keyword">def</span> <span class="token function">parse_page</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"renren.html"</span><span class="token punctuation">,</span> <span class="token string">"wb+"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> filename<span class="token punctuation">:</span>            filename<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span></code></pre><p>这个方法其实就先访问登陆页面的表单，然后登陆成功之后再去爬取想要的页面</p><h2 id="策略三：模拟正规的登陆流程来模拟登陆"><a href="#策略三：模拟正规的登陆流程来模拟登陆" class="headerlink" title="策略三：模拟正规的登陆流程来模拟登陆"></a>策略三：模拟正规的登陆流程来模拟登陆</h2><h3 id="编写爬虫字段-2"><a href="#编写爬虫字段-2" class="headerlink" title="编写爬虫字段"></a>编写爬虫字段</h3><p>这个方法不同于前两种，前两种是重写start_requests方法，这个方法是模拟用户的登陆流程：先访问登陆页面，输入账号密码之后再访问详情页面</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">RenrenSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'renren'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'renren.com'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://renren.com/'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 处理start_urls里的登录url的响应内容，提取登陆需要的参数（如果需要的话)</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 提取登陆需要的参数</span>        <span class="token comment" spellcheck="true"># 发送请求参数，并调用指定回调函数处理</span>        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>FormRequest<span class="token punctuation">.</span>from_response<span class="token punctuation">(</span>            response<span class="token punctuation">,</span>            formdata<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"你的邮箱"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"你的密码"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>            callback <span class="token operator">=</span> self<span class="token punctuation">.</span>parse_page            <span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取登录成功状态，访问需要登录后才能访问的页面</span>    <span class="token keyword">def</span> <span class="token function">parse_page</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        url <span class="token operator">=</span> <span class="token string">"http://www.renren.com/422167102/profile"</span>        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_newpage<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 处理响应内容</span>    <span class="token keyword">def</span> <span class="token function">parse_newpage</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"renren.html"</span><span class="token punctuation">,</span> <span class="token string">"wb+"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> filename<span class="token punctuation">:</span>            filename<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span></code></pre><h2 id="补充点"><a href="#补充点" class="headerlink" title="补充点"></a>补充点</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;单单爬取人人网这类的简单网站用以上三个方法是没问题的，但是类似于知乎这种使用<code>Django</code>作为后台的网站，登陆注册都有个<code>_xsrf</code>字段放在form表单的末尾，这个字段是Django为了防止 跨站域请求伪造攻击而添加的。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;所以在使用模拟登陆前一定要查看表单有没有这个字段，如果有就用xpath或者正则表达式提取出来，然后一起提交。比如我这里拿最后一个方法来说明：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">RenrenSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'renren'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'renren.com'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://renren.com/'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 处理start_urls里的登录url的响应内容，提取登陆需要的参数（如果需要的话)</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 提取登陆需要的参数</span>        _xsrf <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//_xsrf"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># 发送请求参数，并调用指定回调函数处理</span>        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>FormRequest<span class="token punctuation">.</span>from_response<span class="token punctuation">(</span>            response<span class="token punctuation">,</span>            formdata<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"xxx@163.com"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token string">"_xsrf"</span> <span class="token punctuation">:</span> _xsrf <span class="token punctuation">}</span><span class="token punctuation">,</span>        callback <span class="token operator">=</span> self<span class="token punctuation">.</span>parse_page        <span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取登录成功状态，访问需要登录后才能访问的页面</span>        <span class="token keyword">def</span> <span class="token function">parse_page</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>            url <span class="token operator">=</span> <span class="token string">"http://www.renren.com/422167102/profile"</span>            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_newpage<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 处理响应内容</span>        <span class="token keyword">def</span> <span class="token function">parse_newpage</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"renren.html"</span><span class="token punctuation">,</span> <span class="token string">"wb+"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> filename<span class="token punctuation">:</span>                filename<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scrapy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>死磕爬虫之CrawlSpider类</title>
      <link href="/2019/10/09/crawlspider/"/>
      <url>/2019/10/09/crawlspider/</url>
      
        <content type="html"><![CDATA[<blockquote><p>爬虫文件继承的类不仅只有scrapy.Spider类，还有很多类，但是Spider是所有爬虫类的基类。这里我介绍一下CrawlSpider类的使用、说明和spider类和CrawlSpider类的对比</p></blockquote><h2 id="Spider与CrawlSpider案例对比"><a href="#Spider与CrawlSpider案例对比" class="headerlink" title="Spider与CrawlSpider案例对比"></a>Spider与CrawlSpider案例对比</h2><h3 id="Spider爬取有页码的数据"><a href="#Spider爬取有页码的数据" class="headerlink" title="Spider爬取有页码的数据"></a>Spider爬取有页码的数据</h3><p>Spider在爬取有页码的数据的时候要使用回调函数，在请求完一页的数据之后使用回调函数继续执行下一个页面</p><p>比如我这要爬取的是csdn的论坛网站</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570709064975.png" alt=""></p><p>下面有五页数据，从第二页开始url地址就会增加个pages，所以在每次请求完页面的时候都给pages+1去重新爬取新的页面。</p><p>部分源码如下：</p><p>scdemo.py（爬虫文件）</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> scrapy<span class="token keyword">from</span> ZLzhaoping<span class="token punctuation">.</span>items <span class="token keyword">import</span> ZlzhaopingItem<span class="token keyword">class</span> <span class="token class-name">ScdemoSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'scdemo'</span>    <span class="token comment" spellcheck="true"># allowed_domains = ['https://sou.zhaopin.com/?jl=763']</span>    pages<span class="token operator">=</span><span class="token number">1</span>    url<span class="token operator">=</span><span class="token string">'https://bbs.csdn.net/forums/OL_Script?page='</span>    start_urls <span class="token operator">=</span><span class="token punctuation">[</span>url<span class="token operator">+</span>str<span class="token punctuation">(</span>pages<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        zhilian <span class="token operator">=</span> ZlzhaopingItem<span class="token punctuation">(</span><span class="token punctuation">)</span>        list<span class="token operator">=</span>response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//td[@class='forums_topic']"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> each <span class="token keyword">in</span> list<span class="token punctuation">:</span>            title<span class="token operator">=</span>each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"./a[contains(@class,'forums_title ')]/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>            zhilian<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token operator">=</span>title<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">yield</span> zhilian        <span class="token keyword">if</span> self<span class="token punctuation">.</span>pages<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>pages<span class="token operator">+=</span><span class="token number">1</span>        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url <span class="token operator">+</span> str<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pages<span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># with open("bbs.html", "wb+") as f:</span>        <span class="token comment" spellcheck="true">#     f.write(response.body)</span></code></pre><p>pipelines.py（管道文件）</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> json<span class="token keyword">class</span> <span class="token class-name">ZlzhaopingPipeline</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>filename <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">"zp.json"</span><span class="token punctuation">,</span> <span class="token string">"wb+"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        jsontext <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span>        self<span class="token punctuation">.</span>filename<span class="token punctuation">.</span>write<span class="token punctuation">(</span>jsontext<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> item    <span class="token keyword">def</span> <span class="token function">close_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>filename<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><blockquote><p>里面代码关键的就是确定爬取的页码是多少，然后每一次请求玩一页的数据都让pages+1，这样就可以循环出所有的页码的数据了。不过使用CrawlSpider会更简单，CrawlSpider可以创建自己的规则,比如只要存在还有跳转到下一页页码的url字段，就反复请求。</p></blockquote><h3 id="CrawlSpider爬取有页码的数据"><a href="#CrawlSpider爬取有页码的数据" class="headerlink" title="CrawlSpider爬取有页码的数据"></a>CrawlSpider爬取有页码的数据</h3><p>crawlSpider我先演示一下同样是爬取同一个网页</p><p>使用如下命令快捷创建CrawlSpider</p><pre class=" language-python"><code class="language-python">$ scrapy genspider <span class="token operator">-</span>t crawl clidemo https<span class="token punctuation">:</span><span class="token operator">//</span>bbs<span class="token punctuation">.</span>csdn<span class="token punctuation">.</span>net<span class="token operator">/</span>forums<span class="token operator">/</span>OL_Script?page<span class="token operator">=</span><span class="token number">0</span></code></pre><p>clidemo.py:</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>linkextractors <span class="token keyword">import</span> LinkExtractor<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> CrawlSpider<span class="token punctuation">,</span> Rule<span class="token keyword">from</span> ZLzhaoping<span class="token punctuation">.</span>items <span class="token keyword">import</span> ZlzhaopingItem<span class="token keyword">class</span> <span class="token class-name">ClidemoSpider</span><span class="token punctuation">(</span>CrawlSpider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'clidemo'</span>    <span class="token comment" spellcheck="true"># allowed_domains = ['https://bbs.csdn.net/forums/OL_Script?page=2']</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://bbs.csdn.net/forums/OL_Script?page=0'</span><span class="token punctuation">]</span>    rules <span class="token operator">=</span> <span class="token punctuation">(</span>        Rule<span class="token punctuation">(</span>LinkExtractor<span class="token punctuation">(</span>allow<span class="token operator">=</span>r<span class="token string">'page=\d+'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span><span class="token string">'parse_item'</span><span class="token punctuation">,</span> follow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">parse_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        zhilian <span class="token operator">=</span> ZlzhaopingItem<span class="token punctuation">(</span><span class="token punctuation">)</span>        list<span class="token operator">=</span>response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//td[@class='forums_topic']"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> each <span class="token keyword">in</span> list<span class="token punctuation">:</span>            title<span class="token operator">=</span>each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"./a[contains(@class,'forums_title ')]/text()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>            zhilian<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token operator">=</span>title<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">yield</span> zhilian</code></pre><blockquote><p>运行之后就可以直接把所有的页面全部爬完了,方法比Spider来写方便很多。</p><p>唯一不足的地方就是CrawlSpider一次性把全部的页码请求完，而Spider可以设置一个停止条件，不必全部爬完。</p></blockquote><h2 id="CrawlSpider的字段详解"><a href="#CrawlSpider的字段详解" class="headerlink" title="CrawlSpider的字段详解"></a>CrawlSpider的字段详解</h2><p>CrawlSpider源码没啥好解释的，写的挺清楚的，这里解释一下CrawlSpider的匹配规则和提取规则</p><p><strong>LinkExtractor：</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> allow<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> deny<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> allow_domains<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> deny_domains<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> restrict_xpaths<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                 tags<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'area'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attrs<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> canonicalize<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>                 unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> process_value<span class="token operator">=</span>None<span class="token punctuation">,</span> deny_extensions<span class="token operator">=</span>None<span class="token punctuation">,</span> restrict_css<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                 strip<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span></code></pre><p>其中主要的参数如下：</p><ul><li><code>allow</code>：满足括号中“正则表达式”的值会被提取，如果为空，则全部匹配。</li><li><code>deny</code>：与这个正则表达式(或正则表达式列表)不匹配的URL一定不提取。</li><li><code>allow_domains</code>：会被提取的链接的domains。</li><li><code>deny_domains</code>：一定不会被提取链接的domains。</li><li><code>restrict_xpaths</code>：使用xpath表达式，和allow共同作用过滤链接。</li></ul><p><strong>Rule：</strong></p><pre class=" language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> link_extractor<span class="token punctuation">,</span> callback<span class="token operator">=</span>None<span class="token punctuation">,</span> cb_kwargs<span class="token operator">=</span>None<span class="token punctuation">,</span> follow<span class="token operator">=</span>None<span class="token punctuation">,</span> process_links<span class="token operator">=</span>None<span class="token punctuation">,</span> process_request<span class="token operator">=</span>identity<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>link_extractor <span class="token operator">=</span> link_extractor        self<span class="token punctuation">.</span>callback <span class="token operator">=</span> callback        self<span class="token punctuation">.</span>cb_kwargs <span class="token operator">=</span> cb_kwargs <span class="token operator">or</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        self<span class="token punctuation">.</span>process_links <span class="token operator">=</span> process_links        self<span class="token punctuation">.</span>process_request <span class="token operator">=</span> process_request        <span class="token keyword">if</span> follow <span class="token keyword">is</span> None<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>follow <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token keyword">if</span> callback <span class="token keyword">else</span> <span class="token boolean">True</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>follow <span class="token operator">=</span> follow</code></pre><ul><li><p><code>link_extractor</code>：是一个Link Extractor对象，用于定义需要提取的链接。</p></li><li><p><code>callback</code>： 从link_extractor中每获取到链接时，参数所指定的值作为回调函数，该回调函数接受一个response作为其第一个参数。</p><blockquote><p>注意：当编写爬虫规则时，避免使用parse作为回调函数。由于CrawlSpider使用parse方法来实现其逻辑，如果覆盖了 parse方法，crawl spider将会运行失败。</p></blockquote></li><li><p><code>follow</code>：是一个布尔(boolean)值，指定了根据该规则从response提取的链接是否需要跟进(就是是否根据爬取到的页面继续点进去爬取)。 如果callback为None，follow 默认就为True。如果写了callback，follow默认就为False</p></li><li><p><code>process_links</code>：指定该spider中哪个的函数将会被调用，从link_extractor中获取到链接列表时将会调用该函数。该方法主要用来过滤。（比如一些网站，在你快速爬取的时候回给你一些错误的链接让你中断爬取，通常会修改url地址的某些参数，比如说&amp;改成？，但是使用CrawlSpider的话，只要写一个函数来修改就可以了，方法如 process_links=”deal_links”）</p></li><li><p><code>process_request</code>：指定该spider中哪个的函数将会被调用， 该规则提取到每个request时都会调用该函数。 (用来过滤request)</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scrapy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>死磕爬虫之scrapy框架初识</title>
      <link href="/2019/10/07/scrapy/"/>
      <url>/2019/10/07/scrapy/</url>
      
        <content type="html"><![CDATA[<blockquote><p>前言</p><p>​        我们原生爬虫需要使用urllib、requests等库去请求指定的网址，然后通过正则表达式、xpath、css选择等去解析网址，得到自己想要的信息，然后再写一个函数存储到数据库或者本地文件中，这样思路虽然说很清晰，但是流程总归而言还是比较麻烦的，而scrapy框架则帮我们封装好了所有的流程，我们只需要编写几行代码就可以爬取我们需要的资源。</p></blockquote><h2 id="scrapy架构图"><a href="#scrapy架构图" class="headerlink" title="scrapy架构图"></a>scrapy架构图</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/scrapy_all.png" alt="scrapy架构图"></p><ul><li><p><code>Scrapy Engine</code>就是爬虫的引擎，负责<code>Spider</code>、<code>ItemPipeline</code>、<code>Downloader</code>、<code>Scheduler</code>之间的通讯</p></li><li><p><code>Scheduler(调度器)</code>：负责引擎传递过来的request请求，并且按照一定的方式整理排列</p></li><li><p><code>Downloader（下载器）</code>：负责下载引擎传递过来的所有request请求，然后将得到的Responses还给引擎，由引擎交给<code>spiders</code>处理</p></li><li><p><code>Downloader Middlewares（下载中间件）</code>：自定义扩展下载功能的地方，比如需要添加下载的代理等</p></li><li><p><code>Spider（爬虫）</code>：负责从Responses分析提取出所要的数据，如果Responses还有需要的URL数据，就把这些数据交给引擎，由引擎传递给<code>Scheduler(调度器)</code>去处理</p></li><li><p><code>Spider Middlewares（Spider中间件）</code>：一个可以自定扩展和操作<code>引擎</code>和<code>Spider</code>中间<code>通信</code>的功能组件（比如进入<code>Spider</code>的Responses;和从<code>Spider</code>出去的Requests），这个很少用到</p></li><li><p><code>Item Pipeline(管道)</code>：负责处理spiders获取到的item，并且对这些数据进行存储、分析、过滤等处理</p></li></ul><h2 id="scrapy文件配置详解"><a href="#scrapy文件配置详解" class="headerlink" title="scrapy文件配置详解"></a>scrapy文件配置详解</h2><p>创建项目：</p><pre><code>scrapy startproject demo(你的项目名)</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570425985011.png" alt=""></p><p>然后就可以进入刚刚创建的demo项目了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570426136366.png" alt=""></p><p>scrapy.cfg里面是确定项目的配置文件是哪个</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570426236269.png" alt=""></p><p>如图，项目的配置文件就是<code>demo/setting.py</code></p><p>项目的所有文件如下：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570426417062.png" alt=""></p><p><code>items.py</code>是根据要爬取的数据的字段进行设置</p><p><code>pipelines.py</code>是管道文件，即把爬取下来的数据进行存储和过滤等操作</p><p><code>setting.py</code>是核心配置文件</p><pre class=" language-python"><code class="language-python"><span class="token number">12</span><span class="token punctuation">.</span> BOT_NAME <span class="token operator">=</span> <span class="token string">'demo'</span>                            <span class="token comment" spellcheck="true">#项目名字</span><span class="token number">14</span><span class="token punctuation">.</span> SPIDER_MODULES <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'demo.spiders'</span><span class="token punctuation">]</span>            <span class="token comment" spellcheck="true">#项目模板位置</span><span class="token number">15</span><span class="token punctuation">.</span> NEWSPIDER_MODULE <span class="token operator">=</span> <span class="token string">'demo.spiders'</span>            <span class="token comment" spellcheck="true">#新爬虫模板位置</span><span class="token number">22</span><span class="token punctuation">.</span> ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">True</span>                         <span class="token comment" spellcheck="true">#是否遵守robots协议</span><span class="token number">25</span><span class="token punctuation">.</span> CONCURRENT_REQUESTS <span class="token operator">=</span> <span class="token number">32</span>                    <span class="token comment" spellcheck="true">#爬虫的并发量</span><span class="token number">30</span><span class="token punctuation">.</span> DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">3</span>                            <span class="token comment" spellcheck="true">#爬虫延迟</span><span class="token number">36</span><span class="token punctuation">.</span> COOKIES_ENABLED <span class="token operator">=</span> <span class="token boolean">False</span>                        <span class="token comment" spellcheck="true">#是否启用cookie，不想爬虫留下自己的痕迹就不用开启</span><span class="token number">42</span><span class="token punctuation">.</span> DEFAULT_REQUEST_HEADERS <span class="token operator">=</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">#42-45 默认的请求头</span><span class="token number">43</span><span class="token punctuation">.</span>   <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">.</span>   <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en'</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token number">49</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true">#SPIDER_MIDDLEWARES = {                        #爬虫中间件设置，数字越小优先级越大</span><span class="token number">50</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true">#    'demo.middlewares.DemoSpiderMiddleware': 543,</span><span class="token number">51</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true">#}</span><span class="token number">55</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true">#DOWNLOADER_MIDDLEWARES = {                    #下载中间件</span><span class="token number">56</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true">#    'demo.middlewares.DemoDownloaderMiddleware': 543,</span><span class="token number">57</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true">#}</span><span class="token number">67</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true">#ITEM_PIPELINES = {                            #管道文件</span><span class="token number">68</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true">#    'demo.pipelines.DemoPipeline': 300,</span><span class="token number">69</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true">#}</span></code></pre><p>更多的详细配置可见<a href="https://scrapy-chs.readthedocs.io/zh_CN/1.0/topics/settings.html#topics-settings-ref" target="_blank" rel="noopener">官方文档</a></p><h2 id="第一个scrapy爬虫"><a href="#第一个scrapy爬虫" class="headerlink" title="第一个scrapy爬虫"></a>第一个scrapy爬虫</h2><p>scrapy的所有命令都可以用cmd看到</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570517173800.png" alt=""></p><p>创建爬虫文件：</p><pre><code>scrapy genspider bilibili(爬虫文件名) https://www.bilibili.com/(要爬虫的网站)</code></pre><p>刚刚创建的爬虫项目内容如下</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">BilibiliSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'bilibili'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://www.bilibili.com/'</span><span class="token punctuation">]</span>                    <span class="token comment" spellcheck="true">#允许访问的域</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://https://www.bilibili.com//'</span><span class="token punctuation">]</span>                <span class="token comment" spellcheck="true">#开始爬取的网站地址</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>                                        <span class="token comment" spellcheck="true">#解析方法</span>        <span class="token keyword">pass</span></code></pre><p>现在编写一些请求函数</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">BilibiliSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'bilibili'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://www.bilibili.com/'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://www.bilibili.com/v/game/stand_alone/?spm_id_from=333.6.b_7072696d6172795f6d656e75.41#/'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"demo.html"</span><span class="token punctuation">,</span><span class="token string">"wb+"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span></code></pre><p>然后执行命令</p><pre class=" language-python"><code class="language-python">scrapy crawl bilibili</code></pre><p>就可以请求bilibili的页面，然后把源代码写到demo.html文件了</p><h2 id="将scrapy得到的结果保存到第三方格式"><a href="#将scrapy得到的结果保存到第三方格式" class="headerlink" title="将scrapy得到的结果保存到第三方格式"></a>将scrapy得到的结果保存到第三方格式</h2><p>scrapy是默认有xpath解析库的，所以可以直接使用xpath，这里拿传播智客的讲师页面来演示</p><p>创建一个爬虫文件</p><pre class=" language-python"><code class="language-python">scrapy genspider itcast http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>cn<span class="token operator">/</span></code></pre><p>首先先编写要确定爬取的部分</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">ItcastSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'itcast'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.itcast.cn/'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.itcast.cn/channel/teacher.shtml#ajavaee'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        teacher_list <span class="token operator">=</span>response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="li_txt"]'</span><span class="token punctuation">)</span>        teacherItem <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> each <span class="token keyword">in</span> teacher_list<span class="token punctuation">:</span>            name<span class="token operator">=</span>each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./h3/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>            title<span class="token operator">=</span>each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./h4/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>            info<span class="token operator">=</span>each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./p/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span></code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570469433346.png" alt=""></p><p>得到如上页面说明爬取的内容正确</p><p>然后在<code>items.py</code>编写要存储的字段</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">DemoItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># define the fields for your item here like:</span>    name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    title<span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    info <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>然后再编写爬虫文件，将爬取的内容存储到这些字段中</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> scrapy<span class="token keyword">from</span> demo<span class="token punctuation">.</span>items <span class="token keyword">import</span> DemoItem<span class="token keyword">class</span> <span class="token class-name">ItcastSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'itcast'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.itcast.cn/'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.itcast.cn/channel/teacher.shtml#ajavaee'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        teacher_list <span class="token operator">=</span>response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="li_txt"]'</span><span class="token punctuation">)</span>        Item<span class="token operator">=</span>DemoItem<span class="token punctuation">(</span><span class="token punctuation">)</span>        teacherItem <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> each <span class="token keyword">in</span> teacher_list<span class="token punctuation">:</span>            name<span class="token operator">=</span>each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./h3/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>            title<span class="token operator">=</span>each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./h4/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>            info<span class="token operator">=</span>each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./p/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>            Item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token operator">=</span>name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            Item<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token operator">=</span>title<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            Item<span class="token punctuation">[</span><span class="token string">'info'</span><span class="token punctuation">]</span><span class="token operator">=</span>info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            teacherItem<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Item<span class="token punctuation">)</span>        <span class="token keyword">return</span> teacherItem</code></pre><p>最后再执行命令：</p><pre><code>$ scrapy crawl itcast -o itcast.csv</code></pre><p>可以保存为（json，csv，xml）等格式</p><h2 id="使用管道来存储文件"><a href="#使用管道来存储文件" class="headerlink" title="使用管道来存储文件"></a>使用管道来存储文件</h2><p>管道就是在爬取数据之后的处理过程，这里拿个案例来说明</p><p>与上面不同的是爬取的结果不是直接return返回，因为return之后程序就结束了，所以使用yield返回</p><p>itcast.py文件(你的爬虫文件)</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> scrapy<span class="token keyword">from</span> demo<span class="token punctuation">.</span>items <span class="token keyword">import</span> DemoItem<span class="token keyword">class</span> <span class="token class-name">ItcastSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'itcast'</span>    <span class="token comment" spellcheck="true"># allowed_domains = ['http://www.itcast.cn/']</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.itcast.cn/channel/teacher.shtml#ajavaee'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        teacher_list <span class="token operator">=</span>response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="li_txt"]'</span><span class="token punctuation">)</span>        Item<span class="token operator">=</span>DemoItem<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># teacherItem = []</span>        <span class="token keyword">for</span> each <span class="token keyword">in</span> teacher_list<span class="token punctuation">:</span>            name<span class="token operator">=</span>each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./h3/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>            title<span class="token operator">=</span>each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./h4/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>            info<span class="token operator">=</span>each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./p/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>            Item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token operator">=</span>name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            Item<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token operator">=</span>title<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            Item<span class="token punctuation">[</span><span class="token string">'info'</span><span class="token punctuation">]</span><span class="token operator">=</span>info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token comment" spellcheck="true"># teacherItem.append(Item)</span>            <span class="token keyword">yield</span> Item        <span class="token comment" spellcheck="true"># return teacherItem</span></code></pre><p>然后在piplines.py编写存储的方式，这里我用的是存储到json文件</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> json<span class="token keyword">class</span> <span class="token class-name">DemoPipeline</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>filename<span class="token operator">=</span>open<span class="token punctuation">(</span><span class="token string">"teacher.json"</span><span class="token punctuation">,</span><span class="token string">"wb+"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        jsontext<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">,</span>ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'\n'</span>        self<span class="token punctuation">.</span>filename<span class="token punctuation">.</span>write<span class="token punctuation">(</span>jsontext<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> item    <span class="token keyword">def</span> <span class="token function">close_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>filename<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="scrapy-shell的使用"><a href="#scrapy-shell的使用" class="headerlink" title="scrapy shell的使用"></a>scrapy shell的使用</h2><p>scrapy shell可以帮助我们快速查看网页的请求，一般我们在爬取网站的时候，可以先试一下使用scrapy shell启动，因为有些网页是使用ajax或者js来显示的，直接以上面演示的方式请求只能请求到一个空的网页，比如我现在要爬取一个智联招聘的页面：</p><pre class=" language-python"><code class="language-python">$ scrapy shell  https<span class="token punctuation">:</span><span class="token operator">//</span>sou<span class="token punctuation">.</span>zhaopin<span class="token punctuation">.</span>com<span class="token operator">/</span>?jl<span class="token operator">=</span><span class="token number">763</span><span class="token operator">&amp;</span>kw<span class="token operator">=</span>python<span class="token operator">&amp;</span>kt<span class="token operator">=</span><span class="token number">3</span><span class="token operator">&amp;</span>sf<span class="token operator">=</span><span class="token number">0</span><span class="token operator">&amp;</span>st<span class="token operator">=</span><span class="token number">0</span></code></pre><p> 进入shell命令行之后输入命令</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> view<span class="token punctuation">(</span>response<span class="token punctuation">)</span></code></pre><p>然后就可以通过你的默认浏览器看到请求后的结果，如果爬取后的网页是跟浏览器输入地址访问的一样的话，那么就可以直接像我上面演示的方式请求。如果请求后发现重要数据为空的话，比如我这样：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/1570623395604.png" alt="scrapy直接爬取智联招聘页面"></p><p>因为智联招聘的页面是通过js去请求的，所以这些数据都没有显示在request请求的页面上，因为这部分的数据都是使用js去加载的，所以只要打开调试网页查看js的请求地址，然后去请求js的请求地址就可以获取这部分的数据了。</p><p>更多关于如何提取异步加载的数据可以在《scrapy爬取动态网页》博客可以详解</p>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scrapy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>全文搜索方法的使用</title>
      <link href="/2019/09/26/sou-suo-fang-fa/"/>
      <url>/2019/09/26/sou-suo-fang-fa/</url>
      
        <content type="html"><![CDATA[<h2 id="基于-haystack来使用whoosh检索引擎"><a href="#基于-haystack来使用whoosh检索引擎" class="headerlink" title="基于 haystack来使用whoosh检索引擎"></a>基于 haystack来使用whoosh检索引擎</h2><p>这篇博客是基于Django来编写的案例，haystack可以自定义搜索，开发者可以通过haystack间接使用搜索引擎，并且他可以像DJango的ORM一样，只需改少量代码就可以自由切换引擎</p><p>这里拿haystack使用whoosh引擎来作为案例</p><h3 id="基本安装和配置"><a href="#基本安装和配置" class="headerlink" title="基本安装和配置"></a>基本安装和配置</h3><p>首先先安装这两个包</p><pre><code>pip install django-haystackpip install whoosh</code></pre><p>然后在setting.py注册应用haystack</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/18.png" alt=""></p><p>并且在setting.py文件添加如下字段：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 全文检索框架配置</span>HAYSTACK_CONNECTIONS <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true"># 使用whoosh引擎</span>        <span class="token comment" spellcheck="true"># 'ENGINE': 'haystack.backends.whoosh_backend.WhooshEngine',</span>        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'haystack.backends.whoosh_backend.WhooshEngine'</span><span class="token punctuation">,</span>           <span class="token comment" spellcheck="true"># 索引文件路径</span>        <span class="token string">'PATH'</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'whoosh_index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># 当添加、修改、删除数据时，自动生成索引</span>HAYSTACK_SIGNAL_PROCESSOR <span class="token operator">=</span> <span class="token string">'haystack.signals.RealtimeSignalProcessor'</span></code></pre><p>以上的是默认的配置，如果要添加jieba文字的话要另外配置</p><h3 id="生成索引文件"><a href="#生成索引文件" class="headerlink" title="生成索引文件"></a>生成索引文件</h3><p>在你要检索的模型类的那个包中，添加一个文件</p><p>如我要检索的是所有的商品文件：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/19.png" alt=""></p><p>里面的search_indexes.py就是我写的文件</p><p>内容如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> haystack <span class="token keyword">import</span> indexes<span class="token keyword">from</span> goods<span class="token punctuation">.</span>models <span class="token keyword">import</span> GoodsSKU<span class="token keyword">class</span> <span class="token class-name">GoodsSKUIndex</span><span class="token punctuation">(</span>indexes<span class="token punctuation">.</span>SearchIndex<span class="token punctuation">,</span> indexes<span class="token punctuation">.</span>Indexable<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#索引字段document=True指定根据表的哪些字段简历索引文件制定在一个文件中</span>    text <span class="token operator">=</span> indexes<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>document<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> use_template<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># author = indexes.CharField(model_attr='user')</span>    <span class="token comment" spellcheck="true"># pub_date = indexes.DateTimeField(model_attr='pub_date')</span>    <span class="token keyword">def</span> <span class="token function">get_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> GoodsSKU    <span class="token comment" spellcheck="true"># 建立索引数据</span>    <span class="token keyword">def</span> <span class="token function">index_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> using<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>get_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#返回所有数据就是对所有的数据进行索引</span></code></pre><p>然后要定义你检索出来的那个界面</p><p>创建如下文件：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20.png" alt=""></p><p>goodssku_text.txt就是定义你可以检索的字段，我的检索字段如下：</p><pre><code># 指定根据表中的哪些字段建立索引数据{{ object.name }}  # 根据商品的名称建立索引{{ object.desc }}  # 根据商品的简介建立索引{{ object.goods.detail }}  # 根据商品的详情建立索引</code></pre><p>然后使用命令</p><pre><code>python manage.py rebuild_index</code></pre><p>这样会生成索引文件</p><p>如图：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/21.png" alt=""></p><h3 id="使用搜索功能"><a href="#使用搜索功能" class="headerlink" title="使用搜索功能"></a>使用搜索功能</h3><p>在搜索的那个表单上，填写内容如下</p><pre><code>&lt;form action=&quot;/search&quot; method=&quot;get&quot;&gt;&lt;/form&gt;</code></pre><p>然后要添加url路径</p><pre><code>url(&#39;search/&#39;, include(&#39;haystack.urls&#39;)),  # 全文检索框架</code></pre><p>搜索完后结果会提交到一个search.html页面，会传递这几个变量</p><pre><code>query：搜索关键字page：当前页的page对象 –&gt;遍历page对象，获取到的是SearchResult类的实例对象，对象的属性object才是模型类的对象。paginator：分页paginator对象</code></pre><p>然后自定义一个搜索列表的模板，将这三个变量使用Django传递变量的方式添加进去即可</p><h3 id="汉语分词检索"><a href="#汉语分词检索" class="headerlink" title="汉语分词检索"></a>汉语分词检索</h3><p>如果是英文的话一个单词就是一个商品，但是汉语远远比英语复杂的多，比如搜索你好，可以分为你和好</p><p>Python有个jieba包可以帮助我们进行汉语分词</p><p>首先先安装jieba包</p><pre><code>pip install jieba</code></pre><p>要对原来的分词结果使用汉语分词的话就要对下载下来的包进行jieba分词</p><p>进入对pip下载的haystack包里面添加ChineseTokenizer.py文件，内容如下</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> jieba<span class="token keyword">from</span> whoosh<span class="token punctuation">.</span>analysis <span class="token keyword">import</span> Tokenizer<span class="token punctuation">,</span> Token<span class="token keyword">class</span> <span class="token class-name">ChineseTokenizer</span><span class="token punctuation">(</span>Tokenizer<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> positions<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> chars<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>                 keeporiginal<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> removestops<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                 start_pos<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> start_char<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        t <span class="token operator">=</span> Token<span class="token punctuation">(</span>positions<span class="token punctuation">,</span> chars<span class="token punctuation">,</span> removestops<span class="token operator">=</span>removestops<span class="token punctuation">,</span> mode<span class="token operator">=</span>mode<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        seglist <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>value<span class="token punctuation">,</span> cut_all<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> w <span class="token keyword">in</span> seglist<span class="token punctuation">:</span>            t<span class="token punctuation">.</span>original <span class="token operator">=</span> t<span class="token punctuation">.</span>text <span class="token operator">=</span> w            t<span class="token punctuation">.</span>boost <span class="token operator">=</span> <span class="token number">1.0</span>            <span class="token keyword">if</span> positions<span class="token punctuation">:</span>                t<span class="token punctuation">.</span>pos <span class="token operator">=</span> start_pos <span class="token operator">+</span> value<span class="token punctuation">.</span>find<span class="token punctuation">(</span>w<span class="token punctuation">)</span>            <span class="token keyword">if</span> chars<span class="token punctuation">:</span>                t<span class="token punctuation">.</span>startchar <span class="token operator">=</span> start_char <span class="token operator">+</span> value<span class="token punctuation">.</span>find<span class="token punctuation">(</span>w<span class="token punctuation">)</span>                t<span class="token punctuation">.</span>endchar <span class="token operator">=</span> start_char <span class="token operator">+</span> value<span class="token punctuation">.</span>find<span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">+</span> len<span class="token punctuation">(</span>w<span class="token punctuation">)</span>            <span class="token keyword">yield</span> t<span class="token keyword">def</span> <span class="token function">ChineseAnalyzer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> ChineseTokenizer<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>然后拷贝原来的whoosh_backend.py文件，改名为whoosh_cn_backend.py</p><p>添加如下字段：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#对原来导入的包添加</span><span class="token keyword">from</span> <span class="token punctuation">.</span>ChineseAnalyzer <span class="token keyword">import</span> ChineseAnalyzer<span class="token comment" spellcheck="true"># 第163行的</span><span class="token comment" spellcheck="true"># schema_fields[field_class.index_fieldname] = TEXT(stored=True, analyzer=StemmingAnalyzer(),      </span><span class="token comment" spellcheck="true"># field_boost=field_class.boost, sortable=True)</span><span class="token comment" spellcheck="true"># 改为</span><span class="token comment" spellcheck="true"># schema_fields[field_class.index_fieldname] = TEXT(stored=True, analyzer=ChineseAnalyzer(),  </span><span class="token comment" spellcheck="true"># field_boost=field_class.boost, sortable=True)</span></code></pre><p>然后回去setting.py修改成’ENGINE’: ‘haystack.backends.whoosh_cn_backend.WhooshEngine’</p><p>然后再进行一次索引就可以使用汉语的jieba分词了</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> 全文检索 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fastDFS安装及在Django中的部署</title>
      <link href="/2019/09/25/fastdfs-de-an-zhuang-ji-shi-yong/"/>
      <url>/2019/09/25/fastdfs-de-an-zhuang-ji-shi-yong/</url>
      
        <content type="html"><![CDATA[<h2 id="FastDFS在阿里云服务器的安装和配置"><a href="#FastDFS在阿里云服务器的安装和配置" class="headerlink" title="FastDFS在阿里云服务器的安装和配置"></a>FastDFS在阿里云服务器的安装和配置</h2><p>FastDFS安装在这篇<a href="https://blog.csdn.net/busishenren/article/details/83584885" target="_blank" rel="noopener">博客</a>讲解的很清楚了，这里我就不再赘述，只作为补充</p><p>如果你是在轻量云服务器安装的话，方法跟esc服务器一样的，直接在控制台开启防火墙规则端口</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/15.png" alt=""></p><p>开启了防火墙端口还不够</p><p>在进入服务器下，使用这条命令查看防火墙的状态</p><pre><code>firewall-cmd --state</code></pre><p>如果防火墙已开启，则看开放的所有端口</p><pre><code>firewall-cmd --zone=public --list-ports</code></pre><p>如果防火墙关闭，那么开启防火墙</p><pre><code>systemctl start firewalld.service</code></pre><p>如果嫌麻烦就把防火墙关了也行，但是不建议这么做</p><p>查看开放的所有端口后，如果没有开启22122和23000端口，那么开启他</p><pre><code>firewall-cmd --zone=public --add-port=22122/tcp --permanent #开启22122端口firewall-cmd --zone=public --add-port=23000/tcp --permanent #开启23000端口firewall-cmd --reload   # 配置立即生效</code></pre><p>再一次查看端口是否开启</p><pre><code>firewall-cmd --zone=public --list-ports</code></pre><p>在部署完FastDFS并且开启storage和tracker服务后，看一下端口是否被监听</p><pre><code>netstat -lnpt</code></pre><p>能看到23000和22122端口被监听那么就说明成功</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/16.png" alt=""></p><h2 id="FastDFS在Django中的使用"><a href="#FastDFS在Django中的使用" class="headerlink" title="FastDFS在Django中的使用"></a>FastDFS在Django中的使用</h2><p>在Django中，所有资源都是来自于后台的部署，Django后台数据库采用的是ORM模式，Django默认文件的上传是上传到指定的文件夹下面的，如果要修改的话要在一个文件中自定义文件的存储类，也就是继承django.core.files.storage.Storage</p><p>关于文件存储官网文档有很清楚的描述</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/17.png" alt=""></p><p>在setting.py配置你服务器的fastDFS的ip和端口号</p><pre><code># 设置Django的文件存储类DEFAULT_FILE_STORAGE = &#39;utils.fdfs.storage.FDFSStorage&#39;# 设置fdfs使用的client.conf文件路径FDFS_CLIENT_CONF = &#39;./utils/fdfs/client.conf&#39;# 设置fdfs存储服务器上nginx的IP和端口号FDFS_URL = &#39;&#39;</code></pre><p>然后在一个单独的文件夹(比如utils)里面加入以下两个文件</p><p>storage.py</p><pre><code>from django.core.files.storage import Storagefrom django.conf import settingsfrom fdfs_client.client import *class FDFSStorage(Storage):    def __init__(self, client_conf=None, base_url=None):        &quot;&quot;&quot;初始化&quot;&quot;&quot;        if client_conf is None:            client_conf = settings.FDFS_CLIENT_CONF        self.client_conf = client_conf        if base_url is None:            base_url = settings.FDFS_URL        self.base_url = base_url    def _open(self, name, mode=&#39;rb&#39;):        # 打开文件时使用        pass    def _save(self, name, content):        client=Fdfs_client(&#39;./utils/fdfs/client.conf&#39;)        res = client.upload_by_buffer(content.read())        if res.get(&#39;Status&#39;) != &#39;Upload successed.&#39;:            raise Exception(&#39;上传文件到FastDFS失败&#39;)        filename = res.get(&#39;Remote file_id&#39;)        return filename    def exists(self, name):        &quot;&quot;&quot;Django判断文件名是否可用&quot;&quot;&quot;        return False    def url(self, name):        &quot;&quot;&quot;返回访问文件url路径，不然后台保存的时候会报错&quot;&quot;&quot;        return self.base_url + name</code></pre><p>client.conf(修改相应的字段)</p><pre><code># connect timeout in seconds# default value is 30sconnect_timeout=30# network timeout in seconds# default value is 30snetwork_timeout=60# the base path to store log files# 你的个人电脑的存储日志，必须要有这个路径base_path=/Users/LY/Python_log# tracker_server can ocur more than once, and tracker_server format is#  &quot;host:port&quot;, host can be hostname or ip addresstracker_server=你服务器的IP:22122#standard log level as syslog, case insensitive, value list:### emerg for emergency### alert### crit for critical### error### warn for warning### notice### info### debuglog_level=info# if use connection pool# default value is false# since V4.05use_connection_pool = false# connections whose the idle time exceeds this time will be closed# unit: second# default value is 3600# since V4.05connection_pool_max_idle_time = 3600# if load FastDFS parameters from tracker server# since V4.05# default value is falseload_fdfs_parameters_from_tracker=false# if use storage ID instead of IP address# same as tracker.conf# valid only when load_fdfs_parameters_from_tracker is false# default value is false# since V4.05use_storage_id = false# specify storage ids filename, can use relative or absolute path# same as tracker.conf# valid only when load_fdfs_parameters_from_tracker is false# since V4.05storage_ids_filename = storage_ids.conf#HTTP settingshttp.tracker_server_port=80#use &quot;#include&quot; directive to include HTTP other settiongs##include http.conf</code></pre><p>文件上传的路径可以随便写，因为这个都没用，上传后Django会自动按照你自己写的自定义存储方法去上传文件</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> 分布式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Celery异步框架的使用</title>
      <link href="/2019/09/24/celery/"/>
      <url>/2019/09/24/celery/</url>
      
        <content type="html"><![CDATA[<h2 id="Celery是什么"><a href="#Celery是什么" class="headerlink" title="Celery是什么"></a>Celery是什么</h2><p>​    <code>Celery</code>是一个实时处理和任务调度的分布式任务队列，简单的说所就是分布式应用队列，队列的意思就是把任务放在队列中执行，通常应用是把一些耗时的任务放在队列里面，主任务继续执行，耗时任务在队列中执行。</p><p>​    <code>Celery</code>本身只是一个任务队列，或者严格的说是管理分布式任务队列的工具，封装了常用的任务队列操作，通过<code>Celery</code>来管理任务队列的执行和管理，<code>celery</code>本身不含消息服务，它使用第三方消息服务来传递任务，目前，<code>celery</code>支持的消息服务<code>RabbitMQ</code>,<code>redis</code>甚至是数据库，<code>redis</code>是最佳选择，RabbitMQ(<a href="http://docs.celeryproject.org/en/latest/getting-started/brokers/rabbitmq.html#broker-rabbitmq" target="_blank" rel="noopener">http://docs.celeryproject.org/en/latest/getting-started/brokers/rabbitmq.html#broker-rabbitmq</a>)、Redis(<a href="http://docs.celeryproject.org/en/latest/getting-started/brokers/redis.html#broker-redis" target="_blank" rel="noopener">http://docs.celeryproject.org/en/latest/getting-started/brokers/redis.html#broker-redis</a>)处理任务队列的方式，两者的使用文档写的很清楚</p><p>​    在实际应用中，可以把一些比如邮件注册、手机注册、网站页面静态化等耗时操作交给<code>Celery</code>队列中，然后让<code>Redis</code>或者<code>RabbitMQ</code>去执行。下面我拿我项目中的案例来演示一下，也便于自己加深印象</p><h2 id="Celery演示"><a href="#Celery演示" class="headerlink" title="Celery演示"></a>Celery演示</h2><p>这里我拿的都是我最熟悉的<code>Django</code>框架和<code>redis</code>来演示</p><p><code>首先要导入Celery包</code></p><p>一般第三方的处理文件都会专门放到一个文件夹里面，我的直接命名<code>Celery_tasks</code></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> celery <span class="token keyword">import</span> Celeryapp <span class="token operator">=</span> Celery<span class="token punctuation">(</span><span class="token string">'任务名字'</span><span class="token punctuation">,</span> broker<span class="token operator">=</span><span class="token string">'redis://你的服务器IP/数据库名'</span><span class="token punctuation">)</span>@app<span class="token punctuation">.</span>task<span class="token keyword">def</span> 你的要运行的耗时任务<span class="token punctuation">:</span>    <span class="token keyword">pass</span></code></pre><p>直接使用装饰器就可以使得普通的方法变成异步方法</p><p>上面的是uwsgi使用的服务器的代码，在运行异步方法的服务器还要加上这一行代码， 整体代码如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> celery <span class="token keyword">import</span> Celeryapp <span class="token operator">=</span> Celery<span class="token punctuation">(</span><span class="token string">'任务名字'</span><span class="token punctuation">,</span> broker<span class="token operator">=</span><span class="token string">'redis://你的服务器IP/数据库名'</span><span class="token punctuation">)</span><span class="token keyword">import</span> os<span class="token keyword">import</span> djangoos<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'DJANGO_SETTINGS_MODULE'</span><span class="token punctuation">,</span> <span class="token string">'dailyfreshshop.settings'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#dailyfreshshop是我的项目名</span>django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>@app<span class="token punctuation">.</span>task<span class="token keyword">def</span> 你的要运行的耗时任务<span class="token punctuation">:</span>    <span class="token keyword">pass</span></code></pre><p>把原本的同步的方法转换为<code>Celery</code>异步的代码运行即可</p><p>如果你在linux系统上运行Celery代码，就在linux服务器端运行<code>celery -A celery_tasks.tasks worker -l info</code></p><p>如果是windows系统上运行Celery代码，就运行<code>celery -A celery_tasks.tasks worker -l info -P eventlet</code></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 异步 </tag>
            
            <tag> Django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>运维人员的gitlab基本操作</title>
      <link href="/2019/09/22/yun-wei-ren-yuan-de-gitlab-shi-yong/"/>
      <url>/2019/09/22/yun-wei-ren-yuan-de-gitlab-shi-yong/</url>
      
        <content type="html"><![CDATA[<blockquote><p> 本篇讲解了运维人员在后端的基本使用：创建开发项目、定义开发总监、开发人员等</p></blockquote><h2 id="管理员的操作"><a href="#管理员的操作" class="headerlink" title="管理员的操作"></a>管理员的操作</h2><p>点击上面的扳手图标可以进入后台管理界面<br><img src="https://img-blog.csdnimg.cn/20190922092307422.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""></p><h2 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h2><p>点击左边的monitoring标签<br><img src="https://img-blog.csdnimg.cn/20190922092435431.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>第一个system info是服务器的资源使用情况<br><img src="https://img-blog.csdnimg.cn/20190922092634854.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>logs就是gitlab的应用日志和使用日志</p><h2 id="创建账号"><a href="#创建账号" class="headerlink" title="创建账号"></a>创建账号</h2><p>以下两种方法都可以添加账号<br>点击overview的new user按钮，可以为使用者创建账号<br><img src="https://img-blog.csdnimg.cn/20190922093118594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""></p><p><img src="https://img-blog.csdnimg.cn/20190922093433289.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>点击右上角的new user按钮就可以给项目主负责人创建账号</p><h2 id="给项目添加人员"><a href="#给项目添加人员" class="headerlink" title="给项目添加人员"></a>给项目添加人员</h2><p>我这里原先就已经创建好了一个名为test的仓库<br>我这里给test仓库添加人员<br>点击project1<br><img src="https://img-blog.csdnimg.cn/20190922093735602.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>再点击你需要操作的仓库<br><img src="https://img-blog.csdnimg.cn/20190922093800821.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>然后点击manage access<br><img src="https://img-blog.csdnimg.cn/20190922093832764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>这里你要给项目添加的是什么权限可以自定义<br><img src="https://img-blog.csdnimg.cn/20190922094119996.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>master就是有合并分支的权限，developer就是可以用自己的分支写代码的权限<br><img src="https://img-blog.csdnimg.cn/20190922094248435.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""></p><h2 id="给人员修改自己的密码"><a href="#给人员修改自己的密码" class="headerlink" title="给人员修改自己的密码"></a>给人员修改自己的密码</h2><p>点击扳手按钮重回管理界面，点击user<br><img src="https://img-blog.csdnimg.cn/20190922094452932.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>这里就可以给人员信息进行修改了<br><img src="https://img-blog.csdnimg.cn/20190922094506428.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>可以修改密码<br><img src="https://img-blog.csdnimg.cn/20190922094616363.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""></p><h2 id="模拟企业开发者和负责人的使用流程"><a href="#模拟企业开发者和负责人的使用流程" class="headerlink" title="模拟企业开发者和负责人的使用流程"></a>模拟企业开发者和负责人的使用流程</h2><p>这里我不用git原始命令操作，因为比较麻烦，我贪方便就用sourcetree操作，原理是一样的</p><p>开发者使用自己的分支来编写代码</p><p>黏贴这个地址<br><img src="https://img-blog.csdnimg.cn/20190922095222895.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>我随便写了一个test文件，我上传上去的时候会让我给账号密码，就是你刚刚设置的devloper账号密码<br><img src="https://img-blog.csdnimg.cn/20190922104059340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>这里就可以显示我刚刚上传的分支了<br><img src="https://img-blog.csdnimg.cn/20190922104108895.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>然后点右上角蓝色的create merge request<br><img src="https://img-blog.csdnimg.cn/20190922104243370.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>assign是项目负责人的账号就行了，其他的你随便填<br>然后用同样的方法打开负责人账号lead<br><img src="https://img-blog.csdnimg.cn/20190922104425940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>右上角有个橙色的消息，点开<br><img src="https://img-blog.csdnimg.cn/20190922104503516.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>就可以看到开发者提交的申请<br><img src="https://img-blog.csdnimg.cn/20190922104537582.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""><br>点击merge就可以合并分支<br>这里还可以给开发者回复<br><img src="https://img-blog.csdnimg.cn/20190922104737164.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""></p><p>重新返回项目，就可以看到你刚刚操作的文件合并到主分支了<br><img src="https://img-blog.csdnimg.cn/20190922104839441.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gitlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用gitbook搭建github上的书城</title>
      <link href="/2019/09/21/gitbook/"/>
      <url>/2019/09/21/gitbook/</url>
      
        <content type="html"><![CDATA[<h2 id="gitbook的安装和使用"><a href="#gitbook的安装和使用" class="headerlink" title="gitbook的安装和使用"></a>gitbook的安装和使用</h2><p>安装Gitbook前应该先安装node.js，安装这里就不赘述了，直接进入node交互界面</p><pre><code>$ npm install gitbook-cli -g</code></pre><p>检验是否安装成功</p><pre><code>$ gitbook -V</code></pre><p>进入一个空文件夹</p><pre><code>$ gitbook init</code></pre><p>然后会创建 <code>README.md</code> 和 <code>SUMMARY.md</code> 这两个文件， <code>README.md</code> 是说明文件， <code>SUMMARY.md</code>是书的章节目录，然后输入</p><pre><code>$ gitbook serve</code></pre><p>就可以创建gitbook了，默认端口是4000，地址输入<a href="http://localhost:4000" target="_blank" rel="noopener">http://localhost:4000</a> 就可以进入页面，可以用一些markdown编辑器来写，然后就可以在网页上看到实时编辑的内容了。</p><p>目录结构如图</p><p><img src="https://img-blog.csdnimg.cn/20190720225822792.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""></p><p><img src="https://img-blog.csdnimg.cn/20190720225836562.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""></p><p>gitbook的目录结构就是缩进，语法结构一看就懂</p><p>gitbook写完后可以输入命令</p><pre><code>$ gitbook build</code></pre><p>使用这个命令后在本地会生成一个_book的文件夹，里面是自动生成的html文件，这些htm文件在本地打开是不具备跳转效果的，要部署到网上才可以具备全部效果</p><h2 id="部署gitbook到github上"><a href="#部署gitbook到github上" class="headerlink" title="部署gitbook到github上"></a>部署gitbook到github上</h2><p>根据上面的操作，通过 <code>$ gitbook build</code> 把</p><p>先在自己的github上创建一个新的仓库，然后把刚刚_book里面的文件上传到github上，这部分的方法是个程序员都应该掌握，这里不再赘述，上传完之后点击setting，拉倒最下面有个github page的，如图</p><p><img src="https://img-blog.csdnimg.cn/20190720230934856.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTM3NzI3Mw==,size_16,color_FFFFFF,t_70" alt=""></p><p>上面绿色这个地址就是你的网上书籍地址了</p><p>如果要给你自己的gitbook设置一个域名，方法如我上一篇<a href="https://www.ly-blog.top/2019/09/05/hello-world/">博客</a>的自定义域名部分</p><h2 id="gitbook-安装插件"><a href="#gitbook-安装插件" class="headerlink" title="gitbook 安装插件"></a>gitbook 安装插件</h2><p>单单使用gitbook来写，写出来的界面不是特别的好看，功能也没有那么多，gitbook是可以添加插件的，比如返回顶部、折叠、添加版权信息、分享等功能</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gitbook </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitlab部署与使用</title>
      <link href="/2019/09/21/gitlab/"/>
      <url>/2019/09/21/gitlab/</url>
      
        <content type="html"><![CDATA[<h2 id="gitlab的安装"><a href="#gitlab的安装" class="headerlink" title="gitlab的安装"></a>gitlab的安装</h2><p>gitlab和github的区别想必大家都懂，这里我就不再赘述</p><p>这里我来用阿里云学生服务器centos7来演示gitlab的安装过程</p><p>首先打开你的防火墙控制台，开启防火墙规则</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E6%88%AA%E5%9B%BE6.png" alt=""></p><p><strong>注(这里我用的是服务器安装，一般的服务器都默认安装了ssh的，服务器ssh这里可以输入命令也可以不用，如果是用虚拟机的就要一定要安装ssh，并且在命令前加上sudo)</strong></p><p>首先安装ssh，</p><pre><code>yum install -y curl policycoreutils-pythonopenssh-server</code></pre><p>将SSH服务设置成开机自启动，安装命令：</p><pre><code>systemctl enable sshd</code></pre><p>启动SSH服务，安装命令：</p><pre><code>systemctl start sshd</code></pre><p>安装防火墙：</p><pre><code>yum install firewalld systemd -y</code></pre><p>开启防火墙：</p><pre><code>service firewalld  start</code></pre><p>添加http服务到防火墙：</p><pre><code>firewall-cmd --permanent --add-service=http</code></pre><p>然后重启防火墙：</p><pre><code>systemctl reload firewalld</code></pre><p>安装Postfix以发送通知邮件：</p><pre><code>yum install postfix</code></pre><p>将postfix服务设置成开机自启动，安装命令：</p><pre><code>systemctl enable postfix</code></pre><p>启动postfix</p><pre><code>systemctl start postfix</code></pre><p><strong>注意：这里如果成功那么没啥，可能会出现以下这个问题</strong></p><p><code>Job for postfix.service failed because the control process exited with error code. See &quot;systemctl st</code></p><p>这个时候不要慌</p><p>修改/etc/postfix/main.cf这个文件</p><pre><code>vim /etc/postfix/main.cf</code></pre><p>修改这两个字段为：</p><pre><code>inet_interfaces = allinet_protocols = ipv4</code></pre><p>接下来添加gitlab镜像：(这里的我用的是centos7的，centos6的话另外找资料)</p><pre><code>wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-10.0.0-ce.0.el7.x86_64.rpm</code></pre><p>安装gitlab 安装命令：</p><pre><code>rpm -i gitlab-ce-10.0.0-ce.0.el7.x86_64.rpm</code></pre><p><strong>注意，这里可能出现如下错误</strong></p><p><code>warning: gitlab-ce-10.0.0-ce.0.el7.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID f27eab47: NOKEY</code> </p><p>这个是缺少gitlab 的依赖</p><p>下载依赖：</p><pre><code>yum -y install policycoreutils openssh-server openssh-clients postfix</code></pre><p>然后再执行：</p><pre><code>rpm -i gitlab-ce-10.0.0-ce.0.el7.x86_64.rpm</code></pre><p>然后修改gitlab的配置文件</p><pre><code>vim  /etc/gitlab/gitlab.rb</code></pre><p>找到external_url这个字段，把里面的值修改为<code>http://你的服务器ip:你的端口</code>，比如<code>http://36.102.3.26:8899</code>，然后保存退出</p><p><strong>这里注意啦！！！</strong></p><p>这里我用的是开启防火墙配置的，所以要先看看防火墙开启没有</p><pre><code>firewall-cmd --state</code></pre><p>如果没开启就开启防火墙：<code>systemctl stop firewalld.service</code></p><p>然后看一下你有没有开启你配置的端口</p><pre><code>firewall-cmd --zone=public --list-ports</code></pre><p>如果没有就添加端口，并且重启</p><pre><code>firewall-cmd --zone=public --add-port=8899/tcp --permanent   # 开放8899端口firewall-cmd --reload   # 配置立即生效</code></pre><p>然后执行命令</p><pre><code>gitlab-ctl reconfigure</code></pre><p>然后</p><pre><code>gitlab-ctl restart</code></pre><p>这样就可以通过你的服务器ip:你的端口就可以访问gitlab了，这个是成功画面</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E6%88%AA%E5%9B%BE7.png" alt=""></p><p>这个是要你重新配置你的密码，默认的账号是root</p><h2 id="502错误解决和优化"><a href="#502错误解决和优化" class="headerlink" title="502错误解决和优化"></a>502错误解决和优化</h2><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E6%88%AA%E5%9B%BE9.png" alt=""></p><p><strong>注意，第一时间是看错误日志，而不是立马去谷歌百度，因为每一个人的错误都是不同的</strong></p><p>第一时间要查看错误日志，而不是查百度，因为每个人的错误都不同</p><pre><code># 看看unicorn启动日志cat /var/log/gitlab/unicorn/unicorn_stderr.log# 然后再看看gitlab日志，看看是哪里出错tail -100 /var/log/gitlab/gitlab-rails/production.log</code></pre><p><strong>每个人的错误都不同，根据错误日志的问题再去百度谷歌才是正道理</strong></p><h3 id="端口错误问题"><a href="#端口错误问题" class="headerlink" title="端口错误问题"></a>端口错误问题</h3><p><strong>端口错误都是端口被占用，当然按照我上面的方法是不会出现这个情况的</strong></p><p>此时继续修改配置文件</p><pre><code>vim  /etc/gitlab/gitlab.rb</code></pre><p><strong>看看你的错误日志，我的是8080端口被占用，改端口就行了</strong></p><p>找到以下字段取消注释并且修改：</p><pre><code># unicorn[&#39;port&#39;] = 8090   #千万不要是原来的8899端口啊，8090也是我打开过的端口，一样的话好像会报404的</code></pre><h3 id="内存爆满和内存消耗过大的问题"><a href="#内存爆满和内存消耗过大的问题" class="headerlink" title="内存爆满和内存消耗过大的问题"></a>内存爆满和内存消耗过大的问题</h3><p>但是最大的问题就是内存爆满，用命令看看<code>free -h</code>,或者用<code>htop</code>没有htop命令就下载一下<code>yum install htop</code></p><p>看一下结果我相信大部分人都跟我一样，物理内存爆满，然后发现swap居然是0有点奇怪</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E6%88%AA%E5%9B%BE10.png" alt=""></p><p>然后我去去谷歌找了一下原因，发现阿里云默认情况下是不启用swap的，所以我们要自己添加swap来解决</p><h4 id="使用swap分区来减少内存消耗"><a href="#使用swap分区来减少内存消耗" class="headerlink" title="使用swap分区来减少内存消耗"></a>使用swap分区来减少内存消耗</h4><ol><li>查看当前系统中是否已经启用swap分区</li></ol><pre><code>cat /proc/swaps</code></pre><ol start="2"><li>如果没有启用swap分区功能，则新建一个专门的文件用于swap分区</li></ol><pre><code>dd if=/dev/zero of=/data/swap bs=512 count=8388616</code></pre><p><strong>swap的大小是count的大小乘以bs大小，上面命令的大小是4294971392，即4GB</strong></p><ol start="3"><li>通过mkswap命令将上面新建出的文件做成swap分区</li></ol><pre><code>mkswap /data/swap</code></pre><ol start="4"><li>查看内核参数vm.swappiness中的数值是否为0，如果为0则根据实际需要调整成30或者60</li></ol><pre><code>cat /proc/sys/vm/swappinesssysctl -w vm.swappiness=60#永久修改若想永久修改，则编辑/etc/sysctl.conf文件，改文件中有vm.swappiness变量配置，默认为0</code></pre><p><strong>注：若想永久修改，则编辑/etc/sysctl.conf文件</strong></p><ol start="5"><li>启用此交换分区的交换功能</li></ol><pre><code>swapon /data/swapecho “/data/swap swap swap defaults 0 0” &gt;&gt; /etc/fstab</code></pre><ol start="6"><li>然后再看看swap分区是否启动</li></ol><pre><code>cat /proc/swaps </code></pre><ol start="7"><li>然后重启gitlab看看</li></ol><pre><code>gitlab-ctl restart</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E6%88%AA%E5%9B%BE11.png" alt=""></p><p>哦吼，这不就，好起来了吗</p><p>再运行gitlab看看</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E6%88%AA%E5%9B%BE12.png" alt=""></p><p>运行速度如丝般顺滑，刚部署好不知道多少倍，除此之外可能还有其他的bug，但是这个看错误日志修改就好了</p><p><strong>注意：如果修改了配置文件，一定要执行以下命令</strong></p><pre><code>gitlab-ctl reconfiguregitlab-ctl restart</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/%E6%88%AA%E5%9B%BE8.png" alt=""></p><p><strong>如果配置了还是502，耐心等一等，等那么一分钟左右就好了</strong></p><h2 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h2><p>​    这个运行速度慢折腾了我一下午，问题归根结底就是…..服务器配置太烂了，性能差就会经常出现502，因为官方推荐的服务器性能是最低 双核 + 8GB RAM，所以这里只能使用swap才能正常使用</p><p>​    gitlab的使用方法是和github差不多的，可以用git命令行执行，也可以用sourcetree直接clone下来</p><p><strong>解决问题使用到的博客</strong></p><blockquote><p><a href="https://blog.csdn.net/qq_25283709/article/details/78207881" target="_blank" rel="noopener">gitlab服务器经常出现502(阿里云搭建)</a></p></blockquote><blockquote><p><a href="https://blog.51cto.com/dgd2010/1762907?spm=a2c4e.10696291.0.0.2d4919a42dBKR8" target="_blank" rel="noopener">阿里云云主机添加swap分区与swap性能优化</a></p></blockquote><blockquote><p><a href="https://blog.csdn.net/wanchaopeng/article/details/84771195" target="_blank" rel="noopener">gitlab占用内存过大</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gitlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用hexo搭建个人博客并部署域名</title>
      <link href="/2019/09/05/hexo/"/>
      <url>/2019/09/05/hexo/</url>
      
        <content type="html"><![CDATA[<h2 id="搭建环境准备"><a href="#搭建环境准备" class="headerlink" title="搭建环境准备"></a>搭建环境准备</h2><ol><li><p>安装node</p><p><a href="https://nodejs.org/zh-cn/download/" target="_blank" rel="noopener">https://nodejs.org/zh-cn/download/</a></p><p>(电脑是多少位的就下载多少位)</p><p>安装成功之后在cmd输入命令</p><pre><code>node -v</code></pre><p>可以看到版本就安装成功</p></li><li><p>安装Git</p><p><a href="https://git-scm.com/downloads" target="_blank" rel="noopener">https://git-scm.com/downloads</a></p><p>git配置百度查一查，这里不多说</p></li><li><p>安装Hexo</p><pre><code>$ npm install -g hexo</code></pre><p>输入 <code>hexo -v</code>可以看到版本就安装成功</p></li></ol><h2 id="开始第一个博客"><a href="#开始第一个博客" class="headerlink" title="开始第一个博客"></a>开始第一个博客</h2><p>在命令行模式下进入个空文件夹，输入</p><pre><code>hexo init</code></pre><p>就开始创建hexo博客文件(可能需要一定时间)</p><p>然后输入命令安装博客所需要的包</p><pre><code>npm install</code></pre><p>此时博客就已经安装好了</p><p>输入命令开启你的第一个博客</p><pre><code>hexo server#或者hexo s</code></pre><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/01.png" alt=""></p><p>如图所示，第一个博客就已经搭建好了</p><p>​    博客的主题是可以修改的，可以参照网上流传的主题，有很多很漂亮的主题可以使用，比如我这里使用的是<a href="https://blinkfox.github.io/" target="_blank" rel="noopener">hexo-theme-matery-1.0.1</a>,主题可以参照这个网站</p><p>​    需要修改主题的话只需要把下载下来的主题文件,放到刚刚搭建的博客文件夹的theme文件夹下,然后修改博客根目录的_config.yml文件的theme字段修改成主题的名字即可</p><pre><code>theme: hexo-theme-matery-1.0.1</code></pre><p>这里我用的是上面提到的主题，效果如下</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/05.png" alt=""></p><h3 id="添加markdown文章"><a href="#添加markdown文章" class="headerlink" title="添加markdown文章"></a>添加markdown文章</h3><p>接下来我要添加自己的字段</p><p>在根目录的<code>_posts</code>文件夹就是首页展示的文章</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/02.png" alt=""></p><p>直接在<code>_posts</code>文件夹添加markdown文件就可以在前端展示文章</p><h3 id="添加标签tags页"><a href="#添加标签tags页" class="headerlink" title="添加标签tags页"></a>添加标签tags页</h3><p>(如果你的source目录没有<code>tags/index.md</code> 文件，那么就看以下步骤)</p><p>就使用命令添加<code>tags</code>文件夹</p><pre><code>hexo new page &quot;tags&quot;</code></pre><p>然后在<code>tags</code>文件夹下添加<code>index.md</code>文件，并且至少添加内容，</p><pre><code>---title: tagsdate: 2019-09-4 18:37.25type: &quot;tags&quot;layout: &quot;tags&quot;---</code></pre><p>然后在<code>_posts</code>文件夹下的markdown文件的头部添加tags字段</p><p>例如：</p><pre><code>---title: hello worldauthor: LYtags:    - Hexo    - github---</code></pre><p>tags最好用这种方法来写，多个标签就填多个</p><p>效果截图：</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/06.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/07.png" alt=""></p><h3 id="添加分类categories页"><a href="#添加分类categories页" class="headerlink" title="添加分类categories页"></a>添加分类categories页</h3><p>(如果你的source目录没有<code>categories/index.md</code> 文件，那么就看以下步骤)</p><p>使用命令添加<code>categories</code>文件夹</p><pre><code>hexo new page &quot;categories&quot;</code></pre><p>然后在<code>categories</code>文件夹下添加<code>index.md</code>文件，并且至少添加内容，</p><pre><code>---title: categoriesdate: 2019-09-4 18:39.36type: &quot;categories&quot;layout: &quot;categories&quot;---</code></pre><p>然后在markdown文件的头部添加<code>categories</code>字段</p><p>例如</p><pre><code>---title: hello worldauthor: LYtags:    - Hexo    - githubcategories:    - hexo---</code></pre><p>效果如图:</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/08.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/09.png" alt=""></p><h3 id="新建关于我about页"><a href="#新建关于我about页" class="headerlink" title="新建关于我about页"></a>新建关于我about页</h3><p>(如果你的source目录没有<code>about/index.md</code> 文件，那么就看以下步骤)</p><p>使用命令添加<code>categories</code>文件夹</p><pre><code>hexo new page &quot;about&quot;</code></pre><p>然后在<code>about</code>文件夹下添加<code>index.md</code>文件，并且至少添加内容，</p><pre><code>---title: aboutdate: 2019-09-4 18:41.56type: &quot;about&quot;layout: &quot;about&quot;---</code></pre><p>效果截图:</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/11.png" alt=""></p><p>about页面的内容是可以通过<code>themes\hexo-theme-matery-1.0.1\_config.yml</code>来修改</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/12.png" alt=""></p><h3 id="新建友情连接-friends-页（可选的）"><a href="#新建友情连接-friends-页（可选的）" class="headerlink" title="新建友情连接 friends 页（可选的）"></a>新建友情连接 friends 页（可选的）</h3><p>如果在你的博客 <code>source</code> 目录下还没有 <code>friends/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><pre class=" language-bash"><code class="language-bash">hexo new page <span class="token string">"friends"</span></code></pre><p>然后在<code>friends</code>文件夹下添加<code>index.md</code>文件，并且至少添加内容，</p><pre class=" language-yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> friends<span class="token key atrule">date</span><span class="token punctuation">:</span> 2019<span class="token punctuation">-</span>09<span class="token punctuation">-</span>4 18<span class="token punctuation">:</span><span class="token number">45.36</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"friends"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"friends"</span><span class="token punctuation">---</span></code></pre><p>同时，在你的博客 <code>source</code> 目录下新建 <code>_data</code> 目录，在 <code>_data</code> 目录中新建 <code>friends.json</code> 文件，文件内容如下所示：</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">[</span><span class="token punctuation">{</span>    <span class="token property">"avatar"</span><span class="token operator">:</span> <span class="token string">"http://image.luokangyuan.com/1_qq_27922023.jpg"</span><span class="token punctuation">,</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"码酱"</span><span class="token punctuation">,</span>    <span class="token property">"introduction"</span><span class="token operator">:</span> <span class="token string">"我不是大佬，只是在追寻大佬的脚步"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://luokangyuan.com/"</span><span class="token punctuation">,</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"前去学习"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token property">"avatar"</span><span class="token operator">:</span> <span class="token string">"http://image.luokangyuan.com/4027734.jpeg"</span><span class="token punctuation">,</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"闪烁之狐"</span><span class="token punctuation">,</span>    <span class="token property">"introduction"</span><span class="token operator">:</span> <span class="token string">"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://blinkfox.github.io/"</span><span class="token punctuation">,</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"前去学习"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token property">"avatar"</span><span class="token operator">:</span> <span class="token string">"http://image.luokangyuan.com/avatar.jpg"</span><span class="token punctuation">,</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ja_rome"</span><span class="token punctuation">,</span>    <span class="token property">"introduction"</span><span class="token operator">:</span> <span class="token string">"平凡的脚步也可以走出伟大的行程"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"ttps://me.csdn.net/jlh912008548"</span><span class="token punctuation">,</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"前去学习"</span><span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><p><strong>文章还有一个description字段，是显示在主页的摘要，如果不填就是默认取内容的前70个字</strong></p><h2 id="Hexo-Theme-Matery主题的配置"><a href="#Hexo-Theme-Matery主题的配置" class="headerlink" title="Hexo-Theme-Matery主题的配置"></a>Hexo-Theme-Matery主题的配置</h2><p>Hexo-Theme-Matery主题的其他配置可以看他们的<a href="https://blinkfox.github.io/2018/09/28/qian-duan/hexo-bo-ke-zhu-ti-zhi-hexo-theme-matery-de-jie-shao/#toc-heading-1" target="_blank" rel="noopener">主题文档</a></p><p>如果要对Hexo-Theme-Matery主题进行个性化的修改的话，可以参考这个<a href="https://www.jianshu.com/p/2e6ae2123d57" target="_blank" rel="noopener">大神的文章</a></p><p>这里对上面主题修改的文章有说不明白的地方进行补充说明</p><h3 id="自定义每日一言"><a href="#自定义每日一言" class="headerlink" title="自定义每日一言"></a>自定义每日一言</h3><p>如果你不喜欢文章里面的每日一言，想换一个比如<a href="https://api.ooopn.com/ciba/api.php?type=json" target="_blank" rel="noopener">金山每日一言</a>那些的话，就直接在主题文件里面的hexo-theme-matery-1.0.1/layout/index.exj文件添加个ajax代码<br>例如:</p><pre><code>&lt;script&gt;(function () {        $.ajax({            url: &quot;https://api.ooopn.com/ciba/api.php?type=json&quot;,//向本地的json文件发送请求            type: &quot;GET&quot;,            success: function (data) {                ciba=data.ciba  #ciba就是你插入片段的id                document.getElementById(&quot;ciba&quot;).innerHTML=ciba            },            error: function (error) {                document.getElementById(&quot;ciba&quot;).innerHTML=error            }        })    })();&lt;/script&gt;</code></pre><h3 id="评论的gittalk配置"><a href="#评论的gittalk配置" class="headerlink" title="评论的gittalk配置"></a>评论的gittalk配置</h3><p>gittalk主题配置说明没有说清楚，我这里补充一下，因为主题配置说推荐gittalk，所以我这里也拿gittalk来说明</p><p>首先要申请github授权，<a href="https://github.com/settings/applications/new" target="_blank" rel="noopener">申请地址</a></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20200204131222.png" alt=""></p><ul><li>Application name：项目名，随便填</li><li>Homepage URL：博客地址，也就是要访问的地址，我的是<a href="https://373005226.github.io" target="_blank" rel="noopener">https://373005226.github.io</a></li><li>Application description：应用描述，这个随便填</li><li>Authorization callback URL:这个如果你有自己的域名就填自己的域名，没有就和上面的Homepage URL一样就好了</li></ul><p>输入完后会给你一个Client ID和Client Secret</p><p>打开主题配置文件的_config.yml，找到gittalk的这一行</p><pre><code>gitalk:  enable: true        #默认是false，改为true才可以开启评论  owner:             #这里是你的github用户名&#39;  repo:             #这里是你的博客地址  oauth:    clientId:         #刚刚申请的id    clientSecret:     #刚刚申请的密码  admin:             #一般都是你的github用户名了</code></pre><p>然后</p><pre><code>hexo cleanhexo ghexo d</code></pre><p>上传到你的博客就可以看到评论地址搞定了</p><h2 id="hexo的常见命令"><a href="#hexo的常见命令" class="headerlink" title="hexo的常见命令"></a>hexo的常见命令</h2><p>常见命令</p><pre><code>hexo new &quot;postName&quot; #新建文章hexo new page &quot;pageName&quot; #新建页面hexo generate #生成静态页面至public目录hexo server #开启预览访问端口（默认端口4000，&#39;ctrl + c&#39;关闭server）hexo deploy #部署到GitHubhexo help  # 查看帮助hexo version  #查看Hexo的版本</code></pre><p>缩写：</p><pre><code>hexo n == hexo newhexo g == hexo generatehexo s == hexo serverhexo d == hexo deploy</code></pre><p>组合命令：</p><pre><code>hexo s -g #生成并本地预览hexo d -g #生成并上传</code></pre><h2 id="将hexo博客部署到github上"><a href="#将hexo博客部署到github上" class="headerlink" title="将hexo博客部署到github上"></a>将hexo博客部署到github上</h2><p>首先要注册一个github账号，注册步骤就跳过了</p><p>新建一个仓库，名字格式最好如下:</p><p>账号名.github.io</p><p>比如我的账号是373005226，仓库的名字就是373005226.github.io</p><p>然后新建一个index.html文件，内容随便写，如图</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/13.png" alt=""></p><p>然后输入刚刚的仓库名就可以看到自己刚刚写的东西了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/14.png" alt=""></p><p>紧接着在博客源文件的_config.yml文件下修改如下字段:</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/15.png" alt=""></p><p>!!!格式要像我这样一样啊，或者填<a href="https://github.com/373005226/373005226.github.io.git" target="_blank" rel="noopener">https://github.com/373005226/373005226.github.io.git</a></p><p>然后再命令行输入这三行代码</p><pre><code>hexo cleanhexo ghexo d</code></pre><p>根据上述步骤就可以上传到github了</p><h2 id="自定义域名"><a href="#自定义域名" class="headerlink" title="自定义域名"></a>自定义域名</h2><p>github可以绑定自己买的域名</p><p>域名可以去各大服务商买，这里我用的是阿里云</p><p>购买完域名后，进入域名解析</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/16.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/17.png" alt=""></p><p>这里的记录值好像是不一定的，记录值就是你打开cmd命令行，ping 你的账号.github.io</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/18.png" alt=""></p><p>先使用<code>hexo d</code>上传好代码到github上之后，然后在github上新建一个CNAME(没有后缀)文件，里面填写你购买的域名(加不加www都可以)<br><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/19.png" alt=""></p><p>然后点击settings找到Github Pages填写自己的域名</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/21.png" alt=""></p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/hexo/22.png" alt=""></p><p>然后就可以绑定自己的域名了</p><h2 id="markdown图片的存储"><a href="#markdown图片的存储" class="headerlink" title="markdown图片的存储"></a>markdown图片的存储</h2><p>写markdown有时候本地编辑没问题，但是上传到服务器的图片有时候是失效的，所以最好图片之类的媒体资源放到<strong>腾讯云、七牛云</strong>等服务商上面。因为typora黏贴文件默认是在本地的，所以<code>hexo -s</code>一看图片都是失效的，这里我推荐使用<strong>腾讯云的OSS存储</strong>作为图片存储方法，<strong>腾讯云</strong>有免费的6个月给你使用，而且过了6个月的费用还不贵。这里我介绍一款自动上传到腾讯云等平台的软件：<code>picGo</code>，下载地址： <a href="https://github.com/Molunerfinn/PicGo/releases" target="_blank" rel="noopener">https://github.com/Molunerfinn/PicGo/releases</a> </p><p>如图，直接拖动图片就可以立即上传了</p><p><img src="https://txy-tc-ly-1256104767.cos.ap-guangzhou.myqcloud.com/20191025120326.png" alt=""></p><p>关于这个图床工具的使用，这篇博客有详细介绍： <a href="https://www.jianshu.com/p/9d91355e8418" target="_blank" rel="noopener">https://www.jianshu.com/p/9d91355e8418</a> </p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
